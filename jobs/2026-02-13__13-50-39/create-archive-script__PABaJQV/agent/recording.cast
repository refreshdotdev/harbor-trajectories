{"version": 2, "width": 160, "height": 40, "timestamp": 1771008650, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005687, "o", "\u001b[?2004hroot@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[0.972835, "i", "clear\r"]
[0.972942, "o", "clear\r\n\u001b[?2004l\r"]
[0.974125, "o", "\u001b[H\u001b[J"]
[0.974307, "o", "\u001b[?2004hroot@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[60.261517, "i", "mkdir -p /home/user/output /home/user/clean_configs\n"]
[60.261722, "o", "mkdir -p /home/user/output /home/user/clean_configs\r\n\u001b[?2004l\r"]
[60.264506, "o", "\u001b[?2004hroot@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[60.44018, "i", "REF_DATE=$(cat /home/user/reference_date.txt)\n"]
[60.440465, "o", "REF_DATE=$(cat /home/user/reference_date.txt)\r\n\u001b[?2004l\r"]
[60.441843, "o", "\u001b[?2004h"]
[60.441874, "o", "root@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[60.54547, "i", "find /home/user/configs -maxdepth 1 -name 'config_????????\\.conf' -print | while IFS= read -r filename; do file_date=$(echo \"${filename##*/}\" | sed -E 's/config_(........)\\.conf/\\\\1/'); if [ \"${file_date}\" \">\" \"${REF_DATE}\" ]; then echo \"Skipping future draft: ${filename}\" >&2; else echo \"${filename}\"; fi; done > /tmp/valid_files.txt\n"]
[60.546378, "o", "find /home/user/configs -maxdepth 1 -name 'config_????????\\.conf' -print | while IFS= read -r filename; do file_date=$(echo \"${filename##*/}\" | sed -E 's/config_(........)\\.conf/\\\\1/'); if [ \"${file_date}\" \">\" \"${REF_DATE}\" ]; then echo \"Skipping future draft: ${filename}\" >&2; else echo \"${filename}\"; fi; done > /tmp/valid_files.txt\r\n\u001b[?2004l\r"]
[60.549467, "o", "Skipping future draft: /home/user/configs/config_20230115.conf\r\n"]
[60.551057, "o", "Skipping future draft: /home/user/configs/config_20230410.conf\r\n"]
[60.553103, "o", "Skipping future draft: /home/user/configs/config_20230718.conf\r\n"]
[60.55506, "o", "Skipping future draft: /home/user/configs/config_20230901.conf\r\n"]
[60.555341, "o", "\u001b[?2004h"]
[60.555362, "o", "root@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[61.561339, "i", "if [ -s /tmp/valid_files.txt ]; then\n  echo \"Processing valid files...\"\n  # Part 1: Create sanitised files and extract all keys\n  echo -n > /home/user/output/all_keys.txt\n  while IFS= read -r fname; do\n    base_name=$(basename \"${fname}\")\n    # Sanitise file: key=value (no spaces), unquote values\n    awk -F= '{\n      gsub(/[[:space:]]+$/, \"\", $1); gsub(/^[[:space:]]+/, \"\", $1);\n      key = tolower($1);\n      if ($1 ~ /^[^#]/ && $1 != \"\") {\n        if (substr($2, 1, 1) == \"\\\"\") {\n          # Quoted value: extract content between quotes, strip outer quotes and trailing comments/whitespace after closing quote\n          gsub(/^\\\"[[:space:]]*|[[:space:]]*\\\"[^\\\"]*$/, \"\", $2);\n          print key \"=\" $2;\n        } else {\n          # Unquoted value: strip leading/trailing whitespace, remove comments\n          gsub(/^[[:space:]]+/, \"\", $2); gsub(/[[:space:]]+#.*$/, \"\", $2); gsub(/[[:space:]]+$/, \"\", $2);\n          if ($2 != \"\") print key \"=\" $2;\n        }\n      }\n    }' \"${fname}\" > \"/home/user/clean_configs/${base_na"]
[61.561459, "i", "me}\"\n    # Extract keys from sanitised file to accumulate all unique keys\n    awk -F= '{print tolower($1)}' \"/home/user/clean_configs/${base_name}\" | sort -u >> /home/user/output/all_keys.tmp\n  done < /tmp/valid_files.txt\n  # Sort and get unique keys for all_keys.txt\n  sort -u /home/user/output/all_keys.tmp > /home/user/output/all_keys.txt\n  rm /home/user/output/all_keys.tmp\n\n  # Part 2: Count active lines for config_line_counts.tsv\n  echo -n > /home/user/output/config_line_counts.tsv\n  while IFS= read -r fname; do\n    base_name=$(basename \"${fname}\")\n    count=$(grep -c '^[^=]' \"/home/user/clean_configs/${base_name}\") # Count non-blank, non-comment lines in sanitised file\n    echo -e \"${base_name}\\t${count}\" >> /tmp/line_counts_intermediate\n  done < /tmp/valid_files.txt\n  # Sort chronologically by original filename\n  sort -k1,1 /tmp/line_counts_intermediate > /home/user/output/config_line_counts.tsv\n  rm /tmp/line_counts_intermediate\n\n  # Part 3: Generate merged_config.csv\n  echo -n > /home/user/output/merge"]
[61.561494, "i", "d_config.csv\n  # Header\n  echo \"Key,Value,Source\" >> /home/user/output/merged_config.csv\n  # Process files from newest to oldest to get latest value\n  sort -r /tmp/valid_files.txt | while IFS= read -r fname; do\n    base_name=$(basename \"${fname}\")\n    awk -F= '!seen[tolower($1)]++ {print tolower($1), $2, \"'$base_name'\"}' OFS=, \"/home/user/clean_configs/${base_name}\"\n  done >> /home/user/output/merged_config.csv\n  # Sort alphabetically by Key\n  tail -n +2 /home/user/output/merged_config.csv | sort -t, -k1,1 | cat - /home/user/output/merged_config.csv | head -1 > /tmp/merged_config_final.csv\n  mv /tmp/merged_config_final.csv /home/user/output/merged_config.csv\n\n  # Part 4: Generate new_keys.log\n  if [ $(wc -l < /tmp/valid_files.txt) -ge 2 ]; then\n    newest_file=$(sort -r /tmp/valid_files.txt | head -1)\n    oldest_file=$(sort /tmp/valid_files.txt | head -1)\n    newest_keys=$(awk -F= '{print tolower($1)}' \"/home/user/clean_configs/$(basename ${newest_file})\" | sort -u)\n    oldest_keys=$(awk -F= '{print tolower($"]
[61.561525, "i", "1)}' \"/home/user/clean_configs/$(basename ${oldest_file})\" | sort -u)\n    comm -23 <(echo \"${newest_keys}\") <(echo \"${oldest_keys}\") > /home/user/output/new_keys.log\n  elif [ $(wc -l < /tmp/valid_files.txt) -eq 1 ]; then\n    # If only one file, all its keys are 'new' relative to a non-existent older file\n    newest_file=$(head -1 /tmp/valid_files.txt)\n    newest_keys=$(awk -F= '{print tolower($1)}' \"/home/user/clean_configs/$(basename ${newest_file})\" | sort -u)\n    echo \"${newest_keys}\" > /home/user/output/new_keys.log\n  else\n    echo \"\" > /home/user/output/new_keys.log # No valid files or only one, result is empty for comm logic\n  fi\n  echo \"Processing complete.\"\nelse\n  echo \"No valid configuration files found relative to reference date ${REF_DATE}.\"\n  echo \"\" > /home/user/output/config_line_counts.tsv\n  echo \"\" > /home/user/output/all_keys.txt\n  echo \"\" > /home/user/output/new_keys.log\n  echo \"Key,Value,Source\" > /home/user/output/merged_config.csv\nfi\nrm -f /tmp/valid_files.txt\n"]
[61.56165, "o", "if [ -s /tmp/valid_files.txt ]; then\r\n\u001b[?2004l\r"]
[61.56172, "o", "\u001b[?2004h"]
[61.561776, "o", "> "]
[61.561945, "o", "  echo \"Processing valid files...\"\r\n\u001b[?2004l\r"]
[61.561975, "o", "\u001b[?2004h"]
[61.562002, "o", "> "]
[61.562321, "o", "  # Part 1: Create sanitised files and extract all keys\r\n\u001b[?2004l\r"]
[61.562356, "o", "\u001b[?2004h"]
[61.562385, "o", "> "]
[61.562635, "o", "  echo -n > /home/user/output/all_keys.txt\r\n\u001b[?2004l\r"]
[61.562666, "o", "\u001b[?2004h"]
[61.562696, "o", "> "]
[61.562879, "o", "  while IFS= read -r fname; do\r\n\u001b[?2004l\r"]
[61.562917, "o", "\u001b[?2004h"]
[61.562954, "o", "> "]
[61.563151, "o", "    base_name=$(basename \"${fname}\")\r\n\u001b[?2004l\r"]
[61.563181, "o", "\u001b[?2004h"]
[61.563204, "o", "> "]
[61.563561, "o", "    # Sanitise file: key=value (no spaces), unquote values\r\n\u001b[?2004l\r"]
[61.563592, "o", "\u001b[?2004h> "]
[61.563687, "o", "    awk -F= '{\r\n\u001b[?2004l\r"]
[61.563733, "o", "\u001b[?2004h"]
[61.563752, "o", "> "]
[61.564152, "o", "      gsub(/[[:space:]]+$/, \"\", $1); gsub(/^[[:space:]]+/, \"\", $1);\r\n\u001b[?2004l\r"]
[61.564202, "o", "\u001b[?2004h> "]
[61.564353, "o", "      key = tolower($1);\r\n\u001b[?2004l\r"]
[61.564388, "o", "\u001b[?2004h> "]
[61.564622, "o", "      if ($1 ~ /^[^#]/ && $1 != \"\") {\r\n\u001b[?2004l\r"]
[61.56465, "o", "\u001b[?2004h"]
[61.564676, "o", "> "]
[61.564903, "o", "        if (substr($2, 1, 1) == \"\\\"\") {\r\n\u001b[?2004l\r"]
[61.564937, "o", "\u001b[?2004h"]
[61.564966, "o", "> "]
[61.565699, "o", "          # Quoted value: extract content between quotes, strip outer quotes and trailing comments/whitespace after closing quote\r\n\u001b[?2004l\r"]
[61.565739, "o", "\u001b[?2004h"]
[61.565769, "o", "> "]
[61.56613, "o", "          gsub(/^\\\"[[:space:]]*|[[:space:]]*\\\"[^\\\"]*$/, \"\", $2);\r\n\u001b[?2004l\r"]
[61.566175, "o", "\u001b[?2004h"]
[61.566211, "o", "> "]
[61.566354, "o", "          print key \"=\" $2;\r\n\u001b[?2004l\r"]
[61.566391, "o", "\u001b[?2004h"]
[61.566427, "o", "> "]
[61.566512, "o", "        } else {\r\n\u001b[?2004l\r"]
[61.566562, "o", "\u001b[?2004h> "]
[61.567025, "o", "          # Unquoted value: strip leading/trailing whitespace, remove comments\r\n\u001b[?2004l\r"]
[61.567068, "o", "\u001b[?2004h> "]
[61.567692, "o", "          gsub(/^[[:space:]]+/, \"\", $2); gsub(/[[:space:]]+#.*$/, \"\", $2); gsub(/[[:space:]]+$/, \"\", $2);\r\n\u001b[?2004l\r"]
[61.567736, "o", "\u001b[?2004h"]
[61.567771, "o", "> "]
[61.567989, "o", "          if ($2 != \"\") print key \"=\" $2;\r\n\u001b[?2004l\r"]
[61.568036, "o", "\u001b[?2004h"]
[61.568061, "o", "> "]
[61.568114, "o", "        }\r\n\u001b[?2004l\r"]
[61.568156, "o", "\u001b[?2004h> "]
[61.568215, "o", "      }\r\n\u001b[?2004l\r"]
[61.568253, "o", "\u001b[?2004h> "]
[61.568614, "o", "    }' \"${fname}\" > \"/home/user/clean_configs/${base_name}\"\r\n\u001b[?2004l\r"]
[61.568663, "o", "\u001b[?2004h"]
[61.568689, "o", "> "]
[61.569072, "o", "    # Extract keys from sanitised file to accumulate all unique keys\r\n\u001b[?2004l\r"]
[61.56911, "o", "\u001b[?2004h"]
[61.569136, "o", "> "]
[61.569803, "o", "    awk -F= '{print tolower($1)}' \"/home/user/clean_configs/${base_name}\" | sort -u >> /home/user/output/all_keys.tmp\r\n\u001b[?2004l\r"]
[61.569862, "o", "\u001b[?2004h"]
[61.569887, "o", "> "]
[61.57005, "o", "  done < /tmp/valid_files.txt\r\n\u001b[?2004l\r"]
[61.570096, "o", "\u001b[?2004h> "]
[61.570371, "o", "  # Sort and get unique keys for all_keys.txt\r\n\u001b[?2004l\r"]
[61.570402, "o", "\u001b[?2004h"]
[61.570438, "o", "> "]
[61.570854, "o", "  sort -u /home/user/output/all_keys.tmp > /home/user/output/all_keys.txt\r\n\u001b[?2004l\r"]
[61.570908, "o", "\u001b[?2004h> "]
[61.571123, "o", "  rm /home/user/output/all_keys.tmp\r\n\u001b[?2004l\r"]
[61.571156, "o", "\u001b[?2004h"]
[61.571181, "o", "> \r\n\u001b[?2004l\r"]
[61.571218, "o", "\u001b[?2004h"]
[61.571243, "o", "> "]
[61.571584, "o", "  # Part 2: Count active lines for config_line_counts.tsv\r\n\u001b[?2004l\r"]
[61.571616, "o", "\u001b[?2004h"]
[61.571645, "o", "> "]
[61.571934, "o", "  echo -n > /home/user/output/config_line_counts.tsv\r\n\u001b[?2004l\r"]
[61.571977, "o", "\u001b[?2004h"]
[61.572012, "o", "> "]
[61.572173, "o", "  while IFS= read -r fname; do\r\n\u001b[?2004l\r"]
[61.572226, "o", "\u001b[?2004h"]
[61.572257, "o", "> "]
[61.572453, "o", "    base_name=$(basename \"${fname}\")\r\n\u001b[?2004l\r"]
[61.57249, "o", "\u001b[?2004h"]
[61.572525, "o", "> "]
[61.573236, "o", "    count=$(grep -c '^[^=]' \"/home/user/clean_configs/${base_name}\") # Count non-blank, non-comment lines in sanitised file\r\n\u001b[?2004l\r"]
[61.573287, "o", "\u001b[?2004h"]
[61.573321, "o", "> "]
[61.573727, "o", "    echo -e \"${base_name}\\t${count}\" >> /tmp/line_counts_intermediate\r\n\u001b[?2004l\r"]
[61.573764, "o", "\u001b[?2004h"]
[61.5738, "o", "> "]
[61.573971, "o", "  done < /tmp/valid_files.txt\r\n\u001b[?2004l\r"]
[61.57401, "o", "\u001b[?2004h"]
[61.574031, "o", "> "]
[61.574316, "o", "  # Sort chronologically by original filename\r\n\u001b[?2004l\r"]
[61.574384, "o", "\u001b[?2004h> "]
[61.574924, "o", "  sort -k1,1 /tmp/line_counts_intermediate > /home/user/output/config_line_counts.tsv\r\n\u001b[?2004l\r"]
[61.574966, "o", "\u001b[?2004h"]
[61.57499, "o", "> "]
[61.575203, "o", "  rm /tmp/line_counts_intermediate\r\n"]
[61.575226, "o", "\u001b[?2004l\r"]
[61.575264, "o", "\u001b[?2004h"]
[61.575291, "o", "> \r\n\u001b[?2004l\r"]
[61.575318, "o", "\u001b[?2004h> "]
[61.575577, "o", "  # Part 3: Generate merged_config.csv\r\n"]
[61.575606, "o", "\u001b[?2004l\r\u001b[?2004h"]
[61.57563, "o", "> "]
[61.57585, "o", "  echo -n > /home/user/output/merged_config.csv\r\n\u001b[?2004l\r"]
[61.575888, "o", "\u001b[?2004h"]
[61.575912, "o", "> "]
[61.575952, "o", "  # Header\r\n"]
[61.575974, "o", "\u001b[?2004l\r\u001b[?2004h"]
[61.576, "o", "> "]
[61.576298, "o", "  echo \"Key,Value,Source\" >> /home/user/output/merged_config.csv\r\n\u001b[?2004l\r"]
[61.576332, "o", "\u001b[?2004h"]
[61.576355, "o", "> "]
[61.576641, "o", "  # Process files from newest to oldest to get latest value\r\n\u001b[?2004l\r"]
[61.576665, "o", "\u001b[?2004h"]
[61.576692, "o", "> "]
[61.576972, "o", "  sort -r /tmp/valid_files.txt | while IFS= read -r fname; do\r\n\u001b[?2004l\r"]
[61.57701, "o", "\u001b[?2004h"]
[61.577035, "o", "> "]
[61.577197, "o", "    base_name=$(basename \"${fname}\")\r\n\u001b[?2004l\r"]
[61.577229, "o", "\u001b[?2004h"]
[61.577252, "o", "> "]
[61.577821, "o", "    awk -F= '!seen[tolower($1)]++ {print tolower($1), $2, \"'$base_name'\"}' OFS=, \"/home/user/clean_configs/${base_name}\"\r\n\u001b[?2004l\r"]
[61.577868, "o", "\u001b[?2004h> "]
[61.57809, "o", "  done >> /home/user/output/merged_config.csv\r\n\u001b[?2004l\r"]
[61.578129, "o", "\u001b[?2004h"]
[61.578154, "o", "> "]
[61.578295, "o", "  # Sort alphabetically by Key\r\n\u001b[?2004l\r"]
[61.578323, "o", "\u001b[?2004h"]
[61.578346, "o", "> "]
[61.579052, "o", "  tail -n +2 /home/user/output/merged_config.csv | sort -t, -k1,1 | cat - /home/user/output/merged_config.csv | head -1 > /tmp/merged_config_final.csv\r\n\u001b[?2004l\r"]
[61.579092, "o", "\u001b[?2004h"]
[61.579119, "o", "> "]
[61.579436, "o", "  mv /tmp/merged_config_final.csv /home/user/output/merged_config.csv\r\n\u001b[?2004l\r"]
[61.57947, "o", "\u001b[?2004h"]
[61.579493, "o", "> \r\n\u001b[?2004l\r"]
[61.579519, "o", "\u001b[?2004h"]
[61.579552, "o", "> "]
[61.579701, "o", "  # Part 4: Generate new_keys.log\r\n\u001b[?2004l\r"]
[61.579728, "o", "\u001b[?2004h"]
[61.579751, "o", "> "]
[61.579993, "o", "  if [ $(wc -l < /tmp/valid_files.txt) -ge 2 ]; then\r\n\u001b[?2004l\r"]
[61.58003, "o", "\u001b[?2004h"]
[61.580055, "o", "> "]
[61.580318, "o", "    newest_file=$(sort -r /tmp/valid_files.txt | head -1)\r\n\u001b[?2004l\r"]
[61.580352, "o", "\u001b[?2004h"]
[61.580374, "o", "> "]
[61.580636, "o", "    oldest_file=$(sort /tmp/valid_files.txt | head -1)\r\n\u001b[?2004l\r"]
[61.580666, "o", "\u001b[?2004h"]
[61.580689, "o", "> "]
[61.581209, "o", "    newest_keys=$(awk -F= '{print tolower($1)}' \"/home/user/clean_configs/$(basename ${newest_file})\" | sort -u)\r\n\u001b[?2004l\r"]
[61.581257, "o", "\u001b[?2004h"]
[61.581279, "o", "> "]
[61.58181, "o", "    oldest_keys=$(awk -F= '{print tolower($1)}' \"/home/user/clean_configs/$(basename ${oldest_file})\" | sort -u)\r\n\u001b[?2004l\r"]
[61.581856, "o", "\u001b[?2004h"]
[61.581879, "o", "> "]
[61.582319, "o", "    comm -23 <(echo \"${newest_keys}\") <(echo \"${oldest_keys}\") > /home/user/output/new_keys.log\r\n\u001b[?2004l\r"]
[61.58236, "o", "\u001b[?2004h"]
[61.582382, "o", "> "]
[61.582649, "o", "  elif [ $(wc -l < /tmp/valid_files.txt) -eq 1 ]; then\r\n\u001b[?2004l\r"]
[61.582687, "o", "\u001b[?2004h"]
[61.582711, "o", "> "]
[61.583151, "o", "    # If only one file, all its keys are 'new' relative to a non-existent older file\r\n\u001b[?2004l\r"]
[61.583185, "o", "\u001b[?2004h"]
[61.583209, "o", "> "]
[61.583419, "o", "    newest_file=$(head -1 /tmp/valid_files.txt)\r\n\u001b[?2004l\r"]
[61.58345, "o", "\u001b[?2004h"]
[61.583475, "o", "> "]
[61.584006, "o", "    newest_keys=$(awk -F= '{print tolower($1)}' \"/home/user/clean_configs/$(basename ${newest_file})\" | sort -u)\r\n\u001b[?2004l\r"]
[61.58405, "o", "\u001b[?2004h"]
[61.584075, "o", "> "]
[61.584344, "o", "    echo \"${newest_keys}\" > /home/user/output/new_keys.log\r\n\u001b[?2004l\r"]
[61.584378, "o", "\u001b[?2004h"]
[61.584401, "o", "> "]
[61.584431, "o", "  else\r\n\u001b[?2004l\r"]
[61.584463, "o", "\u001b[?2004h"]
[61.584486, "o", "> "]
[61.584986, "o", "    echo \"\" > /home/user/output/new_keys.log # No valid files or only one, result is empty for comm logic\r\n\u001b[?2004l\r"]
[61.585019, "o", "\u001b[?2004h"]
[61.585042, "o", "> "]
[61.585063, "o", "  fi\r\n\u001b[?2004l\r"]
[61.585088, "o", "\u001b[?2004h"]
[61.585112, "o", "> "]
[61.585249, "o", "  echo \"Processing complete.\"\r\n\u001b[?2004l\r"]
[61.585277, "o", "\u001b[?2004h"]
[61.5853, "o", "> "]
[61.585326, "o", "else\r\n\u001b[?2004l\r"]
[61.585353, "o", "\u001b[?2004h"]
[61.585378, "o", "> "]
[61.585777, "o", "  echo \"No valid configuration files found relative to reference date ${REF_DATE}.\"\r\n\u001b[?2004l\r"]
[61.585812, "o", "\u001b[?2004h"]
[61.58584, "o", "> "]
[61.586076, "o", "  echo \"\" > /home/user/output/config_line_counts.tsv\r\n\u001b[?2004l\r"]
[61.586107, "o", "\u001b[?2004h"]
[61.58613, "o", "> "]
[61.586324, "o", "  echo \"\" > /home/user/output/all_keys.txt\r\n\u001b[?2004l\r"]
[61.586356, "o", "\u001b[?2004h"]
[61.586383, "o", "> "]
[61.586589, "o", "  echo \"\" > /home/user/output/new_keys.log\r\n\u001b[?2004l\r"]
[61.586619, "o", "\u001b[?2004h"]
[61.586643, "o", "> "]
[61.586944, "o", "  echo \"Key,Value,Source\" > /home/user/output/merged_config.csv\r\n\u001b[?2004l\r"]
[61.586977, "o", "\u001b[?2004h"]
[61.586999, "o", "> "]
[61.587022, "o", "fi\r\n\u001b[?2004l\r"]
[61.587069, "o", "No valid configuration files found relative to reference date 20230801.\r\n"]
[61.587506, "o", "\u001b[?2004h"]
[61.587528, "o", "root@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
[61.587673, "o", "rm -f /tmp/valid_files.txt\r\n\u001b[?2004l\r"]
[61.589336, "o", "\u001b[?2004h"]
[61.58937, "o", "root@3f03e93d-b991-42f0-b4b7-0065c089c621:~# "]
