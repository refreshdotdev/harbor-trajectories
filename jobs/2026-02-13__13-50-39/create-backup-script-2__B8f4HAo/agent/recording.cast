{"version": 2, "width": 160, "height": 40, "timestamp": 1771009777, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.008875, "o", "\u001b[?2004hroot@74a8d03f-6e18-4e29-8314-82f247838732:~# "]
[0.989249, "i", "clear\r"]
[0.989416, "o", "clear\r\n\u001b[?2004l\r"]
[0.990292, "o", "\u001b[H\u001b[J"]
[0.99043, "o", "\u001b[?2004hroot@74a8d03f-6e18-4e29-8314-82f247838732:~# "]
[15.308142, "i", "cd /home/user/hardening_test\n"]
[15.308424, "o", "cd /home/user/hardening_test\r\n\u001b[?2004l\r"]
[15.308666, "o", "\u001b[?2004hroot@74a8d03f-6e18-4e29-8314-82f247838732:/home/user/hardening_test# "]
[15.424162, "i", "pwd\n"]
[15.424364, "o", "pwd\r\n\u001b[?2004l\r"]
[15.424446, "o", "/home/user/hardening_test\r\n"]
[15.424505, "o", "\u001b[?2004h"]
[15.424553, "o", "root@74a8d03f-6e18-4e29-8314-82f247838732:/home/user/hardening_test# "]
[29.196624, "i", "ls -la\n"]
[29.196753, "o", "ls -la\r\n\u001b[?2004l\r"]
[29.197864, "o", "total 16\r\n"]
[29.197917, "o", "drwxr-xr-x 1 root root  99 Feb 13 18:50 \u001b[0m\u001b[01;34m.\u001b[0m\r\ndrwxr-xr-x 1 root root  36 Feb 13 18:50 \u001b[01;34m..\u001b[0m\r\n-rw-r--r-- 1 root root 160 Feb 13 18:50 login.defs\r\n-rw-r--r-- 1 root root 150 Feb 13 18:50 rules.txt\r\n-rw-r--r-- 1 root root 211 Feb 13 18:50 sshd_config\r\n-rw-r--r-- 1 root root  83 Feb 13 18:50 sysctl.conf\r\n"]
[29.198111, "o", "\u001b[?2004hroot@74a8d03f-6e18-4e29-8314-82f247838732:/home/user/hardening_test# "]
[29.326478, "i", "if [ -f apply_hardening.sh ]; then cp apply_hardening.sh apply_hardening.sh.bak; fi\n"]
[29.326721, "o", "if [ -f apply_hardening.sh ]; then cp apply_hardening.sh apply_hardening.sh.bak; fi\r\n\u001b[?2004l\r"]
[29.326797, "o", "\u001b[?2004hroot@74a8d03f-6e18-4e29-8314-82f247838732:/home/user/hardening_test# "]
[61.603984, "i", "cat > apply_hardening.sh << 'EOF'\n#!/bin/sh\n\n# POSIX-sh compatible hardening automation script\n\n# Initialize empty log file and clear any previous log\n> hardening.log\n\n# Function to add entry to sorted log file\nlog_entry() {\n    file=$1\n    action=$2\n    echo \"$file:$action\" >> hardening.log\n}\n\n# Process rules from rules.txt\nwhile IFS=\"|\" read -r filename search_pattern enforced_line; do\n    # Skip empty lines or lines starting with #\n    if [ -z \"$filename\" ] || [ \"${filename:0:1}\" = \"#\" ]; then\n        continue\n    fi\n    \n    # Safety backup: create .bak if not exists\n    if [ ! -f \"${filename}.bak\" ]; then\n        cp \"$filename\" \"${filename}.bak\"\n    fi\n    \n    # Check if enforced_line already exists (exact line match)\n    if grep -Fxq \"$enforced_line\" \"$filename\"; then\n        log_entry \"$filename\" \"SKIPPED\"\n        chmod 0600 \"$filename\"\n        continue\n    fi\n    \n    # Check if search_pattern exists in file\n    if grep -q \"$search_pattern\" \"$filename\"; then\n        # In-place repair: replace first m"]
[61.604051, "i", "atching line with enforced_line\n        # Using temporary file for atomic replacement\n        temp_file=\"${filename}.tmp\"\n        line_number=$(grep -Fn \"$search_pattern\" \"$filename\" | cut -d: -f1 | head -n1)\n        sed \"${line_number}s|.*|${enforced_line}|\" \"$filename\" > \"$temp_file\"\n        # Preserve original file permissions before replacement\n        permissions=$(stat -c \"%a\" \"$filename\")\n        mv -f \"$temp_file\" \"$filename\"\n        chmod \"${permissions}\" \"$filename\"\n        log_entry \"$filename\" \"REPAIRED\"\n    else\n        # Append enforced_line if search_pattern not found\n        echo \"$enforced_line\" >> \"$filename\"\n        log_entry \"$filename\" \"APPENDED\"\n    fi\n    \n    # Enforce strict permissions after processing\n    if [ \"$filename\" = \"sshd_config\" ]; then\n        chmod 0600 \"$filename\"\n    else\n        chmod 0644 \"$filename\"\n    fi\n\ndone < rules.txt\n\n# Sort the log file alphabetically by filename\nsort -o hardening.log hardening.log\n\n# User feedback\necho \"Hardening completed\"\nEOF"]
[61.604246, "o", "cat > apply_hardening.sh << 'EOF'\r\n\u001b[?2004l\r"]
[61.604313, "o", "\u001b[?2004h"]
[61.604354, "o", "> "]
[61.604398, "o", "#!/bin/sh\r\n\u001b[?2004l\r"]
[61.604435, "o", "\u001b[?2004h"]
[61.60447, "o", "> \r\n\u001b[?2004l\r"]
[61.604506, "o", "\u001b[?2004h> "]
[61.604817, "o", "# POSIX-sh compatible hardening automation script\r\n\u001b[?2004l\r"]
[61.604867, "o", "\u001b[?2004h> "]
[61.604907, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[61.604944, "o", "> "]
[61.605255, "o", "# Initialize empty log file and clear any previous log\r\n\u001b[?2004l\r"]
[61.605294, "o", "\u001b[?2004h"]
[61.605338, "o", "> "]
[61.605403, "o", "> hardening.log\r\n\u001b[?2004l\r"]
[61.605438, "o", "\u001b[?2004h"]
[61.605472, "o", "> \r\n\u001b[?2004l\r"]
[61.605506, "o", "\u001b[?2004h> "]
[61.605775, "o", "# Function to add entry to sorted log file\r\n\u001b[?2004l\r"]
[61.605831, "o", "\u001b[?2004h"]
[61.605865, "o", "> "]
[61.605943, "o", "log_entry() {\r\n\u001b[?2004l\r"]
[61.605978, "o", "\u001b[?2004h"]
[61.606015, "o", "> "]
[61.60607, "o", "    file=$1\r\n\u001b[?2004l\r"]
[61.606116, "o", "\u001b[?2004h"]
[61.606149, "o", "> "]
[61.606219, "o", "    action=$2\r\n\u001b[?2004l\r"]
[61.606253, "o", "\u001b[?2004h"]
[61.606286, "o", "> "]
[61.606521, "o", "    echo \"$file:$action\" >> hardening.log\r\n\u001b[?2004l\r"]
[61.606566, "o", "\u001b[?2004h> "]
[61.6066, "o", "}\r\n\u001b[?2004l\r"]
[61.606634, "o", "\u001b[?2004h> "]
[61.606668, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[61.606705, "o", "> "]
[61.606896, "o", "# Process rules from rules.txt\r\n\u001b[?2004l\r"]
[61.606926, "o", "\u001b[?2004h"]
[61.606957, "o", "> "]
[61.60732, "o", "while IFS=\"|\" read -r filename search_pattern enforced_line; do\r\n\u001b[?2004l\r"]
[61.607356, "o", "\u001b[?2004h"]
[61.60739, "o", "> "]
[61.607657, "o", "    # Skip empty lines or lines starting with #\r\n\u001b[?2004l\r"]
[61.607697, "o", "\u001b[?2004h"]
[61.607741, "o", "> "]
[61.608096, "o", "    if [ -z \"$filename\" ] || [ \"${filename:0:1}\" = \"#\" ]; then\r\n\u001b[?2004l\r"]
[61.608131, "o", "\u001b[?2004h"]
[61.608165, "o", "> "]
[61.608248, "o", "        continue\r\n\u001b[?2004l\r"]
[61.608282, "o", "\u001b[?2004h"]
[61.608316, "o", "> "]
[61.608356, "o", "    fi\r\n\u001b[?2004l\r"]
[61.608389, "o", "\u001b[?2004h> "]
[61.608432, "o", "    \r\n\u001b[?2004l\r"]
[61.608465, "o", "\u001b[?2004h"]
[61.608501, "o", "> "]
[61.608758, "o", "    # Safety backup: create .bak if not exists\r\n\u001b[?2004l\r"]
[61.608793, "o", "\u001b[?2004h"]
[61.608837, "o", "> "]
[61.609057, "o", "    if [ ! -f \"${filename}.bak\" ]; then\r\n\u001b[?2004l\r"]
[61.609115, "o", "\u001b[?2004h> "]
[61.60937, "o", "        cp \"$filename\" \"${filename}.bak\"\r\n\u001b[?2004l\r"]
[61.609412, "o", "\u001b[?2004h> "]
[61.609464, "o", "    fi\r\n\u001b[?2004l\r"]
[61.609502, "o", "\u001b[?2004h"]
[61.609535, "o", "> "]
[61.609584, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h"]
[61.609621, "o", "> "]
[61.609985, "o", "    # Check if enforced_line already exists (exact line match)\r\n\u001b[?2004l\r"]
[61.610016, "o", "\u001b[?2004h"]
[61.610047, "o", "> "]
[61.610341, "o", "    if grep -Fxq \"$enforced_line\" \"$filename\"; then\r\n\u001b[?2004l\r"]
[61.610378, "o", "\u001b[?2004h"]
[61.610413, "o", "> "]
[61.610631, "o", "        log_entry \"$filename\" \"SKIPPED\"\r\n\u001b[?2004l\r"]
[61.610665, "o", "\u001b[?2004h"]
[61.610701, "o", "> "]
[61.610876, "o", "        chmod 0600 \"$filename\"\r\n\u001b[?2004l\r"]
[61.61092, "o", "\u001b[?2004h"]
[61.610954, "o", "> "]
[61.611032, "o", "        continue\r\n\u001b[?2004l\r"]
[61.611082, "o", "\u001b[?2004h> "]
[61.611133, "o", "    fi\r\n\u001b[?2004l\r"]
[61.611167, "o", "\u001b[?2004h"]
[61.611201, "o", "> "]
[61.611235, "o", "    \r\n\u001b[?2004l\r"]
[61.611269, "o", "\u001b[?2004h> "]
[61.611552, "o", "    # Check if search_pattern exists in file\r\n\u001b[?2004l\r"]
[61.611615, "o", "\u001b[?2004h> "]
[61.611902, "o", "    if grep -q \"$search_pattern\" \"$filename\"; then\r\n\u001b[?2004l\r"]
[61.611959, "o", "\u001b[?2004h> "]
[61.612409, "o", "        # In-place repair: replace first matching line with enforced_line\r\n\u001b[?2004l\r"]
[61.612454, "o", "\u001b[?2004h> "]
[61.612774, "o", "        # Using temporary file for atomic replacement\r\n\u001b[?2004l\r"]
[61.612824, "o", "\u001b[?2004h"]
[61.612867, "o", "> "]
[61.613054, "o", "        temp_file=\"${filename}.tmp\"\r\n\u001b[?2004l\r"]
[61.613097, "o", "\u001b[?2004h"]
[61.61314, "o", "> "]
[61.613614, "o", "        line_number=$(grep -Fn \"$search_pattern\" \"$filename\" | cut -d: -f1 | head -n1)\r\n\u001b[?2004l\r"]
[61.613658, "o", "\u001b[?2004h> "]
[61.614131, "o", "        sed \"${line_number}s|.*|${enforced_line}|\" \"$filename\" > \"$temp_file\"\r\n\u001b[?2004l\r"]
[61.614172, "o", "\u001b[?2004h> "]
[61.614558, "o", "        # Preserve original file permissions before replacement\r\n\u001b[?2004l\r"]
[61.614593, "o", "\u001b[?2004h"]
[61.614637, "o", "> "]
[61.614902, "o", "        permissions=$(stat -c \"%a\" \"$filename\")\r\n\u001b[?2004l\r"]
[61.61494, "o", "\u001b[?2004h"]
[61.614982, "o", "> "]
[61.61519, "o", "        mv -f \"$temp_file\" \"$filename\"\r\n\u001b[?2004l\r"]
[61.615224, "o", "\u001b[?2004h"]
[61.615263, "o", "> "]
[61.615493, "o", "        chmod \"${permissions}\" \"$filename\"\r\n\u001b[?2004l\r"]
[61.615535, "o", "\u001b[?2004h> "]
[61.615787, "o", "        log_entry \"$filename\" \"REPAIRED\"\r\n\u001b[?2004l\r"]
[61.615839, "o", "\u001b[?2004h"]
[61.61587, "o", "> "]
[61.615926, "o", "    else\r\n\u001b[?2004l\r"]
[61.615968, "o", "\u001b[?2004h> "]
[61.616304, "o", "        # Append enforced_line if search_pattern not found\r\n\u001b[?2004l\r"]
[61.616345, "o", "\u001b[?2004h> "]
[61.61662, "o", "        echo \"$enforced_line\" >> \"$filename\"\r\n\u001b[?2004l\r"]
[61.616663, "o", "\u001b[?2004h"]
[61.616724, "o", "> "]
[61.616918, "o", "        log_entry \"$filename\" \"APPENDED\"\r\n\u001b[?2004l\r"]
[61.616962, "o", "\u001b[?2004h> "]
[61.61701, "o", "    fi\r\n\u001b[?2004l\r"]
[61.617057, "o", "\u001b[?2004h> "]
[61.617102, "o", "    \r\n\u001b[?2004l\r"]
[61.617145, "o", "\u001b[?2004h> "]
[61.617464, "o", "    # Enforce strict permissions after processing\r\n\u001b[?2004l\r"]
[61.617505, "o", "\u001b[?2004h> "]
[61.617765, "o", "    if [ \"$filename\" = \"sshd_config\" ]; then\r\n\u001b[?2004l\r"]
[61.617816, "o", "\u001b[?2004h"]
[61.6179, "o", "> "]
[61.618016, "o", "        chmod 0600 \"$filename\"\r\n\u001b[?2004l\r"]
[61.618062, "o", "\u001b[?2004h"]
[61.618112, "o", ">     else\r\n"]
[61.618157, "o", "\u001b[?2004l\r\u001b[?2004h"]
[61.618201, "o", "> "]
[61.618365, "o", "        chmod 0644 \"$filename\"\r\n\u001b[?2004l\r"]
[61.618407, "o", "\u001b[?2004h> "]
[61.618452, "o", "    fi\r\n\u001b[?2004l\r"]
[61.618497, "o", "\u001b[?2004h> "]
[61.618542, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[61.618588, "o", "> "]
[61.61866, "o", "done < rules.txt\r\n\u001b[?2004l\r"]
[61.618695, "o", "\u001b[?2004h"]
[61.618745, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[61.61879, "o", "> "]
[61.619064, "o", "# Sort the log file alphabetically by filename\r\n\u001b[?2004l\r"]
[61.619106, "o", "\u001b[?2004h> "]
[61.619334, "o", "sort -o hardening.log hardening.log\r\n\u001b[?2004l\r"]
[61.619376, "o", "\u001b[?2004h> "]
[61.619422, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[61.619476, "o", "> "]
[61.61954, "o", "# User feedback\r\n\u001b[?2004l\r"]
[61.619586, "o", "\u001b[?2004h"]
[61.619631, "o", "> "]
[61.619755, "o", "echo \"Hardening completed\"\r\n\u001b[?2004l\r"]
[61.619796, "o", "\u001b[?2004h> "]
[61.619837, "o", "EOF"]
[61.746567, "i", "chmod +x apply_hardening.sh\n"]
[61.746839, "o", "chmod +x apply_hardening.sh\r\n\u001b[?2004l\r"]
[61.746899, "o", "\u001b[?2004h> "]
