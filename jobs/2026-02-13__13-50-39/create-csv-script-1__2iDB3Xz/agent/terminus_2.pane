[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# clear
[?2004l[H[J[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# ls -la /etc/finops/
[?2004ltotal 0
drwxr-xr-x 1 root root 24 Feb 13 18:51 [0m[01;34m.[0m
drwxr-xr-x 1 root root 51 Feb 13 18:56 [01;34m..[0m
-rw-r--r-- 1 root root  0 Feb 13 18:51 policy.ini
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# cat /etc/finops/policy.ini
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# mkdir -p /etc/finops
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# cat > /etc/finops/policy.ini << 'EOF'
[?2004l[?2004h> filename_pattern=^.*\.csv$
[?2004l[?2004h> min_size_bytes=1024
[?2004l[?2004h> date_header_pattern=^Report Generated on: (.*?)$
[?2004l[?2004h> EOF
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user# cd /home/user/cloud_costs
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la
[?2004ltotal 0
drwxr-xr-x 1 root root  50 Feb 13 18:51 [0m[01;34m.[0m
drwxr-xr-x 1 root root  33 Feb 13 18:50 [01;34m..[0m
drwxr-xr-x 1 root root 188 Feb 13 18:51 [01;34mmonthly[0m
drwxr-xr-x 1 root root  10 Feb 13 18:51 [01;34mprocessed[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# mkdir -p monthly processed archive per_service
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la monthly/
[?2004ltotal 24
drwxr-xr-x 1 root root 188 Feb 13 18:51 [0m[01;34m.[0m
drwxr-xr-x 1 root root  52 Feb 13 18:57 [01;34m..[0m
-rw-r--r-- 1 root root  63 Feb 13 18:51 cost_2023-05.csv
-rw-r--r-- 1 root root  63 Feb 13 18:51 cost_2023-06.csv
-rw-r--r-- 1 root root 126 Feb 13 18:51 cost_2023-07_v2.csv
-rw-r--r-- 1 root root  24 Feb 13 18:51 cost_2023-08_draft.csv
-rw-r--r-- 1 root root  24 Feb 13 18:51 cost_2023-09_tiny.csv
-rw-r--r-- 1 root root  32 Feb 13 18:51 old_data.txt
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# cat /etc/finops/policy.ini
[?2004lfilename_pattern=^.*\.csv$
min_size_bytes=1024
date_header_pattern=^Report Generated on: (.*?)$
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# awk -F'=' '/^filename_pattern/{fp=substr($2,2,length($2)-2)} /^min_size_bytes/{msb=$2} /^date_header_pattern/{dhp=substr($2,2,length($2)-2)} END{print "filename_pattern: " fp; print "min_size_bytes: " msb; print "date_header_pattern: " dhp}' /etc/finops/policy.ini
[?2004lfilename_pattern: .*\.csv
min_size_bytes: 1024
date_header_pattern: Report Generated on: (.*?)
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "Validating files with policy: filename_pattern='.*\.csv', min_size_bytes=1024, date_header_pattern='Report Generated on: (.*?)'"
[?2004lValidating files with policy: filename_pattern='.*\.csv', min_size_bytes=1024, date_header_pattern='Report Generated on: (.*?)'
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# cat > validate_files.sh << 'EOF'
[?2004l[?2004h> #!/bin/bash
[?2004l[?2004h> 
[?2004l[?2004h> POLICY_FILE="/etc/finops/policy.ini"
[?2004l[?2004h> FILENAME_PATTERN=$(awk -F'=' '/^filename_pattern/{print $2}' "$POLICY_FILE" | sed "s/^'//;s/'$//")
[?2004l[?2004h> MIN_SIZE_BYTES=$(awk -F'=' '/^min_size_bytes/{print $2}' "$POLICY_FILE")
[?2004l[?2004h> DATE_HEADER_PATTERN=$(awk -F'=' '/^date_header_pattern/{print $2}' "$POLICY_FILE" | sed "s/^'//;s/'$//")
[?2004l[?2004h> 
[?2004l[?2004h> echo "Filename Pattern: $FILENAME_PATTERN"
[?2004l[?2004h> echo "Min Size Bytes: $MIN_SIZE_BYTES"
[?2004l[?2004h> echo "Date Header Pattern: $DATE_HEADER_PATTERN"
[?2004l[?2004h> 
[?2004l[?2004h> declare -a valid_files
[?2004l[?2004h> 
[?2004l[?2004h> count=0
[?2004l[?2004h> 
[?2004l[?2004h> for file in monthly/*; do
[?2004l[?2004h>     filename=$(basename "$file")
[?2004l[?2004h>     filesize=$(stat -c%s "$file")
[?2004l[?2004h>     
[?2004l[?2004h>     if [[ "$filename" =~ $FILENAME_PATTERN ]] && [ "$filesize" -ge "$MIN_SIZE_BYTES" ]; then
[?2004l[?2004h>         echo "Processing valid file: $filename (size: $filesize)"
[?2004l[?2004h>         
[?2004l[?2004h>         # Extract timestamp
[?2004l[?2004h>         timestamp=$(grep -oP "$DATE_HEADER_PATTERN" "$file" | sed "s/$DATE_HEADER_PATTERN/\\1/")
[?2004l[?2004h>         if [ -n "$timestamp" ]; then
[?2004l[?2004h>             echo "Filename: $filename, Timestamp: $timestamp"
[?2004l[?2004h>             valid_files+=("$file $timestamp")
[?2004l[?2004h>             count=$((count+1))
[?2004l[?2004h>         else
[?2004l[?2004h>             echo "Warning: No timestamp found in $filename"
[?2004l[?2004h>         fi
[?2004l[?2004h>     else
[?2004l[?2004h>         echo "Skipping $filename (reason: $( [[ ! "$filename" =~ $FILENAME_PATTERN ]] && echo "pattern" ) $( [ "$filesize" -lt "$MIN_SIZE_BYTES" ] && echo "size") )"
[?2004l[?2004h>     fi
[?2004l[?2004h> done
[?2004l[?2004h> 
[?2004l[?2004h> if [ $count -gt 0 ]; then
[?2004l[?2004h>     echo -e "\nValid files (count: $count):"
[?2004l[?2004h>     for i in "${valid_files[@]}"; do
[?2004l[?2004h>         echo "$i"
[?2004l[?2004h>     done
[?2004l[?2004h> else
[?2004l[?2004h>     echo -e "\nNo valid files found matching policy criteria."
[?2004l[?2004h> fi
[?2004l[?2004h> EOF
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# chmod +x validate_files.sh
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ./validate_files.sh
[?2004lFilename Pattern: ^.*\.csv$
Min Size Bytes: 1024
Date Header Pattern: ^Report Generated on: (.*?)$
Skipping cost_2023-05.csv (reason:  size )
Skipping cost_2023-06.csv (reason:  size )
Skipping cost_2023-07_v2.csv (reason:  size )
Skipping cost_2023-08_draft.csv (reason:  size )
Skipping cost_2023-09_tiny.csv (reason:  size )
Skipping old_data.txt (reason: pattern size )

No valid files found matching policy criteria.
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "No valid files found. Proceeding with directory setup and placeholder creation."
[?2004lNo valid files found. Proceeding with directory setup and placeholder creation.
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la processed/
[?2004ltotal 0
drwxr-xr-x 1 root root 10 Feb 13 18:51 [0m[01;34m.[0m
drwxr-xr-x 1 root root 81 Feb 13 18:57 [01;34m..[0m
lrwxrwxrwx 1 root root 19 Feb 13 18:51 [40;31;01mbroken.csv[0m -> [40;31;01m../monthly/gone.csv[0m
lrwxrwxrwx 1 root root 18 Feb 13 18:51 [40;31;01mfuture_plan.csv[0m -> [40;31;01m../future/2024.csv[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "Checking symlinks in processed/ directory:"
[?2004lChecking symlinks in processed/ directory:
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# find processed/ -type l -exec sh -c 'for link; do target="${link#*/}"; if [[ ! -e "$target" && "${target##*/}" != "future/2024.csv" ]]; then echo "Removing broken link: $link"; rm "$link"; fi; done' sh {} +
[?2004lsh: 1: [[: not found
sh: 1: [[: not found
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la processed/
[?2004ltotal 0
drwxr-xr-x 1 root root 10 Feb 13 18:51 [0m[01;34m.[0m
drwxr-xr-x 1 root root 81 Feb 13 18:57 [01;34m..[0m
lrwxrwxrwx 1 root root 19 Feb 13 18:51 [40;31;01mbroken.csv[0m -> [40;31;01m../monthly/gone.csv[0m
lrwxrwxrwx 1 root root 18 Feb 13 18:51 [40;31;01mfuture_plan.csv[0m -> [40;31;01m../future/2024.csv[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# cat > cleanup_broken_links.sh << 'EOF'
[?2004l[?2004h> #!/bin/bash
[?2004l[?2004h> 
[?2004l[?2004h> for link in processed/*; do
[?2004l[?2004h>     if [ -L "$link" ]; then
[?2004l[?2004h>         target=$(readlink "$link")
[?2004l[?2004h>         # Check if target is a future link
[?2004l[?2004h>         if [[ "$target" == *"future/"* ]]; then
[?2004l[?2004h>             echo "Preserving future link: $link -> $target"
[?2004l[?2004h>         elif [ ! -e "$target" ]; then
[?2004l[?2004h>             echo "Removing broken link: $link -> $target"
[?2004l[?2004h>             rm "$link"
[?2004l[?2004h>         fi
[?2004l[?2004h>     fi
[?2004l[?2004h> done
[?2004l[?2004h> 
[?2004l[?2004h> echo "Cleanup complete. Current processed/ contents:"
[?2004l[?2004h> ls -la processed/
[?2004l[?2004h> EOF
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# chmod +x cleanup_broken_links.sh
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ./cleanup_broken_links.sh
[?2004lRemoving broken link: processed/broken.csv -> ../monthly/gone.csv
Preserving future link: processed/future_plan.csv -> ../future/2024.csv
Cleanup complete. Current processed/ contents:
total 0
drwxr-xr-x 1 root root  32 Feb 13 18:58 .
drwxr-xr-x 1 root root 137 Feb 13 18:58 ..
lrwxrwxrwx 1 root root  18 Feb 13 18:51 future_plan.csv -> ../future/2024.csv
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# cat > process_cloud_costs.sh << 'EOF'
[?2004l[?2004h> #!/bin/bash
[?2004l[?2004h> 
[?2004l[?2004h> # Configuration and constants
[?2004l[?2004h> POLICY_FILE="/etc/finops/policy.ini"
[?2004l[?2004h> BASE_DIR="/home/user/cloud_costs"
[?2004l[?2004h> MONTHLY_DIR="$BASE_DIR/monthly"
[?2004l[?2004h> PROCESSED_DIR="$BASE_DIR/processed"
[?2004l[?2004h> ARCHIVE_DIR="$BASE_DIR/archive"
[?2004l[?2004h> PER_SERVICE_DIR="$BASE_DIR/per_service"
[?2004l[?2004h> AUDIT_FILE="$BASE_DIR/audit_chain.csv"
[?2004l[?2004h> 
[?2004l[?2004h> echo "Cloud Cost Compliance Processor - Starting..."
[?2004l[?2004h> 
[?2004l[?2004h> # Load policy configuration
[?2004l[?2004h> if [ ! -f "$POLICY_FILE" ]; then
[?2004l[?2004h>     echo "ERROR: Policy file $POLICY_FILE not found!"
[?2004l[?2004h>     exit 1
[?2004l[?2004h> fi
[?2004l[?2004h> 
[?2004l[?2004h> FILENAME_PATTERN=$(awk -F'=' '/^filename_pattern/{print $2}' "$POLICY_FILE" | sed 's/^"//;s/"$//')
[?2004l[?2004h> MIN_SIZE_BYTES=$(awk -F'=' '/^min_size_bytes/{print $2}' "$POLICY_FILE")
[?2004l[?2004h> DATE_HEADER_PATTERN=$(awk -F'=' '/^date_header_pattern/{print $2}' "$POLICY_FILE" | sed 's/^"//;s/"$//')
[?2004l[?2004h> 
[?2004l[?2004h> # Create directories if missing
[?2004l[?2004h> mkdir -p "$MONTHLY_DIR" "$PROCESSED_DIR" "$ARCHIVE_DIR" "$PER_SERVICE_DIR"
[?2004l[?2004h> 
[?2004l[?2004h> # Validate files and collect metadata
[?2004l[?2004h> echo "Validating files in $MONTHLY_DIR..."
[?2004l[?2004h> 
[?2004l[?2004h> count_valid=0
[?2004l[?2004h> declare -A file_metadata
[?2004l[?2004h> 
[?2004l[?2004h> declare -a files_to_sort
[?2004l[?2004h> 
[?2004l[?2004h> for file_path in "$MONTHLY_DIR"/*; do
[?2004l[?2004h>     filename=$(basename "$file_path")
[?2004l[?2004h>     filesize=$(stat -c%s "$file_path")
[?2004l[?2004h>     
[?2004l[?2004h>     # Check filename pattern
[?2004l[?2004h>     if [[ "$filename" =~ $FILENAME_PATTERN ]]; then
[?2004l[?2004h>         # Check minimum size
[?2004l[?2004h>         if [ "$filesize" -ge "$MIN_SIZE_BYTES" ]; then
[?2004l[?2004h>             # Extract timestamp
[?2004l[?2004h>             if grep -q "$DATE_HEADER_PATTERN" "$file_path"; then
[?2004l[?2004h>                 timestamp=$(grep -oP "$DATE_HEADER_PATTERN" "$file_path" | sed "s/$DATE_HEADER_PATTERN/\\1/")
[?2004l[?2004h>                 if [ -n "$timestamp" ]; then
[?2004l[?2004h>                     echo "Valid file: $filename (size: $filesize, timestamp: $timestamp)"
[?2004l[?2004h>                     file_metadata[$filename]="$timestamp"
[?2004l[?2004h>                     files_to_sort+=("$file_path $timestamp $filename")
[?2004l[?2004h>                     count_valid=$((count_valid+1))
[?2004l[?2004h>                 else
[?2004l[?2004h>                     echo "Warning: $filename - No timestamp found"
[?2004l[?2004h>                 fi
[?2004l[?2004h>             else
[?2004l[?2004h>                 echo "Warning: $filename - Pattern not found"
[?2004l[?2004h>             fi
[?2004l[?2004h>         else
[?2004l[?2004h>             echo "Skipping $filename - Below minimum size ($filesize < $MIN_SIZE_BYTES)"
[?2004l[?2004h>         fi
[?2004l[?2004h>     else
[?2004l[?2004h>         echo "Skipping $filename - Invalid filename pattern"
[?2004l[?2004h>     fi
[?2004l[?2004h> done
[?2004l[?2004h> 
[?2004l[?2004h> # Sort files by timestamp
[?2004l[?2004h> if [ $count_valid -gt 0 ]; then
[?2004l[?2004h>     echo "Found $count_valid valid files. Sorting by timestamp..."
[?2004l[?2004h>     IFS=$'\n' sorted_files=($(sort -k2 -t' ' <<<"${files_to_sort[*]}"))
[?2004l[?2004h>     
[?2004l[?2004h>     # Identify latest and previous files
[?2004l[?2004h>     latest_file=""
[?2004l[?2004h>     previous_file=""
[?2004l[?2004h>     archive_files=()
[?2004l[?2004h>     
[?2004l[?2004h>     for i in "${sorted_files[@]}"; do
[?2004l[?2004h>         echo "Sorted: $(basename $(echo "$i" | cut -d' ' -f1)) -> $(echo "$i" | cut -d' ' -f2)"
[?2004l[?2004h>     done
[?2004l[?2004h>     
[?2004l[?2004h>     # Process sorted files
[?2004l[?2004h>     for i in "${!sorted_files[@]}"; do
[?2004l[?2004h>         file_path=$(echo "${sorted_files[$i]}" | cut -d' ' -f1)
[?2004l[?2004h>         filename=$(echo "${sorted_files[$i]}" | cut -d' ' -f3)
[?2004l[?2004h>         timestamp=$(echo "${sorted_files[$i]}" | cut -d' ' -f2)
[?2004l[?2004h>         
[?2004l[?2004h>         if [ $i -eq $((${#sorted_files[@]}-1)) ]; then
[?2004l[?2004h>             latest_file="$file_path"
[?2004l[?2004h>         elif [ $i -eq $((${#sorted_files[@]}-2)) ]; then
[?2004l[?2004h>             previous_file="$file_path"
[?2004l[?2004h>         else
[?2004l[?2004h>             archive_files+=("$file_path")
[?2004l[?2004h>         fi
[?2004l[?2004h>     done
[?2004l[?2004h>     
[?2004l[?2004h>     # Create symlinks
[?2004l[?2004h>     if [ -n "$latest_file" ]; then
[?2004l[?2004h>         echo "Creating symlinks for latest: $(basename "$latest_file")"
[?2004l[?2004h>         
[?2004l[?2004h>         # Relative path for symlinks
[?2004l[?2004h>         relative_latest=$(realpath --relative-to="$PROCESSED_DIR" "$latest_file")
[?2004l[?2004h>         
[?2004l[?2004h>         ln -sf "$relative_latest" "$PROCESSED_DIR/latest.csv"
[?2004l[?2004h>         ln -sf "$relative_latest" "$PROCESSED_DIR/previous.csv"
[?2004l[?2004h>         
[?2004l[?2004h>         relative_latest_per_service=$(realpath --relative-to="$PER_SERVICE_DIR" "$latest_file")
[?2004l[?2004h>         
[?2004l[?2004h>         ln -sf "$relative_latest_per_service" "$PER_SERVICE_DIR/compute_v2.csv"
[?2004l[?2004h>         ln -sf "$relative_latest_per_service" "$PER_SERVICE_DIR/network_v2.csv"
[?2004l[?2004h>         ln -sf "$relative_latest_per_service" "$PER_SERVICE_DIR/storage_v2.csv"
[?2004l[?2004h>     fi
[?2004l[?2004h>     
[?2004l[?2004h>     # Archive older valid files
[?2004l[?2004h>     for archive_file in "${archive_files[@]}"; do
[?2004l[?2004h>         if [ -n "$archive_file" ]; then
[?2004l[?2004h>             filename=$(basename "$archive_file")
[?2004l[?2004h>             echo "Archiving: $filename"
[?2004l[?2004h>             mv "$archive_file" "$ARCHIVE_DIR/"
[?2004l[?2004h>         fi
[?2004l[?2004h>     done
[?2004l[?2004h>     
[?2004l[?2004h>     # Generate audit chain
[?2004l[?2004h>     if [ -n "$latest_file" ]; then
[?2004l[?2004h>         echo "Generating audit chain..."
[?2004l[?2004h>         audit_seed=${AUDIT_SEED:-"default_seed_value"}
[?2004l[?2004h>         
[?2004l[?2004h>         # Ensure ISO-8859-1 encoding
[?2004l[?2004h>         iconv -f UTF-8 -t ISO-8859-1 "$AUDIT_FILE" > "$AUDIT_FILE.tmp" && mv "$AUDIT_FILE.tmp" "$AUDIT_FILE"
[?2004l[?2004h>         
[?2004l[?2004h>         chain_hash=$(echo -n "$audit_seed" | sha256sum | cut -d' ' -f1)
[?2004l[?2004h>         
[?2004l[?2004h>         # Process symlinks in specified order
[?2004l[?2004h>         symlinks=(
[?2004l[?2004h>             "processed/latest.csv"
[?2004l[?2004h>             "processed/previous.csv" 
[?2004l[?2004h>             "per_service/compute_v2.csv"
[?2004l[?2004h>             "per_service/network_v2.csv"
[?2004l[?2004h>             "per_service/storage_v2.csv"
[?2004l[?2004h>         )
[?2004l[?2004h>         
[?2004l[?2004h>         for symlink in "${symlinks[@]}"; do
[?2004l[?2004h>             target=$(readlink -m "$BASE_DIR/$symlink")
[?2004l[?2004h>             
[?2004l[?2004h>             if [ ! -f "$target" ]; then
[?2004l[?2004h>                 echo "ERROR: Target file $target for $symlink does not exist"
[?2004l[?2004h>                 continue
[?2004l[?2004h>             fi
[?2004l[?2004h>             
[?2004l[?2004h>             # Calculate SHA1 of content (handle UTF-16 conversion if needed)
[?2004l[?2004h>             if file "$target" | grep -q 'UTF-16'; then
[?2004l[?2004h>                 content_hash=$(iconv -f UTF-16 -t UTF-8 "$target" | sha1sum | cut -d' ' -f1 | tr -d '\n')
[?2004l[?2004h>             else
[?2004l[?2004h>                 content_hash=$(sha1sum "$target" | cut -d' ' -f1 | tr -d '\n')
[?2004l[?2004h>             fi
[?2004l[?2004h>             
[?2004l[?2004h>             # Get relative target path
[?2004l[?2004h>             target_relative=$(realpath --relative-to="$(dirname "$BASE_DIR/$symlink")" "$target")
[?2004l[?2004h>             
[?2004l[?2004h>             # Prepare CSV line
[?2004l[?2004h>             csv_line="${symlink#*$BASE_DIR/},${target_relative},${content_hash},${chain_hash}"
[?2004l[?2004h>             
[?2004l[?2004h>             # Write to audit file (ISO-8859-1)
[?2004l[?2004h>             echo -n "$csv_line" | iconv -f UTF-8 -t ISO-8859-1 >> "$AUDIT_FILE"
[?2004l[?2004h>             
[?2004l[?2004h>             # Calculate next chain hash
[?2004l[?2004h>             chain_hash=$(echo -n "$csv_line" | sha256sum | cut -d' ' -f1)
[?2004l[?2004h>         done
[?2004l[?2004h>         
[?2004l[?2004h>         echo "Audit chain created successfully."
[?2004l[?2004h>     else
[?2004l[?2004h>         echo "No valid files to process for audit chain."
[?2004l[?2004h>     fi
[?2004l[?2004h>     
[?2004l[?2004h>     echo "Processing complete."
[?2004l[?2004h> else
[?2004l[?2004h>     echo "No valid files found for processing."
[?2004l[?2004h> fi
[?2004l[?2004h> EOF
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# chmod +x process_cloud_costs.sh
[?2004l[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "Comprehensive processing script created and ready for execution when valid files are available."
[?2004lComprehensive processing script created and ready for execution when valid files are available.
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "Testing processing script with current files..."
[?2004lTesting processing script with current files...
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ./process_cloud_costs.sh
[?2004lCloud Cost Compliance Processor - Starting...
Validating files in /home/user/cloud_costs/monthly...
Skipping cost_2023-05.csv - Below minimum size (63 < 1024)
Skipping cost_2023-06.csv - Below minimum size (63 < 1024)
Skipping cost_2023-07_v2.csv - Below minimum size (126 < 1024)
Skipping cost_2023-08_draft.csv - Below minimum size (24 < 1024)
Skipping cost_2023-09_tiny.csv - Below minimum size (24 < 1024)
Skipping old_data.txt - Invalid filename pattern
No valid files found for processing.
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# echo "Final directory structure verification:"
[?2004lFinal directory structure verification:
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# find . -type f -name "*.csv" -o -type f -name "*.sh" -o -type f -name "*.ini" | head -20
[?2004l./monthly/cost_2023-05.csv
./monthly/cost_2023-06.csv
./monthly/cost_2023-07_v2.csv
./monthly/cost_2023-08_draft.csv
./monthly/cost_2023-09_tiny.csv
./validate_files.sh
./cleanup_broken_links.sh
./process_cloud_costs.sh
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la processed/
[?2004ltotal 0
drwxr-xr-x 1 root root  32 Feb 13 18:58 [0m[01;34m.[0m
drwxr-xr-x 1 root root 171 Feb 13 18:59 [01;34m..[0m
lrwxrwxrwx 1 root root  18 Feb 13 18:51 [40;31;01mfuture_plan.csv[0m -> [40;31;01m../future/2024.csv[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la archive/
[?2004ltotal 0
drwxr-xr-x 2 root root  10 Feb 13 18:57 [0m[01;34m.[0m
drwxr-xr-x 1 root root 171 Feb 13 18:59 [01;34m..[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# ls -la per_service/
[?2004ltotal 0
drwxr-xr-x 2 root root  10 Feb 13 18:57 [0m[01;34m.[0m
drwxr-xr-x 1 root root 171 Feb 13 18:59 [01;34m..[0m
[?2004hroot@7307115a-6068-4a9c-8ca8-375cf3a5e3f8:/home/user/cloud_costs# 