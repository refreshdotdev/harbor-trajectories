{"version": 2, "width": 160, "height": 40, "timestamp": 1771009003, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.006442, "o", "\u001b[?2004hroot@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
[1.363094, "i", "clear\r"]
[1.363194, "o", "clear\r\n\u001b[?2004l\r"]
[1.364055, "o", "\u001b[H\u001b[J"]
[1.364192, "o", "\u001b[?2004h"]
[1.364216, "o", "root@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
[203.814603, "i", "mkdir -p /home/user/data\n"]
[203.814839, "o", "mkdir -p /home/user/data\r\n"]
[203.814884, "o", "\u001b[?2004l\r"]
[203.816335, "o", "\u001b[?2004h"]
[203.81639, "o", "root@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
[203.93085, "i", "mkdir -p /home/user/bin\n"]
[203.930961, "o", "mkdir -p /home/user/bin\r\n\u001b[?2004l\r"]
[203.932096, "o", "\u001b[?2004h"]
[203.932117, "o", "root@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
[204.033865, "i", "cat > /home/user/bin/generate_cost_report.sh << 'EOF'\n#!/bin/bash\n\n# FinOps Cost Reporting Pipeline v2\n# This script processes container usage data through multiple stages\n\nset -eo pipefail\n\nSCRIPT_NAME=$(basename \"$0\")\nDEFAULT_REPORT_PATH=\"/home/user/container_usage/cost_report.txt\"\nUSAGE_LOG=\"/home/user/container_usage/usage.log\"\nOWNERS_V2_CSV=\"/home/user/container_usage/owners_v2.csv\"\nINTERMEDIATE_DIR=\"/home/user/data\"\nCLEAN_USAGE_CSV=\"$INTERMEDIATE_DIR/clean_usage.csv\"\nJSON_MODEL=\"$INTERMEDIATE_DIR/cost_model.json\"\n\n# Step 1: Phase 1 - Ingestion & Sanitization\n# Input: usage.log (UTF-8 CSV with comments and NULL/N/A values)\n# Output: clean_usage.csv (UTF-8 CSV with sanitized numeric values)\necho \"=== PHASE 1: Ingestion & Sanitization ===\"\n\n# Create clean_usage.csv with header\n# Filter out comment lines, sanitize NULL/N/A to 0 in numeric fields\nawk -F, 'BEGIN { \n    print \"container_id,image,cpu_percent,mem_mb,runtime_hours,cost_per_hour\" \n}\n!/^#/ { \n    # Sanitize numeric fields - treat NULL/N/A as 0\n    "]
[204.033988, "i", "if ($3 ~ /^[0-9.]+$/ || $3 == \"\" || $3 == \"N/A\" || $3 == \"NULL\") gsub(/[A-Za-z]/, \"\", $3)\n    if ($4 ~ /^[0-9.]+$/ || $4 == \"\" || $4 == \"N/A\" || $4 == \"NULL\") gsub(/[A-Za-z]/, \"\", $4)\n    if ($5 ~ /^[0-9.]+$/ || $5 == \"\" || $5 == \"N/A\" || $5 == \"NULL\") gsub(/[A-Za-z]/, \"\", $5)\n    if ($6 ~ /^[0-9.]+$/ || $6 == \"\" || $6 == \"N/A\" || $6 == \"NULL\") gsub(/[A-Za-z]/, \"\", $6)\n    \n    # Convert empty strings to 0 after sanitization\n    $3 = ($3 == \"\") ? \"0\" : $3\n    $4 = ($4 == \"\") ? \"0\" : $4\n    $5 = ($5 == \"\") ? \"0\" : $5\n    $6 = ($6 == \"\") ? \"0\" : $6\n    \n    # Convert to numbers and ensure numeric values\n    $3 += 0; $4 += 0; $5 += 0; $6 += 0\n    print \n}' \"$USAGE_LOG\" > \"$CLEAN_USAGE_CSV\"\n\n# Step 2: Phase 2 - Enrichment & Cost Modeling\n# Input: clean_usage.csv, owners_v2.csv (UTF-16LE with BOM, semicolon-delimited)\n# Output: cost_model.json (JSON with calculated costs, idle status, metadata)\necho \"=== PHASE 2: Enrichment & Cost Modeling ===\"\n\n# Convert owners_v2.csv from UTF-16LE with BOM to UTF-8 CSV\n# Handle "]
[204.034025, "i", "BOM (byte order mark) and semicolon delimiter\niconv -f UTF-16LE -t UTF-8 \"$OWNERS_V2_CSV\" | \\\n  awk -F\";\" 'NR==1 { \n    gsub(/^\\xef\\xbb\\xbf/, \"\") # Remove BOM\n    print \"container_id,owner_email,environment,region\" \n    next \n  } \n  { \n    print \n  }' > \"$INTERMEDIATE_DIR/owners_utf8.csv\"\n\n# Generate JSON model\n# Calculate costs, apply tax rules, detect idle containers\n# Use current timestamp and calculate SHA256 hash of clean_usage.csv\ngenerated_ts=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\nsource_hash=$(sha256sum \"$CLEAN_USAGE_CSV\" | cut -d' ' -f1)\n\njq -n --arg ts \"$generated_ts\" --arg hash \"$source_hash\" --slurpfile usage \"<\" \"$CLEAN_USAGE_CSV\" ' \n  { \n    _meta: { \n      generated: $ts, \n      source_hash: $hash \n    }, \n    data: [ \n      foreach range(0; .usage[0].length? - 1) as $i ({ \n        container_id: .usage[0][$i][0], \n        image: .usage[0][$i][1], \n        cpu_percent: .usage[0][$i][2], \n        mem_mb: .usage[0][$i][3], \n        runtime_hours: .usage[0][$i][4], \n        cost_per_hour: .usage[0][$i][5"]
[204.034056, "o", "cat > /home/user/bin/generate_cost_report.sh << 'EOF'\r\n\u001b[?2004l\r"]
[204.034088, "i", "] \n      } | .cpu_percent = (tonumber(.cpu_percent) | round(4)), \n                    .mem_mb = (tonumber(.mem_mb) | round(4)), \n                    .runtime_hours = tonumber(.runtime_hours), \n                    .cost_per_hour = tonumber(.cost_per_hour) | \n      if .runtime_hours == 0 or .cost_per_hour == 0 then \n        .base_cost = 0, \n        .taxed_cost = 0, \n        .final_cost = 0, \n        .tax_rate = 0, \n        .is_idle = true \n      else \n        .base_cost = (.runtime_hours * .cost_per_hour), \n        .taxed_cost = ( \n          if .base_cost > 0 then \n            .base_cost * ( \n              if (.region | test(\"eu-west\")) then 1.10 \n              else if (.region | test(\"us-east\")) then 1.00 \n              else 1.05 \n              end \n            ) \n          else .base_cost \n          end \n        ), \n        .final_cost = ( \n          if .environment == \"dev\" then \n            .taxed_cost * 0.50 \n          else \n            .taxed_cost \n          end \n        ), \n        .tax_rate = ( \n       "]
[204.034112, "o", "\u001b[?2004h> "]
[204.034141, "i", "   if .region | test(\"eu-west\") then \"10%\" \n          else if .region | test(\"us-east\") then \"0%\" \n          else \"5%\" \n          end \n        ), \n        .is_idle = (.cpu_percent <= 5.0 and .mem_mb < 512) \n      end | \n      .total_cost = (.final_cost | round(4)), \n      .is_idle = (.is_idle | not), \n      del(.base_cost, .taxed_cost) \n      ) ] \n    } \n  ' \"$INTERMEDIATE_DIR/owners_utf8.csv\" > \"$JSON_MODEL\"\n\n# Step 3: Phase 3 - Final Reporting\n# Input: cost_model.json\n# Output: cost_report.txt (ISO-8859-1 encoded text report)\necho \"=== PHASE 3: Final Reporting ===\"\n\n# Get report output file path\noutput_file=\"${1:-$DEFAULT_REPORT_PATH}\"\n\n# Generate report content\nreport_content=$(jq -r '.data[] | \"\\(.container_id) | \\(.region) | \\(.tax_rate) | \\(.\"total_cost\" | tostring)\"' \"$JSON_MODEL\" | \\\n  awk -v OFS=\"|\" -v tax_col=3 -v cost_col=4 ' \n    BEGIN { \n      print \"Container | Region | Tax | Cost\" \n      print \"---------------------------------\" \n      active=0; idle=0; total_cost=0 \n    } \n    { \n      # Conve"]
[204.034163, "o", "#!/bin/bash\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.03419, "i", "rt scientific notation to decimal for cost\n      if ($cost_col ~ /^[0-9]+\\.[0-9]{4}[eE]/) {\n        $cost_col = sprintf(\"%%\\.2f\", $cost_col) \n      } else { \n        $cost_col = sprintf(\"%%\\.2f\", $cost_col) \n      }\n      \n      # Count idle vs active containers\n      if ($0 ~ /True/) idle++ \n      else active++\n      \n      # Sum total cost (convert to number first)\n      total_cost += $cost_col + 0\n      \n      print \n    } \n    END { \n      printf \"\\\\nSummary\\\\n=======\\\\nActive Containers: %d\\\\nIdle Containers: %d\\\\nTotal Cost: $%%.2f\\\\n\", active, idle, total_cost \n    }' \n)\n\n# Add integrity hash and write report\nintegrity_hash=$(md5sum \"$JSON_MODEL\" | cut -d' ' -f1)\nfinal_report=\"${report_content}\n[Integrity Hash: ${integrity_hash}]\"\n\n# Convert report to ISO-8859-1 and write to file\necho -e \"$final_report\" | iconv -t ISO-8859-1 > \"$output_file\"\n\necho \"Pipeline execution completed successfully.\"\necho \"Report generated at: $output_file\"\n\nEOF\n"]
[204.034213, "o", "\u001b[?2004h> "]
[204.034292, "o", "# FinOps Cost Reporting Pipeline v2\r\n\u001b[?2004l\r"]
[204.034323, "o", "\u001b[?2004h> "]
[204.034535, "o", "# This script processes container usage data through multiple stages\r\n\u001b[?2004l\r\u001b[?2004h"]
[204.034594, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[204.034653, "o", "set -eo pipefail\r\n\u001b[?2004l\r"]
[204.03468, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.034705, "o", "\u001b[?2004h> "]
[204.034784, "o", "SCRIPT_NAME=$(basename \"$0\")\r\n\u001b[?2004l\r"]
[204.03481, "o", "\u001b[?2004h> "]
[204.035031, "o", "DEFAULT_REPORT_PATH=\"/home/user/container_usage/cost_report.txt\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[204.035159, "o", "USAGE_LOG=\"/home/user/container_usage/usage.log\"\r\n\u001b[?2004l\r"]
[204.035188, "o", "\u001b[?2004h> "]
[204.035345, "o", "OWNERS_V2_CSV=\"/home/user/container_usage/owners_v2.csv\"\r\n\u001b[?2004l\r"]
[204.035368, "o", "\u001b[?2004h> "]
[204.03547, "o", "INTERMEDIATE_DIR=\"/home/user/data\"\r\n\u001b[?2004l\r"]
[204.035486, "o", "\u001b[?2004h"]
[204.035515, "o", "> "]
[204.035693, "o", "CLEAN_USAGE_CSV=\"$INTERMEDIATE_DIR/clean_usage.csv\"\r\n\u001b[?2004l\r"]
[204.035722, "o", "\u001b[?2004h> "]
[204.035858, "o", "JSON_MODEL=\"$INTERMEDIATE_DIR/cost_model.json\"\r\n\u001b[?2004l\r"]
[204.035891, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.035918, "o", "\u001b[?2004h> "]
[204.036039, "o", "# Step 1: Phase 1 - Ingestion & Sanitization\r\n\u001b[?2004l\r"]
[204.036062, "o", "\u001b[?2004h> "]
[204.036257, "o", "# Input: usage.log (UTF-8 CSV with comments and NULL/N/A values)\r\n\u001b[?2004l\r"]
[204.036279, "o", "\u001b[?2004h> "]
[204.036485, "o", "# Output: clean_usage.csv (UTF-8 CSV with sanitized numeric values)\r\n\u001b[?2004l\r"]
[204.036508, "o", "\u001b[?2004h"]
[204.036523, "o", "> "]
[204.036666, "o", "echo \"=== PHASE 1: Ingestion & Sanitization ===\"\r\n\u001b[?2004l\r"]
[204.036692, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.036713, "o", "\u001b[?2004h> "]
[204.036826, "o", "# Create clean_usage.csv with header\r\n\u001b[?2004l\r"]
[204.036864, "o", "\u001b[?2004h> "]
[204.037054, "o", "# Filter out comment lines, sanitize NULL/N/A to 0 in numeric fields\r\n\u001b[?2004l\r"]
[204.037096, "o", "\u001b[?2004h> "]
[204.037132, "o", "awk -F, 'BEGIN { \r\n\u001b[?2004l\r"]
[204.037156, "o", "\u001b[?2004h> "]
[204.037384, "o", "    print \"container_id,image,cpu_percent,mem_mb,runtime_hours,cost_per_hour\" \r\n\u001b[?2004l\r"]
[204.037397, "o", "\u001b[?2004h> "]
[204.037521, "o", "}\r\n\u001b[?2004l\r\u001b[?2004h> !/^#/ { \r\n\u001b[?2004l\r\u001b[?2004h> "]
[204.037651, "o", "    # Sanitize numeric fields - treat NULL/N/A as 0\r\n\u001b[?2004l\r"]
[204.037681, "o", "\u001b[?2004h> "]
[204.037949, "o", "    if ($3 ~ /^[0-9.]+$/ || $3 == \"\" || $3 == \"N/A\" || $3 == \"NULL\") gsub(/[A-Za-z]/, \"\", $3)\r\n\u001b[?2004l\r"]
[204.03798, "o", "\u001b[?2004h> "]
[204.038246, "o", "    if ($4 ~ /^[0-9.]+$/ || $4 == \"\" || $4 == \"N/A\" || $4 == \"NULL\") gsub(/[A-Za-z]/, \"\", $4)\r\n\u001b[?2004l\r"]
[204.038273, "o", "\u001b[?2004h> "]
[204.038545, "o", "    if ($5 ~ /^[0-9.]+$/ || $5 == \"\" || $5 == \"N/A\" || $5 == \"NULL\") gsub(/[A-Za-z]/, \"\", $5)\r\n\u001b[?2004l\r"]
[204.038578, "o", "\u001b[?2004h> "]
[204.038846, "o", "    if ($6 ~ /^[0-9.]+$/ || $6 == \"\" || $6 == \"N/A\" || $6 == \"NULL\") gsub(/[A-Za-z]/, \"\", $6)\r\n\u001b[?2004l\r"]
[204.038873, "o", "\u001b[?2004h> "]
[204.038899, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.038926, "o", "> "]
[204.039059, "o", "    # Convert empty strings to 0 after sanitization\r\n\u001b[?2004l\r"]
[204.039086, "o", "\u001b[?2004h> "]
[204.039173, "o", "    $3 = ($3 == \"\") ? \"0\" : $3\r\n\u001b[?2004l\r"]
[204.039204, "o", "\u001b[?2004h> "]
[204.039284, "o", "    $4 = ($4 == \"\") ? \"0\" : $4\r\n\u001b[?2004l\r"]
[204.039333, "o", "\u001b[?2004h> "]
[204.039399, "o", "    $5 = ($5 == \"\") ? \"0\" : $5\r\n\u001b[?2004l\r"]
[204.039429, "o", "\u001b[?2004h> "]
[204.039509, "o", "    $6 = ($6 == \"\") ? \"0\" : $6\r\n\u001b[?2004l\r"]
[204.039539, "o", "\u001b[?2004h> "]
[204.039547, "o", "    \r\n\u001b[?2004l\r"]
[204.039594, "o", "\u001b[?2004h> "]
[204.039725, "o", "    # Convert to numbers and ensure numeric values\r\n\u001b[?2004l\r"]
[204.039753, "o", "\u001b[?2004h> "]
[204.039863, "o", "    $3 += 0; $4 += 0; $5 += 0; $6 += 0\r\n\u001b[?2004l\r"]
[204.039892, "o", "\u001b[?2004h> "]
[204.039922, "o", "    print \r\n\u001b[?2004l\r"]
[204.03993, "o", "\u001b[?2004h"]
[204.039971, "o", "> "]
[204.040046, "o", "}' \"$USAGE_LOG\" > \"$CLEAN_USAGE_CSV\"\r\n\u001b[?2004l\r"]
[204.040078, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.040107, "o", "\u001b[?2004h"]
[204.040115, "o", "> "]
[204.040236, "o", "# Step 2: Phase 2 - Enrichment & Cost Modeling\r\n\u001b[?2004l\r"]
[204.040273, "o", "\u001b[?2004h> "]
[204.040498, "o", "# Input: clean_usage.csv, owners_v2.csv (UTF-16LE with BOM, semicolon-delimited)\r\n\u001b[?2004l\r"]
[204.040525, "o", "\u001b[?2004h> "]
[204.040756, "o", "# Output: cost_model.json (JSON with calculated costs, idle status, metadata)\r\n\u001b[?2004l\r"]
[204.04079, "o", "\u001b[?2004h> "]
[204.040923, "o", "echo \"=== PHASE 2: Enrichment & Cost Modeling ===\"\r\n\u001b[?2004l\r"]
[204.040952, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\r\n"]
[204.040984, "o", "\u001b[?2004h> "]
[204.041123, "o", "# Convert owners_v2.csv from UTF-16LE with BOM to UTF-8 CSV\r\n\u001b[?2004l\r"]
[204.041152, "o", "\u001b[?2004h> "]
[204.041277, "o", "# Handle BOM (byte order mark) and semicolon delimiter\r\n\u001b[?2004l\r"]
[204.041293, "o", "\u001b[?2004h"]
[204.04132, "o", "> "]
[204.04142, "o", "iconv -f UTF-16LE -t UTF-8 \"$OWNERS_V2_CSV\" | \\\r\n\u001b[?2004l\r"]
[204.041445, "o", "\u001b[?2004h> "]
[204.041504, "o", "  awk -F\";\" 'NR==1 { \r\n\u001b[?2004l\r"]
[204.041519, "o", "\u001b[?2004h"]
[204.04155, "o", "> "]
[204.041656, "o", "    gsub(/^\\xef\\xbb\\xbf/, \"\") # Remove BOM\r\n\u001b[?2004l\r"]
[204.041679, "o", "\u001b[?2004h"]
[204.041707, "o", "> "]
[204.041821, "o", "    print \"container_id,owner_email,environment,region\" \r\n\u001b[?2004l\r"]
[204.041849, "o", "\u001b[?2004h> "]
[204.041873, "o", "    next \r\n\u001b[?2004l\r"]
[204.0419, "o", "\u001b[?2004h> "]
[204.041944, "o", "  } \r\n\u001b[?2004l\r\u001b[?2004h>   { \r\n\u001b[?2004l\r"]
[204.041975, "o", "\u001b[?2004h> "]
[204.042, "o", "    print \r\n\u001b[?2004l\r"]
[204.042029, "o", "\u001b[?2004h> "]
[204.042126, "o", "  }' > \"$INTERMEDIATE_DIR/owners_utf8.csv\"\r\n\u001b[?2004l\r"]
[204.042141, "o", "\u001b[?2004h"]
[204.042171, "o", "> \r\n\u001b[?2004l\r"]
[204.042197, "o", "\u001b[?2004h> "]
[204.042228, "o", "# Generate JSON model\r\n\u001b[?2004l\r"]
[204.042256, "o", "\u001b[?2004h> "]
[204.042396, "o", "# Calculate costs, apply tax rules, detect idle containers\r\n\u001b[?2004l\r"]
[204.042423, "o", "\u001b[?2004h> "]
[204.042591, "o", "# Use current timestamp and calculate SHA256 hash of clean_usage.csv\r\n\u001b[?2004l\r"]
[204.042618, "o", "\u001b[?2004h> "]
[204.042728, "o", "generated_ts=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\r\n\u001b[?2004l\r"]
[204.042743, "o", "\u001b[?2004h"]
[204.042767, "o", "> "]
[204.0429, "o", "source_hash=$(sha256sum \"$CLEAN_USAGE_CSV\" | cut -d' ' -f1)\r\n\u001b[?2004l\r"]
[204.042934, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.042947, "o", "> "]
[204.043202, "o", "jq -n --arg ts \"$generated_ts\" --arg hash \"$source_hash\" --slurpfile usage \"<\" \"$CLEAN_USAGE_CSV\" ' \r\n\u001b[?2004l\r"]
[204.043248, "o", "\u001b[?2004h>   { \r\n\u001b[?2004l\r"]
[204.043285, "o", "\u001b[?2004h> "]
[204.043315, "o", "    _meta: { \r\n\u001b[?2004l\r"]
[204.043324, "o", "\u001b[?2004h"]
[204.043363, "o", "> "]
[204.043393, "o", "      generated: $ts, \r\n\u001b[?2004l\r"]
[204.043402, "o", "\u001b[?2004h"]
[204.043439, "o", "> "]
[204.043472, "o", "      source_hash: $hash \r\n\u001b[?2004l\r"]
[204.043501, "o", "\u001b[?2004h> "]
[204.04351, "o", "    }, \r\n\u001b[?2004l\r"]
[204.043549, "o", "\u001b[?2004h> "]
[204.043585, "o", "    data: [ \r\n\u001b[?2004l\r"]
[204.043635, "o", "\u001b[?2004h> "]
[204.043734, "o", "      foreach range(0; .usage[0].length? - 1) as $i ({ \r\n\u001b[?2004l\r"]
[204.043779, "o", "\u001b[?2004h> "]
[204.043852, "o", "        container_id: .usage[0][$i][0], \r\n\u001b[?2004l\r"]
[204.043883, "o", "\u001b[?2004h> "]
[204.043955, "o", "        image: .usage[0][$i][1], \r\n\u001b[?2004l\r"]
[204.043986, "o", "\u001b[?2004h> "]
[204.04407, "o", "        cpu_percent: .usage[0][$i][2], \r\n\u001b[?2004l\r"]
[204.0441, "o", "\u001b[?2004h> "]
[204.044176, "o", "        mem_mb: .usage[0][$i][3], \r\n\u001b[?2004l\r"]
[204.044206, "o", "\u001b[?2004h> "]
[204.044295, "o", "        runtime_hours: .usage[0][$i][4], \r\n\u001b[?2004l\r"]
[204.044324, "o", "\u001b[?2004h> "]
[204.044415, "o", "        cost_per_hour: .usage[0][$i][5] \r\n\u001b[?2004l\r"]
[204.044445, "o", "\u001b[?2004h> "]
[204.04462, "o", "      } | .cpu_percent = (tonumber(.cpu_percent) | round(4)), \r\n\u001b[?2004l\r"]
[204.044654, "o", "\u001b[?2004h> "]
[204.044794, "o", "                    .mem_mb = (tonumber(.mem_mb) | round(4)), \r\n\u001b[?2004l\r"]
[204.044829, "o", "\u001b[?2004h> "]
[204.044965, "o", "                    .runtime_hours = tonumber(.runtime_hours), \r\n\u001b[?2004l\r"]
[204.045001, "o", "\u001b[?2004h> "]
[204.045146, "o", "                    .cost_per_hour = tonumber(.cost_per_hour) | \r\n\u001b[?2004l\r"]
[204.045175, "o", "\u001b[?2004h> "]
[204.045304, "o", "      if .runtime_hours == 0 or .cost_per_hour == 0 then \r\n"]
[204.045326, "o", "\u001b[?2004l\r"]
[204.045336, "o", "\u001b[?2004h> "]
[204.045391, "o", "        .base_cost = 0, \r\n\u001b[?2004l\r"]
[204.045425, "o", "\u001b[?2004h> "]
[204.045479, "o", "        .taxed_cost = 0, \r\n\u001b[?2004l\r"]
[204.045518, "o", "\u001b[?2004h> "]
[204.045578, "o", "        .final_cost = 0, \r\n\u001b[?2004l\r"]
[204.045609, "o", "\u001b[?2004h"]
[204.045617, "o", "> "]
[204.045675, "o", "        .tax_rate = 0, \r\n\u001b[?2004l\r"]
[204.045705, "o", "\u001b[?2004h> "]
[204.045757, "o", "        .is_idle = true \r\n\u001b[?2004l\r"]
[204.045789, "o", "\u001b[?2004h> "]
[204.045813, "o", "      else \r\n\u001b[?2004l\r"]
[204.045841, "o", "\u001b[?2004h> "]
[204.045963, "o", "        .base_cost = (.runtime_hours * .cost_per_hour), \r\n\u001b[?2004l\r"]
[204.045994, "o", "\u001b[?2004h> "]
[204.046044, "o", "        .taxed_cost = ( \r\n\u001b[?2004l\r"]
[204.046074, "o", "\u001b[?2004h> "]
[204.046144, "o", "          if .base_cost > 0 then \r\n\u001b[?2004l\r"]
[204.046174, "o", "\u001b[?2004h> "]
[204.046235, "o", "            .base_cost * ( \r\n\u001b[?2004l\r"]
[204.046264, "o", "\u001b[?2004h> "]
[204.046397, "o", "              if (.region | test(\"eu-west\")) then 1.10 \r\n\u001b[?2004l\r"]
[204.046427, "o", "\u001b[?2004h"]
[204.046437, "o", "> "]
[204.046559, "o", "              else if (.region | test(\"us-east\")) then 1.00 \r\n\u001b[?2004l\r"]
[204.046595, "o", "\u001b[?2004h> "]
[204.046653, "o", "              else 1.05 \r\n\u001b[?2004l\r"]
[204.046683, "o", "\u001b[?2004h> "]
[204.04672, "o", "              end \r\n\u001b[?2004l\r"]
[204.046754, "o", "\u001b[?2004h> "]
[204.046782, "o", "            ) \r\n\u001b[?2004l\r"]
[204.046811, "o", "\u001b[?2004h> "]
[204.046865, "o", "          else .base_cost \r\n\u001b[?2004l\r"]
[204.046896, "o", "\u001b[?2004h> "]
[204.046925, "o", "          end \r\n\u001b[?2004l\r"]
[204.046955, "o", "\u001b[?2004h> "]
[204.04698, "o", "        ), \r\n\u001b[?2004l\r"]
[204.046988, "o", "\u001b[?2004h> "]
[204.047055, "o", "        .final_cost = ( \r\n\u001b[?2004l\r"]
[204.047087, "o", "\u001b[?2004h> "]
[204.047178, "o", "          if .environment == \"dev\" then \r\n\u001b[?2004l\r"]
[204.047207, "o", "\u001b[?2004h> "]
[204.047273, "o", "            .taxed_cost * 0.50 \r\n\u001b[?2004l\r"]
[204.047304, "o", "\u001b[?2004h> "]
[204.047336, "o", "          else \r\n\u001b[?2004l\r"]
[204.047365, "o", "\u001b[?2004h> "]
[204.047414, "o", "            .taxed_cost \r\n\u001b[?2004l\r"]
[204.047445, "o", "\u001b[?2004h> "]
[204.047474, "o", "          end \r\n\u001b[?2004l\r"]
[204.047503, "o", "\u001b[?2004h> "]
[204.047528, "o", "        ), \r\n\u001b[?2004l\r"]
[204.047536, "o", "\u001b[?2004h"]
[204.047547, "o", "> "]
[204.047611, "o", "        .tax_rate = ( \r\n\u001b[?2004l\r"]
[204.047641, "o", "\u001b[?2004h> "]
[204.04775, "o", "          if .region | test(\"eu-west\") then \"10%\" \r\n\u001b[?2004l\r"]
[204.047783, "o", "\u001b[?2004h> "]
[204.047903, "o", "          else if .region | test(\"us-east\") then \"0%\" \r\n\u001b[?2004l\r"]
[204.047932, "o", "\u001b[?2004h> "]
[204.047971, "o", "          else \"5%\" \r\n\u001b[?2004l\r"]
[204.048003, "o", "\u001b[?2004h> "]
[204.048032, "o", "          end \r\n\u001b[?2004l\r"]
[204.048063, "o", "\u001b[?2004h> "]
[204.048093, "o", "        ), \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.048101, "o", "> "]
[204.048243, "o", "        .is_idle = (.cpu_percent <= 5.0 and .mem_mb < 512) \r\n\u001b[?2004l\r"]
[204.048275, "o", "\u001b[?2004h> "]
[204.048301, "o", "      end | \r\n\u001b[?2004l\r"]
[204.048309, "o", "\u001b[?2004h"]
[204.048344, "o", "> "]
[204.048432, "o", "      .total_cost = (.final_cost | round(4)), \r\n\u001b[?2004l\r"]
[204.048465, "o", "\u001b[?2004h> "]
[204.048538, "o", "      .is_idle = (.is_idle | not), \r\n\u001b[?2004l\r"]
[204.048569, "o", "\u001b[?2004h> "]
[204.048661, "o", "      del(.base_cost, .taxed_cost) \r\n\u001b[?2004l\r"]
[204.048695, "o", "\u001b[?2004h"]
[204.048721, "o", ">       ) ] \r\n\u001b[?2004l\r"]
[204.048731, "o", "\u001b[?2004h> "]
[204.048772, "o", "    } \r\n\u001b[?2004l\r"]
[204.04878, "o", "\u001b[?2004h> "]
[204.048898, "o", "  ' \"$INTERMEDIATE_DIR/owners_utf8.csv\" > \"$JSON_MODEL\"\r\n\u001b[?2004l\r"]
[204.048929, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.048938, "o", "> "]
[204.049027, "o", "# Step 3: Phase 3 - Final Reporting\r\n\u001b[?2004l\r"]
[204.049058, "o", "\u001b[?2004h> "]
[204.049109, "o", "# Input: cost_model.json\r\n\u001b[?2004l\r"]
[204.049139, "o", "\u001b[?2004h> "]
[204.049269, "o", "# Output: cost_report.txt (ISO-8859-1 encoded text report)\r\n\u001b[?2004l\r"]
[204.049304, "o", "\u001b[?2004h> "]
[204.049386, "o", "echo \"=== PHASE 3: Final Reporting ===\"\r\n\u001b[?2004l\r"]
[204.049418, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.049426, "o", "\u001b[?2004h"]
[204.04946, "o", "> "]
[204.049505, "o", "# Get report output file path\r\n\u001b[?2004l\r"]
[204.049538, "o", "\u001b[?2004h> "]
[204.049637, "o", "output_file=\"${1:-$DEFAULT_REPORT_PATH}\"\r\n\u001b[?2004l\r"]
[204.04967, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.049708, "o", "> "]
[204.049746, "o", "# Generate report content\r\n\u001b[?2004l\r"]
[204.049778, "o", "\u001b[?2004h> "]
[204.05007, "o", "report_content=$(jq -r '.data[] | \"\\(.container_id) | \\(.region) | \\(.tax_rate) | \\(.\"total_cost\" | tostring)\"' \"$JSON_MODEL\" | \\\r\n\u001b[?2004l\r"]
[204.050111, "o", "\u001b[?2004h> "]
[204.050208, "o", "  awk -v OFS=\"|\" -v tax_col=3 -v cost_col=4 ' \r\n\u001b[?2004l\r"]
[204.050241, "o", "\u001b[?2004h> "]
[204.050268, "o", "    BEGIN { \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.050297, "o", "> "]
[204.050394, "o", "      print \"Container | Region | Tax | Cost\" \r\n\u001b[?2004l\r"]
[204.050426, "o", "\u001b[?2004h> "]
[204.050531, "o", "      print \"---------------------------------\" \r\n\u001b[?2004l\r"]
[204.050563, "o", "\u001b[?2004h> "]
[204.050657, "o", "      active=0; idle=0; total_cost=0 \r\n\u001b[?2004l\r"]
[204.050691, "o", "\u001b[?2004h>     } \r\n\u001b[?2004l\r"]
[204.050724, "o", "\u001b[?2004h> "]
[204.050758, "o", "    { \r\n\u001b[?2004l\r"]
[204.050789, "o", "\u001b[?2004h> "]
[204.050889, "o", "      # Convert scientific notation to decimal for cost\r\n\u001b[?2004l\r"]
[204.05092, "o", "\u001b[?2004h> "]
[204.051025, "o", "      if ($cost_col ~ /^[0-9]+\\.[0-9]{4}[eE]/) {\r\n\u001b[?2004l\r"]
[204.051057, "o", "\u001b[?2004h> "]
[204.051167, "o", "        $cost_col = sprintf(\"%%\\.2f\", $cost_col) \r\n\u001b[?2004l\r"]
[204.051197, "o", "\u001b[?2004h> "]
[204.051224, "o", "      } else { \r\n\u001b[?2004l\r"]
[204.051255, "o", "\u001b[?2004h> "]
[204.051366, "o", "        $cost_col = sprintf(\"%%\\.2f\", $cost_col) \r\n\u001b[?2004l\r"]
[204.051395, "o", "\u001b[?2004h> "]
[204.051402, "o", "      }\r\n\u001b[?2004l\r"]
[204.05144, "o", "\u001b[?2004h> "]
[204.051448, "o", "      \r\n\u001b[?2004l\r"]
[204.051484, "o", "\u001b[?2004h> "]
[204.051564, "o", "      # Count idle vs active containers\r\n\u001b[?2004l\r"]
[204.051595, "o", "\u001b[?2004h> "]
[204.051673, "o", "      if ($0 ~ /True/) idle++ \r\n\u001b[?2004l\r"]
[204.051702, "o", "\u001b[?2004h> "]
[204.05174, "o", "      else active++\r\n\u001b[?2004l\r"]
[204.05177, "o", "\u001b[?2004h> "]
[204.051778, "o", "      \r\n\u001b[?2004l\r"]
[204.051812, "o", "\u001b[?2004h> "]
[204.051917, "o", "      # Sum total cost (convert to number first)\r\n\u001b[?2004l\r"]
[204.051948, "o", "\u001b[?2004h> "]
[204.052021, "o", "      total_cost += $cost_col + 0\r\n\u001b[?2004l\r"]
[204.052051, "o", "\u001b[?2004h> "]
[204.052058, "o", "      \r\n\u001b[?2004l\r"]
[204.052093, "o", "\u001b[?2004h> "]
[204.052118, "o", "      print \r\n\u001b[?2004l\r"]
[204.052125, "o", "\u001b[?2004h"]
[204.052159, "o", ">     } \r\n\u001b[?2004l\r"]
[204.052182, "o", "\u001b[?2004h"]
[204.052205, "o", "> "]
[204.052213, "o", "    END { \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.052248, "o", "> "]
[204.052541, "o", "      printf \"\\\\nSummary\\\\n=======\\\\nActive Containers: %d\\\\nIdle Containers: %d\\\\nTotal Cost: $%%.2f\\\\n\", active, idle, total_cost \r\n\u001b[?2004l\r"]
[204.052576, "o", "\u001b[?2004h> "]
[204.052615, "o", "    }' \r\n\u001b[?2004l\r\u001b[?2004h> "]
[204.052624, "o", ")\r\n\u001b[?2004l\r"]
[204.052654, "o", "\u001b[?2004h> "]
[204.052662, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[204.052758, "o", "# Add integrity hash and write report\r\n\u001b[?2004l\r"]
[204.052787, "o", "\u001b[?2004h> "]
[204.052909, "o", "integrity_hash=$(md5sum \"$JSON_MODEL\" | cut -d' ' -f1)\r\n\u001b[?2004l\r"]
[204.052938, "o", "\u001b[?2004h> "]
[204.053006, "o", "final_report=\"${report_content}\r\n\u001b[?2004l\r"]
[204.053037, "o", "\u001b[?2004h> "]
[204.053117, "o", "[Integrity Hash: ${integrity_hash}]\"\r\n\u001b[?2004l\r"]
[204.053146, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[204.053174, "o", "> "]
[204.053277, "o", "# Convert report to ISO-8859-1 and write to file\r\n\u001b[?2004l\r"]
[204.053307, "o", "\u001b[?2004h> "]
[204.053452, "o", "echo -e \"$final_report\" | iconv -t ISO-8859-1 > \"$output_file\"\r\n\u001b[?2004l\r"]
[204.053484, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.053492, "o", "\u001b[?2004h"]
[204.053525, "o", "> "]
[204.053629, "o", "echo \"Pipeline execution completed successfully.\"\r\n\u001b[?2004l\r"]
[204.053659, "o", "\u001b[?2004h> "]
[204.053753, "o", "echo \"Report generated at: $output_file\"\r\n\u001b[?2004l\r"]
[204.053784, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[204.053792, "o", "\u001b[?2004h"]
[204.053826, "o", "> EOF\r\n\u001b[?2004l\r"]
[204.055489, "o", "\u001b[?2004h"]
[204.055497, "o", "root@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
[204.177235, "i", "chmod +x /home/user/bin/generate_cost_report.sh\n"]
[204.177394, "o", "chmod +x /home/user/bin/generate_cost_report.sh\r\n\u001b[?2004l\r"]
[204.178381, "o", "\u001b[?2004hroot@0a2420fe-fc93-4111-856f-d3cbc843a217:~# "]
