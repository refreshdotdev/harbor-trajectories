{"version": 2, "width": 160, "height": 40, "timestamp": 1771009632, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.007643, "o", "\u001b[?2004hroot@90de8620-3a3e-4b77-819e-69303ac3e398:~# "]
[0.927459, "i", "clear\r"]
[0.927576, "o", "clear\r\n\u001b[?2004l\r"]
[0.928602, "o", "\u001b[H\u001b[J"]
[0.928795, "o", "\u001b[?2004h"]
[0.928817, "o", "root@90de8620-3a3e-4b77-819e-69303ac3e398:~# "]
[25.042224, "i", "cd /home/user\n"]
[25.042367, "o", "cd /home/user\r\n\u001b[?2004l\r"]
[25.042433, "o", "\u001b[?2004hroot@90de8620-3a3e-4b77-819e-69303ac3e398:/home/user# "]
[25.193229, "i", "pwd\n"]
[25.193434, "o", "pwd\r\n\u001b[?2004l\r/home/user\r\n\u001b[?2004hroot@90de8620-3a3e-4b77-819e-69303ac3e398:/home/user# "]
[25.332423, "i", "mkdir -p bin container_usage data\n"]
[25.332719, "o", "mkdir -p bin container_usage data\r\n\u001b[?2004l\r"]
[25.334199, "o", "\u001b[?2004h"]
[25.334247, "o", "root@90de8620-3a3e-4b77-819e-69303ac3e398:/home/user# "]
[25.50087, "i", "touch bin/generate_cost_report.sh\n"]
[25.501052, "o", "touch bin/generate_cost_report.sh\r\n\u001b[?2004l\r"]
[25.505009, "o", "\u001b[?2004hroot@90de8620-3a3e-4b77-819e-69303ac3e398:/home/user# "]
[25.607403, "i", "chmod +x bin/generate_cost_report.sh\n"]
[25.607708, "o", "chmod +x bin/generate_cost_report.sh\r\n\u001b[?2004l\r"]
[25.608822, "o", "\u001b[?2004h"]
[25.608853, "o", "root@90de8620-3a3e-4b77-819e-69303ac3e398:/home/user# "]
[25.729754, "i", "cat > bin/generate_cost_report.sh << 'EOF'\n#!/bin/bash\n\n# FinOps Cost Reporting Pipeline v2\n# Automated container cost tracking workflow\n\n# Default output file path\nDEFAULT_REPORT_FILE=\"/home/user/container_usage/cost_report.txt\"\n\n# Get output file from arguments or use default\nif [ \"$#\" -eq 0 ]; then\n    OUTPUT_REPORT_FILE=\"$DEFAULT_REPORT_FILE\"\nelse\n    OUTPUT_REPORT_FILE=\"$1\"\nfi\n\n# Configuration variables\nINPUT_USAGE_LOG=\"/home/user/container_usage/usage.log\"\nINPUT_OWNERS_FILE=\"/home/user/container_usage/owners_v2.csv\"\nINTERMEDIATE_DATA_DIR=\"/home/user/data\"\n\necho \"FinOps Cost Reporting Pipeline v2\"\necho \"Output report will be written to: $OUTPUT_REPORT_FILE\"\necho \"Intermediate files will be stored in: $INTERMEDIATE_DATA_DIR\"\n\n# Check if input files exist\nif [ ! -f \"$INPUT_USAGE_LOG\" ]; then\n    echo \"ERROR: Usage log file not found at $INPUT_USAGE_LOG\"\n    exit 1\nfi\n\nif [ ! -f \"$INPUT_OWNERS_FILE\" ]; then\n    echo \"ERROR: Owners file not found at $INPUT_OWNERS_FILE\"\n    exit 1\nfi\n\n# Create data directory "]
[25.729884, "i", "if it doesn't exist\nmkdir -p \"$INTERMEDIATE_DATA_DIR\"\n\necho \"Pipeline starting...\"\nEOF"]
[25.730005, "o", "cat > bin/generate_cost_report.sh << 'EOF'\r\n"]
[25.730036, "o", "\u001b[?2004l\r"]
[25.730082, "o", "\u001b[?2004h"]
[25.730108, "o", "> "]
[25.730153, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[25.730179, "o", "\u001b[?2004h"]
[25.730203, "o", "> \r\n\u001b[?2004l\r"]
[25.730227, "o", "\u001b[?2004h> "]
[25.73041, "o", "# FinOps Cost Reporting Pipeline v2\r\n\u001b[?2004l\r"]
[25.730438, "o", "\u001b[?2004h"]
[25.730466, "o", "> "]
[25.730643, "o", "# Automated container cost tracking workflow\r\n\u001b[?2004l\r"]
[25.730681, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[25.730705, "o", "\u001b[?2004h"]
[25.73073, "o", "> "]
[25.730842, "o", "# Default output file path\r\n\u001b[?2004l\r"]
[25.730864, "o", "\u001b[?2004h"]
[25.730892, "o", "> "]
[25.731163, "o", "DEFAULT_REPORT_FILE=\"/home/user/container_usage/cost_report.txt\"\r\n\u001b[?2004l\r"]
[25.731187, "o", "\u001b[?2004h"]
[25.731216, "o", "> \r\n\u001b[?2004l\r"]
[25.731241, "o", "\u001b[?2004h> "]
[25.731466, "o", "# Get output file from arguments or use default\r\n\u001b[?2004l\r"]
[25.73149, "o", "\u001b[?2004h"]
[25.731514, "o", "> "]
[25.731613, "o", "if [ \"$#\" -eq 0 ]; then\r\n\u001b[?2004l\r"]
[25.731648, "o", "\u001b[?2004h"]
[25.731673, "o", "> "]
[25.732, "o", "    OUTPUT_REPORT_FILE=\"$DEFAULT_REPORT_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h> else\r\n\u001b[?2004l\r\u001b[?2004h> "]
[25.73208, "o", "    OUTPUT_REPORT_FILE=\"$1\"\r\n\u001b[?2004l\r"]
[25.732104, "o", "\u001b[?2004h"]
[25.732133, "o", "> fi\r\n\u001b[?2004l\r"]
[25.732167, "o", "\u001b[?2004h> \r\n"]
[25.732191, "o", "\u001b[?2004l\r\u001b[?2004h"]
[25.732215, "o", "> "]
[25.732359, "o", "# Configuration variables\r\n\u001b[?2004l\r"]
[25.732382, "o", "\u001b[?2004h"]
[25.732404, "o", "> "]
[25.732658, "o", "INPUT_USAGE_LOG=\"/home/user/container_usage/usage.log\"\r\n\u001b[?2004l\r"]
[25.732687, "o", "\u001b[?2004h> "]
[25.732969, "o", "INPUT_OWNERS_FILE=\"/home/user/container_usage/owners_v2.csv\"\r\n\u001b[?2004l\r"]
[25.732994, "o", "\u001b[?2004h"]
[25.733017, "o", "> "]
[25.733147, "o", "INTERMEDIATE_DATA_DIR=\"/home/user/data\"\r\n\u001b[?2004l\r"]
[25.733176, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[25.733206, "o", "\u001b[?2004h> "]
[25.733313, "o", "echo \"FinOps Cost Reporting Pipeline v2\"\r\n\u001b[?2004l\r"]
[25.733341, "o", "\u001b[?2004h> "]
[25.733494, "o", "echo \"Output report will be written to: $OUTPUT_REPORT_FILE\"\r\n\u001b[?2004l\r"]
[25.733518, "o", "\u001b[?2004h> "]
[25.733695, "o", "echo \"Intermediate files will be stored in: $INTERMEDIATE_DATA_DIR\"\r\n\u001b[?2004l\r"]
[25.733718, "o", "\u001b[?2004h> "]
[25.733746, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[25.733832, "o", "# Check if input files exist\r\n\u001b[?2004l\r"]
[25.733853, "o", "\u001b[?2004h> "]
[25.733959, "o", "if [ ! -f \"$INPUT_USAGE_LOG\" ]; then\r\n\u001b[?2004l\r"]
[25.733986, "o", "\u001b[?2004h> "]
[25.734143, "o", "    echo \"ERROR: Usage log file not found at $INPUT_USAGE_LOG\"\r\n\u001b[?2004l\r"]
[25.734167, "o", "\u001b[?2004h> "]
[25.734194, "o", "    exit 1\r\n\u001b[?2004l\r"]
[25.734217, "o", "\u001b[?2004h> "]
[25.734241, "o", "fi\r\n\u001b[?2004l\r"]
[25.734275, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[25.734299, "o", "> "]
[25.734399, "o", "if [ ! -f \"$INPUT_OWNERS_FILE\" ]; then\r\n\u001b[?2004l\r"]
[25.734414, "o", "\u001b[?2004h"]
[25.734443, "o", "> "]
[25.734583, "o", "    echo \"ERROR: Owners file not found at $INPUT_OWNERS_FILE\"\r\n\u001b[?2004l\r"]
[25.734607, "o", "\u001b[?2004h> "]
[25.734639, "o", "    exit 1\r\n\u001b[?2004l\r"]
[25.73466, "o", "\u001b[?2004h> "]
[25.734686, "o", "fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[25.734709, "o", "> \r\n\u001b[?2004l\r"]
[25.734733, "o", "\u001b[?2004h> "]
[25.734848, "o", "# Create data directory if it doesn't exist\r\n\u001b[?2004l\r"]
[25.734873, "o", "\u001b[?2004h> "]
[25.734957, "o", "mkdir -p \"$INTERMEDIATE_DATA_DIR\"\r\n\u001b[?2004l\r"]
[25.734983, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[25.735008, "o", "\u001b[?2004h> "]
[25.735085, "o", "echo \"Pipeline starting...\"\r\n\u001b[?2004l\r"]
[25.735099, "o", "\u001b[?2004h> "]
[25.735117, "o", "EOF"]
[47.322698, "i", "cat >> bin/generate_cost_report.sh << 'EOF'\n\n######################################################################\n# Phase 1: Ingestion & Sanitization\n######################################################################\n\nclean_usage_file=\"$INTERMEDIATE_DATA_DIR/clean_usage.csv\"\necho \"Phase 1: Processing usage data...\"\n\n# Check if usage.log contains data\nif [ ! -s \"$INPUT_USAGE_LOG\" ]; then\n    echo \"ERROR: Usage log file is empty\"\n    exit 1\nfi\n\n# Process usage.log - remove comments, sanitize numeric fields, convert to standard CSV\nawk -F, 'BEGIN { \n    print \"container_id,image,cpu_percent,mem_mb,runtime_hours,cost_per_hour\" > \"\"clean_usage_file\"\" \n    OFS=\",\" \n}\n/^#/ { next } # Skip comment lines\n!NF { next } # Skip empty lines\n{\n    # Sanitize numeric fields - convert NULL/N/A to 0\n    gsub(\"NULL\", \"0\", $3); gsub(\"N/A\", \"0\", $3)\n    gsub(\"NULL\", \"0\", $4); gsub(\"N/A\", \"0\", $4)\n    gsub(\"NULL\", \"0\", $5); gsub(\"N/A\", \"0\", $5)\n    gsub(\"NULL\", \"0\", $6); gsub(\"N/A\", \"0\", $6)\n    print $0 \n}' \"$INPUT_USAGE_LO"]
[47.322737, "i", "G\"\n\nif [ ! -s \"$clean_usage_file\" ]; then\n    echo \"ERROR: Failed to generate cleaned usage data\"\n    exit 1\nfi\n\necho \"Phase 1 complete: Cleaned usage data saved to $clean_usage_file\"\nEOF"]
[47.322976, "o", "cat >> bin/generate_cost_report.sh << 'EOF'\r\n"]
[47.32299, "o", "\u001b[?2004l\r"]
[47.323039, "o", "\u001b[?2004h"]
[47.323052, "o", "> \r\n\u001b[?2004l\r"]
[47.323085, "o", "\u001b[?2004h"]
[47.323119, "o", "> "]
[47.323431, "o", "######################################################################\r\n\u001b[?2004l\r"]
[47.32346, "o", "\u001b[?2004h"]
[47.323493, "o", "> "]
[47.32363, "o", "# Phase 1: Ingestion & Sanitization\r\n\u001b[?2004l\r"]
[47.323666, "o", "\u001b[?2004h> "]
[47.323981, "o", "######################################################################\r\n\u001b[?2004l\r"]
[47.324019, "o", "\u001b[?2004h"]
[47.32404, "o", "> \r\n\u001b[?2004l\r"]
[47.324082, "o", "\u001b[?2004h> "]
[47.324337, "o", "clean_usage_file=\"$INTERMEDIATE_DATA_DIR/clean_usage.csv\"\r\n\u001b[?2004l\r"]
[47.324362, "o", "\u001b[?2004h"]
[47.324433, "o", "> "]
[47.324565, "o", "echo \"Phase 1: Processing usage data...\"\r\n\u001b[?2004l\r"]
[47.324599, "o", "\u001b[?2004h"]
[47.324628, "o", "> \r\n\u001b[?2004l\r"]
[47.324658, "o", "\u001b[?2004h"]
[47.324683, "o", "> "]
[47.324806, "o", "# Check if usage.log contains data\r\n\u001b[?2004l\r"]
[47.324831, "o", "\u001b[?2004h"]
[47.324856, "o", "> "]
[47.325008, "o", "if [ ! -s \"$INPUT_USAGE_LOG\" ]; then\r\n\u001b[?2004l\r"]
[47.325035, "o", "\u001b[?2004h"]
[47.325064, "o", "> "]
[47.325232, "o", "    echo \"ERROR: Usage log file is empty\"\r\n\u001b[?2004l\r"]
[47.325256, "o", "\u001b[?2004h"]
[47.325304, "o", "> "]
[47.325331, "o", "    exit 1\r\n\u001b[?2004l\r"]
[47.325356, "o", "\u001b[?2004h"]
[47.325382, "o", "> "]
[47.32541, "o", "fi\r\n\u001b[?2004l\r"]
[47.325436, "o", "\u001b[?2004h"]
[47.325461, "o", "> \r\n\u001b[?2004l\r"]
[47.325487, "o", "\u001b[?2004h"]
[47.325513, "o", "> "]
[47.325866, "o", "# Process usage.log - remove comments, sanitize numeric fields, convert to standard CSV\r\n\u001b[?2004l\r"]
[47.325897, "o", "\u001b[?2004h"]
[47.325921, "o", "> "]
[47.325998, "o", "awk -F, 'BEGIN { \r\n\u001b[?2004l\r"]
[47.326028, "o", "\u001b[?2004h"]
[47.326052, "o", "> "]
[47.326503, "o", "    print \"container_id,image,cpu_percent,mem_mb,runtime_hours,cost_per_hour\" > \"\"clean_usage_file\"\" \r\n\u001b[?2004l\r"]
[47.326539, "o", "\u001b[?2004h"]
[47.32656, "o", "> "]
[47.326614, "o", "    OFS=\",\" \r\n"]
[47.32664, "o", "\u001b[?2004l\r"]
[47.32667, "o", "\u001b[?2004h"]
[47.326699, "o", "> }\r\n\u001b[?2004l\r"]
[47.32672, "o", "\u001b[?2004h"]
[47.326747, "o", "> "]
[47.326869, "o", "/^#/ { next } # Skip comment lines\r\n\u001b[?2004l\r"]
[47.326896, "o", "\u001b[?2004h"]
[47.32692, "o", "> "]
[47.327059, "o", "!NF { next } # Skip empty lines\r\n\u001b[?2004l\r"]
[47.327088, "o", "\u001b[?2004h"]
[47.327117, "o", "> {\r\n\u001b[?2004l\r"]
[47.327146, "o", "\u001b[?2004h"]
[47.327164, "o", "> "]
[47.327411, "o", "    # Sanitize numeric fields - convert NULL/N/A to 0\r\n"]
[47.327442, "o", "\u001b[?2004l\r"]
[47.327469, "o", "\u001b[?2004h> "]
[47.32767, "o", "    gsub(\"NULL\", \"0\", $3); gsub(\"N/A\", \"0\", $3)\r\n\u001b[?2004l\r"]
[47.327698, "o", "\u001b[?2004h"]
[47.327728, "o", "> "]
[47.327926, "o", "    gsub(\"NULL\", \"0\", $4); gsub(\"N/A\", \"0\", $4)\r\n\u001b[?2004l\r"]
[47.327956, "o", "\u001b[?2004h"]
[47.327987, "o", "> "]
[47.328185, "o", "    gsub(\"NULL\", \"0\", $5); gsub(\"N/A\", \"0\", $5)\r\n\u001b[?2004l\r"]
[47.328215, "o", "\u001b[?2004h"]
[47.328247, "o", "> "]
[47.328471, "o", "    gsub(\"NULL\", \"0\", $6); gsub(\"N/A\", \"0\", $6)\r\n\u001b[?2004l\r"]
[47.328516, "o", "\u001b[?2004h> "]
[47.328578, "o", "    print $0 \r\n\u001b[?2004l\r"]
[47.328621, "o", "\u001b[?2004h> "]
[47.328701, "o", "}' \"$INPUT_USAGE_LOG\"\r\n\u001b[?2004l\r"]
[47.328743, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[47.328786, "o", "\u001b[?2004h> "]
[47.328947, "o", "if [ ! -s \"$clean_usage_file\" ]; then\r\n\u001b[?2004l\r"]
[47.32899, "o", "\u001b[?2004h> "]
[47.329231, "o", "    echo \"ERROR: Failed to generate cleaned usage data\"\r\n\u001b[?2004l\r"]
[47.329284, "o", "\u001b[?2004h> "]
[47.329329, "o", "    exit 1\r\n\u001b[?2004l\r"]
[47.329375, "o", "\u001b[?2004h> fi\r\n\u001b[?2004l\r"]
[47.32942, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[47.329462, "o", "\u001b[?2004h> "]
[47.329772, "o", "echo \"Phase 1 complete: Cleaned usage data saved to $clean_usage_file\"\r\n\u001b[?2004l\r"]
[47.329818, "o", "\u001b[?2004h> EOF"]
[186.398751, "i", "cat >> bin/generate_cost_report.sh << 'EOF'\n######################################################################\n# Phase 2: Enrichment & Cost Modeling\n######################################################################\n\ncost_model_file=\"$INTERMEDIATE_DATA_DIR/cost_model.json\"\necho \"Phase 2: Enriching data and modeling costs...\"\n\n# Function to convert UTF-16LE file to UTF-8 CSV\nconvert_utf16le_to_csv() {\n    local utf16le_file=\"$1\"\n    local output_file=\"$2\"\n    iconv -f UTF-16LE -t UTF-8 \"$utf16le_file\" | \\\n    awk -F';' 'BEGIN { OFS=\",\" } { \\$1=\\$1; gsub(/^\\\\xEF\\\\xBB\\\\xBF/, \"\", \\$0); print }' > \"$output_file\"\n}\n\n# Convert owners file from UTF-16LE to UTF-8 CSV\nowners_utf8_file=\"$INTERMEDIATE_DATA_DIR/owners_utf8.csv\"\nconvert_utf16le_to_csv \"$INPUT_OWNERS_FILE\" \"$owners_utf8_file\"\n\nif [ ! -s \"$owners_utf8_file\" ]; then\n    echo \"ERROR: Failed to convert owners file\"\n    exit 1\nfi\n\n# Get current timestamp\nmetadata_timestamp=$(date -u +%Y-%m-%dT%H:%M:%SZ)\n\n# Calculate SHA256 hash of clean usage file\nsource"]
[186.39888, "i", "_hash=$(sha256sum \"$clean_usage_file\" | awk '{print tolower($1)}')\n\n# Join usage data with owner information and calculate costs\nawk -F, '\nBEGIN {\n    print \"{\\n  \\\"_meta\\\": {\\n    \\\"generated\\\": \\\"\"metadata_timestamp\"\\\",\\n    \\\"source_hash\\\": \\\"\"source_hash\"\\\"\\n  },\\n  \\\"data\\\": [\" > \"\"cost_model_file\"\"\n    OFS=\",\" \n}\nNR==FNR {\n    if (NR>1) {\n        owners[$1] = $2 \";\" $3 \";\" $4\n    }\n    next\n}\nNR==1 {\n    # Skip header for usage file\n    next\n}\n{\n    # Get owner info or set defaults\n    owner_info = ($1 in owners) ? owners[$1] : \"Unknown;prod;global\"\n    split(owner_info, fields, \";\")\n    owner_email = fields[1]\n    environment = fields[2]\n    region = fields[3]\n    \n    # Convert to numbers, treat empty as 0\n    cpu_percent = ($3 ~ /^[0-9.]+$/) ? $3 : 0\n    mem_mb = ($4 ~ /^[0-9.]+$/) ? $4 : 0\n    runtime_hours = ($5 ~ /^[0-9.]+$/) ? $5 : 0\n    cost_per_hour = ($6 ~ /^[0-9.]+$/) ? $6 : 0\n    \n    # Calculate base cost\n    base_cost = runtime_hours * cost_per_hour\n    \n    # Apply regional tax\n    if (re"]
[186.398983, "i", "gion == \"eu-west\") {\n        taxed_cost = base_cost * 1.10\n        tax_rate = \"10%\"\n    } else if (region == \"us-east\") {\n        taxed_cost = base_cost\n        tax_rate = \"0%\"\n    } else {\n        taxed_cost = base_cost * 1.05\n        tax_rate = \"5%\"\n    }\n    \n    # Apply environment discount\n    if (environment == \"dev\") {\n        final_cost = taxed_cost * 0.50\n    } else {\n        final_cost = taxed_cost\n    }\n    \n    # Round final cost to 4 decimal places\n    final_cost_rounded = sprintf(\"%.4f\", final_cost)\n    \n    # Determine if idle\n    is_idle = (cpu_percent <= 5.0 && mem_mb < 512) ? \"true\" : \"false\"\n    \n    # Format JSON object\n    if (NR>2) {\n        print \",\" >> \"\"cost_model_file\"\" \n    }\n    printf \"{\\n    \\\"container_id\\\": \\\"%s\\\",\\n    \\\"image\\\": \\\"%s\\\",\\n    \\\"cpu_percent\\\": %.2f,\\n    \\\"mem_mb\\\": %.2f,\\n    \\\"runtime_hours\\\": %.2f,\\n    \\\"cost_per_hour\\\": %.2f,\\n    \\\"owner_email\\\": \\\"%s\\\",\\n    \\\"environment\\\": \\\"%s\\\",\\n    \\\"region\\\": \\\"%s\\\",\\n    \\\"tax_rate\\\": \\\"%s\\\",\\n    \\\"total_cost\\\":"]
[186.399048, "o", "cat >> bin/generate_cost_report.sh << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> "]
[186.399115, "i", " %.4f,\\n    \\\"is_idle\\\": %s\\n\" \n    , $1, $2, cpu_percent, mem_mb, runtime_hours, cost_per_hour \n    , owner_email, environment, region, tax_rate, final_cost_rounded, is_idle >> \"\"cost_model_file\"\"\n}\nEND {\n    print \"\\n  ]\\n}\" >> \"\"cost_model_file\"\"\n}\n' \"$owners_utf8_file\" \"$clean_usage_file\"\n\nif [ ! -s \"$cost_model_file\" ]; then\n    echo \"ERROR: Failed to generate cost model JSON\"\n    exit 1\nfi\n\necho \"Phase 2 complete: Cost model saved to $cost_model_file\"\nEOF"]
[186.399189, "o", "######################################################################\r\n\u001b[?2004l\r"]
[186.399246, "o", "\u001b[?2004h> "]
[186.399358, "o", "# Phase 2: Enrichment & Cost Modeling\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.399411, "o", "> "]
[186.399572, "o", "######################################################################\r\n\u001b[?2004l\r"]
[186.399625, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[186.399779, "o", "cost_model_file=\"$INTERMEDIATE_DATA_DIR/cost_model.json\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.399816, "o", "> "]
[186.39996, "o", "echo \"Phase 2: Enriching data and modeling costs...\"\r\n\u001b[?2004l\r"]
[186.399992, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[186.400023, "o", "\u001b[?2004h> "]
[186.400142, "o", "# Function to convert UTF-16LE file to UTF-8 CSV\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.400171, "o", "> "]
[186.400232, "o", "convert_utf16le_to_csv() {\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.400261, "o", "> "]
[186.400393, "o", "    local utf16le_file=\"$1\"\r\n\u001b[?2004l\r"]
[186.400426, "o", "\u001b[?2004h> "]
[186.400579, "o", "    local output_file=\"$2\"\r\n\u001b[?2004l\r"]
[186.400609, "o", "\u001b[?2004h> "]
[186.400847, "o", "    iconv -f UTF-16LE -t UTF-8 \"$utf16le_file\" | \\\r\n\u001b[?2004l\r"]
[186.400876, "o", "\u001b[?2004h> "]
[186.401358, "o", "    awk -F';' 'BEGIN { OFS=\",\" } { \\$1=\\$1; gsub(/^\\\\xEF\\\\xBB\\\\xBF/, \"\", \\$0); print }' > \"$output_file\"\r\n\u001b[?2004l\r"]
[186.401392, "o", "\u001b[?2004h> }\r\n\u001b[?2004l\r"]
[186.401422, "o", "\u001b[?2004h"]
[186.401452, "o", "> \r\n\u001b[?2004l\r"]
[186.40148, "o", "\u001b[?2004h> "]
[186.401712, "o", "# Convert owners file from UTF-16LE to UTF-8 CSV\r\n\u001b[?2004l\r"]
[186.401742, "o", "\u001b[?2004h> "]
[186.402038, "o", "owners_utf8_file=\"$INTERMEDIATE_DATA_DIR/owners_utf8.csv\"\r\n\u001b[?2004l\r"]
[186.402072, "o", "\u001b[?2004h"]
[186.402101, "o", "> "]
[186.402445, "o", "convert_utf16le_to_csv \"$INPUT_OWNERS_FILE\" \"$owners_utf8_file\"\r\n\u001b[?2004l\r"]
[186.402475, "o", "\u001b[?2004h> "]
[186.402505, "o", "\r\n\u001b[?2004l\r"]
[186.402532, "o", "\u001b[?2004h> "]
[186.402729, "o", "if [ ! -s \"$owners_utf8_file\" ]; then\r\n\u001b[?2004l\r"]
[186.402757, "o", "\u001b[?2004h> "]
[186.402992, "o", "    echo \"ERROR: Failed to convert owners file\"\r\n\u001b[?2004l\r"]
[186.403022, "o", "\u001b[?2004h> "]
[186.403088, "o", "    exit 1\r\n\u001b[?2004l\r"]
[186.403116, "o", "\u001b[?2004h"]
[186.403148, "o", "> fi\r\n\u001b[?2004l\r"]
[186.40318, "o", "\u001b[?2004h> "]
[186.403254, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[186.403381, "o", "# Get current timestamp\r\n\u001b[?2004l\r"]
[186.403431, "o", "\u001b[?2004h> "]
[186.403658, "o", "metadata_timestamp=$(date -u +%Y-%m-%dT%H:%M:%SZ)\r\n\u001b[?2004l\r"]
[186.403707, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[186.403746, "o", "\u001b[?2004h> "]
[186.403968, "o", "# Calculate SHA256 hash of clean usage file\r\n\u001b[?2004l\r"]
[186.404011, "o", "\u001b[?2004h> "]
[186.404347, "o", "source_hash=$(sha256sum \"$clean_usage_file\" | awk '{print tolower($1)}')\r\n\u001b[?2004l\r"]
[186.404383, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[186.404424, "o", "\u001b[?2004h> "]
[186.404707, "o", "# Join usage data with owner information and calculate costs\r\n\u001b[?2004l\r"]
[186.40474, "o", "\u001b[?2004h> "]
[186.404782, "o", "awk -F, '\r\n\u001b[?2004l\r"]
[186.404824, "o", "\u001b[?2004h> "]
[186.404884, "o", "BEGIN {\r\n\u001b[?2004l\r"]
[186.404917, "o", "\u001b[?2004h> "]
[186.40564, "o", "    print \"{\\n  \\\"_meta\\\": {\\n    \\\"generated\\\": \\\"\"metadata_timestamp\"\\\",\\n    \\\"source_hash\\\": \\\"\"source_hash\"\\\"\\n  },\\n  \\\"data\\\": [\" > \"\"cost_model_file\"\" \r\u001bM\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[C\u001b[K\"\r\n"]
[186.405677, "o", "\u001b[?2004l\r\u001b[?2004h"]
[186.405719, "o", "> "]
[186.405761, "o", "    OFS=\",\" \r\n\u001b[?2004l\r"]
[186.405791, "o", "\u001b[?2004h"]
[186.405822, "o", "> }\r\n\u001b[?2004l\r"]
[186.405854, "o", "\u001b[?2004h> "]
[186.405915, "o", "NR==FNR {\r\n\u001b[?2004l\r"]
[186.405942, "o", "\u001b[?2004h> "]
[186.406037, "o", "    if (NR>1) {\r\n\u001b[?2004l\r"]
[186.406068, "o", "\u001b[?2004h> "]
[186.406254, "o", "        owners[$1] = $2 \";\" $3 \";\" $4\r\n\u001b[?2004l\r"]
[186.406308, "o", "\u001b[?2004h> "]
[186.406357, "o", "    }\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.40639, "o", "> "]
[186.40642, "o", "    next\r\n\u001b[?2004l\r"]
[186.406478, "o", "\u001b[?2004h> }\r\n\u001b[?2004l\r"]
[186.406546, "o", "\u001b[?2004h> "]
[186.40659, "o", "NR==1 {\r\n\u001b[?2004l\r"]
[186.406627, "o", "\u001b[?2004h"]
[186.406655, "o", "> "]
[186.406803, "o", "    # Skip header for usage file\r\n\u001b[?2004l\r"]
[186.406835, "o", "\u001b[?2004h"]
[186.406868, "o", "> "]
[186.406913, "o", "    next\r\n\u001b[?2004l\r"]
[186.406939, "o", "\u001b[?2004h"]
[186.406986, "o", "> }\r\n\u001b[?2004l\r"]
[186.407032, "o", "\u001b[?2004h> {\r\n\u001b[?2004l\r"]
[186.407078, "o", "\u001b[?2004h> "]
[186.407262, "o", "    # Get owner info or set defaults\r\n\u001b[?2004l\r"]
[186.407318, "o", "\u001b[?2004h> "]
[186.407627, "o", "    owner_info = ($1 in owners) ? owners[$1] : \"Unknown;prod;global\"\r\n\u001b[?2004l\r"]
[186.407673, "o", "\u001b[?2004h> "]
[186.407839, "o", "    split(owner_info, fields, \";\")\r\n\u001b[?2004l\r"]
[186.407885, "o", "\u001b[?2004h> "]
[186.40802, "o", "    owner_email = fields[1]\r\n\u001b[?2004l\r"]
[186.408069, "o", "\u001b[?2004h> "]
[186.4082, "o", "    environment = fields[2]\r\n\u001b[?2004l\r"]
[186.408245, "o", "\u001b[?2004h> "]
[186.408368, "o", "    region = fields[3]\r\n\u001b[?2004l\r"]
[186.408416, "o", "\u001b[?2004h> "]
[186.408463, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h"]
[186.408509, "o", "> "]
[186.408692, "o", "    # Convert to numbers, treat empty as 0\r\n\u001b[?2004l\r"]
[186.408739, "o", "\u001b[?2004h> "]
[186.408954, "o", "    cpu_percent = ($3 ~ /^[0-9.]+$/) ? $3 : 0\r\n\u001b[?2004l\r"]
[186.409002, "o", "\u001b[?2004h> "]
[186.409192, "o", "    mem_mb = ($4 ~ /^[0-9.]+$/) ? $4 : 0\r\n\u001b[?2004l\r"]
[186.409239, "o", "\u001b[?2004h> "]
[186.40946, "o", "    runtime_hours = ($5 ~ /^[0-9.]+$/) ? $5 : 0\r\n\u001b[?2004l\r"]
[186.409501, "o", "\u001b[?2004h> "]
[186.409733, "o", "    cost_per_hour = ($6 ~ /^[0-9.]+$/) ? $6 : 0\r\n\u001b[?2004l\r"]
[186.409788, "o", "\u001b[?2004h> "]
[186.409838, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h> "]
[186.409981, "o", "    # Calculate base cost\r\n\u001b[?2004l\r"]
[186.410048, "o", "\u001b[?2004h> "]
[186.410246, "o", "    base_cost = runtime_hours * cost_per_hour\r\n\u001b[?2004l\r"]
[186.410307, "o", "\u001b[?2004h>     \r\n\u001b[?2004l\r"]
[186.410364, "o", "\u001b[?2004h> "]
[186.410492, "o", "    # Apply regional tax\r\n\u001b[?2004l\r"]
[186.410542, "o", "\u001b[?2004h> "]
[186.410687, "o", "    if (region == \"eu-west\") {\r\n\u001b[?2004l\r"]
[186.410738, "o", "\u001b[?2004h> "]
[186.410916, "o", "        taxed_cost = base_cost * 1.10\r\n\u001b[?2004l\r"]
[186.410967, "o", "\u001b[?2004h> "]
[186.411085, "o", "        tax_rate = \"10%\"\r\n\u001b[?2004l\r"]
[186.411151, "o", "\u001b[?2004h> "]
[186.41134, "o", "    } else if (region == \"us-east\") {\r\n\u001b[?2004l\r"]
[186.411386, "o", "\u001b[?2004h> "]
[186.411525, "o", "        taxed_cost = base_cost\r\n\u001b[?2004l\r"]
[186.411572, "o", "\u001b[?2004h> "]
[186.41169, "o", "        tax_rate = \"0%\"\r\n\u001b[?2004l\r"]
[186.411736, "o", "\u001b[?2004h> "]
[186.411799, "o", "    } else {\r\n\u001b[?2004l\r"]
[186.411844, "o", "\u001b[?2004h> "]
[186.412025, "o", "        taxed_cost = base_cost * 1.05\r\n\u001b[?2004l\r"]
[186.412072, "o", "\u001b[?2004h> "]
[186.412181, "o", "        tax_rate = \"5%\"\r\n\u001b[?2004l\r"]
[186.412227, "o", "\u001b[?2004h> "]
[186.412291, "o", "    }\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.412337, "o", ">     \r\n\u001b[?2004l\r"]
[186.412383, "o", "\u001b[?2004h> "]
[186.412544, "o", "    # Apply environment discount\r\n\u001b[?2004l\r"]
[186.41259, "o", "\u001b[?2004h> "]
[186.412736, "o", "    if (environment == \"dev\") {\r\n\u001b[?2004l\r"]
[186.412781, "o", "\u001b[?2004h> "]
[186.412979, "o", "        final_cost = taxed_cost * 0.50\r\n\u001b[?2004l\r"]
[186.413023, "o", "\u001b[?2004h> "]
[186.413092, "o", "    } else {\r\n\u001b[?2004l\r"]
[186.413123, "o", "\u001b[?2004h"]
[186.413161, "o", "> "]
[186.413316, "o", "        final_cost = taxed_cost\r\n\u001b[?2004l\r"]
[186.413352, "o", "\u001b[?2004h"]
[186.413369, "o", "> "]
[186.413428, "o", "    }\r\n\u001b[?2004l\r\u001b[?2004h"]
[186.413458, "o", "> "]
[186.413489, "o", "    \r\n\u001b[?2004l\r"]
[186.413522, "o", "\u001b[?2004h> "]
[186.413741, "o", "    # Round final cost to 4 decimal places\r\n\u001b[?2004l\r"]
[186.413771, "o", "\u001b[?2004h"]
[186.4138, "o", "> "]
[186.414034, "o", "    final_cost_rounded = sprintf(\"%.4f\", final_cost)\r\n\u001b[?2004l\r"]
[186.414063, "o", "\u001b[?2004h"]
[186.414093, "o", "> "]
[186.414123, "o", "    \r\n\u001b[?2004l\r"]
[186.414152, "o", "\u001b[?2004h> "]
[186.414281, "o", "    # Determine if idle\r\n\u001b[?2004l\r"]
[186.414311, "o", "\u001b[?2004h"]
[186.414345, "o", "> "]
[186.414649, "o", "    is_idle = (cpu_percent <= 5.0 && mem_mb < 512) ? \"true\" : \"false\"\r\n\u001b[?2004l\r"]
[186.414678, "o", "\u001b[?2004h"]
[186.414707, "o", "> "]
[186.414731, "o", "    \r\n\u001b[?2004l\r"]
[186.41476, "o", "\u001b[?2004h"]
[186.414788, "o", "> "]
[186.414901, "o", "    # Format JSON object\r\n\u001b[?2004l\r"]
[186.414929, "o", "\u001b[?2004h"]
[186.414958, "o", "> "]
[186.415036, "o", "    if (NR>2) {\r\n\u001b[?2004l\r"]
[186.415065, "o", "\u001b[?2004h"]
[186.415094, "o", "> "]
[186.415301, "o", "        print \",\" >> \"\"cost_model_file\"\" \r\n\u001b[?2004l\r"]
[186.41533, "o", "\u001b[?2004h> "]
[186.41537, "o", "    }\r\n\u001b[?2004l\r"]
[186.4154, "o", "\u001b[?2004h"]
[186.415429, "o", "> "]
[186.416934, "o", "    printf \"{\\n    \\\"container_id\\\": \\\"%s\\\",\\n    \\\"image\\\": \\\"%s\\\",\\n    \\\"cpu_percent\\\": %.2f,\\n    \\\"mem_mb\\\": %.2f,\\n    \\\"runtime_hours\\\": %.2f,\\n    \\\"cost_per_hour\\\": %.2f,\\n    \\\"owner_email\\\": \\\"%s\\\",\\n    \\\"environment\\\": \\\"%s\\\",\\n    \\\"region\\\": \\\"%s\\\",\\n    \\\"tax_rate\\\": \\\"%s\\\",\\n    \\\"total_cost\\\": %.4f,\\n    \\\"is_idle\\\": %s\\n\" \r\n\u001b[?2004l\r"]
[186.416975, "o", "\u001b[?2004h> "]
[186.417286, "o", "    , $1, $2, cpu_percent, mem_mb, runtime_hours, cost_per_hour \r\n\u001b[?2004l\r"]
[186.417331, "o", "\u001b[?2004h> "]
[186.41778, "o", "    , owner_email, environment, region, tax_rate, final_cost_rounded, is_idle >> \"\"cost_model_file\"\"\r\n\u001b[?2004l\r"]
[186.417824, "o", "\u001b[?2004h"]
[186.417857, "o", "> }\r\n\u001b[?2004l\r"]
[186.417886, "o", "\u001b[?2004h"]
[186.417915, "o", "> "]
[186.417944, "o", "END {\r\n\u001b[?2004l\r"]
[186.417973, "o", "\u001b[?2004h"]
[186.418001, "o", "> "]
[186.418195, "o", "    print \"\\n  ]\\n}\" >> \"\"cost_model_file\"\"\r\n\u001b[?2004l\r"]
[186.418224, "o", "\u001b[?2004h"]
[186.418254, "o", "> }\r\n\u001b[?2004l\r"]
[186.418299, "o", "\u001b[?2004h> "]
[186.418504, "o", "' \"$owners_utf8_file\" \"$clean_usage_file\"\r\n\u001b[?2004l\r"]
[186.418537, "o", "\u001b[?2004h"]
[186.418569, "o", "> \r\n\u001b[?2004l\r"]
[186.418598, "o", "\u001b[?2004h> "]
[186.418776, "o", "if [ ! -s \"$cost_model_file\" ]; then\r\n\u001b[?2004l\r"]
[186.41881, "o", "\u001b[?2004h"]
[186.418839, "o", "> "]
[186.419087, "o", "    echo \"ERROR: Failed to generate cost model JSON\"\r\n\u001b[?2004l\r"]
[186.41913, "o", "\u001b[?2004h> "]
[186.419196, "o", "    exit 1\r\n\u001b[?2004l\r"]
[186.419226, "o", "\u001b[?2004h"]
[186.419256, "o", "> fi\r\n\u001b[?2004l\r"]
[186.419296, "o", "\u001b[?2004h"]
[186.419326, "o", "> \r\n\u001b[?2004l\r"]
[186.419355, "o", "\u001b[?2004h> "]
[186.419661, "o", "echo \"Phase 2 complete: Cost model saved to $cost_model_file\"\r\n\u001b[?2004l\r"]
[186.419692, "o", "\u001b[?2004h> "]
[186.419722, "o", "EOF"]
[218.163994, "i", "cat >> bin/generate_cost_report.sh << 'EOF'\n\n######################################################################\n# Phase 3: Final Reporting\n######################################################################\necho \"Phase 3: Generating final report...\"\n\n# Convert JSON to CSV for easier parsing\njson_to_csv() {\n    jq -r '.data[] | [.container_id, .region, .tax_rate, .total_cost] | @csv' \"$cost_model_file\" |\n    awk -F, '{ printf(\"%s | %s | %s | %.2f\\\\n\", $1, $2, $3, $4) }'\n}\n\n# Generate CSV content\nfinal_data_csv=$(json_to_csv)\n\n# Extract individual fields\ncontainer_ids=$(jq -r '.data[].container_id' \"$cost_model_file\")\nregions=$(jq -r '.data[].region' \"$cost_model_file\")\ntax_rates=$(jq -r '.data[].tax_rate' \"$cost_model_file\") \ncosts=$(jq -r '.data[].total_cost' \"$cost_model_file\" | awk '{printf \"%.2f\\\\n\", $1}')\n\n# Calculate summary statistics\nactive_containers=$(jq '.data[] | select(.is_idle == false) | length' \"$cost_model_file\")\nidle_containers=$(jq '.data[] | select(.is_idle == true) | length' \"$cost_"]
[218.164124, "i", "model_file\")\ntotal_cost=$(jq -r '.data[] | .total_cost' \"$cost_model_file\" | awk '{sum+=$1} END {printf \"%.2f\", sum}')\n\n# Get integrity hash\nintegrity_hash=$(md5sum \"$cost_model_file\" | awk '{print $1}')\n\n# Create report header with current date\nreport_header=\"FinOps Cost Report (v2)\\nDate: $(date +\\%Y-\\%m-\\%d)\\n\\nContainer \\| Region \\| Tax \\| Cost\\n---------------------------------\"\n\n# Combine all report parts and convert to ISO-8859-1 encoding\nreport_content=\"$report_header\\n$final_data_csv\\n\\nSummary\\n=======\\nActive Containers: $active_containers\\nIdle Containers: $idle_containers\\nTotal Cost: \\$${total_cost}\\n\\n[Integrity Hash: ${integrity_hash}]\"\n\n# Write report to specified output file (convert to Latin-1 encoding)\necho \"$report_content\" | iconv -f UTF-8 -t ISO-8859-1 > \"$OUTPUT_REPORT_FILE\"\n\nif [ ! -s \"$OUTPUT_REPORT_FILE\" ]; then\n    echo \"ERROR: Failed to generate final report\"\n    exit 1\nfi\n\necho \"Pipeline complete! Report saved to $OUTPUT_REPORT_FILE\"\necho \"All deliverables created successfully.\"\n"]
[218.164149, "i", "EOF"]
[218.164184, "o", "cat >> bin/generate_cost_report.sh << 'EOF'\r\n"]
[218.164214, "o", "\u001b[?2004l\r"]
[218.164235, "o", "\u001b[?2004h"]
[218.164258, "o", "> \r\n\u001b[?2004l\r"]
[218.164281, "o", "\u001b[?2004h"]
[218.164302, "o", "> "]
[218.164483, "o", "######################################################################\r\n\u001b[?2004l\r"]
[218.164508, "o", "\u001b[?2004h> "]
[218.164587, "o", "# Phase 3: Final Reporting\r\n\u001b[?2004l\r"]
[218.164609, "o", "\u001b[?2004h> "]
[218.164798, "o", "######################################################################\r\n\u001b[?2004l\r"]
[218.164822, "o", "\u001b[?2004h> "]
[218.164943, "o", "echo \"Phase 3: Generating final report...\"\r\n\u001b[?2004l\r"]
[218.164965, "o", "\u001b[?2004h> "]
[218.164987, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[218.165007, "o", "> "]
[218.165119, "o", "# Convert JSON to CSV for easier parsing\r\n\u001b[?2004l\r"]
[218.165143, "o", "\u001b[?2004h> "]
[218.165196, "o", "json_to_csv() {\r\n\u001b[?2004l\r"]
[218.165214, "o", "\u001b[?2004h"]
[218.165238, "o", "> "]
[218.165494, "o", "    jq -r '.data[] | [.container_id, .region, .tax_rate, .total_cost] | @csv' \"$cost_model_file\" |\r\n\u001b[?2004l\r"]
[218.165518, "o", "\u001b[?2004h> "]
[218.165698, "o", "    awk -F, '{ printf(\"%s | %s | %s | %.2f\\\\n\", $1, $2, $3, $4) }'\r\n\u001b[?2004l\r"]
[218.165721, "o", "\u001b[?2004h> "]
[218.165745, "o", "}\r\n\u001b[?2004l\r\u001b[?2004h"]
[218.165767, "o", "> \r\n\u001b[?2004l\r"]
[218.165789, "o", "\u001b[?2004h> "]
[218.165858, "o", "# Generate CSV content\r\n\u001b[?2004l\r"]
[218.165877, "o", "\u001b[?2004h"]
[218.165903, "o", "> "]
[218.165972, "o", "final_data_csv=$(json_to_csv)\r\n\u001b[?2004l\r"]
[218.165991, "o", "\u001b[?2004h> "]
[218.166013, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[218.166033, "o", "> "]
[218.166108, "o", "# Extract individual fields\r\n\u001b[?2004l\r"]
[218.166135, "o", "\u001b[?2004h> "]
[218.166314, "o", "container_ids=$(jq -r '.data[].container_id' \"$cost_model_file\")\r\n\u001b[?2004l\r"]
[218.166334, "o", "\u001b[?2004h> "]
[218.166479, "o", "regions=$(jq -r '.data[].region' \"$cost_model_file\")\r\n\u001b[?2004l\r"]
[218.166498, "o", "\u001b[?2004h> "]
[218.166657, "o", "tax_rates=$(jq -r '.data[].tax_rate' \"$cost_model_file\") \r\n\u001b[?2004l\r"]
[218.166677, "o", "\u001b[?2004h> "]
[218.166902, "o", "costs=$(jq -r '.data[].total_cost' \"$cost_model_file\" | awk '{printf \"%.2f\\\\n\", $1}')\r\n\u001b[?2004l\r"]
[218.16692, "o", "\u001b[?2004h> "]
[218.166941, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[218.166965, "o", "> "]
[218.167045, "o", "# Calculate summary statistics\r\n\u001b[?2004l\r"]
[218.167067, "o", "\u001b[?2004h> "]
[218.16731, "o", "active_containers=$(jq '.data[] | select(.is_idle == false) | length' \"$cost_model_file\")\r\n\u001b[?2004l\r"]
[218.167328, "o", "\u001b[?2004h> "]
[218.167557, "o", "idle_containers=$(jq '.data[] | select(.is_idle == true) | length' \"$cost_model_file\")\r\n\u001b[?2004l\r"]
[218.167585, "o", "\u001b[?2004h> "]
[218.167854, "o", "total_cost=$(jq -r '.data[] | .total_cost' \"$cost_model_file\" | awk '{sum+=$1} END {printf \"%.2f\", sum}')\r\n\u001b[?2004l\r"]
[218.16788, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[218.167904, "o", "\u001b[?2004h> "]
[218.16797, "o", "# Get integrity hash\r\n\u001b[?2004l\r"]
[218.168, "o", "\u001b[?2004h> "]
[218.168162, "o", "integrity_hash=$(md5sum \"$cost_model_file\" | awk '{print $1}')\r\n\u001b[?2004l\r"]
[218.16818, "o", "\u001b[?2004h> "]
[218.168203, "o", "\r\n\u001b[?2004l\r"]
[218.168227, "o", "\u001b[?2004h> "]
[218.168339, "o", "# Create report header with current date\r\n\u001b[?2004l\r"]
[218.168359, "o", "\u001b[?2004h> "]
[218.168721, "o", "report_header=\"FinOps Cost Report (v2)\\nDate: $(date +\\%Y-\\%m-\\%d)\\n\\nContainer \\| Region \\| Tax \\| Cost\\n---------------------------------\"\r\n\u001b[?2004l\r"]
[218.168756, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[218.168781, "o", "\u001b[?2004h> "]
[218.16894, "o", "# Combine all report parts and convert to ISO-8859-1 encoding\r\n\u001b[?2004l\r"]
[218.16896, "o", "\u001b[?2004h> "]
[218.169498, "o", "report_content=\"$report_header\\n$final_data_csv\\n\\nSummary\\n=======\\nActive Containers: $active_containers\\nIdle Containers: $idle_containers\\nTotal Cost: \\$${total_cost}\\n\\n[Integrity Hash: ${integrity_hash}]\"\r\n\u001b[?2004l\r"]
[218.169545, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[218.169569, "o", "> "]
[218.169741, "o", "# Write report to specified output file (convert to Latin-1 encoding)\r\n\u001b[?2004l\r"]
[218.169764, "o", "\u001b[?2004h"]
[218.169788, "o", "> "]
[218.169979, "o", "echo \"$report_content\" | iconv -f UTF-8 -t ISO-8859-1 > \"$OUTPUT_REPORT_FILE\"\r\n\u001b[?2004l\r"]
[218.169998, "o", "\u001b[?2004h> "]
[218.170022, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[218.170044, "o", "> "]
[218.170146, "o", "if [ ! -s \"$OUTPUT_REPORT_FILE\" ]; then\r\n\u001b[?2004l\r"]
[218.170162, "o", "\u001b[?2004h"]
[218.170188, "o", "> "]
[218.170314, "o", "    echo \"ERROR: Failed to generate final report\"\r\n\u001b[?2004l\r"]
[218.170331, "o", "\u001b[?2004h"]
[218.17035, "o", "> "]
[218.17038, "o", "    exit 1\r\n\u001b[?2004l\r"]
[218.170399, "o", "\u001b[?2004h> "]
[218.170421, "o", "fi\r\n\u001b[?2004l\r"]
[218.170449, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[218.170468, "o", "\u001b[?2004h> "]
[218.170639, "o", "echo \"Pipeline complete! Report saved to $OUTPUT_REPORT_FILE\"\r\n\u001b[?2004l\r"]
[218.170656, "o", "\u001b[?2004h"]
[218.170675, "o", "> "]
[218.170795, "o", "echo \"All deliverables created successfully.\"\r\n\u001b[?2004l\r"]
[218.170811, "o", "\u001b[?2004h"]
[218.170838, "o", "> EOF"]
[218.970433, "i", "chmod +x bin/generate_cost_report.sh\n"]
[218.970701, "o", "chmod +x bin/generate_cost_report.sh\r\n"]
[218.97072, "o", "\u001b[?2004l\r"]
[218.9708, "o", "\u001b[?2004h> "]
[219.177442, "i", "echo \"Script development complete. All phases implemented successfully.\"\n"]
[219.177712, "o", "echo \"Script development complete. All phases implemented successfully.\"\r\n\u001b[?2004l\r"]
[219.177752, "o", "\u001b[?2004h> "]
