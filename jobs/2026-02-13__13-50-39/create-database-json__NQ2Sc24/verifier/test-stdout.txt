Hit:1 http://security.ubuntu.com/ubuntu jammy-security InRelease
Hit:2 http://archive.ubuntu.com/ubuntu jammy InRelease
Hit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
curl is already the newest version (7.81.0-1ubuntu1.21).
0 upgraded, 0 newly installed, 0 to remove and 3 not upgraded.
downloading uv 0.9.5 x86_64-unknown-linux-gnu
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Downloading cpython-3.12.12-linux-x86_64-gnu (download) (31.1MiB)
 Downloading cpython-3.12.12-linux-x86_64-gnu (download)
Downloading pygments (1.2MiB)
 Downloading pygments
Installed 5 packages in 14ms
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.1, pluggy-1.6.0 -- /root/.cache/uv/archive-v0/kmeveKkGtUYGpQN9in1pM/bin/python
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 5 items

../../tests/test_final_state.py::test_environment_packages FAILED        [ 20%]
../../tests/test_final_state.py::test_staging_file_existence_and_encoding FAILED [ 40%]
../../tests/test_final_state.py::test_staging_file_content FAILED        [ 60%]
../../tests/test_final_state.py::test_report_structure_and_hash FAILED   [ 80%]
../../tests/test_final_state.py::test_suggestions_logic FAILED           [100%]

=================================== FAILURES ===================================
__________________________ test_environment_packages ___________________________

    def test_environment_packages():
        venv_pip = BASE_DIR / "env/bin/pip"
        assert venv_pip.exists(), "Virtual environment not found"
    
        # Check installed packages
        import subprocess
        res = subprocess.run([str(venv_pip), "list", "--format=json"], capture_output=True, text=True)
        pkgs = {p["name"]: p["version"] for p in json.loads(res.stdout)}
    
        assert pkgs.get("sqlparse") == "0.4.4"
>       assert pkgs.get("psycopg2-binary") == "2.9.7"
E       AssertionError: assert '2.9.9' == '2.9.7'
E         
E         - 2.9.7
E         ?     ^
E         + 2.9.9
E         ?     ^

/tests/test_final_state.py:45: AssertionError
___________________ test_staging_file_existence_and_encoding ___________________

    def test_staging_file_existence_and_encoding():
>       assert STAGING_FILE.exists(), "Staging CSV file missing"
E       AssertionError: Staging CSV file missing
E       assert False
E        +  where False = exists()
E        +    where exists = PosixPath('/home/user/query_optimization/staging/raw_extract.csv').exists

/tests/test_final_state.py:48: AssertionError
__________________________ test_staging_file_content ___________________________

    def test_staging_file_content():
        # Read with correct encoding and newline handling
>       with open(STAGING_FILE, "r", encoding="iso-8859-1", newline="") as f:
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/home/user/query_optimization/staging/raw_extract.csv'

/tests/test_final_state.py:64: FileNotFoundError
________________________ test_report_structure_and_hash ________________________

    def test_report_structure_and_hash():
>       assert REPORT_FILE.exists()
E       AssertionError: assert False
E        +  where False = exists()
E        +    where exists = PosixPath('/home/user/query_optimization/report.json').exists

/tests/test_final_state.py:76: AssertionError
____________________________ test_suggestions_logic ____________________________

    def test_suggestions_logic():
>       with open(REPORT_FILE, "r", encoding="utf-8") as f:
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/home/user/query_optimization/report.json'

/tests/test_final_state.py:90: FileNotFoundError
=========================== short test summary info ============================
FAILED ../../tests/test_final_state.py::test_environment_packages - Assertion...
FAILED ../../tests/test_final_state.py::test_staging_file_existence_and_encoding
FAILED ../../tests/test_final_state.py::test_staging_file_content - FileNotFo...
FAILED ../../tests/test_final_state.py::test_report_structure_and_hash - Asse...
FAILED ../../tests/test_final_state.py::test_suggestions_logic - FileNotFound...
============================== 5 failed in 0.31s ===============================
