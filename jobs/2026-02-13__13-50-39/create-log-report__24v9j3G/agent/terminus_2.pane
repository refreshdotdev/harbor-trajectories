[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:~# clear
[?2004l[H[J[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:~# cd /home/user/datasets
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# mkdir -p organized/png_large organized/jpg_old organized/misc_small
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# touch organized/organize_log.tsv organized/summary.json
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# cd organized
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# moved_count=0; copied_count=0; total_bytes=0
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# echo -e "original_path\tnew_absolute_path\tsize_bytes\tmtime_epoch\tmd5_hash" > organize_log.tsv
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# cd ..
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# find raw -type f -print0 | sort -z | while IFS= read -r -d '' src; do
[?2004l[?2004h> dst_base="${src##*/}"
[?2004l[?2004h> dir_name="$(dirname "$src" | xargs basename)"
[?2004l[?2004h> if [ ! -L "$src" ] && [ "$(stat -c %a "$src" 2>/dev/null)" != "000" ]; then
[?2004l[?2004h>     case "$dst_base" in
[?2004l[?2004h>         *.png)
[?2004l[?2004h>             if [ "$(stat -c %s "$src" 2>/dev/null)" -gt 1000000 ]; then
[?2004l[?2004h>                 echo "Processing PNG: $src"
[?2004l[?2004h>                 if [ -f "organized/png_large/$dst_base" ]; then
[?2004l[?2004h>                     new_dst="${dst_base%.*}_${dir_name}.${dst_base##*.}"
[?2004l[?2004h>                     mv "$src" "organized/png_large/$new_dst" && new_path=$(realpath "organized/png_large/$new_dst")
[?2004l[?2004h>                 else
[?2004l[?2004h>                     mv "$src" "organized/png_large/$dst_base" && new_path=$(realpath "organized/png_large/$dst_base")
[?2004l[?2004h>                 fi
[?2004l[?2004h>                 size=$(stat -c %s "$new_path" 2>/dev/null)
[?2004l[?2004h>                 mtime=$(stat -c %Y "$new_path" 2>/dev/null)
[?2004l[?2004h>                 hash=$(md5sum "$new_path" | cut -d' ' -f1)
[?2004l[?2004h>                 echo -e "$src\t$new_path\t$size\t$mtime\t$hash" >> organized/organize_log.tsv
[?2004l[?2004h>                 let "moved_count+=1"
[?2004l[?2004h>                 let "total_bytes+=${size:-0}"
[?2004l[?2004h>             fi
[?2004l[?2004h>             ;;
[?2004l[?2004h>         *.jpg)
[?2004l[?2004h>             if [ "$(stat -c %Y "$src" 2>/dev/null)" -lt 1625097600 ]; then
[?2004l[?2004h>                 echo "Processing JPG: $src"
[?2004l[?2004h>                 if [ -f "organized/jpg_old/$dst_base" ]; then
[?2004l[?2004h>                     new_dst="${dst_base%.*}_${dir_name}.${dst_base##*.}"
[?2004l[?2004h>                     cp -a "$src" "organized/jpg_old/$new_dst" && new_path=$(realpath "organized/jpg_old/$new_dst")
[?2004l[?2004h>                 else
[?2004l[?2004h>                     cp -a "$src" "organized/jpg_old/$dst_base" && new_path=$(realpath "organized/jpg_old/$dst_base")
[?2004l[?2004h>                 fi
[?2004l[?2004h>                 size=$(stat -c %s "$new_path" 2>/dev/null)
[?2004l[?2004h>                 mtime=$(stat -c %Y "$new_path" 2>/dev/null)
[?2004l[?2004h>                 hash=$(md5sum "$new_path" | cut -d' ' -f1)
[?2004l[?2004h>                 echo -e "$src\t$new_path\t$size\t$mtime\t$hash" >> organized/organize_log.tsv
[?2004l[?2004h>                 let "copied_count+=1"
[?2004l[?2004h>                 let "total_bytes+=${size:-0}"
[?2004l[?2004h>             fi
[?2004l[?2004h>             ;;
[?2004l[?2004h>     esac
[?2004l[?2004h> fi
[?2004l[?2004h> done
[?2004lProcessing JPG: raw/orphan.jpg
Processing PNG: raw/projectA/img1.png
Processing JPG: raw/projectA/old1.jpg
Processing PNG: raw/projectB/big_graph.png
Processing PNG: raw/projectB/img1.png
[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# find raw -type f -print0 | sort -z | while IFS= read -r -d '' src; do
[?2004l[?2004h>     dst_base="${src##*/}"
[?2004l[?2004h>     dir_name="$(dirname "$src" | xargs basename)"
[?2004l[?2004h>     if [ ! -L "$src" ] && [ "$(stat -c %a "$src" 2>/dev/null)" != "000" ]; then
[?2004l[?2004h>         case "$dst_base" in
[?2004l[?2004h>             *.png)
[?2004l[?2004h>                 if [ "$(stat -c %s "$src" 2>/dev/null)" -gt 1000000 ]; then
[?2004l[?2004h>                     echo "Processing PNG: $src"
[?2004l[?2004h>                     if [ -f "organized/png_large/$dst_base" ]; then
[?2004l[?2004h>                         new_dst="${dst_base%.*}_${dir_name}.${dst_base##*.}"
[?2004l[?2004h>                         mv "$src" "organized/png_large/$new_dst" && new_path=$(realpath "organized/png_large/$new_dst")
[?2004l[?2004h>                     else
[?2004l[?2004h>                         mv "$src" "organized/png_large/$dst_base" && new_path=$(realpath "organized/png_large/$dst_base")
[?2004l[?2004h>                     fi
[?2004l[?2004h>                     size=$(stat -c %s "$new_path" 2>/dev/null)
[?2004l[?2004h>                     mtime=$(stat -c %Y "$new_path" 2>/dev/null)
[?2004l[?2004h>                     hash=$(md5sum "$new_path" | cut -d' ' -f1)
[?2004l[?2004h>                     echo -e "$src\t$new_path\t$size\t$mtime\t$hash" >> organized/organize_log.tsv
[?2004l[?2004h>                     let "moved_count+=1"
[?2004l[?2004h>                     let "total_bytes+=${size:-0}"
[?2004l[?2004h>                 fi
[?2004l[?2004h>                 ;;
[?2004l[?2004h>             *.jpg)
[?2004l[?2004h>                 if [ "$(stat -c %Y "$src" 2>/dev/null)" -lt 1625097600 ]; then
[?2004l[?2004h>                     echo "Processing JPG: $src"
[?2004l[?2004h>                     if [ -f "organized/jpg_old/$dst_base" ]; then
[?2004l[?2004h>                         new_dst="${dst_base%.*}_${dir_name}.${dst_base##*.}"
[?2004l[?2004h>                         cp -a "$src" "organized/jpg_old/$new_dst" && new_path=$(realpath "organized/jpg_old/$new_dst")
[?2004l[?2004h>                     else
[?2004l[?2004h>                         cp -a "$src" "organized/jpg_old/$dst_base" && new_path=$(realpath "organized/jpg_old/$dst_base")
[?2004l[?2004h>                     fi
[?2004l[?2004h>                     size=$(stat -c %s "$new_path" 2>/dev/null)
[?2004l[?2004h>                     mtime=$(stat -c %Y "$new_path" 2>/dev/null)
[?2004l[?2004h>                     hash=$(md5sum "$new_path" | cut -d' ' -f1)
[?2004l[?2004h>                     echo -e "$src\t$new_path\t$size\t$mtime\t$hash" >> organized/organize_log.tsv
[?2004l[?2004h>                     let "copied_count+=1"
[?2004l[?2004h>                     let "total_bytes+=${size:-0}"
[?2004l[?2004h>                 fi
[?2004l[?2004h>                 ;;
[?2004l[?2004h>             *)
[?2004l[?2004h>                 if [ "${dst_base##*.}" != "txt" ] && [ "$(stat -c %s "$src" 2>/dev/null)" -le 512000 ]; then
[?2004l[?2004h>                     echo "Processing MISC: $src"
[?2004l[?2004h>                     if [ -f "organized/misc_small/$dst_base" ]; then
[?2004l[?2004h>                         new_dst="${dst_base%.*}_${dir_name}.${dst_base##*.}"
[?2004l[?2004h>                         cp -a "$src" "organized/misc_small/$new_dst" && new_path=$(realpath "organized/misc_small/$new_dst")
[?2004l[?2004h>                     else
[?2004l[?2004h>                         cp -a "$src" "organized/misc_small/$dst_base" && new_path=$(realpath "organized/misc_small/$dst_base")
[?2004l[?2004h>                     fi
[?2004l[?2004h>                     size=$(stat -c %s "$new_path" 2>/dev/null)
[?2004l[?2004h>                     mtime=$(stat -c %Y "$new_path" 2>/dev/null)
[?2004l[?2004h>                     hash=$(md5sum "$new_path" | cut -d' ' -f1)
[?2004l[?2004h>                     echo -e "$src\t$new_path\t$size\t$mtime\t$hash" >> organized/organize_log.tsv
[?2004l[?2004h>                     let "copied_count+=1"
[?2004l[?2004h>                     let "total_bytes+=${size:-0}"
[?2004l[?2004h>                 fi
[?2004l[?2004h>                 ;;
[?2004l[?2004h>         esac
[?2004l[?2004h>     fi
[?2004l[?2004h> done
[?2004lProcessing JPG: raw/orphan.jpg
Processing JPG: raw/projectA/old1.jpg
Processing MISC: raw/projectB/locked.dat
Processing MISC: raw/projectB/tiny.dat
Processing MISC: raw/readme.md
[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets# cd organized
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# tail -n +2 organize_log.tsv | sort -k1 > organize_log_sorted.tmp && mv organize_log_sorted.tmp organize_log.tsv
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# echo "{\"moved_count\": $moved_count, \"copied_count\": $copied_count, \"total_bytes\": $total_bytes}" > summary.json
[?2004l[?2004hroot@4ae6d2bb-a43d-4ccf-939c-1c831a251b49:/home/user/datasets/organized# 