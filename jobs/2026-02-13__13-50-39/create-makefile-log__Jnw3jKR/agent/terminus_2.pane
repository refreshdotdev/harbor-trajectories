[?2004hroot@b4e94858-9976-4f8d-8697-addb5ad6d2b1:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@b4e94858-9976-4f8d-8697-addb5ad6d2b1:~# clear
[?2004l[H[J[?2004hroot@b4e94858-9976-4f8d-8697-addb5ad6d2b1:~# mkdir -p /home/user/netdiag/logs
[?2004l[?2004hroot@b4e94858-9976-4f8d-8697-addb5ad6d2b1:~# cd /home/user/netdiag
[?2004l[?2004hroot@b4e94858-9976-4f8d-8697-addb5ad6d2b1:/home/user/netdiag# cat > Makefile << 'EOF'
[?2004l[?2004h> TARGET_IP ?= 127.0.0.1
[?2004l[?2004h> LOG_DIR = $(shell dirname $(abspath logs/loopback.log))
[?2004l[?2004h> LOG_FILE = $(LOG_DIR)/loopback.log
[?2004l[?2004h> LOG_BAK_FILE = $(LOG_DIR)/loopback.bak
[?2004l[?2004h> SESSION_TIME := $(shell date -u +%Y-%m-%dT%H:%M:%SZ)
[?2004l[?2004h> 
[?2004l[?2004h> .PHONY: all ping trace clean
[?2004l[?2004h> 
[?2004l[?2004h> all: rotate_log session_header ping trace
[?2004l[?2004h> 
[?2004l[?2004h> rotate_log:
[?2004l[?2004h> logs/@echo "Checking log size for rotation..."
[?2004l[?2004h> logs/@LOG_SIZE=$$(stat --printf="%s" $(LOG_FILE) 2>/dev/null || echo "0"); \
[?2004l[?2004h> logs/if [ "$${LOG_SIZE}" -gt 500 ]; then \
[?2004l[?2004h> logs/  echo "Log file size ($${LOG_SIZE}) > 500 bytes. Rotating..."; \
[?2004l[?2004h> logs/  mv -f $(LOG_FILE) $(LOG_BAK_FILE); \
[?2004l[?2004h> logs/else \
[?2004l[?2004h> logs/  echo "Log file size ($${LOG_SIZE}) <= 500 bytes or does not exist. No rotation needed."; \
[?2004l[?2004h> logs/fi
[?2004l[?2004h> 
[?2004l[?2004h> session_header:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> SESSION: $(SESSION_TIME)" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> ping:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> PING START" >> $(LOG_FILE)
[?2004l[?2004h> logs/@ping -c 3 $(TARGET_IP) | grep -i "bytes from" >> $(LOG_FILE)
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> PING END" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> trace:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> TRACE START" >> $(LOG_FILE)
[?2004l[?2004h> logs/@traceroute -m 3 -n $(TARGET_IP) >> $(LOG_FILE)
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> TRACE END" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> clean:
[?2004l[?2004h> logs/rm -f $(LOG_FILE) $(LOG_BAK_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> EOFmake
[?2004l[?2004h> rm Makefile
[?2004l[?2004h> cat > Makefile << 'EOF'
[?2004l >> $(LOG_FILE)

EOF[?2004h> TARGET_IP ?= 127.0.0.1
[?2004l[?2004h> LOG_DIR = $(shell dirname $(abspath logs/loopback.log))
[?2004l[?2004h> LOG_FILE = $(LOG_DIR)/loopback.log
[?2004l[?2004h> LOG_BAK_FILE = $(LOG_DIR)/loopback.bak
[?2004l[?2004h> SESSION_TIME := $(shell date -u +%Y-%m-%dT%H:%M:%SZ)
[?2004l[?2004h> 
[?2004l[?2004h> .PHONY: all ping trace clean
[?2004l[?2004h> 
[?2004l[?2004h> all: rotate_log session_header ping trace
[?2004l[?2004h> 
[?2004l[?2004h> rotate_log:
[?2004l[?2004h> logs/@echo "Checking log size for rotation..."
[?2004l[?2004h> logs/@LOG_SIZE=$$(stat --printf="%s" $(LOG_FILE) 2>/dev/null || echo "0"); \
[?2004l[?2004h> logs/if [ "$${LOG_SIZE}" -gt 500 ]; then \
[?2004l[?2004h> logs/  echo "Log file size ($${LOG_SIZE}) > 500 bytes. Rotating..."; \
[?2004l[?2004h> logs/  mv -f $(LOG_FILE) $(LOG_BAK_FILE); \
[?2004l[?2004h> logs/else \
[?2004l[?2004h> logs/  echo "Log file size ($${LOG_SIZE}) <= 500 bytes or does not exist. No rotation needed."; \
[?2004l[?2004h> logs/fi
[?2004l[?2004h> 
[?2004l[?2004h> session_header:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> SESSION: $(SESSION_TIME)" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> ping:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> PING START" >> $(LOG_FILE)
[?2004l[?2004h> logs/@ping -c 3 $(TARGET_IP) | grep -i "bytes from" >> $(LOG_FILE)
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> PING END" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> trace:
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> TRACE START" >> $(LOG_FILE)
[?2004l[?2004h> logs/@traceroute -m 3 -n $(TARGET_IP) >> $(LOG_FILE)
[?2004l[?2004h> logs/@echo "
[?2004l[?2004h> >>> TRACE END" >> $(LOG_FILE)
[?2004l[?2004h> 
[?2004l[?2004h> EOFmake
[?2004l[?2004h> 