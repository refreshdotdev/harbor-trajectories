[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:~# clear
[?2004l[H[J[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:~# mkdir -p /home/user/netdiag/logs
[?2004l[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:~# cd /home/user/netdiag
[?2004l[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# cat > Makefile << EOF
[?2004l[?2004h> TARGET_IP ?= 127.0.0.1
[?2004l[?2004h> LOG_DIR = logs
[?2004l[?2004h> LOG_FILE = $(LOG_DIR)/loopback.log
[?2004l[?2004h> BAK_FILE = $(LOG_DIR)/loopback.bak
[?2004l[?2004h> 
[?2004l[?2004h> .PHONY: all ping trace clean
[?2004l[?2004h> 
[?2004l[?2004h> all: rotate_log session_header ping trace
[?2004l[?2004h> 
[?2004l[?2004h> # Log Rotation: If loopback.log exceeds 500 bytes, rotate it
[?2004l[?2004h> rotate_log:
[?2004l[?2004h> logs/@stat -c%s "$${LOG_FILE}" 2>/dev/null | grep -q '[1-9][0-9][0-9][0-9][0-9]' 2>/dev/null; \
[?2004l[?2004h> logs/if [ $$? -eq 0 ]; then \
[?2004l[?2004h> logs/if [ "$${LOG_FILE}" != "$${BAK_FILE}" ]; then \
[?2004l[?2004h> logs/mv -f "$${LOG_FILE}" "$${BAK_FILE}" 2>/dev/null || true; \
[?2004l[?2004h> logs/fi; \
[?2004l[?2004h> logs/fi
[?2004l[?2004h> 
[?2004l[?2004h> # Session Header: UTC ISO 8601 format (YYYY-MM-DDTHH:MM:SSZ)
[?2004l[?2004h> session_header:
[?2004l[?2004h> logs/@echo ">>> SESSION: $$(date --iso-8601=seconds --utc)Z" >> "$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> # Ping target
[?2004l[?2004h> ping:
[?2004l[?2004h> logs/@echo ">>> PING START" >> "$${LOG_FILE}"
[?2004l[?2004h> logs/@ping -c 3 "$${TARGET_IP}" 2>&1 | grep -i "bytes from" >> "$${LOG_FILE}"
[?2004l[?2004h> logs/@echo ">>> PING END" >> "$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> # Traceroute to target (max 3 hops)
[?2004l[?2004h> trace:
[?2004l[?2004h> logs/@echo ">>> TRACE START" >> "$${LOG_FILE}"
[?2004l[?2004h> logs/@traceroute -m 3 "$${TARGET_IP}" 2>&1 >> "$${LOG_FILE}"
[?2004l[?2004h> logs/@echo ">>> TRACE END" >> "$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> clean:
[?2004l[?2004h> logs/rm -f "$${LOG_FILE}" "$${BAK_FILE}
[?2004l[?2004h> 
[?2004l[?2004h> EOF
[?2004lbash: LOG_DIR: command not found
bash: LOG_DIR: command not found
[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# make
[?2004lMakefile:12: *** missing separator.  Stop.
[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# rm -f Makefile
[?2004l[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# cat > Makefile << EOF
[?2004l[?2004h> TARGET_IP ?= 127.0.0.1
[?2004l[?2004h> LOG_DIR = logs
[?2004l[?2004h> LOG_FILE = $(LOG_DIR)/loopback.log
[?2004l[?2004h> BAK_FILE = $(LOG_DIR)/loopback.bak
[?2004l[?2004h> 
[?2004l[?2004h> .PHONY: all ping trace clean
[?2004l[?2004h> 
[?2004l[?2004h> all: rotate_log session_header ping trace
[?2004l[?2004h> 
[?2004l[?2004h> # Log Rotation: If loopback.log exceeds 500 bytes, rotate it
[?2004l[?2004h> rotate_log:
[?2004l[?2004h> logs/@stat -c%s "$$${LOG_FILE}" 2>/dev/null | grep -q '[1-9][0-9][0-9][0-9][0-9]' 2>/dev/null; \
[?2004l[?2004h> logs/if [ $$? -eq 0 ]; then \
[?2004l[?2004h> logs/if [ "$$${LOG_FILE}" != "$$${BAK_FILE}" ]; then \
[?2004l[?2004h> logs/mv -f "$$${LOG_FILE}" "$$${BAK_FILE}" 2>/dev/null || true; \
[?2004l[?2004h> logs/fi; \
[?2004l[?2004h> logs/fi
[?2004l[?2004h> 
[?2004l[?2004h> # Session Header: UTC ISO 8601 format (YYYY-MM-DDTHH:MM:SSZ)
[?2004l[?2004h> session_header:
[?2004l[?2004h> logs/@echo ">>> SESSION: $$(date --iso-8601=seconds --utc)Z" >> "$$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> # Ping target
[?2004l[?2004h> ping:
[?2004l[?2004h> logs/@echo ">>> PING START" >> "$$${LOG_FILE}"
[?2004l[?2004h> logs/@ping -c 3 "$${TARGET_IP}" 2>&1 | grep -i "bytes from" >> "$$${LOG_FILE}"
[?2004l[?2004h> logs/@echo ">>> PING END" >> "$$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> # Traceroute to target (max 3 hops)
[?2004l[?2004h> trace:
[?2004l[?2004h> logs/@echo ">>> TRACE START" >> "$$${LOG_FILE}"
[?2004l[?2004h> logs/@traceroute -m 3 "$${TARGET_IP}" 2>&1 >> "$$${LOG_FILE}"
[?2004l[?2004h> logs/@echo ">>> TRACE END" >> "$$${LOG_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> clean:
[?2004l[?2004h> logs/rm -f "$$${LOG_FILE}" "$$${BAK_FILE}"
[?2004l[?2004h> 
[?2004l[?2004h> EOF
[?2004lbash: LOG_DIR: command not found
bash: LOG_DIR: command not found
[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# make
[?2004lMakefile:12: *** missing separator.  Stop.
[?2004hroot@8da850db-b34f-440b-ba23-69fe8257344a:/home/user/netdiag# 