[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:~# clear
[?2004l[H[J[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:~# cd /home/user/hardener
[?2004l[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:/home/user/hardener# touch bump.log
[?2004l[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:/home/user/hardener# sha256sum version.txt | awk '{print "START_HASH: " $1}' > bump.log
[?2004l[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:/home/user/hardener# awk 'NR>1 { printf "%s", $0 > "version.txt.tmp" }' version.txt && mv version.txt.tmp version.txt
[?2004lmv: cannot stat 'version.txt.tmp': No such file or directory
[?2004hroot@0922889e-7881-4f88-b0ff-e0a521a60871:/home/user/hardener# CURRENT_VERSION=$(grep -o "v[^"]*" version.txt) && echo "Processing $CURRENT_VERSION" >> bump.log M[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[C[Kg
[?2004l[?2004h> MAJOR=$(echo "$CURRENT_VERSION" | grep -o "v[0-9]*") && echo "MAJOR: $MAJOR" >> bump.log
[?2004l[?2004h> MINOR=$(echo "$CURRENT_VERSION" | grep -oP "(?<=\.)[0-9]+(?=\.)") && NEW_MINOR=$((MINOR + 1)) && echo "MINOR: $MINOR -> $NEW_MINOR" >> bump.log
[?2004l[?2004h> LABEL=$(echo "$CURRENT_VERSION" | grep -oP "(?<=\()[^)]+" | tr -d '
[?2004l[?2004h> ') && echo "LABEL: $LABEL" >> bump.log
[?2004l[?2004h> SUM_ASCII=$(echo -n "$LABEL" | LC_ALL=C grep -aob . | grep -o "[0-9]*" | awk '{sum+=$1} END {print sum}') && echo "ASCII SUM: $SUM_ASCII" >> bump.log
[?2004l[?2004h> MAGIC_OFFSET=$(cat .config/magic_offset) && echo "MAGIC OFFSET: $MAGIC_OFFSET" >> bump.log
[?2004l[?2004h> NEW_PATCH=$((SUM_ASCII + MAGIC_OFFSET)) && echo "NEW PATCH: $NEW_PATCH" >> bump.log
[?2004l[?2004h> echo "$MAJOR.$NEW_MINOR.$NEW_PATCH" | iconv -t ISO-8859-1 > version.txt
[?2004l[?2004h> if [ ! -s version.txt ]; then echo "v0.0.0 (initial)" > version.txt; fi
[?2004l[?2004h> CURRENT_VERSION=$(grep -o "v[^"]*" version.txt) || CURRENT_VERSION="v0.0.0 (initial)"
[?2004l[?2004h> echo "Processing ${CURRENT_VERSION:-v0.0.0 (initial)}" >> bump.log
[?2004l[?2004h> MAJOR=$(echo "${CURRENT_VERSION}" | grep -o "v[0-9]*") || MAJOR="v0"
[?2004l[?2004h> echo "MAJOR: ${MAJOR:-v0}" >> bump.log
[?2004l[?2004h> MINOR=$(echo "${CURRENT_VERSION}" | grep -oP "(?<=\.)[0-9]+(?=\.)") || MINOR=0
[?2004l[?2004h> NEW_MINOR=$((MINOR + 1))
[?2004l[?2004h> echo "MINOR: ${MINOR:-0} -> $NEW_MINOR" >> bump.log
[?2004l[?2004h> LABEL=$(echo "${CURRENT_VERSION}" | grep -oP "(?<=\()[^)]+") || LABEL=""
[?2004l[?2004h> echo "LABEL: ${LABEL:-}" >> bump.log
[?2004l[?2004h> SUM_ASCII=$(echo -n "${LABEL}" | LC_ALL=C grep -aob "." | grep -o "[0-9]*" | awk '{sum+=$1} END {print sum}') || SUM_ASCII=0
[?2004l[?2004h> echo "ASCII SUM: ${SUM_ASCII:-0}" >> bump.log
[?2004l[?2004h> MAGIC_OFFSET=$(cat .config/magic_offset 2>/dev/null) || MAGIC_OFFSET=0
[?2004l[?2004h> echo "MAGIC OFFSET: ${MAGIC_OFFSET:-0}" >> bump.log
[?2004l[?2004h> NEW_PATCH=$((SUM_ASCII + MAGIC_OFFSET))
[?2004l[?2004h> echo "NEW PATCH: $NEW_PATCH" >> bump.log
[?2004l[?2004h> echo "${MAJOR}.${NEW_MINOR}.${NEW_PATCH}" | iconv -t ISO-8859-1 > version.txt
[?2004l[?2004h> cat > changelog_section.txt << 'EOF'
[?2004l[?2004h> ## Version $(cat version.txt) :: $(date +%Y.%m.%d)
[?2004l[?2004h> EOF
[?2004l[?2004h> ADDED=\"\$(jq -r '.Added[] | select(. != null)' release_notes.json)\"
[?2004l[?2004h> SORTED_ADDED=$(echo "$ADDED" | jq -r '. | sort_by(-length) | sort_by(.)')
[?2004l[?2004h> if [ "$SORTED_ADDED" = "null" ]; then echo "### Added" >> changelog_section.txt && echo "_None_" >> changelog_section.txt; else echo "### Added" >> changelog_section.txt && echo "$SORTED_ADDED" | jq -r '.[] | "- \" + . + \""' >> changelog_section.txt; fi
[?2004l[?2004h> CHANGED=\"\$(jq -r '.Changed[] | select(. != null)' release_notes.json)\"
[?2004l[?2004h> SORTED_CHANGED=$(echo "$CHANGED" | jq -r '. | sort_by(-length) | sort_by(.)')
[?2004l[?2004h> if [ "$SORTED_CHANGED" = "null" ]; then echo "### Changed" >> changelog_section.txt && echo "_None_" >> changelog_section.txt; else echo "### Changed" >> changelog_section.txt && echo "$SORTED_CHANGED" | jq -r '.[] | "- \" + . + \""' >> changelog_section.txt; fi
[?2004l[?2004h> FIXED=\"\$(jq -r '.Fixed[] | select(. != null)' release_notes.json)\"
[?2004l[?2004h> SORTED_FIXED=$(echo "$FIXED" | jq -r '. | sort_by(-length) | sort_by(.)')
[?2004l[?2004h> if [ "$SORTED_FIXED" = "null" ]; then echo "### Fixed" >> changelog_section.txt && echo "_None_" >> changelog_section.txt; else echo "### Fixed" >> changelog_section.txt && echo "$SORTED_FIXED" | jq -r '.[] | "- \" + . + \""' >> changelog_section.txt; fi
[?2004l[?2004h> cat changelog_section.txt > temp.md && cat CHANGELOG.md >> temp.md && mv temp.md CHANGELOG.md
[?2004l[?2004h> unix2dos CHANGELOG.md
[?2004l[?2004h> mkdir -p dist
[?2004l[?2004h> echo "$(sha256sum version.txt | awk '{print $1 "  VERSION.TXT"}')" > dist/release.map
[?2004l[?2004h> echo "$(sha256sum CHANGELOG.md | awk '{print $1 "  CHANGELOG.MD"}')" >> dist/release.map
[?2004l[?2004h> sha256sum version.txt | awk '{print "END_HASH: " $1}' >> bump.log
[?2004l[?2004h> 