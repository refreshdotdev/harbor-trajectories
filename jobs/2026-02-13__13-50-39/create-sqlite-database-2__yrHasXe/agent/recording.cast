{"version": 2, "width": 160, "height": 40, "timestamp": 1771008750, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005916, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker# "]
[0.975803, "i", "clear\r"]
[0.975926, "o", "clear\r\n\u001b[?2004l\r"]
[0.977009, "o", "\u001b[H\u001b[J"]
[0.977213, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker# "]
[10.07974, "i", "mkdir -p configs db logs reports\n"]
[10.079885, "o", "mkdir -p configs db logs reports\r\n\u001b[?2004l\r"]
[10.126292, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker# "]
[10.147794, "i", "cd configs\n"]
[10.147868, "o", "cd configs\r\n\u001b[?2004l\r"]
[10.147938, "o", "\u001b[?2004h"]
[10.147964, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[10.259428, "i", "echo -e \"Host 192.168.1.1\\r\\nUser admin\\r\\nPort 22\\r\\nIdentityFile \\\"/home/user/.ssh/id_rsa\\\"\" > ssh.cfg\n"]
[10.259761, "o", "echo -e \"Host 192.168.1.1\\r\\nUser admin\\r\\nPort 22\\r\\nIdentityFile \\\"/home/user/.ssh/id_rsa\\\"\" > ssh.cfg\r\n\u001b[?2004l\r"]
[10.292475, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[10.372348, "i", "echo \"# Copyright © 2023 Example Corp\" > nginx.conf\n"]
[10.372823, "o", "echo \"# Copyright © 2023 Example Corp\" > nginx.conf\r\n\u001b[?2004l\r"]
[10.392428, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[10.622971, "i", "echo -e \"[app]\\nname = myapp\\nport = 8080\\n\\n# trailing whitespace test   \" > app.ini\n"]
[10.623633, "o", "echo -e \"[app]\\nname = myapp\\nport = 8080\\n\\n# trailing whitespace test   \" > app.ini\r\n\u001b[?2004l\r"]
[10.660797, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[10.707805, "i", "touch .hidden_file .gitkeep\n"]
[10.707954, "o", "touch .hidden_file .gitkeep\r\n\u001b[?2004l\r"]
[10.709128, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[10.893368, "i", "echo \"backup data\" > old.config.bak\n"]
[10.89353, "o", "echo \"backup data\" > old.config.bak\r\n\u001b[?2004l\r"]
[10.893723, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[11.019156, "i", "cd ..\n"]
[11.019267, "o", "cd ..\r\n\u001b[?2004l\r"]
[11.019397, "o", "\u001b[?2004h"]
[11.019446, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker# "]
[18.83716, "i", "cd configs\n"]
[18.837261, "o", "cd configs\r\n\u001b[?2004l\r"]
[18.837315, "o", "\u001b[?2004h"]
[18.83734, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[18.900534, "i", "sed -i 's/\\r$//' ssh.cfg\n"]
[18.900666, "o", "sed -i 's/\\r$//' ssh.cfg\r\n\u001b[?2004l\r"]
[18.902426, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[19.026473, "i", "iconv -f ISO-8859-1 -t UTF-8 nginx.conf > nginx.tmp && mv nginx.tmp nginx.conf\n"]
[19.027068, "o", "iconv -f ISO-8859-1 -t UTF-8 nginx.conf > nginx.tmp && mv nginx.tmp nginx.conf\r\n\u001b[?2004l\r"]
[19.03024, "o", "\u001b[?2004h"]
[19.030303, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[19.113192, "i", "sed -i 's/[ \\t]*$//' app.ini\n"]
[19.113327, "o", "sed -i 's/[ \\t]*$//' app.ini\r\n\u001b[?2004l\r"]
[19.114856, "o", "\u001b[?2004h"]
[19.114896, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[19.238015, "i", "ls -la\n"]
[19.238121, "o", "ls -la\r\n\u001b[?2004l\r"]
[19.239525, "o", "total 16\r\n"]
[19.239555, "o", "drwxrwxrwx 1 root root 112 Feb 13 18:52 \u001b[0m\u001b[34;42m.\u001b[0m\r\ndrwxrwxrwx 1 root root  78 Feb 13 18:52 \u001b[34;42m..\u001b[0m\r\n-rwxrwxrwx 1 root root  59 Feb 13 18:52 \u001b[01;32mapp.ini\u001b[0m\r\n-rw-r--r-- 1 root root   0 Feb 13 18:52 .gitkeep\r\n-rwxrwxrwx 1 root root   0 Feb 13 18:49 \u001b[01;32m.hidden\u001b[0m\r\n-rw-r--r-- 1 root root   0 Feb 13 18:52 .hidden_file\r\n-rw-r--r-- 1 root root  35 Feb 13 18:52 nginx.conf\r\n"]
[19.239578, "o", "-rw-r--r-- 1 root root  12 Feb 13 18:52 old.config.bak\r\n-rwxrwxrwx 1 root root   0 Feb 13 18:49 \u001b[01;32mrestore.bak\u001b[0m\r\n-rwxrwxrwx 1 root root  74 Feb 13 18:52 \u001b[01;32mssh.cfg\u001b[0m\r\n"]
[19.239789, "o", "\u001b[?2004h"]
[19.239808, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[19.346929, "i", "rm -f .hidden_file .gitkeep old.config.bak\n"]
[19.347095, "o", "rm -f .hidden_file .gitkeep old.config.bak\r\n\u001b[?2004l\r"]
[19.348373, "o", "\u001b[?2004h"]
[19.348417, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[19.500915, "i", "ls -la\n"]
[19.501021, "o", "ls -la\r\n\u001b[?2004l\r"]
[19.502352, "o", "total 12\r\n"]
[19.502398, "o", "drwxrwxrwx 1 root root 54 Feb 13 18:52 \u001b[0m\u001b[34;42m.\u001b[0m\r\ndrwxrwxrwx 1 root root 78 Feb 13 18:52 \u001b[34;42m..\u001b[0m\r\n-rwxrwxrwx 1 root root 59 Feb 13 18:52 \u001b[01;32mapp.ini\u001b[0m\r\n-rwxrwxrwx 1 root root  0 Feb 13 18:49 \u001b[01;32m.hidden\u001b[0m\r\n-rw-r--r-- 1 root root 35 Feb 13 18:52 nginx.conf\r\n-rwxrwxrwx 1 root root  0 Feb 13 18:49 \u001b[01;32mrestore.bak\u001b[0m\r\n-rwxrwxrwx 1 root root 74 Feb 13 18:52 \u001b[01;32mssh.cfg\u001b[0m\r\n"]
[19.50262, "o", "\u001b[?2004h"]
[19.502649, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[24.463717, "i", "rm -f .hidden restore.bak\n"]
[24.463831, "o", "rm -f .hidden restore.bak\r\n"]
[24.463859, "o", "\u001b[?2004l\r"]
[24.465249, "o", "\u001b[?2004hroot@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[24.548654, "i", "cat nginx.conf\n"]
[24.548759, "o", "cat nginx.conf\r\n\u001b[?2004l\r"]
[24.549652, "o", "# Copyright Â© 2023 Example Corp\r\n"]
[24.549814, "o", "\u001b[?2004h"]
[24.549835, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker/configs# "]
[24.656664, "i", "cd ..\n"]
[24.656771, "o", "cd ..\r\n\u001b[?2004l\r"]
[24.656807, "o", "\u001b[?2004h"]
[24.656829, "o", "root@a1bcaa34-2d93-4e84-9324-2aed6c124b95:/home/user/cmtracker# "]
[43.500236, "i", "cat > init_db.py << 'EOF'\n#!/usr/bin/env python3\nimport sqlite3\nimport os\nimport hashlib\nimport datetime\nfrom pathlib import Path\n\ndef get_file_magic_hex(filepath):\n    \"\"\"Get first 4 bytes of file as lowercase hex string.\"\"\"\n    try:\n        with open(filepath, 'rb') as f:\n            magic_bytes = f.read(4)\n        return magic_bytes.hex().lower()\n    except Exception as e:\n        return ''\n\ndef get_file_sha256(filepath):\n    \"\"\"Get SHA-256 hash of file content.\"\"\"\n    try:\n        hash_sha256 = hashlib.sha256()\n        with open(filepath, 'rb') as f:\n            for chunk in iter(lambda: f.read(4096), b''):\n                hash_sha256.update(chunk)\n        return hash_sha256.hexdigest()\n    except Exception as e:\n        return ''\n\ndef main():\n    db_path = 'db/audit.db'\n    configs_dir = 'configs'\n    \n    # Create database and tables\n    conn = sqlite3.connect(db_path)\n    cursor = conn.cursor()\n    \n    cursor.execute('''\n        CREATE TABLE IF NOT EXISTS tracked_files (\n            id INTEGER PRIMARY"]
[43.500379, "i", " KEY AUTOINCREMENT,\n            rel_path TEXT UNIQUE NOT NULL,\n            file_hash TEXT NOT NULL,\n            magic_hex TEXT NOT NULL,\n            size_bytes INTEGER NOT NULL\n        )''')\n    \n    cursor.execute('''\n        CREATE TABLE IF NOT EXISTS audit_events (\n            event_id INTEGER PRIMARY KEY AUTOINCREMENT,\n            file_id INTEGER NOT NULL,\n            event_type TEXT NOT NULL CHECK(event_type IN ('INIT', 'MODIFY', 'PERM')),\n            event_ts TEXT NOT NULL,\n            FOREIGN KEY (file_id) REFERENCES tracked_files (id)\n        )''')\n    \n    conn.commit()\n    \n    # Process files and insert into database\n    files_processed = 0\n    for filename in os.listdir(configs_dir):\n        filepath = os.path.join(configs_dir, filename)\n        if os.path.isfile(filepath):\n            try:\n                rel_path = filename\n                file_hash = get_file_sha256(filepath)\n                magic_hex = get_file_magic_hex(filepath)\n                size_bytes = os.path.getsize(filepath)\n        "]
[43.500485, "o", "cat > init_db.py << 'EOF'\r\n\u001b[?2004l\r KEY AUTOINCREMENT,\r\n            rel_path TEXT U"]
[43.500569, "i", "        mtime_ts = datetime.datetime.fromtimestamp(os.path.getmtime(filepath)).strftime('%Y-%m-%d %H:%M:%S')\n                \n                cursor.execute('''\n                    INSERT INTO tracked_files (rel_path, file_hash, magic_hex, size_bytes)\n                    VALUES (?, ?, ?, ?)\n                ''', (rel_path, file_hash, magic_hex, size_bytes))\n                \n                file_id = cursor.lastrowid\n                \n                cursor.execute('''\n                    INSERT INTO audit_events (file_id, event_type, event_ts)\n                    VALUES (?, 'INIT', ?)\n                ''', (file_id, mtime_ts))\n                \n                files_processed += 1\n                conn.commit()\n                print(f\"Processed: {filename}\")\n            except Exception as e:\n                print(f\"Error processing {filename}: {e}\")\n    \n    print(f\"{files_processed} files processed successfully\")\n    conn.close()\n\nif __name__ == '__main__':\n    main()\nEOF"]
[43.500594, "o", "NIQUE NOT NULL,\r\n            file_hash TEXT NOT NULL,\r\n            magic_hex TEXT NOT NULL,\r\n            siz"]
[43.500616, "o", "e_bytes INTEGER NOT NULL\r\n  "]
[43.500643, "o", "      )''')\r\n"]
[43.500665, "o", "    \r\n    c"]
[43.500685, "o", "ursor.ex"]
[43.500708, "o", "ecute('''\r\n      "]
[43.500723, "o", "  CREATE TABL"]
[43.500861, "o", "E IF NOT EXISTS audit_events (\r\n            event_id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n            file_id INTEGER NOT NULL,\r\n            event_type "]
[43.500925, "o", "TEXT NOT NULL CHECK(event_type IN ('INIT', 'MODIFY', 'PERM')),\r\n            event_ts TEXT NOT NULL,\r\n            FOREIGN KEY (file_id) REFERENCES tracked_files (id)\r\n        )''')\r\n    \r\n    conn.commit"]
[43.500983, "o", "()\r\n    \r\n    # Process files and insert into database\r\n    files_processed = 0\r\n    for filename in os.listdir(configs_dir):\r\n        filepath = "]
[43.501037, "o", "os.path.join(configs_dir, filename)\r\n        if os.path.isfile(filepath):\r\n  "]
[43.501081, "o", "          try:\r\n                rel_path = filename\r\n                file_hash = get_file_sha256(filepath)\r\n                magic_hex "]
[43.501128, "o", "= get_file_magic_hex(filepath)\r\n                size_bytes = os.path.getsize(filepath)\r\n        "]
[43.501201, "o", "        mtime_ts = datetime.datetime.fromtimestamp(os.path.getmtime(filepath)).strftime('%Y"]
[43.501265, "o", "-%m-%d %H:%M:%S')\r\n                \r\n                cursor.execute('''\r\n                    INSERT INTO tracked_files (rel_path, file_hash, magic_hex, size_bytes"]
[43.501349, "o", ")\r\n                    VALUES (?, ?, ?, ?)\r\n                ''', (rel_path, file_hash, magic_hex, s"]
[43.501496, "o", "ize_bytes))\r\n                \r\n                file_id = cursor.lastrowid\r\n                \r\n                cursor.execute('''\r\n                    I"]
[43.501587, "o", "NSERT INTO audit_events (file_id, event_type, event_t"]
[43.50166, "o", "s)\r\n                    VALUES (?, 'INIT', ?)\r\n                ''', (file_id, mtime_ts))\r\n                \r\n                files_proces"]
[43.501707, "o", "sed += 1\r\n                conn.commit()\r\n                prin"]
[43.501764, "o", "t(f\"Processed: {filename}\")\r\n            except Exception as e:\r\n    "]
[43.501824, "o", "            print(f\"Error processing {filename}: {e}\")\r\n    \r\n    print(f\"{files_pro"]
[43.501881, "o", "cessed} files processed successfully\")\r\n    conn."]
[43.501907, "o", "close()\r\n\r\nif __name__ == '__main__':\r\n    mai"]
[43.502008, "o", "n()\r\nEOF\u001b[?2004h> "]
[43.502074, "o", "#!/usr/bin/env python3\r\n\u001b[?2004l\r"]
[43.502111, "o", "\u001b[?2004h> "]
[43.502169, "o", "import sqlite3\r\n\u001b[?2004l\r"]
[43.502208, "o", "\u001b[?2004h> "]
[43.502241, "o", "import os\r\n\u001b[?2004l\r"]
[43.502275, "o", "\u001b[?2004h> "]
[43.502312, "o", "import hashlib\r\n\u001b[?2004l\r"]
[43.502353, "o", "\u001b[?2004h> "]
[43.502393, "o", "import datetime\r\n\u001b[?2004l\r"]
[43.502439, "o", "\u001b[?2004h> "]
[43.50251, "o", "from pathlib import Path\r\n\u001b[?2004l\r"]
[43.502542, "o", "\u001b[?2004h> "]
[43.502552, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.5026, "o", "> "]
[43.50268, "o", "def get_file_magic_hex(filepath):\r\n\u001b[?2004l\r"]
[43.502712, "o", "\u001b[?2004h> "]
[43.502912, "o", "    \"\"\"Get first 4 bytes of file as lowercase hex string.\"\"\"\r\n\u001b[?2004l\r"]
[43.502921, "o", "\u001b[?2004h"]
[43.502973, "o", ">     try:\r\n\u001b[?2004l\r"]
[43.502983, "o", "\u001b[?2004h"]
[43.503039, "o", "> "]
[43.503124, "o", "        with open(filepath, 'rb') as f:\r\n\u001b[?2004l\r"]
[43.503158, "o", "\u001b[?2004h> "]
[43.50327, "o", "            magic_bytes = f.read(4)\r\n\u001b[?2004l\r"]
[43.503293, "o", "\u001b[?2004h> "]
[43.50344, "o", "        return magic_bytes.hex().lower()\r\n\u001b[?2004l\r"]
[43.503465, "o", "\u001b[?2004h> "]
[43.503561, "o", "    except Exception as e:\r\n\u001b[?2004l\r"]
[43.503599, "o", "\u001b[?2004h> "]
[43.503649, "o", "        return ''\r\n\u001b[?2004l\r"]
[43.503689, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[43.503727, "o", "> "]
[43.503808, "o", "def get_file_sha256(filepath):\r\n\u001b[?2004l\r"]
[43.503845, "o", "\u001b[?2004h> "]
[43.503981, "o", "    \"\"\"Get SHA-256 hash of file content.\"\"\"\r\n\u001b[?2004l\r"]
[43.504019, "o", "\u001b[?2004h> "]
[43.504057, "o", "    try:\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.504067, "o", "> "]
[43.504205, "o", "        hash_sha256 = hashlib.sha256()\r\n\u001b[?2004l\r"]
[43.504244, "o", "\u001b[?2004h> "]
[43.504361, "o", "        with open(filepath, 'rb') as f:\r\n\u001b[?2004l\r"]
[43.504409, "o", "\u001b[?2004h> "]
[43.504586, "o", "            for chunk in iter(lambda: f.read(4096), b''):\r\n\u001b[?2004l\r"]
[43.504632, "o", "\u001b[?2004h> "]
[43.504761, "o", "                hash_sha256.update(chunk)\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.504807, "o", "> "]
[43.504916, "o", "        return hash_sha256.hexdigest()\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.504965, "o", "> "]
[43.505038, "o", "    except Exception as e:\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.505085, "o", "> "]
[43.505132, "o", "        return ''\r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.505176, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.505221, "o", "def main():\r\n\u001b[?2004l\r"]
[43.505269, "o", "\u001b[?2004h> "]
[43.505343, "o", "    db_path = 'db/audit.db'\r\n\u001b[?2004l\r"]
[43.505383, "o", "\u001b[?2004h> "]
[43.505473, "o", "    configs_dir = 'configs'\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.505514, "o", ">     \r\n\u001b[?2004l\r"]
[43.505563, "o", "\u001b[?2004h> "]
[43.505652, "o", "    # Create database and tables\r\n\u001b[?2004l\r"]
[43.505693, "o", "\u001b[?2004h> "]
[43.505796, "o", "    conn = sqlite3.connect(db_path)\r\n\u001b[?2004l\r"]
[43.505836, "o", "\u001b[?2004h> "]
[43.505915, "o", "    cursor = conn.cursor()\r\n\u001b[?2004l\r"]
[43.505956, "o", "\u001b[?2004h>     \r\n\u001b[?2004l\r"]
[43.506013, "o", "\u001b[?2004h> "]
[43.506071, "o", "    cursor.execute('''\r\n\u001b[?2004l\r"]
[43.506111, "o", "\u001b[?2004h> "]
[43.506269, "o", "        CREATE TABLE IF NOT EXISTS tracked_files ("]
[43.506495, "o", "\r\n\u001b[?2004l\r\u001b[?2004h>             id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.506536, "o", "> "]
[43.506662, "o", "            rel_path TEXT UNIQUE NOT NULL,\r\n\u001b[?2004l\r"]
[43.506706, "o", "\u001b[?2004h> "]
[43.506814, "o", "            file_hash TEXT NOT NULL,\r\n\u001b[?2004l\r"]
[43.506854, "o", "\u001b[?2004h> "]
[43.506971, "o", "            magic_hex TEXT NOT NULL,\r\n\u001b[?2004l\r"]
[43.507013, "o", "\u001b[?2004h> "]
[43.507141, "o", "            size_bytes INTEGER NOT NULL\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.507183, "o", "> "]
[43.507231, "o", "        )''')\r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.507275, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.507361, "o", "    cursor.execute('''\r\n\u001b[?2004l\r"]
[43.507421, "o", "\u001b[?2004h> "]
[43.507563, "o", "        CREATE TABLE IF NOT EXISTS audit_events (\r\n\u001b[?2004l\r"]
[43.507604, "o", "\u001b[?2004h> "]
[43.507777, "o", "            event_id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n\u001b[?2004l\r"]
[43.507824, "o", "\u001b[?2004h> "]
[43.50793, "o", "            file_id INTEGER NOT NULL,\r\n\u001b[?2004l\r"]
[43.507975, "o", "\u001b[?2004h> "]
[43.50824, "o", "            event_type TEXT NOT NULL CHECK(event_type IN ('INIT', 'MODIFY', 'PERM')),\r\n\u001b[?2004l\r"]
[43.508302, "o", "\u001b[?2004h> "]
[43.508389, "o", "            event_ts TEXT NOT NULL,\r\n\u001b[?2004l\r"]
[43.508465, "o", "\u001b[?2004h> "]
[43.508638, "o", "            FOREIGN KEY (file_id) REFERENCES tracked_files (id)\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.508691, "o", "> "]
[43.508736, "o", "        )''')\r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.508781, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h> "]
[43.508846, "o", "    conn.commit()\r\n\u001b[?2004l\r"]
[43.508893, "o", "\u001b[?2004h>     \r\n\u001b[?2004l\r\u001b[?2004h"]
[43.50894, "o", "> "]
[43.509064, "o", "    # Process files and insert into database\r\n\u001b[?2004l\r"]
[43.509101, "o", "\u001b[?2004h> "]
[43.509171, "o", "    files_processed = 0\r\n\u001b[?2004l\r"]
[43.509211, "o", "\u001b[?2004h> "]
[43.509359, "o", "    for filename in os.listdir(configs_dir):\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.509398, "o", "> "]
[43.509565, "o", "        filepath = os.path.join(configs_dir, filename)\r\n\u001b[?2004l\r"]
[43.509604, "o", "\u001b[?2004h> "]
[43.509717, "o", "        if os.path.isfile(filepath):\r\n\u001b[?2004l\r"]
[43.509755, "o", "\u001b[?2004h> "]
[43.509812, "o", "            try:\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.50984, "o", "> "]
[43.509956, "o", "                rel_path = filename\r\n\u001b[?2004l\r"]
[43.509995, "o", "\u001b[?2004h> "]
[43.510161, "o", "                file_hash = get_file_sha256(filepath)\r\n\u001b[?2004l\r"]
[43.510199, "o", "\u001b[?2004h> "]
[43.510373, "o", "                magic_hex = get_file_magic_hex(filepath)\r\n\u001b[?2004l\r"]
[43.510427, "o", "\u001b[?2004h> "]
[43.510587, "o", "                size_bytes = os.path.getsize(filepath)\r\n\u001b[?2004l\r"]
[43.510626, "o", "\u001b[?2004h> "]
[43.510994, "o", "                mtime_ts = datetime.datetime.fromtimestamp(os.path.getmtime(filepath)).strftime('%Y-%m-%d %H:%M:%S')\r\n\u001b[?2004l\r"]
[43.511041, "o", "\u001b[?2004h> "]
[43.511085, "o", "                \r\n\u001b[?2004l\r"]
[43.511127, "o", "\u001b[?2004h> "]
[43.511225, "o", "                cursor.execute('''\r\n\u001b[?2004l\r"]
[43.511265, "o", "\u001b[?2004h> "]
[43.51156, "o", "                    INSERT INTO tracked_files (rel_path, file_hash, magic_hex, size_bytes)\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.511607, "o", "> "]
[43.511718, "o", "                    VALUES (?, ?, ?, ?)\r\n\u001b[?2004l\r"]
[43.511748, "o", "\u001b[?2004h> "]
[43.511974, "o", "                ''', (rel_path, file_hash, magic_hex, size_bytes))\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.512013, "o", "> "]
[43.512058, "o", "                \r\n\u001b[?2004l\r"]
[43.512089, "o", "\u001b[?2004h> "]
[43.512229, "o", "                file_id = cursor.lastrowid\r\n\u001b[?2004l\r"]
[43.512268, "o", "\u001b[?2004h> "]
[43.512309, "o", "                \r\n\u001b[?2004l\r"]
[43.512348, "o", "\u001b[?2004h> "]
[43.512472, "o", "                cursor.execute('''\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.5125, "o", "> "]
[43.512745, "o", "                    INSERT INTO audit_events (file_id, event_type, event_ts)\r\n\u001b[?2004l\r"]
[43.512774, "o", "\u001b[?2004h> "]
[43.512914, "o", "                    VALUES (?, 'INIT', ?)\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.512953, "o", "> "]
[43.513074, "o", "                ''', (file_id, mtime_ts))\r\n\u001b[?2004l\r"]
[43.5131, "o", "\u001b[?2004h> "]
[43.513167, "o", "                \r\n\u001b[?2004l\r\u001b[?2004h"]
[43.513196, "o", "> "]
[43.513312, "o", "                files_processed += 1\r\n\u001b[?2004l\r"]
[43.51335, "o", "\u001b[?2004h> "]
[43.513443, "o", "                conn.commit()\r\n\u001b[?2004l\r"]
[43.513484, "o", "\u001b[?2004h> "]
[43.513633, "o", "                print(f\"Processed: {filename}\")\r\n\u001b[?2004l\r"]
[43.513672, "o", "\u001b[?2004h> "]
[43.513776, "o", "            except Exception as e:\r\n\u001b[?2004l\r"]
[43.513803, "o", "\u001b[?2004h> "]
[43.513994, "o", "                print(f\"Error processing {filename}: {e}\")\r\n\u001b[?2004l\r"]
[43.514033, "o", "\u001b[?2004h>     \r\n\u001b[?2004l\r"]
[43.514074, "o", "\u001b[?2004h> "]
[43.514284, "o", "    print(f\"{files_processed} files processed successfully\")\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.514315, "o", "> "]
[43.514369, "o", "    conn.close()\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.514397, "o", "> \r\n\u001b[?2004l\r"]
[43.514448, "o", "\u001b[?2004h> "]
[43.514533, "o", "if __name__ == '__main__':\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.514562, "o", "> "]
[43.514593, "o", "    main()\r\n\u001b[?2004l\r"]
[43.514621, "o", "\u001b[?2004h> EOF"]
[44.149, "i", "chmod +x init_db.py\n"]
[44.149209, "o", "chmod +x init_db.py\r\n"]
[44.149257, "o", "\u001b[?2004l\r"]
[44.149287, "o", "\u001b[?2004h"]
[44.149325, "o", "> "]
[44.259123, "i", "python3 init_db.py\n"]
[44.259317, "o", "python3 init_db.py\r\n\u001b[?2004l\r"]
[44.259383, "o", "\u001b[?2004h> "]
[53.037458, "i", "cd configs\n"]
[53.037627, "o", "cd configs\r\n\u001b[?2004l\r\u001b[?2004h> "]
[53.140381, "i", "sed -i '1s/^/# URGENT SECURITY PATCH\\n/' ssh.cfg\n"]
[53.140594, "o", "sed -i '1s/^/# URGENT SECURITY PATCH\\n/' ssh.cfg\r\n\u001b[?2004l\r"]
[53.14066, "o", "\u001b[?2004h> "]
[53.297795, "i", "sleep 1\n"]
[53.297908, "o", "sleep 1\r\n"]
[53.297933, "o", "\u001b[?2004l\r"]
[53.297984, "o", "\u001b[?2004h"]
[53.298029, "o", "> "]
[54.347978, "i", "chmod 400 nginx.conf\n"]
[54.348162, "o", "chmod 400 nginx.conf\r\n\u001b[?2004l\r"]
[54.348235, "o", "\u001b[?2004h> "]
[54.502471, "i", "cd ..\n"]
[54.502602, "o", "cd ..\r\n\u001b[?2004l\r\u001b[?2004h> "]
[76.457739, "i", "cat > update_db.py << 'EOF'\n#!/usr/bin/env python3\nimport sqlite3\nimport os\nimport hashlib\nimport datetime\n\ndef get_file_magic_hex(filepath):\n    \"\"\"Get first 4 bytes of file as lowercase hex string.\"\"\"\n    try:\n        with open(filepath, 'rb') as f:\n            magic_bytes = f.read(4)\n        return magic_bytes.hex().lower()\n    except Exception as e:\n        return ''\n\ndef get_file_sha256(filepath):\n    \"\"\"Get SHA-256 hash of file content.\"\"\"\n    try:\n        hash_sha256 = hashlib.sha256()\n        with open(filepath, 'rb') as f:\n            for chunk in iter(lambda: f.read(4096), b''):\n                hash_sha256.update(chunk)\n        return hash_sha256.hexdigest()\n    except Exception as e:\n        return ''\n\ndef main():\n    db_path = 'db/audit.db'\n    configs_dir = 'configs'\n    \n    conn = sqlite3.connect(db_path)\n    cursor = conn.cursor()\n    \n    # Update ssh.cfg record and add MODIFY event\n    ssh_cfg_path = os.path.join(configs_dir, 'ssh.cfg')\n    if os.path.exists(ssh_cfg_path):\n        try:\n     "]
[76.457869, "i", "       new_file_hash = get_file_sha256(ssh_cfg_path)\n            new_magic_hex = get_file_magic_hex(ssh_cfg_path)\n            new_size_bytes = os.path.getsize(ssh_cfg_path)\n            mtime_ts = datetime.datetime.fromtimestamp(os.path.getmtime(ssh_cfg_path)).strftime('%Y-%m-%d %H:%M:%S')\n            \n            # Get current file ID\n            cursor.execute('SELECT id FROM tracked_files WHERE rel_path = ?', ('ssh.cfg',))\n            file_id = cursor.fetchone()[0]\n            \n            # Update tracked_files record\n            cursor.execute('''\n                UPDATE tracked_files \n                SET file_hash = ?, magic_hex = ?, size_bytes = ?\n                WHERE id = ?\n            ''', (new_file_hash, new_magic_hex, new_size_bytes, file_id))\n            \n            # Add MODIFY event\n            cursor.execute('''\n                INSERT INTO audit_events (file_id, event_type, event_ts)\n                VALUES (?, 'MODIFY', ?)\n            ''', (file_id, mtime_ts))\n            \n            print(\"Up"]
[76.457884, "o", "cat > update_db.py << 'EOF'\r\n\u001b[?2004l\r"]
[76.457924, "i", "dated ssh.cfg in database\")\n        except Exception as e:\n            print(f\"Error updating ssh.cfg: {e}\")\n    \n    # Add PERM event for nginx.conf\n    nginx_cfg_path = os.path.join(configs_dir, 'nginx.conf')\n    if os.path.exists(nginx_cfg_path):\n        try:\n            cursor.execute('SELECT id FROM tracked_files WHERE rel_path = ?', ('nginx.conf',))\n            file_id = cursor.fetchone()[0]\n            current_time = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')\n            \n            cursor.execute('''\n                INSERT INTO audit_events (file_id, event_type, event_ts)\n                VALUES (?, 'PERM', ?)\n            ''', (file_id, current_time))\n            \n            print(\"Added PERM event for nginx.conf\")\n        except Exception as e:\n            print(f\"Error adding PERM event: {e}\")\n    \n    conn.commit()\n    conn.close()\n    print(\"Database update complete\")\n\nif __name__ == '__main__':\n    main()\nEOF"]
[76.457937, "o", "\u001b[?2004h> "]
[76.457994, "o", "#!/usr/bin/env python3\r\n\u001b[?2004l\r"]
[76.458023, "o", "\u001b[?2004h> "]
[76.458057, "o", "import sqlite3\r\n\u001b[?2004l\r"]
[76.458071, "o", "\u001b[?2004h"]
[76.458104, "o", "> import os\r\n\u001b[?2004l\r"]
[76.458133, "o", "\u001b[?2004h> "]
[76.458169, "o", "import hashlib\r\n\u001b[?2004l\r"]
[76.458203, "o", "\u001b[?2004h> "]
[76.458241, "o", "import datetime\r\n\u001b[?2004l\r"]
[76.458268, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[76.458292, "o", "\u001b[?2004h> "]
[76.458383, "o", "def get_file_magic_hex(filepath):\r\n\u001b[?2004l\r"]
[76.458422, "o", "\u001b[?2004h> "]
[76.458577, "o", "    \"\"\"Get first 4 bytes of file as lowercase hex string.\"\"\"\r\n\u001b[?2004l\r"]
[76.458602, "o", "\u001b[?2004h> "]
[76.458624, "o", "    try:\r\n\u001b[?2004l\r"]
[76.458649, "o", "\u001b[?2004h> "]
[76.458747, "o", "        with open(filepath, 'rb') as f:\r\n\u001b[?2004l\r"]
[76.458772, "o", "\u001b[?2004h> "]
[76.458871, "o", "            magic_bytes = f.read(4)\r\n\u001b[?2004l\r"]
[76.458899, "o", "\u001b[?2004h"]
[76.458927, "o", "> "]
[76.459007, "o", "        return magic_bytes.hex().lower()\r\n\u001b[?2004l\r"]
[76.459032, "o", "\u001b[?2004h> "]
[76.459101, "o", "    except Exception as e:\r\n\u001b[?2004l\r"]
[76.459126, "o", "\u001b[?2004h> "]
[76.459171, "o", "        return ''\r\n\u001b[?2004l\r"]
[76.459195, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[76.459216, "o", "\u001b[?2004h> "]
[76.459363, "o", "def get_file_sha256(filepath):\r\n"]
[76.459387, "o", "\u001b[?2004l\r"]
[76.45942, "o", "\u001b[?2004h"]
[76.459458, "o", "> "]
[76.459735, "o", "    \"\"\"Get SHA-256 hash of file content.\"\"\"\r\n"]
[76.459763, "o", "\u001b[?2004l\r"]
[76.459787, "o", "\u001b[?2004h"]
[76.459822, "o", "> "]
[76.459863, "o", "    try:\r\n\u001b[?2004l\r"]
[76.459904, "o", "\u001b[?2004h"]
[76.459926, "o", "> "]
[76.460175, "o", "        hash_sha256 = hashlib.sha256()\r\n\u001b[?2004l\r"]
[76.460215, "o", "\u001b[?2004h"]
[76.460238, "o", "> "]
[76.460508, "o", "        with open(filepath, 'rb') as f:\r\n\u001b[?2004l\r"]
[76.46055, "o", "\u001b[?2004h"]
[76.460572, "o", "> "]
[76.460936, "o", "            for chunk in iter(lambda: f.read(4096), b''):\r\n\u001b[?2004l\r"]
[76.460979, "o", "\u001b[?2004h"]
[76.461004, "o", "> "]
[76.461267, "o", "                hash_sha256.update(chunk)\r\n\u001b[?2004l\r"]
[76.461306, "o", "\u001b[?2004h"]
[76.461329, "o", "> "]
[76.461588, "o", "        return hash_sha256.hexdigest()\r\n\u001b[?2004l\r"]
[76.461629, "o", "\u001b[?2004h"]
[76.461664, "o", "> "]
[76.461826, "o", "    except Exception as e:\r\n\u001b[?2004l\r"]
[76.461867, "o", "\u001b[?2004h"]
[76.461889, "o", "> "]
[76.462007, "o", "        return ''\r\n\u001b[?2004l\r"]
[76.462047, "o", "\u001b[?2004h"]
[76.462071, "o", "> "]
[76.462095, "o", "\r\n\u001b[?2004l\r"]
[76.46212, "o", "\u001b[?2004h"]
[76.462143, "o", "> "]
[76.462218, "o", "def main():\r\n\u001b[?2004l\r"]
[76.462258, "o", "\u001b[?2004h"]
[76.46228, "o", "> "]
[76.462481, "o", "    db_path = 'db/audit.db'\r\n\u001b[?2004l\r"]
[76.462522, "o", "\u001b[?2004h"]
[76.462546, "o", "> "]
[76.462723, "o", "    configs_dir = 'configs'\r\n"]
[76.462749, "o", "\u001b[?2004l\r"]
[76.462774, "o", "\u001b[?2004h"]
[76.462798, "o", "> "]
[76.462824, "o", "    \r\n\u001b[?2004l\r"]
[76.462865, "o", "\u001b[?2004h"]
[76.462889, "o", "> "]
[76.463118, "o", "    conn = sqlite3.connect(db_path)\r\n\u001b[?2004l\r"]
[76.463159, "o", "\u001b[?2004h"]
[76.463181, "o", "> "]
[76.463355, "o", "    cursor = conn.cursor()\r\n\u001b[?2004l\r"]
[76.463395, "o", "\u001b[?2004h"]
[76.463436, "o", "> "]
[76.463466, "o", "    \r\n\u001b[?2004l\r"]
[76.463507, "o", "\u001b[?2004h"]
[76.463529, "o", "> "]
[76.463841, "o", "    # Update ssh.cfg record and add MODIFY event\r\n\u001b[?2004l\r"]
[76.463881, "o", "\u001b[?2004h"]
[76.463903, "o", "> "]
[76.464254, "o", "    ssh_cfg_path = os.path.join(configs_dir, 'ssh.cfg')\r\n\u001b[?2004l\r"]
[76.464294, "o", "\u001b[?2004h"]
[76.464327, "o", "> "]
[76.464564, "o", "    if os.path.exists(ssh_cfg_path):\r\n\u001b[?2004l\r"]
[76.464604, "o", "\u001b[?2004h"]
[76.464627, "o", "> "]
[76.464715, "o", "        try:\r\n\u001b[?2004l\r"]
[76.464755, "o", "\u001b[?2004h"]
[76.464777, "o", "> "]
[76.465143, "o", "            new_file_hash = get_file_sha256(ssh_cfg_path)\r\n\u001b[?2004l\r"]
[76.465185, "o", "\u001b[?2004h"]
[76.465207, "o", "> "]
[76.465604, "o", "            new_magic_hex = get_file_magic_hex(ssh_cfg_path)\r\n\u001b[?2004l\r"]
[76.465644, "o", "\u001b[?2004h"]
[76.465672, "o", "> "]
[76.466038, "o", "            new_size_bytes = os.path.getsize(ssh_cfg_path)\r\n\u001b[?2004l\r"]
[76.466077, "o", "\u001b[?2004h"]
[76.466099, "o", "> "]
[76.466837, "o", "            mtime_ts = datetime.datetime.fromtimestamp(os.path.getmtime(ssh_cfg_path)).strftime('%Y-%m-%d %H:%M:%S')\r\n\u001b[?2004l\r"]
[76.466895, "o", "\u001b[?2004h"]
[76.466932, "o", "> "]
[76.467006, "o", "            \r\n\u001b[?2004l\r"]
[76.467046, "o", "\u001b[?2004h"]
[76.467068, "o", "> "]
[76.467285, "o", "            # Get current file ID\r\n\u001b[?2004l\r"]
[76.467326, "o", "\u001b[?2004h"]
[76.467349, "o", "> "]
[76.467934, "o", "            cursor.execute('SELECT id FROM tracked_files WHERE rel_path = ?', ('ssh.cfg',))\r\n\u001b[?2004l\r"]
[76.467975, "o", "\u001b[?2004h"]
[76.467998, "o", "> "]
[76.468271, "o", "            file_id = cursor.fetchone()[0]\r\n\u001b[?2004l\r"]
[76.468313, "o", "\u001b[?2004h"]
[76.468334, "o", "> "]
[76.468433, "o", "            \r\n"]
[76.468457, "o", "\u001b[?2004l\r"]
[76.46848, "o", "\u001b[?2004h"]
[76.468503, "o", "> "]
[76.468763, "o", "            # Update tracked_files record\r\n"]
[76.468787, "o", "\u001b[?2004l\r"]
[76.468812, "o", "\u001b[?2004h"]
[76.468836, "o", "> "]
[76.469018, "o", "            cursor.execute('''\r\n\u001b[?2004l\r"]
[76.469066, "o", "\u001b[?2004h"]
[76.46909, "o", "> "]
[76.469325, "o", "                UPDATE tracked_files \r\n"]
[76.469349, "o", "\u001b[?2004l\r"]
[76.469373, "o", "\u001b[?2004h> "]
[76.469798, "o", "                SET file_hash = ?, magic_hex = ?, size_bytes = ?\r\n\u001b[?2004l\r"]
[76.469834, "o", "\u001b[?2004h"]
[76.469858, "o", "> "]
[76.470036, "o", "                WHERE id = ?\r\n"]
[76.470061, "o", "\u001b[?2004l\r"]
[76.470084, "o", "\u001b[?2004h"]
[76.470109, "o", "> "]
[76.470563, "o", "            ''', (new_file_hash, new_magic_hex, new_size_bytes, file_id))\r\n\u001b[?2004l\r"]
[76.470598, "o", "\u001b[?2004h"]
[76.470625, "o", "> "]
[76.470701, "o", "            \r\n"]
[76.470725, "o", "\u001b[?2004l\r"]
[76.470749, "o", "\u001b[?2004h"]
[76.470772, "o", "> "]
[76.470955, "o", "            # Add MODIFY event\r\n\u001b[?2004l\r"]
[76.470998, "o", "\u001b[?2004h"]
[76.471022, "o", "> "]
[76.471215, "o", "            cursor.execute('''\r\n\u001b[?2004l\r"]
[76.47125, "o", "\u001b[?2004h"]
[76.471277, "o", "> "]
[76.471736, "o", "                INSERT INTO audit_events (file_id, event_type, event_ts)\r\n\u001b[?2004l\r"]
[76.471771, "o", "\u001b[?2004h"]
[76.471798, "o", "> "]
[76.472044, "o", "                VALUES (?, 'MODIFY', ?)\r\n\u001b[?2004l\r"]
[76.472082, "o", "\u001b[?2004h"]
[76.472108, "o", "> "]
[76.47234, "o", "            ''', (file_id, mtime_ts))\r\n\u001b[?2004l\r"]
[76.472377, "o", "\u001b[?2004h"]
[76.472406, "o", "> "]
[76.472488, "o", "            \r\n\u001b[?2004l\r"]
[76.472525, "o", "\u001b[?2004h"]
[76.47255, "o", "> "]
[76.472851, "o", "            print(\"Updated ssh.cfg in database\")\r\n"]
[76.472887, "o", "\u001b[?2004l\r\u001b[?2004h"]
[76.472919, "o", "> "]
[76.473109, "o", "        except Exception as e:\r\n\u001b[?2004l\r"]
[76.473146, "o", "\u001b[?2004h"]
[76.473171, "o", "> "]
[76.473485, "o", "            print(f\"Error updating ssh.cfg: {e}\")\r\n\u001b[?2004l\r"]
[76.473526, "o", "\u001b[?2004h"]
[76.473551, "o", "> "]
[76.47358, "o", "    \r\n\u001b[?2004l\r"]
[76.473618, "o", "\u001b[?2004h"]
[76.473642, "o", "> "]
[76.473864, "o", "    # Add PERM event for nginx.conf\r\n\u001b[?2004l\r"]
[76.4739, "o", "\u001b[?2004h"]
[76.473924, "o", "> "]
[76.474302, "o", "    nginx_cfg_path = os.path.join(configs_dir, 'nginx.conf')\r\n\u001b[?2004l\r"]
[76.474339, "o", "\u001b[?2004h"]
[76.474361, "o", "> "]
[76.474619, "o", "    if os.path.exists(nginx_cfg_path):\r\n\u001b[?2004l\r"]
[76.474654, "o", "\u001b[?2004h"]
[76.474682, "o", "> "]
[76.474769, "o", "        try:\r\n\u001b[?2004l\r"]
[76.474807, "o", "\u001b[?2004h"]
[76.474829, "o", "> "]
[76.475427, "o", "            cursor.execute('SELECT id FROM tracked_files WHERE rel_path = ?', ('nginx.conf',))\r\n\u001b[?2004l\r"]
[76.475467, "o", "\u001b[?2004h"]
[76.475494, "o", "> "]
[76.475757, "o", "            file_id = cursor.fetchone()[0]\r\n\u001b[?2004l\r"]
[76.475808, "o", "\u001b[?2004h"]
[76.475839, "o", "> "]
[76.476351, "o", "            current_time = datetime.datetime.utcnow().strftime('%Y-%m-%d %H:%M:%S')\r\n\u001b[?2004l\r"]
[76.476394, "o", "\u001b[?2004h"]
[76.476438, "o", "> "]
[76.476513, "o", "            \r\n\u001b[?2004l\r"]
[76.476547, "o", "\u001b[?2004h"]
[76.476576, "o", "> "]
[76.476798, "o", "            cursor.execute('''\r\n\u001b[?2004l\r"]
[76.476846, "o", "\u001b[?2004h> "]
[76.477297, "o", "                INSERT INTO audit_events (file_id, event_type, event_ts)\r\n\u001b[?2004l\r"]
[76.47734, "o", "\u001b[?2004h"]
[76.477361, "o", "> "]
[76.477612, "o", "                VALUES (?, 'PERM', ?)\r\n\u001b[?2004l\r"]
[76.477652, "o", "\u001b[?2004h"]
[76.477676, "o", "> "]
[76.477943, "o", "            ''', (file_id, current_time))\r\n\u001b[?2004l\r"]
[76.477986, "o", "\u001b[?2004h"]
[76.478017, "o", "> "]
[76.478092, "o", "            \r\n\u001b[?2004l\r"]
[76.478129, "o", "\u001b[?2004h"]
[76.47815, "o", "> "]
[76.478515, "o", "            print(\"Added PERM event for nginx.conf\")\r\n\u001b[?2004l\r"]
[76.478557, "o", "\u001b[?2004h"]
[76.47858, "o", "> "]
[76.478775, "o", "        except Exception as e:\r\n"]
[76.4788, "o", "\u001b[?2004l\r"]
[76.478828, "o", "\u001b[?2004h"]
[76.478857, "o", "> "]
[76.479178, "o", "            print(f\"Error adding PERM event: {e}\")\r\n"]
[76.479202, "o", "\u001b[?2004l\r"]
[76.479228, "o", "\u001b[?2004h"]
[76.479252, "o", "> "]
[76.479279, "o", "    \r\n\u001b[?2004l\r"]
[76.479317, "o", "\u001b[?2004h"]
[76.479337, "o", "> "]
[76.479481, "o", "    conn.commit()\r\n"]
[76.479492, "o", "\u001b[?2004l\r"]
[76.479529, "o", "\u001b[?2004h"]
[76.479556, "o", "> "]
[76.479663, "o", "    conn.close()\r\n"]
[76.479688, "o", "\u001b[?2004l\r"]
[76.479712, "o", "\u001b[?2004h"]
[76.479735, "o", "> "]
[76.47997, "o", "    print(\"Database update complete\")\r\n\u001b[?2004l\r"]
[76.480007, "o", "\u001b[?2004h"]
[76.480031, "o", "> "]
[76.480055, "o", "\r\n\u001b[?2004l\r"]
[76.480078, "o", "\u001b[?2004h"]
[76.480103, "o", "> "]
[76.480283, "o", "if __name__ == '__main__':\r\n"]
[76.480307, "o", "\u001b[?2004l\r"]
[76.480328, "o", "\u001b[?2004h"]
[76.480353, "o", "> "]
[76.48044, "o", "    main()\r\n"]
[76.480465, "o", "\u001b[?2004l\r"]
[76.480489, "o", "\u001b[?2004h"]
[76.480512, "o", "> "]
[76.480543, "o", "EOF"]
[77.37143, "i", "chmod +x update_db.py\n"]
[77.371634, "o", "chmod +x update_db.py\r\n\u001b[?2004l\r\u001b[?2004h> "]
[77.464917, "i", "python3 update_db.py\n"]
[77.465071, "o", "python3 update_db.py\r\n\u001b[?2004l\r\u001b[?2004h> "]
[79.470974, "i", "cat > version.txt << 'EOF'\nv1.2.3-RELEASE\nEOF"]
[79.471155, "o", "cat > version.txt << 'EOF'\r\n\u001b[?2004l\r"]
[79.471202, "o", "\u001b[?2004h"]
[79.471232, "o", "> "]
[79.471289, "o", "v1.2.3-RELEASE\r\n\u001b[?2004l\r"]
[79.471318, "o", "\u001b[?2004h"]
[79.471342, "o", "> "]
[79.471366, "o", "EOF"]
[99.220635, "i", "cat > generate_report.py << 'EOF'\n#!/usr/bin/env python3\nimport sqlite3\nimport csv\nimport datetime\n\ndef main():\n    db_path = 'db/audit.db'\n    report_path = 'reports/audit_summary.csv'\n    sql_log_path = 'logs/sql_history.log'\n    \n    # Create reports directory if needed\n    import os\n    os.makedirs('reports', exist_ok=True)\n    \n    # Read version from file\n    try:\n        with open('version.txt', 'r') as f:\n            version = f.read().strip()\n    except:\n        version = \"UNKNOWN\"\n    \n    # Connect to database and enable logging\n    conn = sqlite3.connect(db_path)\n    conn.set_trace_callback(lambda sql: open(sql_log_path, 'a').write(sql + '\\n'))\n    \n    cursor = conn.cursor()\n    \n    # Get data for report\n    cursor.execute('''\n        SELECT \n            tf.rel_path,\n            ae.event_type,\n            tf.file_hash,\n            MIN(ae.event_ts) as first_event_ts\n        FROM tracked_files tf\n        JOIN audit_events ae ON tf.id = ae.file_id\n        GROUP BY tf.rel_path, ae.event_type, tf.fil"]
[99.220849, "i", "e_hash\n        ORDER BY ae.event_type, tf.rel_path\n    ''')\n    \n    # Generate report\n    with open(report_path, 'w') as csvfile:\n        writer = csv.writer(csvfile, delimiter=';', lineterminator='\\n')\n        writer.writerow([f\"PATH;EVENT;HASH;VERSION={version}\"])\n        \n        for row in cursor.fetchall():\n            writer.writerow(row)\n    \n    print(f\"Report generated at: {report_path}\")\n    \n    # Calculate database checksum for integrity check\n    conn.close()\n    \n    import hashlib\n    sha256 = hashlib.sha256()\n    with open(db_path, 'rb') as f:\n        while True:\n            data = f.read(4096)\n            if not data:\n                break\n            sha256.update(data)\n    db_checksum = sha256.hexdigest()\n    \n    # Append integrity checksum to SQL log\n    with open(sql_log_path, 'a') as f:\n        f.write(f\"-- DB_CHECKSUM: {db_checksum}\\n\")\n    \n    print(f\"Database checksum: {db_checksum}\")\n    print(\"SQL log updated with integrity checksum\")\n\nif __name__ == '__main__':\n    main()\nEOF"]
[99.220976, "o", "cat > generate_report.py << 'EOF'\r\n\u001b[?2004l\r"]
[99.221055, "o", "\u001b[?2004h"]
[99.221116, "o", "> "]
[99.221238, "o", "#!/usr/bin/env python3\r\n\u001b[?2004l\r"]
[99.221322, "o", "\u001b[?2004h> "]
[99.221428, "o", "import sqlite3\r\n\u001b[?2004l\r"]
[99.221474, "o", "\u001b[?2004h"]
[99.221519, "o", "> "]
[99.221579, "o", "import csv\r\n\u001b[?2004l\r"]
[99.221621, "o", "\u001b[?2004h"]
[99.221663, "o", "> "]
[99.221756, "o", "import datetime\r\n\u001b[?2004l\r"]
[99.221812, "o", "\u001b[?2004h> "]
[99.221855, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[99.221888, "o", "> "]
[99.221972, "o", "def main():\r\n\u001b[?2004l\r"]
[99.222014, "o", "\u001b[?2004h"]
[99.222057, "o", "> "]
[99.222217, "o", "    db_path = 'db/audit.db'\r\n\u001b[?2004l\r"]
[99.222252, "o", "\u001b[?2004h"]
[99.222284, "o", "> "]
[99.22259, "o", "    report_path = 'reports/audit_summary.csv'\r\n\u001b[?2004l\r"]
[99.222636, "o", "\u001b[?2004h"]
[99.222682, "o", "> "]
[99.222917, "o", "    sql_log_path = 'logs/sql_history.log'\r\n\u001b[?2004l\r"]
[99.222959, "o", "\u001b[?2004h"]
[99.223, "o", "> "]
[99.223039, "o", "    \r\n\u001b[?2004l\r"]
[99.223075, "o", "\u001b[?2004h> "]
[99.223344, "o", "    # Create reports directory if needed\r\n\u001b[?2004l\r"]
[99.223386, "o", "\u001b[?2004h"]
[99.223413, "o", "> "]
[99.223512, "o", "    import os\r\n"]
[99.223526, "o", "\u001b[?2004l\r"]
[99.223577, "o", "\u001b[?2004h> "]
[99.223854, "o", "    os.makedirs('reports', exist_ok=True)\r\n\u001b[?2004l\r"]
[99.223895, "o", "\u001b[?2004h"]
[99.223937, "o", "> "]
[99.223982, "o", "    \r\n\u001b[?2004l\r"]
[99.224021, "o", "\u001b[?2004h"]
[99.224065, "o", "> "]
[99.224215, "o", "    # Read version from file\r\n\u001b[?2004l\r"]
[99.224257, "o", "\u001b[?2004h"]
[99.224297, "o", "> "]
[99.224345, "o", "    try:\r\n\u001b[?2004l\r"]
[99.224386, "o", "\u001b[?2004h"]
[99.224431, "o", "> "]
[99.224697, "o", "        with open('version.txt', 'r') as f:\r\n\u001b[?2004l\r"]
[99.224735, "o", "\u001b[?2004h"]
[99.224778, "o", "> "]
[99.225, "o", "            version = f.read().strip()\r\n\u001b[?2004l\r"]
[99.225042, "o", "\u001b[?2004h"]
[99.225082, "o", "> "]
[99.225132, "o", "    except:\r\n\u001b[?2004l\r"]
[99.225168, "o", "\u001b[?2004h"]
[99.225208, "o", "> "]
[99.225373, "o", "        version = \"UNKNOWN\"\r\n\u001b[?2004l\r"]
[99.225435, "o", "\u001b[?2004h"]
[99.225478, "o", "> "]
[99.22552, "o", "    \r\n\u001b[?2004l\r"]
[99.225564, "o", "\u001b[?2004h"]
[99.225608, "o", "> "]
[99.225835, "o", "    # Connect to database and enable logging\r\n\u001b[?2004l\r"]
[99.225872, "o", "\u001b[?2004h"]
[99.225912, "o", "> "]
[99.226115, "o", "    conn = sqlite3.connect(db_path)\r\n\u001b[?2004l\r"]
[99.226151, "o", "\u001b[?2004h"]
[99.226191, "o", "> "]
[99.226715, "o", "    conn.set_trace_callback(lambda sql: open(sql_log_path, 'a').write(sql + '\\n'))\r\n\u001b[?2004l\r"]
[99.226758, "o", "\u001b[?2004h"]
[99.226802, "o", "> "]
[99.22684, "o", "    \r\n\u001b[?2004l\r"]
[99.226883, "o", "\u001b[?2004h> "]
[99.227029, "o", "    cursor = conn.cursor()\r\n\u001b[?2004l\r"]
[99.227065, "o", "\u001b[?2004h"]
[99.227105, "o", "> "]
[99.227151, "o", "    \r\n\u001b[?2004l\r"]
[99.227194, "o", "\u001b[?2004h"]
[99.227238, "o", "> "]
[99.227365, "o", "    # Get data for report\r\n\u001b[?2004l\r"]
[99.227405, "o", "\u001b[?2004h"]
[99.227443, "o", "> "]
[99.227594, "o", "    cursor.execute('''\r\n\u001b[?2004l\r"]
[99.227635, "o", "\u001b[?2004h"]
[99.227678, "o", "> "]
[99.227768, "o", "        SELECT \r\n\u001b[?2004l\r"]
[99.227847, "o", "\u001b[?2004h"]
[99.227891, "o", "> "]
[99.228036, "o", "            tf.rel_path,\r\n\u001b[?2004l\r"]
[99.228103, "o", "\u001b[?2004h"]
[99.228148, "o", "> "]
[99.228292, "o", "            ae.event_type,\r\n\u001b[?2004l\r"]
[99.228329, "o", "\u001b[?2004h"]
[99.228343, "o", "> "]
[99.228523, "o", "            tf.file_hash,\r\n\u001b[?2004l\r"]
[99.228558, "o", "\u001b[?2004h"]
[99.228572, "o", "> "]
[99.228881, "o", "            MIN(ae.event_ts) as first_event_ts\r\n"]
[99.228895, "o", "\u001b[?2004l\r"]
[99.228964, "o", "\u001b[?2004h> "]
[99.229138, "o", "        FROM tracked_files tf\r\n\u001b[?2004l\r"]
[99.229171, "o", "\u001b[?2004h"]
[99.229186, "o", "> "]
[99.229531, "o", "        JOIN audit_events ae ON tf.id = ae.file_id\r\n"]
[99.229572, "o", "\u001b[?2004l\r"]
[99.229621, "o", "\u001b[?2004h"]
[99.22967, "o", "> "]
[99.229965, "o", "        GROUP BY tf.rel_path, ae.event_type, tf.file_hash\r\n\u001b[?2004l\r"]
[99.230007, "o", "\u001b[?2004h> "]
[99.230293, "o", "        ORDER BY ae.event_type, tf.rel_path\r\n\u001b[?2004l\r"]
[99.230327, "o", "\u001b[?2004h"]
[99.230341, "o", "> "]
[99.230419, "o", "    ''')\r\n"]
[99.230432, "o", "\u001b[?2004l\r"]
[99.2305, "o", "\u001b[?2004h> "]
[99.230514, "o", "    \r\n"]
[99.230528, "o", "\u001b[?2004l\r"]
[99.230613, "o", "\u001b[?2004h> "]
[99.230728, "o", "    # Generate report\r\n\u001b[?2004l\r"]
[99.230769, "o", "\u001b[?2004h"]
[99.230817, "o", "> "]
[99.231076, "o", "    with open(report_path, 'w') as csvfile:\r\n\u001b[?2004l\r"]
[99.231118, "o", "\u001b[?2004h"]
[99.231166, "o", "> "]
[99.231614, "o", "        writer = csv.writer(csvfile, delimiter=';', lineterminator='\\n')\r\n\u001b[?2004l\r"]
[99.231658, "o", "\u001b[?2004h"]
[99.231673, "o", "> "]
[99.232079, "o", "        writer.writerow([f\"PATH;EVENT;HASH;VERSION={version}\"])\r\n\u001b[?2004l\r"]
[99.232115, "o", "\u001b[?2004h"]
[99.232129, "o", "> "]
[99.232201, "o", "        \r\n"]
[99.232214, "o", "\u001b[?2004l\r"]
[99.232278, "o", "\u001b[?2004h"]
[99.232325, "o", "> "]
[99.232532, "o", "        for row in cursor.fetchall():\r\n"]
[99.232546, "o", "\u001b[?2004l\r"]
[99.232613, "o", "\u001b[?2004h> "]
[99.23281, "o", "            writer.writerow(row)\r\n\u001b[?2004l\r"]
[99.232853, "o", "\u001b[?2004h"]
[99.232867, "o", "> "]
[99.232926, "o", "    \r\n\u001b[?2004l\r"]
[99.232972, "o", "\u001b[?2004h> "]
[99.233288, "o", "    print(f\"Report generated at: {report_path}\")\r\n\u001b[?2004l\r"]
[99.233329, "o", "\u001b[?2004h"]
[99.233344, "o", "> "]
[99.233408, "o", "    \r\n\u001b[?2004l\r"]
[99.233447, "o", "\u001b[?2004h"]
[99.233462, "o", "> "]
[99.233811, "o", "    # Calculate database checksum for integrity check\r\n"]
[99.233826, "o", "\u001b[?2004l\r"]
[99.233887, "o", "\u001b[?2004h> "]
[99.233997, "o", "    conn.close()\r\n\u001b[?2004l\r"]
[99.234039, "o", "\u001b[?2004h"]
[99.234086, "o", "> "]
[99.234101, "o", "    \r\n\u001b[?2004l\r"]
[99.234163, "o", "\u001b[?2004h> "]
[99.234295, "o", "    import hashlib\r\n\u001b[?2004l\r"]
[99.234335, "o", "\u001b[?2004h"]
[99.234349, "o", "> "]
[99.234567, "o", "    sha256 = hashlib.sha256()\r\n\u001b[?2004l\r"]
[99.234607, "o", "\u001b[?2004h"]
[99.234665, "o", "> "]
[99.234858, "o", "    with open(db_path, 'rb') as f:\r\n\u001b[?2004l\r"]
[99.2349, "o", "\u001b[?2004h"]
[99.234953, "o", "> "]
[99.235059, "o", "        while True:\r\n\u001b[?2004l\r"]
[99.235102, "o", "\u001b[?2004h"]
[99.235152, "o", "> "]
[99.235349, "o", "            data = f.read(4096)\r\n\u001b[?2004l\r"]
[99.235393, "o", "\u001b[?2004h"]
[99.235455, "o", "> "]
[99.23559, "o", "            if not data:\r\n\u001b[?2004l\r"]
[99.235636, "o", "\u001b[?2004h> "]
[99.235786, "o", "                break\r\n\u001b[?2004l\r"]
[99.235821, "o", "\u001b[?2004h"]
[99.235836, "o", "> "]
[99.23605, "o", "            sha256.update(data)\r\n"]
[99.236064, "o", "\u001b[?2004l\r"]
[99.236131, "o", "\u001b[?2004h> "]
[99.236364, "o", "    db_checksum = sha256.hexdigest()\r\n\u001b[?2004l\r"]
[99.236422, "o", "\u001b[?2004h"]
[99.236482, "o", "> "]
[99.236499, "o", "    \r\n\u001b[?2004l\r"]
[99.236561, "o", "\u001b[?2004h"]
[99.236609, "o", "> "]
[99.236834, "o", "    # Append integrity checksum to SQL log\r\n\u001b[?2004l\r"]
[99.236883, "o", "\u001b[?2004h"]
[99.236933, "o", "> "]
[99.237153, "o", "    with open(sql_log_path, 'a') as f:\r\n\u001b[?2004l\r"]
[99.237189, "o", "\u001b[?2004h"]
[99.237239, "o", "> "]
[99.237548, "o", "        f.write(f\"-- DB_CHECKSUM: {db_checksum}\\n\")\r\n\u001b[?2004l\r"]
[99.237599, "o", "\u001b[?2004h"]
[99.237615, "o", "> "]
[99.237672, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h"]
[99.237703, "o", "> "]
[99.238013, "o", "    print(f\"Database checksum: {db_checksum}\")\r\n\u001b[?2004l\r"]
[99.238062, "o", "\u001b[?2004h"]
[99.238112, "o", "> "]
[99.238443, "o", "    print(\"SQL log updated with integrity checksum\")\r\n\u001b[?2004l\r"]
[99.238485, "o", "\u001b[?2004h"]
[99.238499, "o", "> "]
[99.238561, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[99.238575, "o", "> "]
[99.23876, "o", "if __name__ == '__main__':\r\n\u001b[?2004l\r"]
[99.238803, "o", "\u001b[?2004h"]
[99.238817, "o", "> "]
[99.2389, "o", "    main()\r\n\u001b[?2004l\r"]
[99.238938, "o", "\u001b[?2004h"]
[99.238952, "o", "> "]
[99.239008, "o", "EOF"]
[100.11003, "i", "chmod +x generate_report.py\n"]
[100.110319, "o", "chmod +x generate_report.py\r\n\u001b[?2004l\r"]
[100.110398, "o", "\u001b[?2004h> "]
[100.223993, "i", "python3 generate_report.py\n"]
[100.224252, "o", "python3 generate_report.py\r\n\u001b[?2004l\r"]
[100.224328, "o", "\u001b[?2004h"]
[100.224375, "o", "> "]
[102.249948, "i", "ls -la reports/\n"]
[102.250154, "o", "ls -la reports/\r\n"]
[102.250226, "o", "\u001b[?2004l\r\u001b[?2004h"]
[102.250302, "o", "> "]
[102.356607, "i", "head -5 reports/audit_summary.csv\n"]
[102.35691, "o", "head -5 reports/audit_summary.csv\r\n\u001b[?2004l\r"]
[102.356966, "o", "\u001b[?2004h"]
[102.35701, "o", "> "]
[102.490758, "i", "tail -5 logs/sql_history.log\n"]
[102.491024, "o", "tail -5 logs/sql_history.log\r\n\u001b[?2004l\r"]
[102.491089, "o", "\u001b[?2004h"]
[102.491142, "o", "> "]
