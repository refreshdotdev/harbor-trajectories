{"version": 2, "width": 160, "height": 40, "timestamp": 1771009069, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.006495, "o", "\u001b[?2004hroot@49573271-cd29-43f5-ba0c-59db462adeb9:~# "]
[0.903073, "i", "clear\r"]
[0.903228, "o", "clear\r\n\u001b[?2004l\r"]
[0.904304, "o", "\u001b[H\u001b[J"]
[0.904498, "o", "\u001b[?2004h"]
[0.904508, "o", "root@49573271-cd29-43f5-ba0c-59db462adeb9:~# "]
[56.061229, "i", "cat > ~/backup_configs.sh << 'EOF'\n#!/bin/bash\n\n# Set strict error handling\nset -euo pipefail\n\n# Define paths\nreadonly CONFIGS_DIR=\"/home/user/configs\"\nreadonly BACKUPS_DIR=\"/home/user/backups\"\nreadonly BACKUP_LOGS_DIR=\"/home/user/backup_logs\"\nreadonly BACKUP_ID_FILE=\"/home/user/backup_id\"\n\n# Read and trim backup ID\nreadonly BACKUP_ID=$(cat \"$BACKUP_ID_FILE\" | tr -d '[:space:]')\n\n# Ensure backup directories exist\nmkdir -p \"$BACKUPS_DIR\"\nmkdir -p \"$BACKUP_LOGS_DIR\"\n\n# Log file path\nreadonly LOG_FILE=\"$BACKUP_LOGS_DIR/backup_${BACKUP_ID}.log\"\n\n# Header for the log file\nreadonly LOG_HEADER=\"REL_PATH|ARCHIVE_NAME|SHA256|SIZE\"\n\n# Temporary files for logging individual file details\nreadonly INTERMEDIATE_LOG_FILE=\"${LOG_FILE}.tmp_lines\"\nreadonly SORTED_LOG_FILE=\"${LOG_FILE}.tmp_sorted\"\n\n# 1. Identify and Filter Files\n# Find files recursively in CONFIGS_DIR:\n# - Name ending in .conf or .yml\n# - Size <= 512 bytes\n# - Not named test.conf (path-aware exclusion)\n# - Print full path\nFIND_CMD=(\n  find \"$CONFIGS_DIR\" -type "]
[56.061273, "i", "f \\\n    \\( -name \"*.conf\" -or -name \"*.yml\" \\) \\\n    -size -512c \\\n    ! -name \"test.conf\" \\\n    -print\n)\n\n# Process each found file\n# Use a temporary array to store background PIDs\ndeclare -a background_pids\n\n# Create intermediate log file and add header\necho \"$LOG_HEADER\" > \"$INTERMEDIATE_LOG_FILE\"\n\n# Iterate through each file found by find\nwhile IFS= read -r file_path; do\n  # 2. Create Individual Archives (Parallel)\n  \n  # Get filename and extension\n  filename=$(basename \"$file_path\")\n  extension=\"${filename##*.}\"\n  \n  # Get basename (filename without extension), handle spaces\n  basename=\"${filename%.*}\"\n  \n  # Determine compression based on extension\n  if [ \"$extension\" = \"conf\" ]; then\n    archive_ext=\"tar.gz\"\n    tar_compress_flag=\"z\"\n  elif [ \"$extension\" = \"yml\" ]; then\n    archive_ext=\"tar.bz2\"\n    tar_compress_flag=\"j\"\n  else\n    # Should not happen due to find criteria, but as a safeguard\n    echo \"Warning: Unknown file type for $filename, skipping.\" >&2\n    continue\n  fi\n  \n  # Construct archive n"]
[56.061362, "i", "ame: <basename>_<BACKUP_ID>.tar.<ext>\n  archive_name=\"${basename}_${BACKUP_ID}.tar.${archive_ext}\"\n  \n  # Target archive path\n  target_archive_path=\"${BACKUPS_DIR}/${archive_name}\"\n  \n  # Path of the file relative to CONFIGS_DIR (for tar and log)\n  # Remove CONFIGS_DIR prefix and ensure no leading slash or './'\n  rel_path=\"${file_path#${CONFIGS_DIR}/}\"\n  if [ \"${rel_path:0:1}\" = \"/\" ]; then\n    rel_path=\"${rel_path:1}\"\n  fi\n  if [ \"${rel_path:0:2}\" = \"./\" ]; then\n    rel_path=\"${rel_path:2}\"\n  fi\n  \n  # Calculate SHA256 checksum of the original source file\n  file_sha256=$(sha256sum \"$file_path\" | awk '{print $1}')\n  \n  # Get file size in bytes\n  file_size=$(stat -c%s \"$file_path\")\n  \n  # Add details to intermediate log (will be sorted later)\n  echo \"${rel_path}|${archive_name}|${file_sha256}|${file_size}\" >> \"$INTERMEDIATE_LOG_FILE\"\n  \n  # Create the archive in the background\n  # tar -C <parent_of_item> -${tar_compress_flag}vf <archive_path> <item_relative_to_parent>\n  # Example: tar -C /home/user/configs -zv"]
[56.061392, "i", "f /home/user/backups/app_v1.2.tar.gz subdir/app.conf\n  # This means we need to cd into $CONFIGS_DIR first, then tar the relative path\n  \n  # Construct command for background job\n  # tar is run from CONFIGS_DIR so paths are relative\n  ( \n    cd \"$CONFIGS_DIR\" || exit 1\n    tar -C \"$CONFIGS_DIR\" -${tar_compress_flag}cf \"$target_archive_path\" \"${rel_path}\" \n  ) &\n  background_pids+=($!)\ndone\n\n# Wait for all background jobs to finish\n# Check if any background_pids were actually spawned\nif [ ${#background_pids[@]} -eq 0 ]; then\n  echo \"No files matching criteria found for individual backups. Proceeding to full archive.\" >&2\nelse\n  echo \"Waiting for ${#background_pids[@]} background archiving jobs to complete...\"\n  for pid in \"${background_pids[@]}\"; do\n    wait \"$pid\" || {\n      echo \"Error: Background job (PID $pid) exited with a non-zero status.\" >&2\n      # Propagate error if any background job fails\n      false \n    }\n  done\n  echo \"All background archiving jobs completed.\"\nfi\n\n# 3. Create Full Archive\n# Path:"]
[56.061414, "i", " /home/user/backups/configs_full_<BACKUP_ID>.tar.xz\nfull_archive_name=\"configs_full_${BACKUP_ID}.tar.xz\"\nfull_archive_path=\"${BACKUPS_DIR}/${full_archive_name}\"\n\necho \"Creating full archive: ${full_archive_path}...\"\ntar -C \"$(dirname \"$CONFIGS_DIR\")\" -Jcf \"$full_archive_path\" \"$(basename \"$CONFIGS_DIR\")\"\n\n# 4. Generate Log File\n# Sort intermediate log file by SHA256 column\n# Sort options:\n# -k4,4: Sort by 4th field (SHA256)\n# -t'|': Use pipe as delimiter\n# -o: Specify output file\nsort -k4,4 -t'|' -o \"$SORTED_LOG_FILE\" \"$INTERMEDIATE_LOG_FILE\"\n\n# Move sorted log to final log file name\nmv \"$SORTED_LOG_FILE\" \"$LOG_FILE\"\n\necho \"Backup process completed successfully.\"\necho \"Log file: $LOG_FILE\"\necho \"Individual archives are in: $BACKUPS_DIR\"\necho \"Full archive: $full_archive_path\"\n\n# Clean up temporary files (if any, though mv handles this)\n# rm -f \"$INTERMEDIATE_LOG_FILE\" \"$SORTED_LOG_FILE\" # Not strictly needed if mv is used\n\n# Exit successfully\nexit 0\nEOF"]
[56.061591, "o", "cat > ~/backup_configs.sh << 'EOF'\r\n"]
[56.06161, "o", "\u001b[?2004l\r"]
[56.061698, "o", "\u001b[?2004h"]
[56.061725, "o", "> "]
[56.061866, "o", "#!/bin/bash\r\n"]
[56.061887, "o", "\u001b[?2004l\r"]
[56.061915, "o", "\u001b[?2004h"]
[56.061946, "o", "> \r\n\u001b[?2004l\r"]
[56.061984, "o", "\u001b[?2004h"]
[56.062007, "o", "> "]
[56.062288, "o", "# Set strict error handling\r\n"]
[56.062311, "o", "\u001b[?2004l\r"]
[56.062338, "o", "\u001b[?2004h"]
[56.06236, "o", "> "]
[56.062513, "o", "set -euo pipefail\r\n"]
[56.062531, "o", "\u001b[?2004l\r"]
[56.062556, "o", "\u001b[?2004h"]
[56.062576, "o", "> "]
[56.062595, "o", "\r\n\u001b[?2004l\r"]
[56.062621, "o", "\u001b[?2004h"]
[56.062642, "o", "> "]
[56.062781, "o", "# Define paths\r\n"]
[56.062799, "o", "\u001b[?2004l\r"]
[56.062834, "o", "\u001b[?2004h"]
[56.06286, "o", "> "]
[56.063252, "o", "readonly CONFIGS_DIR=\"/home/user/configs\"\r\n\u001b[?2004l\r"]
[56.063293, "o", "\u001b[?2004h"]
[56.063328, "o", "> "]
[56.063725, "o", "readonly BACKUPS_DIR=\"/home/user/backups\"\r\n\u001b[?2004l\r"]
[56.063762, "o", "\u001b[?2004h"]
[56.063804, "o", "> "]
[56.06419, "o", "readonly BACKUP_LOGS_DIR=\"/home/user/backup_logs\"\r\n\u001b[?2004l\r"]
[56.064302, "o", "\u001b[?2004h> "]
[56.064685, "o", "readonly BACKUP_ID_FILE=\"/home/user/backup_id\"\r\n\u001b[?2004l\r"]
[56.064749, "o", "\u001b[?2004h"]
[56.064837, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[56.065067, "o", "# Read and trim backup ID\r\n\u001b[?2004l\r"]
[56.065113, "o", "\u001b[?2004h"]
[56.065167, "o", "> "]
[56.065702, "o", "readonly BACKUP_ID=$(cat \"$BACKUP_ID_FILE\" | tr -d '[:space:]')\r\n\u001b[?2004l\r"]
[56.065757, "o", "\u001b[?2004h> "]
[56.065813, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[56.065888, "o", "> "]
[56.066154, "o", "# Ensure backup directories exist\r\n\u001b[?2004l\r"]
[56.066211, "o", "\u001b[?2004h"]
[56.066259, "o", "> "]
[56.066445, "o", "mkdir -p \"$BACKUPS_DIR\"\r\n\u001b[?2004l\r"]
[56.066495, "o", "\u001b[?2004h"]
[56.066546, "o", "> "]
[56.066767, "o", "mkdir -p \"$BACKUP_LOGS_DIR\"\r\n\u001b[?2004l\r"]
[56.066838, "o", "\u001b[?2004h> "]
[56.066885, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[56.066941, "o", "> "]
[56.067055, "o", "# Log file path\r\n\u001b[?2004l\r"]
[56.067102, "o", "\u001b[?2004h"]
[56.067158, "o", "> "]
[56.067667, "o", "readonly LOG_FILE=\"$BACKUP_LOGS_DIR/backup_${BACKUP_ID}.log\"\r\n\u001b[?2004l\r"]
[56.067717, "o", "\u001b[?2004h"]
[56.067763, "o", "> \r\n\u001b[?2004l\r"]
[56.067808, "o", "\u001b[?2004h> "]
[56.068052, "o", "# Header for the log file\r\n\u001b[?2004l\r"]
[56.068098, "o", "\u001b[?2004h"]
[56.068163, "o", "> "]
[56.068617, "o", "readonly LOG_HEADER=\"REL_PATH|ARCHIVE_NAME|SHA256|SIZE\"\r\n\u001b[?2004l\r"]
[56.068673, "o", "\u001b[?2004h"]
[56.068719, "o", "> \r\n\u001b[?2004l\r"]
[56.068763, "o", "\u001b[?2004h> "]
[56.069271, "o", "# Temporary files for logging individual file details\r\n\u001b[?2004l\r"]
[56.06933, "o", "\u001b[?2004h"]
[56.069379, "o", "> "]
[56.06978, "o", "readonly INTERMEDIATE_LOG_FILE=\"${LOG_FILE}.tmp_lines\"\r\n\u001b[?2004l\r"]
[56.069836, "o", "\u001b[?2004h"]
[56.069925, "o", "> "]
[56.07035, "o", "readonly SORTED_LOG_FILE=\"${LOG_FILE}.tmp_sorted\"\r\n\u001b[?2004l\r"]
[56.070407, "o", "\u001b[?2004h> "]
[56.070454, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[56.070504, "o", "> "]
[56.070775, "o", "# 1. Identify and Filter Files\r\n\u001b[?2004l\r"]
[56.070829, "o", "\u001b[?2004h"]
[56.070886, "o", "> "]
[56.071217, "o", "# Find files recursively in CONFIGS_DIR:\r\n\u001b[?2004l\r"]
[56.071266, "o", "\u001b[?2004h"]
[56.071322, "o", "> "]
[56.071584, "o", "# - Name ending in .conf or .yml\r\n\u001b[?2004l\r"]
[56.071627, "o", "\u001b[?2004h"]
[56.071687, "o", "> "]
[56.071861, "o", "# - Size <= 512 bytes\r\n\u001b[?2004l\r"]
[56.071916, "o", "\u001b[?2004h"]
[56.071975, "o", "> "]
[56.072339, "o", "# - Not named test.conf (path-aware exclusion)\r\n\u001b[?2004l\r"]
[56.072382, "o", "\u001b[?2004h"]
[56.072429, "o", "> "]
[56.072547, "o", "# - Print full path\r\n\u001b[?2004l\r"]
[56.072599, "o", "\u001b[?2004h"]
[56.072639, "o", "> "]
[56.072709, "o", "FIND_CMD=(\r\n\u001b[?2004l\r"]
[56.072749, "o", "\u001b[?2004h"]
[56.072794, "o", "> "]
[56.073021, "o", "  find \"$CONFIGS_DIR\" -type f \\\r\n\u001b[?2004l\r"]
[56.073061, "o", "\u001b[?2004h"]
[56.07311, "o", "> "]
[56.073427, "o", "    \\( -name \"*.conf\" -or -name \"*.yml\" \\) \\\r\n\u001b[?2004l\r"]
[56.073486, "o", "\u001b[?2004h"]
[56.073538, "o", "> "]
[56.073639, "o", "    -size -512c \\\r\n\u001b[?2004l\r"]
[56.073686, "o", "\u001b[?2004h"]
[56.073731, "o", "> "]
[56.073914, "o", "    ! -name \"test.conf\" \\\r\n\u001b[?2004l\r"]
[56.073968, "o", "\u001b[?2004h"]
[56.074029, "o", "> "]
[56.074079, "o", "    -print\r\n\u001b[?2004l\r"]
[56.074122, "o", "\u001b[?2004h"]
[56.074164, "o", "> )\r\n\u001b[?2004l\r"]
[56.074213, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[56.074264, "o", "\u001b[?2004h"]
[56.07432, "o", "> "]
[56.074489, "o", "# Process each found file\r\n\u001b[?2004l\r"]
[56.074526, "o", "\u001b[?2004h"]
[56.074568, "o", "> "]
[56.074933, "o", "# Use a temporary array to store background PIDs\r\n\u001b[?2004l\r"]
[56.074976, "o", "\u001b[?2004h"]
[56.075022, "o", "> "]
[56.075206, "o", "declare -a background_pids\r\n\u001b[?2004l\r"]
[56.075258, "o", "\u001b[?2004h"]
[56.075321, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[56.075371, "o", "> "]
[56.07568, "o", "# Create intermediate log file and add header\r\n\u001b[?2004l\r"]
[56.075724, "o", "\u001b[?2004h"]
[56.075767, "o", "> "]
[56.076105, "o", "echo \"$LOG_HEADER\" > \"$INTERMEDIATE_LOG_FILE\"\r\n\u001b[?2004l\r"]
[56.076148, "o", "\u001b[?2004h"]
[56.076192, "o", "> \r\n\u001b[?2004l\r"]
[56.076237, "o", "\u001b[?2004h> "]
[56.076524, "o", "# Iterate through each file found by find\r\n\u001b[?2004l\r"]
[56.076576, "o", "\u001b[?2004h"]
[56.076618, "o", "> "]
[56.076858, "o", "while IFS= read -r file_path; do\r\n\u001b[?2004l\r"]
[56.076904, "o", "\u001b[?2004h"]
[56.076949, "o", "> "]
[56.077262, "o", "  # 2. Create Individual Archives (Parallel)\r\n\u001b[?2004l\r"]
[56.077308, "o", "\u001b[?2004h"]
[56.077355, "o", "> "]
[56.077398, "o", "  \r\n\u001b[?2004l\r\u001b[?2004h"]
[56.077448, "o", "> "]
[56.077651, "o", "  # Get filename and extension\r\n\u001b[?2004l\r"]
[56.07769, "o", "\u001b[?2004h"]
[56.077748, "o", "> "]
[56.077996, "o", "  filename=$(basename \"$file_path\")\r\n\u001b[?2004l\r"]
[56.078043, "o", "\u001b[?2004h"]
[56.07809, "o", "> "]
[56.078289, "o", "  extension=\"${filename##*.}\"\r\n\u001b[?2004l\r"]
[56.078337, "o", "\u001b[?2004h"]
[56.078397, "o", ">   \r\n\u001b[?2004l\r"]
[56.078445, "o", "\u001b[?2004h> "]
[56.078875, "o", "  # Get basename (filename without extension), handle spaces\r\n\u001b[?2004l\r"]
[56.078932, "o", "\u001b[?2004h"]
[56.078977, "o", "> "]
[56.079174, "o", "  basename=\"${filename%.*}\"\r\n\u001b[?2004l\r"]
[56.079217, "o", "\u001b[?2004h"]
[56.079269, "o", ">   \r\n\u001b[?2004l\r"]
[56.079321, "o", "\u001b[?2004h> "]
[56.079681, "o", "  # Determine compression based on extension\r\n\u001b[?2004l\r"]
[56.079739, "o", "\u001b[?2004h"]
[56.079777, "o", "> "]
[56.08006, "o", "  if [ \"$extension\" = \"conf\" ]; then\r\n\u001b[?2004l\r"]
[56.080102, "o", "\u001b[?2004h"]
[56.080145, "o", "> "]
[56.080316, "o", "    archive_ext=\"tar.gz\"\r\n\u001b[?2004l\r"]
[56.080358, "o", "\u001b[?2004h"]
[56.080404, "o", "> "]
[56.08059, "o", "    tar_compress_flag=\"z\"\r\n\u001b[?2004l\r"]
[56.080631, "o", "\u001b[?2004h"]
[56.080676, "o", "> "]
[56.080944, "o", "  elif [ \"$extension\" = \"yml\" ]; then\r\n\u001b[?2004l\r"]
[56.080982, "o", "\u001b[?2004h"]
[56.081024, "o", "> "]
[56.081177, "o", "    archive_ext=\"tar.bz2\"\r\n\u001b[?2004l\r"]
[56.081214, "o", "\u001b[?2004h"]
[56.081257, "o", "> "]
[56.081409, "o", "    tar_compress_flag=\"j\"\r\n\u001b[?2004l\r"]
[56.081454, "o", "\u001b[?2004h"]
[56.0815, "o", "> "]
[56.081548, "o", "  else\r\n\u001b[?2004l\r"]
[56.081594, "o", "\u001b[?2004h> "]
[56.082096, "o", "    # Should not happen due to find criteria, but as a safeguard\r\n\u001b[?2004l\r"]
[56.082143, "o", "\u001b[?2004h> "]
[56.082621, "o", "    echo \"Warning: Unknown file type for $filename, skipping.\" >&2\r\n\u001b[?2004l\r"]
[56.082715, "o", "\u001b[?2004h> "]
[56.082869, "o", "    continue\r\n\u001b[?2004l\r\u001b[?2004h> "]
[56.083117, "o", "  fi\r\n\u001b[?2004l\r\u001b[?2004h>   \r\n\u001b[?2004l\r\u001b[?2004h> "]
[56.083514, "o", "  # Construct archive name: <basename>_<BACKUP_ID>.tar.<ext>\r\n\u001b[?2004l\r"]
[56.083572, "o", "\u001b[?2004h> "]
[56.084038, "o", "  archive_name=\"${basename}_${BACKUP_ID}.tar.${archive_ext}\"\r\n\u001b[?2004l\r"]
[56.08409, "o", "\u001b[?2004h"]
[56.08413, "o", ">   \r\n\u001b[?2004l\r"]
[56.084173, "o", "\u001b[?2004h"]
[56.084208, "o", "> "]
[56.084383, "o", "  # Target archive path\r\n\u001b[?2004l\r"]
[56.084425, "o", "\u001b[?2004h"]
[56.084454, "o", "> "]
[56.084839, "o", "  target_archive_path=\"${BACKUPS_DIR}/${archive_name}\"\r\n\u001b[?2004l\r"]
[56.084877, "o", "\u001b[?2004h"]
[56.084908, "o", "> "]
[56.084937, "o", "  \r\n"]
[56.084967, "o", "\u001b[?2004l\r"]
[56.084996, "o", "\u001b[?2004h> "]
[56.085468, "o", "  # Path of the file relative to CONFIGS_DIR (for tar and log)\r\n"]
[56.085478, "o", "\u001b[?2004l\r"]
[56.08552, "o", "\u001b[?2004h"]
[56.085548, "o", "> "]
[56.086033, "o", "  # Remove CONFIGS_DIR prefix and ensure no leading slash or './'\r\n\u001b[?2004l\r"]
[56.086075, "o", "\u001b[?2004h"]
[56.086114, "o", "> "]
[56.086404, "o", "  rel_path=\"${file_path#${CONFIGS_DIR}/}\"\r\n\u001b[?2004l\r"]
[56.086443, "o", "\u001b[?2004h"]
[56.086466, "o", "> "]
[56.08675, "o", "  if [ \"${rel_path:0:1}\" = \"/\" ]; then\r\n"]
[56.086782, "o", "\u001b[?2004l\r"]
[56.086812, "o", "\u001b[?2004h"]
[56.086848, "o", "> "]
[56.087061, "o", "    rel_path=\"${rel_path:1}\"\r\n\u001b[?2004l\r"]
[56.087105, "o", "\u001b[?2004h"]
[56.087136, "o", "> "]
[56.087177, "o", "  fi\r\n\u001b[?2004l\r"]
[56.08722, "o", "\u001b[?2004h"]
[56.08725, "o", "> "]
[56.087502, "o", "  if [ \"${rel_path:0:2}\" = \"./\" ]; then\r\n\u001b[?2004l\r"]
[56.087533, "o", "\u001b[?2004h"]
[56.087569, "o", "> "]
[56.087766, "o", "    rel_path=\"${rel_path:2}\"\r\n"]
[56.087797, "o", "\u001b[?2004l\r"]
[56.087808, "o", "\u001b[?2004h"]
[56.087858, "o", "> "]
[56.087898, "o", "  fi\r\n\u001b[?2004l\r"]
[56.087933, "o", "\u001b[?2004h> "]
[56.087962, "o", "  \r\n\u001b[?2004l\r"]
[56.087999, "o", "\u001b[?2004h"]
[56.088026, "o", "> "]
[56.088408, "o", "  # Calculate SHA256 checksum of the original source file\r\n\u001b[?2004l\r"]
[56.088457, "o", "\u001b[?2004h> "]
[56.088882, "o", "  file_sha256=$(sha256sum \"$file_path\" | awk '{print $1}')\r\n\u001b[?2004l\r"]
[56.088927, "o", "\u001b[?2004h"]
[56.088972, "o", ">   \r\n"]
[56.089016, "o", "\u001b[?2004l\r\u001b[?2004h"]
[56.089059, "o", "> "]
[56.089244, "o", "  # Get file size in bytes\r\n\u001b[?2004l\r"]
[56.089291, "o", "\u001b[?2004h"]
[56.089333, "o", "> "]
[56.08959, "o", "  file_size=$(stat -c%s \"$file_path\")\r\n\u001b[?2004l\r"]
[56.089643, "o", "\u001b[?2004h"]
[56.089684, "o", ">   \r\n\u001b[?2004l\r"]
[56.089727, "o", "\u001b[?2004h"]
[56.089769, "o", "> "]
[56.090158, "o", "  # Add details to intermediate log (will be sorted later)\r\n\u001b[?2004l\r"]
[56.090199, "o", "\u001b[?2004h"]
[56.090244, "o", "> "]
[56.090968, "o", "  echo \"${rel_path}|${archive_name}|${file_sha256}|${file_size}\" >> \"$INTERMEDIATE_LOG_FILE\"\r\n\u001b[?2004l\r"]
[56.091086, "o", "\u001b[?2004h>   \r\n\u001b[?2004l\r\u001b[?2004h> "]
[56.091388, "o", "  # Create the archive in the background\r\n\u001b[?2004l\r"]
[56.091447, "o", "\u001b[?2004h> "]
[56.092167, "o", "  # tar -C <parent_of_item> -${tar_compress_flag}vf <archive_path> <item_relative_to_parent>\r\n\u001b[?2004l\r"]
[56.092272, "o", "\u001b[?2004h> "]
[56.092948, "o", "  # Example: tar -C /home/user/configs -zvf /home/user/backups/app_v1.2.tar.gz subdir/app.conf\r\n\u001b[?2004l\r"]
[56.093038, "o", "\u001b[?2004h"]
[56.093095, "o", "> "]
[56.09362, "o", "  # This means we need to cd into $CONFIGS_DIR first, then tar the relative path\r\n\u001b[?2004l\r"]
[56.093682, "o", "\u001b[?2004h"]
[56.093734, "o", ">   \r\n\u001b[?2004l\r"]
[56.09379, "o", "\u001b[?2004h> "]
[56.094057, "o", "  # Construct command for background job\r\n\u001b[?2004l\r"]
[56.094103, "o", "\u001b[?2004h"]
[56.094139, "o", "> "]
[56.094463, "o", "  # tar is run from CONFIGS_DIR so paths are relative\r\n\u001b[?2004l\r"]
[56.094501, "o", "\u001b[?2004h"]
[56.094563, "o", ">   ( \r\n"]
[56.094603, "o", "\u001b[?2004l\r"]
[56.094639, "o", "\u001b[?2004h"]
[56.09467, "o", "> "]
[56.094927, "o", "    cd \"$CONFIGS_DIR\" || exit 1\r\n"]
[56.09496, "o", "\u001b[?2004l\r"]
[56.094988, "o", "\u001b[?2004h"]
[56.095018, "o", "> "]
[56.095594, "o", "    tar -C \"$CONFIGS_DIR\" -${tar_compress_flag}cf \"$target_archive_path\" \"${rel_path}\" \r\n\u001b[?2004l\r"]
[56.095634, "o", "\u001b[?2004h"]
[56.095661, "o", "> "]
[56.095716, "o", "  ) &\r\n"]
[56.095746, "o", "\u001b[?2004l\r"]
[56.095777, "o", "\u001b[?2004h"]
[56.095806, "o", "> "]
[56.09599, "o", "  background_pids+=($!)\r\n\u001b[?2004l\r"]
[56.096044, "o", "\u001b[?2004h"]
[56.096084, "o", "> "]
[56.096118, "o", "done\r\n\u001b[?2004l\r"]
[56.096155, "o", "\u001b[?2004h"]
[56.096189, "o", "> \r\n\u001b[?2004l\r"]
[56.096237, "o", "\u001b[?2004h"]
[56.096273, "o", "> "]
[56.096547, "o", "# Wait for all background jobs to finish\r\n\u001b[?2004l\r"]
[56.096586, "o", "\u001b[?2004h"]
[56.096613, "o", "> "]
[56.096986, "o", "# Check if any background_pids were actually spawned\r\n\u001b[?2004l\r"]
[56.097027, "o", "\u001b[?2004h"]
[56.097055, "o", "> "]
[56.097349, "o", "if [ ${#background_pids[@]} -eq 0 ]; then\r\n\u001b[?2004l\r"]
[56.097386, "o", "\u001b[?2004h"]
[56.097414, "o", "> "]
[56.098064, "o", "  echo \"No files matching criteria found for individual backups. Proceeding to full archive.\" >&2\r\n\u001b[?2004l\r"]
[56.098107, "o", "\u001b[?2004h"]
[56.098143, "o", "> "]
[56.098178, "o", "else\r\n"]
[56.098208, "o", "\u001b[?2004l\r"]
[56.098237, "o", "\u001b[?2004h"]
[56.098267, "o", "> "]
[56.098825, "o", "  echo \"Waiting for ${#background_pids[@]} background archiving jobs to complete...\"\r\n\u001b[?2004l\r"]
[56.09887, "o", "\u001b[?2004h"]
[56.098898, "o", "> "]
[56.099181, "o", "  for pid in \"${background_pids[@]}\"; do\r\n\u001b[?2004l\r"]
[56.099237, "o", "\u001b[?2004h"]
[56.099264, "o", "> "]
[56.099426, "o", "    wait \"$pid\" || {\r\n\u001b[?2004l\r"]
[56.099466, "o", "\u001b[?2004h"]
[56.099494, "o", "> "]
[56.100038, "o", "      echo \"Error: Background job (PID $pid) exited with a non-zero status.\" >&2\r\n\u001b[?2004l\r"]
[56.100078, "o", "\u001b[?2004h"]
[56.100106, "o", "> "]
[56.10046, "o", "      # Propagate error if any background job fails\r\n\u001b[?2004l\r"]
[56.100506, "o", "\u001b[?2004h"]
[56.100566, "o", "> "]
[56.100645, "o", "      false \r\n"]
[56.100677, "o", "\u001b[?2004l\r"]
[56.100713, "o", "\u001b[?2004h> "]
[56.100772, "o", "    }\r\n\u001b[?2004l\r"]
[56.100834, "o", "\u001b[?2004h"]
[56.100869, "o", "> "]
[56.100926, "o", "  done\r\n"]
[56.100958, "o", "\u001b[?2004l\r"]
[56.10099, "o", "\u001b[?2004h"]
[56.101023, "o", "> "]
[56.101352, "o", "  echo \"All background archiving jobs completed.\"\r\n\u001b[?2004l\r"]
[56.101394, "o", "\u001b[?2004h"]
[56.101426, "o", "> "]
[56.101465, "o", "fi\r\n"]
[56.101496, "o", "\u001b[?2004l\r\u001b[?2004h"]
[56.101529, "o", "> "]
[56.101559, "o", "\r\n\u001b[?2004l\r"]
[56.101593, "o", "\u001b[?2004h"]
[56.101626, "o", "> "]
[56.101808, "o", "# 3. Create Full Archive\r\n\u001b[?2004l\r"]
[56.10187, "o", "\u001b[?2004h"]
[56.101902, "o", "> "]
[56.102269, "o", "# Path: /home/user/backups/configs_full_<BACKUP_ID>.tar.xz\r\n\u001b[?2004l\r"]
[56.102326, "o", "\u001b[?2004h"]
[56.102356, "o", "> "]
[56.102709, "o", "full_archive_name=\"configs_full_${BACKUP_ID}.tar.xz\"\r\n\u001b[?2004l\r"]
[56.102753, "o", "\u001b[?2004h"]
[56.102782, "o", "> "]
[56.10316, "o", "full_archive_path=\"${BACKUPS_DIR}/${full_archive_name}\"\r\n\u001b[?2004l\r"]
[56.103208, "o", "\u001b[?2004h"]
[56.103238, "o", "> \r\n\u001b[?2004l\r"]
[56.103285, "o", "\u001b[?2004h"]
[56.103319, "o", "> "]
[56.103665, "o", "echo \"Creating full archive: ${full_archive_path}...\"\r\n\u001b[?2004l\r"]
[56.103705, "o", "\u001b[?2004h"]
[56.103728, "o", "> "]
[56.104317, "o", "tar -C \"$(dirname \"$CONFIGS_DIR\")\" -Jcf \"$full_archive_path\" \"$(basename \"$CONFIGS_DIR\")\"\r\n\u001b[?2004l\r"]
[56.104359, "o", "\u001b[?2004h"]
[56.104392, "o", "> \r\n\u001b[?2004l\r"]
[56.104432, "o", "\u001b[?2004h"]
[56.104455, "o", "> "]
[56.104619, "o", "# 4. Generate Log File\r\n\u001b[?2004l\r"]
[56.104659, "o", "\u001b[?2004h"]
[56.104684, "o", "> "]
[56.104999, "o", "# Sort intermediate log file by SHA256 column\r\n\u001b[?2004l\r"]
[56.105044, "o", "\u001b[?2004h"]
[56.105067, "o", "> "]
[56.159737, "o", "# Sort options:\r\n\u001b[?2004l\r\u001b[?2004h> # -k4,4: Sort by 4th field (SHA256)\r\n\u001b[?2004l\r\u001b[?2004h> # -t'|': Use pipe as delimiter\r\n\u001b[?2004l\r\u001b[?2004h> # -o: Specify output file\r\n\u001b[?2004l\r\u001b[?2004h> sort -k4,4 -t'|' -o \"$SORTED_LOG_FILE\" \"$INTERMEDIATE_LOG_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Move sorted log to final log file name\r\n\u001b[?2004l\r\u001b[?2004h> mv \"$SORTED_LOG_FILE\" \"$LOG_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> echo \"Backup process completed successfully.\"\r\n\u001b[?2004l\r\u001b[?2004h> echo \"Log file: $LOG_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[56.159926, "o", "echo \"Individual archives are in: $BACKUPS_DIR\"\r\n\u001b[?2004l\r"]
[56.160125, "o", "\u001b[?2004h> "]
[56.160291, "o", "echo \"Full archive: $full_archive_path\"\r\n\u001b[?2004l\r"]
[56.160358, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[56.160408, "o", "\u001b[?2004h"]
[56.160466, "o", "> "]
[56.16085, "o", "# Clean up temporary files (if any, though mv handles this)\r\n\u001b[?2004l\r"]
[56.160918, "o", "\u001b[?2004h> "]
[56.161504, "o", "# rm -f \"$INTERMEDIATE_LOG_FILE\" \"$SORTED_LOG_FILE\" # Not strictly needed if mv is used\r\n\u001b[?2004l\r"]
[56.161562, "o", "\u001b[?2004h> \r\n"]
[56.161623, "o", "\u001b[?2004l\r\u001b[?2004h"]
[56.161682, "o", "> "]
[56.161802, "o", "# Exit successfully\r\n\u001b[?2004l\r"]
[56.161875, "o", "\u001b[?2004h"]
[56.161936, "o", "> exit 0\r\n"]
[56.161995, "o", "\u001b[?2004l\r\u001b[?2004h"]
[56.162054, "o", "> EOF"]
[56.519364, "i", "chmod +x ~/backup_configs.sh\n"]
[56.519612, "o", "chmod +x ~/backup_configs.sh\r\n\u001b[?2004l\r"]
[56.519701, "o", "\u001b[?2004h> "]
[56.602566, "i", "echo \"Script created: ~/backup_configs.sh\"\n"]
[56.602929, "o", "echo \"Script created: ~/backup_configs.sh\"\r\n\u001b[?2004l\r"]
[56.602995, "o", "\u001b[?2004h"]
[56.603047, "o", "> "]
