{"version": 2, "width": 160, "height": 40, "timestamp": 1771009002, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.004271, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[0.837836, "i", "clear\r"]
[0.837972, "o", "clear\r\n\u001b[?2004l\r"]
[0.839407, "o", "\u001b[H\u001b[J"]
[0.839684, "o", "\u001b[?2004h"]
[0.839734, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[42.707323, "i", "mkdir -p /home/user/configs\n"]
[42.707517, "o", "mkdir -p /home/user/configs\r\n\u001b[?2004l\r"]
[42.709517, "o", "\u001b[?2004h"]
[42.709541, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[42.945257, "i", "mkdir -p /home/user/backups\n"]
[42.945377, "o", "mkdir -p /home/user/backups\r\n\u001b[?2004l\r"]
[42.94667, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[43.128684, "i", "mkdir -p /home/user/backup_logs\n"]
[43.128904, "o", "mkdir -p /home/user/backup_logs\r\n\u001b[?2004l\r"]
[43.131109, "o", "\u001b[?2004h"]
[43.131134, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[43.280154, "i", "echo \"v1.2-2023\" > /home/user/backup_id\n"]
[43.280405, "o", "echo \"v1.2-2023\" > /home/user/backup_id\r\n\u001b[?2004l\r"]
[43.308226, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[43.666183, "i", "cat > /home/user/configs/app.conf << 'EOF'\n# Application Configuration\nhost=localhost\nport=8080\nEOF\n"]
[43.666366, "o", "cat > /home/user/configs/app.conf << 'EOF'\r\n\u001b[?2004l\r"]
[43.666382, "o", "\u001b[?2004h"]
[43.666442, "o", "> "]
[43.666481, "o", "# Application Configuration\r\n\u001b[?2004l\r"]
[43.666492, "o", "\u001b[?2004h"]
[43.666536, "o", "> "]
[43.666548, "o", "host=localhost\r\n\u001b[?2004l\r"]
[43.666597, "o", "\u001b[?2004h> port=8080\r\n\u001b[?2004l\r"]
[43.666609, "o", "\u001b[?2004h"]
[43.666692, "o", "> EOF\r\n\u001b[?2004l\r"]
[43.675681, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[43.874692, "i", "cat > /home/user/configs/subdir/my\\ config.yml << 'EOF'\n---\ndatabase:\n  host: db.example.com\n  user: admin\nEOF\n"]
[43.875032, "o", "cat > /home/user/configs/subdir/my\\ config.yml << 'EOF'\r\n\u001b[?2004l\r"]
[43.875116, "o", "\u001b[?2004h> ---\r\n"]
[43.87513, "o", "\u001b[?2004l\r"]
[43.875216, "o", "\u001b[?2004h> database:\r\n\u001b[?2004l\r"]
[43.875274, "o", "\u001b[?2004h> "]
[43.875395, "o", "  host: db.example.com\r\n\u001b[?2004l\r\u001b[?2004h"]
[43.875423, "o", "> "]
[43.875479, "o", "  user: admin\r\n\u001b[?2004l\r"]
[43.875543, "o", "\u001b[?2004h> EOF\r\n"]
[43.87559, "o", "\u001b[?2004l\r"]
[43.916853, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.018008, "i", "cat > /home/user/configs/another.conf << 'EOF'\n[settings]\nlog_level=INFO\nmax_connections=100\nEOF\n"]
[44.018173, "o", "cat > /home/user/configs/another.conf << 'EOF'\r\n\u001b[?2004l\r"]
[44.018204, "o", "\u001b[?2004h"]
[44.018223, "o", "> "]
[44.018244, "o", "[settings]\r\n\u001b[?2004l\r"]
[44.018262, "o", "\u001b[?2004h> "]
[44.018311, "o", "log_level=INFO\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.018329, "o", "> "]
[44.018376, "o", "max_connections=100\r\n\u001b[?2004l\r"]
[44.018395, "o", "\u001b[?2004h> "]
[44.01841, "o", "EOF\r\n\u001b[?2004l\r"]
[44.020295, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.114868, "i", "cat > /home/user/configs/test.conf << 'EOF'\n# This file should be excluded\nexclude=true\nEOF\n"]
[44.115038, "o", "cat > /home/user/configs/test.conf << 'EOF'\r\n\u001b[?2004l\r"]
[44.115088, "o", "\u001b[?2004h> "]
[44.11516, "o", "# This file should be excluded\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.115207, "o", "> exclude=true\r\n\u001b[?2004l\r"]
[44.115244, "o", "\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[44.116596, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.350082, "i", "dd if=/dev/zero of=/home/user/configs/large.yml bs=1 count=513 status=none\n"]
[44.350533, "o", "dd if=/dev/zero of=/home/user/configs/large.yml bs=1 count=513 status=none\r\n\u001b[?2004l\r"]
[44.352807, "o", "\u001b[?2004h"]
[44.352865, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.458709, "i", "cp /home/user/configs/app.conf /home/user/configs/duplicate\\_name.conf\n"]
[44.45922, "o", "cp /home/user/configs/app.conf /home/user/configs/duplicate\\_name.conf\r\n\u001b[?2004l\r"]
[44.461546, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.657943, "i", "cat > /home/user/backup_configurations.sh << 'EOF'\n#!/bin/bash\n\n# Exit on any error\nset -e\n\n# Define directories and backup ID\nBASE_CONFIG_PATH=\"/home/user/configs\"\nBACKUP_DIR=\"/home/user/backups\"\nLOG_DIR=\"/home/user/backup_logs\"\nBACKUP_ID_FILE=\"/home/user/backup_id\"\n\n# Read backup ID, trim whitespace\nBACKUP_ID=$(cat \"$BACKUP_ID_FILE\")\nBACKUP_ID=\"${BACKUP_ID//[^[:alnum:].-]/}\"  # Sanitize ID\n\n# Ensure directories exist\nmkdir -p \"$BACKUP_DIR\"\nmkdir -p \"$LOG_DIR\"\n\n# Function to create individual archives\ncreate_individual_archive() {\n  local filepath=\"$1\"\n  local rel_path=\"${filepath#$BASE_CONFIG_PATH/}\"\n  local filename=\"$(basename \"${filepath#*/}\")\"\n  local basename=\"${filename%.*}\"\n  local ext=\"${filename##*.}\"\n  \n  # Determine compression based on extension\n  local archive_ext=\"\"\n  local tar_option=\"\"\n  if [ \"$ext\" == \"conf\" ]; then\n    archive_ext=\"tar.gz\"\n    tar_option=\"z\"\n  elif [ \"$ext\" == \"yml\" ]; then\n    archive_ext=\"tar.bz2\"\n    tar_option=\"j\"\n  else\n    echo \"ERROR: Unknown extension $ext for file"]
[44.658083, "i", " $filepath\" >&2\n    return 1\n  fi\n\n  local archive_name=\"${basename}_${BACKUP_ID}.${archive_ext}\"\n  local archive_path=\"${BACKUP_DIR}/${archive_name}\"\n\n  # Create archive, preserving relative path\n  # -C /home/user/configs creates archive with path relative to configs\n  # -h is for dereferencing symlinks (if any), not strictly needed here\n  tar -c${tar_option}h -f \"${archive_path}\" -C \"${BASE_CONFIG_PATH}\" \"${rel_path}\" \n  \necho \"Created archive: ${archive_path}\"\n}\n\n# Function to log file details\nlog_file_details() {\n  local filepath=\"$1\"\n  local rel_path=\"${filepath#$BASE_CONFIG_PATH/}\"\n  local filename=\"$(basename \"${filepath#*/}\")\"\n  local basename=\"${filename%.*}\"\n  local ext=\"${filename##*.}\"\n\n  local archive_name=\"${basename}_${BACKUP_ID}\"\n  if [ \"$ext\" == \"conf\" ]; then\n    archive_name+=\".tar.gz\"\n  elif [ \"$ext\" == \"yml\" ]; then\n    archive_name+=\".tar.bz2\"\n  fi\n\n  local sha256=\"$(sha256sum \"$filepath\" | awk '{print $1}')\"\n  local size=\"$(wc -c < \"$filepath\" | tr -d ' \\n')\"\n  \n  echo \"${rel_path}|${ar"]
[44.658175, "i", "chive_name}|${sha256}|${size}\"\n}\n\n# Find valid files and process in parallel\nfind \"$BASE_CONFIG_PATH\" -type f \\( -name \"*.conf\" -o -name \"*.yml\" \\) -not -name \"test.conf\" -size -512c -print0 | \\\nwhile IFS= read -r -d '' filepath; do\n  \n  # Create archive in background\n  create_individual_archive \"$filepath\" &\n  \n  # Log details\n  log_file_details \"$filepath\"\ndone > \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\"\n\n# Wait for all background jobs to finish\nwait\n\n# Create log file header and sort content\n# Ensure temporary log file has unique lines first (if any duplicates from different basenames)\nsort -u -k1,1 -t'|' \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\" | \\\nsort -k3,3 > \"${LOG_DIR}/backup_${BACKUP_ID}.log\"\n\n# Add header to the log file\nsed -i '1i\\REL_PATH|ARCHIVE_NAME|SHA256|SIZE' \"${LOG_DIR}/backup_${BACKUP_ID}.log\"\n\n# Clean up temporary file\nrm \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\"\n\n# Create full archive\nfull_archive_name=\"configs_full_${BACKUP_ID}.tar.xz\"\nfull_archive_path=\"${BACKUP_DIR}/${full_archive_"]
[44.658228, "i", "name}\"\ntar -cJ -f \"${full_archive_path}\" -C \"$(dirname \"$BASE_CONFIG_PATH\")\" \"$(basename \"$BASE_CONFIG_PATH\")\"\n\necho \"Created full archive: ${full_archive_path}\"\necho \"Backup process complete. Log file: ${LOG_DIR}/backup_${BACKUP_ID}.log\"\n\nexit 0\nEOF\n"]
[44.658358, "o", "cat > /home/user/backup_configurations.sh << 'EOF'\r\n\u001b[?2004l\r"]
[44.658443, "o", "\u001b[?2004h"]
[44.658476, "o", "> "]
[44.658534, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[44.658572, "o", "\u001b[?2004h"]
[44.658603, "o", "> \r\n\u001b[?2004l\r"]
[44.658654, "o", "\u001b[?2004h> "]
[44.658781, "o", "# Exit on any error\r\n\u001b[?2004l\r"]
[44.658815, "o", "\u001b[?2004h"]
[44.658849, "o", "> "]
[44.65888, "o", "set -e\r\n\u001b[?2004l\r"]
[44.658913, "o", "\u001b[?2004h"]
[44.658945, "o", "> \r\n\u001b[?2004l\r"]
[44.658976, "o", "\u001b[?2004h> "]
[44.659189, "o", "# Define directories and backup ID\r\n\u001b[?2004l\r"]
[44.659225, "o", "\u001b[?2004h"]
[44.659256, "o", "> "]
[44.65946, "o", "BASE_CONFIG_PATH=\"/home/user/configs\"\r\n\u001b[?2004l\r"]
[44.659497, "o", "\u001b[?2004h"]
[44.659537, "o", "> "]
[44.659713, "o", "BACKUP_DIR=\"/home/user/backups\"\r\n\u001b[?2004l\r"]
[44.659742, "o", "\u001b[?2004h"]
[44.659789, "o", "> "]
[44.659953, "o", "LOG_DIR=\"/home/user/backup_logs\"\r\n\u001b[?2004l\r"]
[44.659987, "o", "\u001b[?2004h"]
[44.660027, "o", "> "]
[44.660227, "o", "BACKUP_ID_FILE=\"/home/user/backup_id\"\r\n\u001b[?2004l\r"]
[44.660282, "o", "\u001b[?2004h> "]
[44.660317, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.660354, "o", "> "]
[44.66054, "o", "# Read backup ID, trim whitespace\r\n\u001b[?2004l\r"]
[44.660575, "o", "\u001b[?2004h"]
[44.660612, "o", "> "]
[44.66081, "o", "BACKUP_ID=$(cat \"$BACKUP_ID_FILE\")\r\n\u001b[?2004l\r"]
[44.660839, "o", "\u001b[?2004h"]
[44.660878, "o", "> "]
[44.661187, "o", "BACKUP_ID=\"${BACKUP_ID//[^[:alnum:].-]/}\"  # Sanitize ID\r\n\u001b[?2004l\r"]
[44.661218, "o", "\u001b[?2004h"]
[44.661258, "o", "> \r\n\u001b[?2004l\r"]
[44.661293, "o", "\u001b[?2004h> "]
[44.661448, "o", "# Ensure directories exist\r\n\u001b[?2004l\r"]
[44.661487, "o", "\u001b[?2004h"]
[44.661524, "o", "> "]
[44.661665, "o", "mkdir -p \"$BACKUP_DIR\"\r\n\u001b[?2004l\r"]
[44.661698, "o", "\u001b[?2004h"]
[44.661736, "o", "> "]
[44.661836, "o", "mkdir -p \"$LOG_DIR\"\r\n\u001b[?2004l\r"]
[44.661872, "o", "\u001b[?2004h"]
[44.661912, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[44.661943, "o", "> "]
[44.662193, "o", "# Function to create individual archives\r\n\u001b[?2004l\r"]
[44.662245, "o", "\u001b[?2004h> "]
[44.66241, "o", "create_individual_archive() {\r\n\u001b[?2004l\r"]
[44.66245, "o", "\u001b[?2004h> "]
[44.662596, "o", "  local filepath=\"$1\"\r\n\u001b[?2004l\r"]
[44.662647, "o", "\u001b[?2004h> "]
[44.662947, "o", "  local rel_path=\"${filepath#$BASE_CONFIG_PATH/}\"\r\n\u001b[?2004l\r"]
[44.662989, "o", "\u001b[?2004h> "]
[44.663272, "o", "  local filename=\"$(basename \"${filepath#*/}\")\"\r\n\u001b[?2004l\r"]
[44.663314, "o", "\u001b[?2004h"]
[44.663353, "o", "> "]
[44.66353, "o", "  local basename=\"${filename%.*}\"\r\n\u001b[?2004l\r"]
[44.663573, "o", "\u001b[?2004h> "]
[44.663764, "o", "  local ext=\"${filename##*.}\"\r\n\u001b[?2004l\r"]
[44.663807, "o", "\u001b[?2004h> "]
[44.663847, "o", "  \r\n\u001b[?2004l\r"]
[44.663898, "o", "\u001b[?2004h> "]
[44.664159, "o", "  # Determine compression based on extension\r\n\u001b[?2004l\r"]
[44.664206, "o", "\u001b[?2004h> "]
[44.66434, "o", "  local archive_ext=\"\"\r\n\u001b[?2004l\r"]
[44.664387, "o", "\u001b[?2004h> "]
[44.664519, "o", "  local tar_option=\"\"\r\n\u001b[?2004l\r"]
[44.664565, "o", "\u001b[?2004h> "]
[44.664777, "o", "  if [ \"$ext\" == \"conf\" ]; then\r\n\u001b[?2004l\r"]
[44.664827, "o", "\u001b[?2004h> "]
[44.664977, "o", "    archive_ext=\"tar.gz\"\r\n\u001b[?2004l\r"]
[44.665031, "o", "\u001b[?2004h> "]
[44.665136, "o", "    tar_option=\"z\"\r\n\u001b[?2004l\r"]
[44.665183, "o", "\u001b[?2004h> "]
[44.665389, "o", "  elif [ \"$ext\" == \"yml\" ]; then\r\n\u001b[?2004l\r"]
[44.665448, "o", "\u001b[?2004h"]
[44.665488, "o", "> "]
[44.665587, "o", "    archive_ext=\"tar.bz2\"\r\n\u001b[?2004l\r"]
[44.665653, "o", "\u001b[?2004h> "]
[44.665758, "o", "    tar_option=\"j\"\r\n\u001b[?2004l\r"]
[44.665804, "o", "\u001b[?2004h> "]
[44.665854, "o", "  else\r\n\u001b[?2004l\r"]
[44.665893, "o", "\u001b[?2004h"]
[44.66593, "o", "> "]
[44.666283, "o", "    echo \"ERROR: Unknown extension $ext for file $filepath\" >&2\r\n\u001b[?2004l\r"]
[44.666333, "o", "\u001b[?2004h> "]
[44.666414, "o", "    return 1\r\n\u001b[?2004l\r"]
[44.666452, "o", "\u001b[?2004h"]
[44.666491, "o", "> "]
[44.666539, "o", "  fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.66658, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[44.666628, "o", "> "]
[44.66698, "o", "  local archive_name=\"${basename}_${BACKUP_ID}.${archive_ext}\"\r\n\u001b[?2004l\r"]
[44.667032, "o", "\u001b[?2004h"]
[44.667083, "o", "> "]
[44.667338, "o", "  local archive_path=\"${BACKUP_DIR}/${archive_name}\"\r\n\u001b[?2004l\r"]
[44.66742, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[44.667475, "o", "> "]
[44.667728, "o", "  # Create archive, preserving relative path\r\n\u001b[?2004l\r"]
[44.667787, "o", "\u001b[?2004h> "]
[44.668192, "o", "  # -C /home/user/configs creates archive with path relative to configs\r\n\u001b[?2004l\r"]
[44.668249, "o", "\u001b[?2004h> "]
[44.668666, "o", "  # -h is for dereferencing symlinks (if any), not strictly needed here\r\n\u001b[?2004l\r"]
[44.668709, "o", "\u001b[?2004h"]
[44.668752, "o", "> "]
[44.669214, "o", "  tar -c${tar_option}h -f \"${archive_path}\" -C \"${BASE_CONFIG_PATH}\" \"${rel_path}\" \r\n\u001b[?2004l\r"]
[44.669277, "o", "\u001b[?2004h>   \r\n\u001b[?2004l\r"]
[44.669336, "o", "\u001b[?2004h> "]
[44.669564, "o", "echo \"Created archive: ${archive_path}\"\r\n\u001b[?2004l\r"]
[44.669617, "o", "\u001b[?2004h"]
[44.669666, "o", "> }\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.669707, "o", "> \r\n\u001b[?2004l\r"]
[44.66975, "o", "\u001b[?2004h> "]
[44.669924, "o", "# Function to log file details\r\n\u001b[?2004l\r"]
[44.669975, "o", "\u001b[?2004h> "]
[44.6701, "o", "log_file_details() {\r\n\u001b[?2004l\r"]
[44.670142, "o", "\u001b[?2004h> "]
[44.670278, "o", "  local filepath=\"$1\"\r\n\u001b[?2004l\r"]
[44.670326, "o", "\u001b[?2004h> "]
[44.670619, "o", "  local rel_path=\"${filepath#$BASE_CONFIG_PATH/}\"\r\n\u001b[?2004l\r"]
[44.670678, "o", "\u001b[?2004h> "]
[44.670962, "o", "  local filename=\"$(basename \"${filepath#*/}\")\"\r\n\u001b[?2004l\r"]
[44.671008, "o", "\u001b[?2004h> "]
[44.671215, "o", "  local basename=\"${filename%.*}\"\r\n\u001b[?2004l\r"]
[44.671263, "o", "\u001b[?2004h> "]
[44.671436, "o", "  local ext=\"${filename##*.}\"\r\n\u001b[?2004l\r"]
[44.671477, "o", "\u001b[?2004h> "]
[44.671518, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.671559, "o", "> "]
[44.671841, "o", "  local archive_name=\"${basename}_${BACKUP_ID}\"\r\n\u001b[?2004l\r"]
[44.671896, "o", "\u001b[?2004h> "]
[44.672079, "o", "  if [ \"$ext\" == \"conf\" ]; then\r\n\u001b[?2004l\r"]
[44.672122, "o", "\u001b[?2004h> "]
[44.672295, "o", "    archive_name+=\".tar.gz\"\r\n\u001b[?2004l\r"]
[44.672339, "o", "\u001b[?2004h> "]
[44.672536, "o", "  elif [ \"$ext\" == \"yml\" ]; then\r\n\u001b[?2004l\r"]
[44.672579, "o", "\u001b[?2004h> "]
[44.672768, "o", "    archive_name+=\".tar.bz2\"\r\n\u001b[?2004l\r"]
[44.672834, "o", "\u001b[?2004h>   fi"]
[44.672879, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.672925, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[44.672965, "o", "> "]
[44.673312, "o", "  local sha256=\"$(sha256sum \"$filepath\" | awk '{print $1}')\"\r\n\u001b[?2004l\r"]
[44.67336, "o", "\u001b[?2004h> "]
[44.673671, "o", "  local size=\"$(wc -c < \"$filepath\" | tr -d ' \\n')\"\r\n\u001b[?2004l\r"]
[44.673721, "o", "\u001b[?2004h> "]
[44.673763, "o", "  \r\n\u001b[?2004l\r\u001b[?2004h"]
[44.673801, "o", "> "]
[44.674114, "o", "  echo \"${rel_path}|${archive_name}|${sha256}|${size}\"\r\n\u001b[?2004l\r"]
[44.674157, "o", "\u001b[?2004h> "]
[44.674197, "o", "}\r\n\u001b[?2004l\r\u001b[?2004h"]
[44.674238, "o", "> \r\n\u001b[?2004l\r"]
[44.67428, "o", "\u001b[?2004h> "]
[44.674534, "o", "# Find valid files and process in parallel\r\n\u001b[?2004l\r"]
[44.674577, "o", "\u001b[?2004h> "]
[44.675267, "o", "find \"$BASE_CONFIG_PATH\" -type f \\( -name \"*.conf\" -o -name \"*.yml\" \\) -not -name \"test.conf\" -size -512c -print0 | \\\r\n\u001b[?2004l\r"]
[44.675321, "o", "\u001b[?2004h> "]
[44.675541, "o", "while IFS= read -r -d '' filepath; do\r\n\u001b[?2004l\r"]
[44.675578, "o", "\u001b[?2004h"]
[44.675609, "o", ">   \r\n"]
[44.675658, "o", "\u001b[?2004l\r\u001b[?2004h"]
[44.675689, "o", "> "]
[44.675866, "o", "  # Create archive in background\r\n\u001b[?2004l\r"]
[44.6759, "o", "\u001b[?2004h"]
[44.675934, "o", "> "]
[44.676161, "o", "  create_individual_archive \"$filepath\" &\r\n\u001b[?2004l\r"]
[44.676195, "o", "\u001b[?2004h"]
[44.676227, "o", ">   \r\n"]
[44.67626, "o", "\u001b[?2004l\r\u001b[?2004h"]
[44.676303, "o", "> "]
[44.676381, "o", "  # Log details\r\n\u001b[?2004l\r"]
[44.676415, "o", "\u001b[?2004h"]
[44.676446, "o", "> "]
[44.676614, "o", "  log_file_details \"$filepath\"\r\n\u001b[?2004l\r"]
[44.67667, "o", "\u001b[?2004h> "]
[44.676961, "o", "done > \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\"\r\n\u001b[?2004l\r"]
[44.676994, "o", "\u001b[?2004h"]
[44.677026, "o", "> \r\n\u001b[?2004l\r"]
[44.677056, "o", "\u001b[?2004h> "]
[44.677307, "o", "# Wait for all background jobs to finish\r\n\u001b[?2004l\r"]
[44.677342, "o", "\u001b[?2004h"]
[44.677373, "o", "> "]
[44.677407, "o", "wait\r\n\u001b[?2004l\r"]
[44.677438, "o", "\u001b[?2004h> "]
[44.677468, "o", "\r\n\u001b[?2004l\r"]
[44.677499, "o", "\u001b[?2004h> "]
[44.677752, "o", "# Create log file header and sort content\r\n\u001b[?2004l\r"]
[44.677789, "o", "\u001b[?2004h"]
[44.67782, "o", "> "]
[44.678358, "o", "# Ensure temporary log file has unique lines first (if any duplicates from different basenames)\r\n\u001b[?2004l\r"]
[44.678392, "o", "\u001b[?2004h"]
[44.678423, "o", "> "]
[44.678806, "o", "sort -u -k1,1 -t'|' \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\" | \\\r\n\u001b[?2004l\r"]
[44.678836, "o", "\u001b[?2004h"]
[44.678867, "o", "> "]
[44.679142, "o", "sort -k3,3 > \"${LOG_DIR}/backup_${BACKUP_ID}.log\"\r\n\u001b[?2004l\r"]
[44.679182, "o", "\u001b[?2004h"]
[44.679213, "o", "> \r\n\u001b[?2004l\r"]
[44.679244, "o", "\u001b[?2004h> "]
[44.679424, "o", "# Add header to the log file\r\n\u001b[?2004l\r"]
[44.679461, "o", "\u001b[?2004h"]
[44.679492, "o", "> "]
[44.679964, "o", "sed -i '1i\\REL_PATH|ARCHIVE_NAME|SHA256|SIZE' \"${LOG_DIR}/backup_${BACKUP_ID}.log\"\r\n\u001b[?2004l\r"]
[44.679994, "o", "\u001b[?2004h"]
[44.680025, "o", "> \r\n\u001b[?2004l\r"]
[44.680057, "o", "\u001b[?2004h> "]
[44.680221, "o", "# Clean up temporary file\r\n\u001b[?2004l\r"]
[44.680254, "o", "\u001b[?2004h"]
[44.680285, "o", "> "]
[44.680537, "o", "rm \"${LOG_DIR}/file_details_${BACKUP_ID}.tmp\"\r\n\u001b[?2004l\r"]
[44.680574, "o", "\u001b[?2004h"]
[44.680606, "o", "> \r\n\u001b[?2004l\r"]
[44.680647, "o", "\u001b[?2004h> "]
[44.680788, "o", "# Create full archive\r\n\u001b[?2004l\r"]
[44.680818, "o", "\u001b[?2004h"]
[44.680849, "o", "> "]
[44.681141, "o", "full_archive_name=\"configs_full_${BACKUP_ID}.tar.xz\"\r\n\u001b[?2004l\r"]
[44.681174, "o", "\u001b[?2004h"]
[44.681204, "o", "> "]
[44.68151, "o", "full_archive_path=\"${BACKUP_DIR}/${full_archive_name}\"\r\n\u001b[?2004l\r"]
[44.681544, "o", "\u001b[?2004h"]
[44.681575, "o", "> "]
[44.682162, "o", "tar -cJ -f \"${full_archive_path}\" -C \"$(dirname \"$BASE_CONFIG_PATH\")\" \"$(basename \"$BASE_CONFIG_PATH\")\"\r\n\u001b[?2004l\r"]
[44.682192, "o", "\u001b[?2004h"]
[44.682223, "o", "> \r\n\u001b[?2004l\r"]
[44.682261, "o", "\u001b[?2004h> "]
[44.682564, "o", "echo \"Created full archive: ${full_archive_path}\"\r\n\u001b[?2004l\r"]
[44.682601, "o", "\u001b[?2004h"]
[44.68264, "o", "> "]
[44.68309, "o", "echo \"Backup process complete. Log file: ${LOG_DIR}/backup_${BACKUP_ID}.log\"\r\n\u001b[?2004l\r"]
[44.683123, "o", "\u001b[?2004h> "]
[44.683154, "o", "\r\n\u001b[?2004l\r"]
[44.683185, "o", "\u001b[?2004h> "]
[44.683237, "o", "exit 0\r\n\u001b[?2004l\r"]
[44.683271, "o", "\u001b[?2004h"]
[44.683302, "o", "> "]
[44.683333, "o", "EOF\r\n\u001b[?2004l\r"]
[44.685075, "o", "\u001b[?2004h"]
[44.68511, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[44.834244, "i", "chmod +x /home/user/backup_configurations.sh\n"]
[44.834444, "o", "chmod +x /home/user/backup_configurations.sh\r\n\u001b[?2004l\r"]
[44.836612, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[58.304769, "i", "/home/user/backup_configurations.sh\n"]
[58.305058, "o", "/home/user/backup_configurations.sh\r\n\u001b[?2004l\r"]
[58.369581, "o", "Created full archive: /home/user/backups/configs_full_v1.2-2023.tar.xz\r\nBackup process complete. Log file: /home/user/backup_logs/backup_v1.2-2023.log\r\n"]
[58.369854, "o", "\u001b[?2004h"]
[58.369903, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[60.212915, "i", "ls -la /home/user/backups/\n"]
[60.213071, "o", "ls -la /home/user/backups/\r\n\u001b[?2004l\r"]
[60.215271, "o", "total 32\r\n"]
[60.215326, "o", "drwxr-xr-x 2 root root 4096 Feb 13 18:57  .\r\ndrwxr-xr-x 1 root root  167 Feb 13 18:57  ..\r\n-rw-r--r-- 1 root root  170 Feb 13 18:57  another_v1.2-2023.tar.gz\r\n-rw-r--r-- 1 root root  163 Feb 13 18:57  app_v1.2-2023.tar.gz\r\n-rw-r--r-- 1 root root  660 Feb 13 18:57  configs_full_v1.2-2023.tar.xz\r\n-rw-r--r-- 1 root root  116 Feb 13 18:57  db_v1.2-2023.tar.bz2\r\n"]
[60.215377, "o", "-rw-r--r-- 1 root root  171 Feb 13 18:57  duplicate_name_v1.2-2023.tar.gz\r\n-rw-r--r-- 1 root root  174 Feb 13 18:57 'my config_v1.2-2023.tar.bz2'\r\n-rw-r--r-- 1 root root  120 Feb 13 18:57  nginx_v1.2-2023.tar.gz\r\n"]
[60.215655, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[60.820014, "i", "wc -l /home/user/backup_logs/backup_v1.2-2023.log\n"]
[60.820189, "o", "wc -l /home/user/backup_logs/backup_v1.2-2023.log\r\n\u001b[?2004l\r"]
[60.821595, "o", "13 /home/user/backup_logs/backup_v1.2-2023.log\r\n"]
[60.821814, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[61.291721, "i", "head -5 /home/user/backup_logs/backup_v1.2-2023.log\n"]
[61.29194, "o", "head -5 /home/user/backup_logs/backup_v1.2-2023.log\r\n\u001b[?2004l\r"]
[61.293455, "o", "REL_PATH|ARCHIVE_NAME|SHA256|SIZE\r\nanother.conf|another_v1.2-2023.tar.gz|e40725be3a1e6a49e81a829989efc10c93f02c8a77a61cead4f1decddc14a398|46\r\napp.conf|app_v1.2-2023.tar.gz|a6a7baf1c18fae82e572baf2b74bd82da47a274a51af97bea17194e2f2bb6d53|53\r\ndb.yml|db_v1.2-2023.tar.bz2|e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855|0\r\nduplicate_name.conf|duplicate_name_v1.2-2023.tar.gz|a6a7baf1c18fae82e572baf2b74bd82da47a274a51af97bea17194e2f2bb6d53|53\r\n"]
[61.293721, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[80.839951, "i", "tar -tzf /home/user/backups/app_v1.2-2023.tar.gz\n"]
[80.84026, "o", "tar -tzf /home/user/backups/app_v1.2-2023.tar.gz\r\n\u001b[?2004l\r"]
[80.843357, "o", "app.conf\r\n"]
[80.843759, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[81.253218, "i", "file /home/user/backups/app_v1.2-2023.tar.gz\n"]
[81.25357, "o", "file /home/user/backups/app_v1.2-2023.tar.gz\r\n\u001b[?2004l\r"]
[81.254054, "o", "bash: file: command not found\r\n"]
[81.254412, "o", "\u001b[?2004h"]
[81.254457, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[81.760026, "i", "tar -tzf /home/user/backups/'my config_v1.2-2023.tar.bz2'\n"]
[81.760361, "o", "tar -tzf /home/user/backups/'my config_v1.2-2023.tar.bz2'\r\n\u001b[?2004l\r"]
[81.763096, "o", "\r\ngzip: stdin: not in gzip format\r\n"]
[81.763276, "o", "tar: Child returned status 1\r\ntar: Error is not recoverable: exiting now\r\n"]
[81.763743, "o", "\u001b[?2004h"]
[81.763775, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[82.322349, "i", "file /home/user/backups/'my config_v1.2-2023.tar.bz2'\n"]
[82.322865, "o", "file /home/user/backups/'my config_v1.2-2023.tar.bz2'\r\n\u001b[?2004l\r"]
[82.323329, "o", "bash: file: command not found\r\n"]
[82.323586, "o", "\u001b[?2004h"]
[82.323663, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[82.834017, "i", "tar -tJf /home/user/backups/configs_full_v1.2-2023.tar.xz | head -10\n"]
[82.834529, "o", "tar -tJf /home/user/backups/configs_full_v1.2-2023.tar.xz | head -10\r\n\u001b[?2004l\r"]
[82.83898, "o", "configs/\r\nconfigs/legacy/\r\nconfigs/legacy/big_blob.conf\r\nconfigs/nginx/\r\nconfigs/nginx/nginx.conf\r\nconfigs/nginx/old.conf.bak\r\n"]
[82.839022, "o", "configs/subdir/\r\nconfigs/subdir/my config.yml\r\nconfigs/app.conf\r\n"]
[82.83913, "o", "configs/another.conf\r\n"]
[82.839212, "o", "tar: stdout: write error\r\n"]
[82.839711, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[83.279775, "i", "file /home/user/backups/configs_full_v1.2-2023.tar.xz\n"]
[83.280096, "o", "file /home/user/backups/configs_full_v1.2-2023.tar.xz\r\n\u001b[?2004l\r"]
[83.280504, "o", "bash: file: command not found\r\n"]
[83.280749, "o", "\u001b[?2004h"]
[83.280794, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[83.785478, "i", "sort -t'|' -k3 -c /home/user/backup_logs/backup_v1.2-2023.log\n"]
[83.785887, "o", "sort -t'|' -k3 -c /home/user/backup_logs/backup_v1.2-2023.log\r\n\u001b[?2004l\r"]
[83.787273, "o", "sort: /home/user/backup_logs/backup_v1.2-2023.log:3: disorder: app.conf|app_v1.2-2023.tar.gz|a6a7baf1c18fae82e572baf2b74bd82da47a274a51af97bea17194e2f2bb6d53|53\r\n"]
[83.787635, "o", "\u001b[?2004h"]
[83.787683, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[84.353508, "i", "awk -F'|' 'length($1) && length($2) && length($3) && length($4) {print NF}' /home/user/backup_logs/backup_v1.2-2023.log\n"]
[84.354375, "o", "awk -F'|' 'length($1) && length($2) && length($3) && length($4) {print NF}' /home/user/backup_logs/backup_v1.2-2023.log\r\n\u001b[?2004l\r"]
[84.356103, "o", "4\r\n4\r\n4\r\n4\r\n4\r\n4\r\n4\r\n"]
[84.356495, "o", "\u001b[?2004h"]
[84.356544, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[103.445926, "i", "/home/user/backup_configurations.sh\n"]
[103.446219, "o", "/home/user/backup_configurations.sh\r\n\u001b[?2004l\r"]
[103.562438, "o", "Created full archive: /home/user/backups/configs_full_v1.2-2023.tar.xz\r\nBackup process complete. Log file: /home/user/backup_logs/backup_v1.2-2023.log\r\n"]
[103.562709, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[105.362869, "i", "tar -tzf /home/user/backups/app_v1.2-2023.tar.gz\n"]
[105.36304, "o", "tar -tzf /home/user/backups/app_v1.2-2023.tar.gz\r\n\u001b[?2004l\r"]
[105.365152, "o", "app.conf\r\n"]
[105.365387, "o", "\u001b[?2004h"]
[105.365416, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[105.918595, "i", "tar -tf /home/user/backups/'my config_v1.2-2023.tar.bz2'\n"]
[105.918968, "o", "tar -tf /home/user/backups/'my config_v1.2-2023.tar.bz2'\r\n\u001b[?2004l\r"]
[105.922146, "o", "subdir/my config.yml\r\n"]
[105.922518, "o", "\u001b[?2004h"]
[105.922565, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[106.451037, "i", "tar -tJf /home/user/backups/configs_full_v1.2-2023.tar.xz | head -5\n"]
[106.451261, "o", "tar -tJf /home/user/backups/configs_full_v1.2-2023.tar.xz | head -5\r\n\u001b[?2004l\r"]
[106.453617, "o", "configs/\r\nconfigs/legacy/\r\nconfigs/legacy/big_blob.conf\r\nconfigs/nginx/\r\nconfigs/nginx/nginx.conf\r\n"]
[106.453763, "o", "tar: stdout: write error\r\n"]
[106.453969, "o", "\u001b[?2004h"]
[106.453989, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[106.937336, "i", "head -1 /home/user/backup_logs/backup_v1.2-2023.log\n"]
[106.937502, "o", "head -1 /home/user/backup_logs/backup_v1.2-2023.log\r\n\u001b[?2004l\r"]
[106.938343, "o", "REL_PATH|ARCHIVE_NAME|SHA256|SIZE\r\n"]
[106.938485, "o", "\u001b[?2004hroot@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
[107.117836, "i", "awk -F'|' 'NR>1 && NF==4 {print $1\":\"$2\":\"$3\":\"$4}' /home/user/backup_logs/backup_v1.2-2023.log | head -3\n"]
[107.118479, "o", "awk -F'|' 'NR>1 && NF==4 {print $1\":\"$2\":\"$3\":\"$4}' /home/user/backup_logs/backup_v1.2-2023.log | head -3\r\n\u001b[?2004l\r"]
[107.119876, "o", "another.conf:another_v1.2-2023.tar.gz:e40725be3a1e6a49e81a829989efc10c93f02c8a77a61cead4f1decddc14a398:46\r\napp.conf:app_v1.2-2023.tar.gz:a6a7baf1c18fae82e572baf2b74bd82da47a274a51af97bea17194e2f2bb6d53:53\r\ndb.yml:db_v1.2-2023.tar.bz2:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:0\r\n"]
[107.120158, "o", "\u001b[?2004h"]
[107.120175, "o", "root@984af9b5-0321-4e94-8ca7-9cd47d38a120:~# "]
