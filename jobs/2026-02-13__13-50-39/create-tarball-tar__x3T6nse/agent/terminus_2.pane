[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# clear
[?2004l[H[J[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# DEST=${BACKUP_DEST:-/home/user/archives} && LOG=${LOG_FILE:-/home/user/backup_logs/backup.log}
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Destination: $DEST, Log file: $LOG"
[?2004lDestination: /home/user/secure_backups, Log file: /home/user/audit/backup_audit.log
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# mkdir -p "$DEST" && mkdir -p "$(dirname "$LOG")"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Created destination and log directories."
[?2004lCreated destination and log directories.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# TIMESTAMP_ARCHIVE=$(date +%Y%m%d) && TIMESTAMP_LOG=$(date '+%Y-%m-%d %H:%M:%S')
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# ARCHIVE_FILE="daily_$TIMESTAMP_ARCHIVE.tar.gz" && CHECKSUM_FILE="daily_$TIMESTAMP_ARCHIVE.sha256"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Archive: $ARCHIVE_FILE, Checksum: $CHECKSUM_FILE, Log timestamp: $TIMESTAMP_LOG"
[?2004lArchive: daily_20260213.tar.gz, Checksum: daily_20260213.sha256, Log timestamp: 2026-02-13 18:58:40
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# if [ -f "$DEST/$ARCHIVE_FILE" ]; then
[?2004l[?2004h>   UNIX_TIMESTAMP=$(date +%s)
[?2004l[?2004h>   mv "$DEST/$ARCHIVE_FILE" "$DEST/${ARCHIVE_FILE}.bak-$UNIX_TIMESTAMP"
[?2004l[?2004h>   echo "Rotated existing archive: $ARCHIVE_FILE â†’ ${ARCHIVE_FILE}.bak-$UNIX_TIMESTAMP"
[?2004l[?2004h> fi
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# tar -czf "$DEST/$ARCHIVE_FILE" --exclude='*.tmp' --exclude='broken_symlinks' -C /home/user/data .
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Created archive: $ARCHIVE_FILE"
[?2004lCreated archive: daily_20260213.tar.gz
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# tar -f "$DEST/$ARCHIVE_FILE" --owner=0 --group=0 --mode='g=o-rwx' --no-same-owner --paxlibname=generic --xattrs=0 --rsh="sh -c 'chmod o-rwx \"\$1\"' -- \$1" --files-from /dev/null
[?2004ltar: unrecognized option '--paxlibname=generic'
Try 'tar --help' or 'tar --usage' for more information.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# sha256sum "$DEST/$ARCHIVE_FILE" > "$DEST/$CHECKSUM_FILE"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# awk '{print "SHA256 (" $2 ") = " $1}' "$DEST/$CHECKSUM_FILE" > "${DEST}/${CHECKSUM_FILE}.tmp" && mv "${DEST}/${CHECKSUM_FILE}.tmp" "$DEST/$CHECKSUM_FILE"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Created checksum: $CHECKSUM_FILE"
[?2004lCreated checksum: daily_20260213.sha256
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# if [ ! -f "$LOG" ]; then
[?2004l[?2004h>   echo "TIMESTAMP | ARCHIVE | STATUS" > "$LOG"
[?2004l[?2004h>   echo "Log header created."
[?2004l[?2004h> fi
[?2004lLog header created.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "$TIMESTAMP_LOG - $ARCHIVE_FILE - OK" >> "$LOG"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Log entry appended. Backup complete."
[?2004lLog entry appended. Backup complete.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# TMP_DIR="/tmp/backup_fix" && mkdir -p "$TMP_DIR"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Extracting archive to $TMP_DIR for permission fix..."
[?2004lExtracting archive to /tmp/backup_fix for permission fix...
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# tar -xzf "$DEST/$ARCHIVE_FILE" -C "$TMP_DIR"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Applied permissions recursively..."
[?2004lApplied permissions recursively...
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# chown -R root:root "$TMP_DIR" && chmod -R o-rwx "$TMP_DIR"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Recreating archive with corrected permissions..."
[?2004lRecreating archive with corrected permissions...
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# tar -czf "$DEST/$ARCHIVE_FILE" -C "$TMP_DIR" .
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# rm -rf "$TMP_DIR"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Permissions corrected. Recreating checksum..."
[?2004lPermissions corrected. Recreating checksum...
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# sha256sum "$DEST/$ARCHIVE_FILE" > "$DEST/$CHECKSUM_FILE"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# awk '{print "SHA256 (" $2 ") = " $1}' "$DEST/$CHECKSUM_FILE" > "${DEST}/${CHECKSUM_FILE}.tmp" && mv "${DEST}/${CHECKSUM_FILE}.tmp" "$DEST/$CHECKSUM_FILE"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Checksum updated."
[?2004lChecksum updated.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# CORRECTED_TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "$CORRECTED_TIMESTAMP - $ARCHIVE_FILE - OK (permissions corrected)" >> "$LOG"
[?2004l[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# echo "Log updated. All tasks complete."
[?2004lLog updated. All tasks complete.
[?2004hroot@b1a5b1bc-02c8-4477-9fc3-ddfebb3eb6de:~# 