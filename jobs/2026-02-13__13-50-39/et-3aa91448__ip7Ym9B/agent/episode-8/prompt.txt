New Terminal Output:

user@20d4b0d1-d68a-4eb4-b56b-12e8a6151092:~/data$ cat > generate_firewall.py << 'EOF'
> #!/usr/bin/env python3
> import re
>
> # Read original iptables configuration
> with open('current_iptables.save', 'r') as f:
>     original_rules = f.readlines()
>
> # Find position after loopback ACCEPT rule
> loopback_pos = -1
> for i, line in enumerate(original_rules):
>     if '-A INPUT -i lo -j ACCEPT' in line.strip():
>         loopback_pos = i + 1  # Insert after this line
>         break
>
> if loopback_pos == -1:
>     print("ERROR: Loopback rule not found")
>     exit(1)
>
> # Read report data to get sorted IPs
> report_data = []
> with open('/home/user/evidence/report.csv', 'r') as f:
>     next(f)  # Skip header
>     for line in f:
>         if line.strip():
>             parts = line.strip().split(',')
>             report_data.append(parts[0])  # Source_IP is first column
>
> # Create new DROP rules in the same order as report (highest risk first)
> drop_rules = []
> for ip in report_data:
>     drop_rules.append(f"-A INPUT -s {ip} -j DROP\n")
>
> # Insert new rules at the correct position
> new_rules = original_rules[:loopback_pos] + drop_rules + original_rules[loopback_pos:]
>
> # Write the hardened rules file
> with open('/home/user/firewall/hardened_rules.v4', 'w', encoding='utf-8') as f:
>     f.writelines(new_rules)
>
> print("Firewall rules generated at /home/user/firewall/hardened_rules.v4")
> print("Preview of new rules:")
> for rule in drop_rules:
>     print(rule.strip())
>
> EOF
user@20d4b0d1-d68a-4eb4-b56b-12e8a6151092:~/data$ python3 generate_firewall.py
Firewall rules generated at /home/user/firewall/hardened_rules.v4
Preview of new rules:
-A INPUT -s 192.168.1.100 -j DROP
-A INPUT -s 172.16.0.8 -j DROP
user@20d4b0d1-d68a-4eb4-b56b-12e8a6151092:~/data$ head -n 20 /home/user/firewall/hardened_rules.v4
# Generated by iptables-save v1.8.7 on Sun Jan  1 12:00:00 2024
*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -s 192.168.1.100 -j DROP
-A INPUT -s 172.16.0.8 -j DROP
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 80 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 443 -j ACCEPT
-A INPUT -j LOG --log-prefix "IPTABLES: "
-A INPUT -j DROP
COMMIT
# Completed on Sun Jan  1 12:00:00 2024
user@20d4b0d1-d68a-4eb4-b56b-12e8a6151092:~/data$
