New Terminal Output:

> cat > /home/user/db_queries/process_batch.py << 'EOF'
> #!/usr/bin/env python3
>
> import os
> import hashlib
> import sqlparse
> import json
>
> def process_queries():
>     batch_id = os.environ.get('DB_BATCH_ID', '42')
>
>     input_file = f"/home/user/db_queries/raw_batch_{batch_id}.sql"
>     backup_file = f"/home/user/db_queries/raw_batch_{batch_id}_backup.sql"
>     read_output = f"/home/user/db_queries/batch_{batch_id}_optimized_read.sql"
>     write_output = f"/home/user/db_queries/batch_{batch_id}_optimized_write.sql"
>     manifest_file = f"/home/user/db_queries/batch_{batch_id}_manifest.json"
>     log_file = f"/home/user/db_queries/batch_{batch_id}_pipeline.log"
>
>     with open(input_file, 'r') as f:
>         raw_sql = f.read()
>
>     with open(backup_file, 'w') as f:
>         f.write(raw_sql)
>
>     queries = sqlparse.split(raw_sql)
>     total_queries = len(queries)
>     read_queries = []
>     write_queries = []
>
>     for query in queries:
>         if not query.strip():
>             continue
>
>         original_query = query.strip()
>         md5_hash = hashlib.md5(original_query.encode()).hexdigest()
>
>         parsed = sqlparse.parse(original_query)[0]
>         formatted = sqlparse.format(parsed, keyword_case='upper')
>
>         optimized = formatted.replace('\n', ' ').strip() + f' -- id={md5_hash}'
>
>         first_token = str(parsed.tokens[0]).upper()
>         if first_token.startswith('SELECT'):
>             read_queries.append(f"{optimized};\n")
>         else:
>             write_queries.append(f"{optimized};\n")
>
>     with open(read_output, 'w') as f:
>         f.writelines(read_queries)
>
>     with open(write_output, 'w') as f:
>         f.writelines(write_queries)
>
>     manifest = {
>         "batch_id": batch_id,
>         "read_count": len(read_queries),
>         "write_count": len(write_queries)
>     }
>     with open(manifest_file, 'w') as f:
>         json.dump(manifest, f, indent=2)
>
>     with open(log_file, 'w') as f:
>         f.write("PIPELINE START\n")
>         f.write(f"Batch ID: {batch_id}\n")
>         f.write(f"Input: raw_batch_{batch_id}.sql\n")
>         f.write(f"Processed: {total_queries}\n")
>         f.write("PIPELINE END\n")
>
> if __name__ == "__main__":
>     process_queries()
> EOF
> chmod +x /home/user/db_queries/process_batch.py
> /home/user/.venvs/opt_queries/bin/python /home/user/db_queries/process_batch.py
>
