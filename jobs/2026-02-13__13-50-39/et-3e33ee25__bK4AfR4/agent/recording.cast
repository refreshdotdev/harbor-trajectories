{"version": 2, "width": 160, "height": 40, "timestamp": 1771009002, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005178, "o", "\u001b[?2004hroot@76343478-bab0-4967-8cd8-dc349a5172f7:~# "]
[0.979478, "i", "clear\r"]
[0.979579, "o", "clear\r\n\u001b[?2004l\r"]
[0.980607, "o", "\u001b[H\u001b[J"]
[0.980749, "o", "\u001b[?2004h"]
[0.980772, "o", "root@76343478-bab0-4967-8cd8-dc349a5172f7:~# "]
[90.72812, "i", "mkdir -p /home/user/reports\n"]
[90.728244, "o", "mkdir -p /home/user/reports\r\n\u001b[?2004l\r"]
[90.7294, "o", "\u001b[?2004hroot@76343478-bab0-4967-8cd8-dc349a5172f7:~# "]
[90.887571, "i", "cat > /home/user/reports/run_security_scan.sh << 'EOF'\n#!/bin/bash\n\n# Enterprise Security Baseline Automation (SOP-992) - Ticket SEC-4022\n# Automate daily infrastructure snapshot report generation\n\nset -eo pipefail\n\n# Configuration\nUID_LIMIT=1000\nSCRIPT_DIR=\"/home/user/reports\"\nINPUT_DIR=\"/home/user/sample_data\"\nCONFIG_DIR=\"/home/user/config\"\nTMP_DIR=\"/tmp/$(basename \"$0\")-$$\"\n\ndebug() {\n    echo \"[DEBUG $(date '+%Y-%m-%d %H:%M:%S')] $*\" >> \"${SCRIPT_DIR}/scan_exec_time.log\"\n}\n\n# Cleanup temporary files on exit\ncleanup() {\n    rm -rf \"${TMP_DIR}\"\n}\n\n# Register cleanup function\ntrap cleanup EXIT INT TERM\n\n# Create temporary working directory\nmkdir -p \"${TMP_DIR}\"\n\n# 1. Capture start time (Unix epoch)\nSTART_EPOCH=$(date '+%s')\n\necho \"Script started at: $(date)\"  # Optional: for human-readable log\n\n# 2. Calculate input hash for integrity check\nINPUT_HASH=$(cat \"${INPUT_DIR}/mock_netstat.txt\" \"${INPUT_DIR}/mock_passwd\" | md5sum - | cut -d' ' -f1)\n\n# 3. Process service_names.csv - strip BOM and create lookup datab"]
[90.887683, "i", "ase\necho \"Processing service names...\"\niconv -f UTF-8 -t UTF-8 \"${INPUT_DIR}/service_names.csv\" | sed '1s/^\\xef\\xbb\\xbf//' > \"${TMP_DIR}/service_names_clean.csv\"\n\n# Create awk-friendly service name lookup database\nawk -F, '{print $1 \"\\\"\" $2 \"\\\"\"}' \"${TMP_DIR}/service_names_clean.csv\" > \"${TMP_DIR}/service_names.db\"\n\necho \"Service names processed successfully.\"\n\n# 4. Job 1: Network Exposure Analysis (parallel)\necho \"Starting network exposure analysis...\"\n\n# Define netstat processing function\nprocess_netstat() {\n    awk -v service_db=\"${TMP_DIR}/service_names.db\" -v OFS=',' -F\" \" 'BEGIN {\n        while (getline < service_db > 0) {\n            split($0, parts, /\\\"\\\"/);\n            service_map[parts[1]] = parts[2];\n        }\n    }\n    $NF ~ /LISTEN|udp$/ {\n        split($4, addr_port, \":\");\n        port = addr_port[length(addr_port)];\n        proto_key = ($5 \"/\" $6);\n        service_name = (proto_key in service_map) ? \",\" service_map[proto_key] : \"\";\n        \n        # Scope classification\n        if ($4 ~ /^0\\.0"]
[90.887699, "i", "\\.0\\.0/) {\n            proto = \"public-\" $6;\n        } else if ($4 ~ /^127\\.0\\.0\\.1/) {\n            proto = \"local-\" $6;\n        } else {\n            proto = $6;\n        }\n        \n        # Enrichment and output\n        gsub(/[()]/, \"\", $0);  # Clean parentheses from original process name\n        print port, proto, $NF \",\" $0 service_name;\n    }' \"${INPUT_DIR}/mock_netstat.txt\" | sort -n > \"${TMP_DIR}/open_ports.csv\"\n}\n\n# 5. Job 2: User Audit (parallel)\necho \"Starting user audit...\"\n\n# Define user audit function\nprocess_users() {\n    awk -v uid_limit=${UID_LIMIT} -v blacklist_file=\"${CONFIG_DIR}/user_blacklist.txt\" -v OFS=',' 'BEGIN {\n        while (getline < blacklist_file > 0) {\n            blacklist[$0] = 1;\n        }\n    }\n    $3 < uid_limit && $7 != \"/bin/false\" && !($1 in blacklist) {\n        print $1;\n    }' \"${INPUT_DIR}/mock_passwd\" | sort > \"${TMP_DIR}/insecure_users.csv\"\n}\n\n# Launch both jobs in parallel\nprocess_netstat &\nPID_NETSTAT=$!\nprocess_users &\nPID_USERS=$!\n\n# Wait for both jobs to complet"]
[90.887755, "i", "e\necho \"Waiting for background jobs to complete...\"\nwait ${PID_NETSTAT} ${PID_USERS}\n\necho \"Background jobs completed successfully.\"\n\n# 6. Generate Artifact A: Mainframe Report (infra_security_report.yml)\necho \"Generating mainframe security report...\"\n\n# Create YAML content with proper encoding\n{\n    echo \"---\"\n    echo \"meta:\"  \n    echo \"  input_hash: ${INPUT_HASH}\"\n    echo \"insecure_users:\"  \n    while IFS= read -r user; do\n        echo \"  - ${user}\"\n    done < \"${TMP_DIR}/insecure_users.csv\"\n    echo \"open_ports:\"  \n    while IFS=, read -r port protocol process rest; do\n        echo \"  - port: ${port}\"\n        echo \"    protocol: ${protocol}\"\n        echo \"    process: ${process}\"\n    done < \"${TMP_DIR}/open_ports.csv\"\n} | iconv -f UTF-8 -t ISO-8859-1 > \"${SCRIPT_DIR}/infra_security_report.yml\"\n\necho \"Mainframe security report generated successfully.\"\n\n# 7. Generate Artifact B: SIEM Log (scan_exec_time.log)\necho \"Generating SIEM log...\"\n\n# Calculate duration and create CSV with CRLF line endings\nEND_EPOC"]
[90.88778, "i", "H=$(date '+%s')\nDURATION=$((END_EPOCH - START_EPOCH))\n\n# Create CSV with CRLF line endings\n{\n    echo -n \"start_epoch,end_epoch,duration\\r\"\n    echo -n \"${START_EPOCH},${END_EPOCH},${DURATION}\\r\"\n} > \"${SCRIPT_DIR}/scan_exec_time.log\"\n\necho \"SIEM log generated successfully.\"\n\n# 8. Final status\nEND_EPOCH=$(date '+%s')\nDURATION=$((END_EPOCH - START_EPOCH))\necho \"Script execution completed in ${DURATION} seconds.\"\necho \"Final artifacts generated at: $(date '+%Y-%m-%d %H:%M:%S')\"\n\n# 9. Make script executable\nchmod +x \"${SCRIPT_DIR}/run_security_scan.sh\"\nEOF"]
[90.887789, "o", "cat > /home/user/reports/run_security_scan.sh << 'EOF'\r\n\u001b[?2004l\r"]
[90.887822, "o", "H=$(date '+%s')\r\nDURATION=$((END_EPOCH - START_EPOCH))\r\n"]
[90.887853, "o", "\u001b[?2004h> "]
[90.887916, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[90.888002, "o", "\u001b[?2004h> \r\n\u001b[?2004l\rV"]
[90.888041, "o", "\u001b[?2004h> "]
[90.888258, "o", "# Enterprise Security Baseline Automation (SOP-992) - Ticket SEC-4022\r\n\u001b[?2004l\r"]
[90.888302, "o", "\u001b[?2004h> "]
[90.888498, "o", "# Automate daily infrastructure snapshot report generation\r\n\u001b[?2004l\r"]
[90.888527, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.888554, "o", "> "]
[90.888614, "o", "set -eo pipefail\r\n\u001b[?2004l\r"]
[90.888637, "o", "\u001b[?2004h> "]
[90.888648, "o", "\r\n\u001b[?2004l\r"]
[90.888686, "o", "\u001b[?2004h> "]
[90.888747, "o", "# Configuration\r\n\u001b[?2004l\r"]
[90.888777, "o", "\u001b[?2004h> "]
[90.888849, "o", "UID_LIMIT=1000\r\n\u001b[?2004l\r"]
[90.888878, "o", "\u001b[?2004h> "]
[90.888999, "o", "SCRIPT_DIR=\"/home/user/reports\"\r\n\u001b[?2004l\r"]
[90.889033, "o", "\u001b[?2004h> "]
[90.889149, "o", "INPUT_DIR=\"/home/user/sample_data\"\r\n\u001b[?2004l\r"]
[90.889177, "o", "\u001b[?2004h> "]
[90.889302, "o", "CONFIG_DIR=\"/home/user/config\"\r\n\u001b[?2004l\r"]
[90.889352, "o", "\u001b[?2004h> "]
[90.889467, "o", "TMP_DIR=\"/tmp/$(basename \"$0\")-$$\"\r\n\u001b[?2004l\r"]
[90.889507, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.889575, "o", "\u001b[?2004h> "]
[90.889649, "o", "debug() {\r\n\u001b[?2004l\r\u001b[?2004h> "]
[90.889932, "o", "    echo \"[DEBUG $(date '+%Y-%m-%d %H:%M:%S')] $*\" >> \"${SCRIPT_DIR}/scan_exec_time.log\"\r\n\u001b[?2004l\r"]
[90.889973, "o", "\u001b[?2004h> }\r\n\u001b[?2004l\r\u001b[?2004h"]
[90.889989, "o", "> \r\n\u001b[?2004l\r"]
[90.890033, "o", "\u001b[?2004h> "]
[90.890152, "o", "# Cleanup temporary files on exit\r\n\u001b[?2004l\r"]
[90.890183, "o", "\u001b[?2004h> "]
[90.890224, "o", "cleanup() {\r\n\u001b[?2004l\r"]
[90.890246, "o", "\u001b[?2004h> "]
[90.89035, "o", "    rm -rf \"${TMP_DIR}\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[90.890386, "o", "> }\r\n\u001b[?2004l\r\u001b[?2004h"]
[90.89041, "o", "> \r\n\u001b[?2004l\r"]
[90.890431, "o", "\u001b[?2004h> "]
[90.890523, "o", "# Register cleanup function\r\n\u001b[?2004l\r"]
[90.890553, "o", "\u001b[?2004h> "]
[90.890625, "o", "trap cleanup EXIT INT TERM\r\n\u001b[?2004l\r"]
[90.890647, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.890671, "o", "\u001b[?2004h"]
[90.890689, "o", "> "]
[90.890792, "o", "# Create temporary working directory\r\n\u001b[?2004l\r"]
[90.890814, "o", "\u001b[?2004h"]
[90.890838, "o", "> "]
[90.890895, "o", "mkdir -p \"${TMP_DIR}\"\r\n\u001b[?2004l\r"]
[90.890945, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.890957, "o", "> "]
[90.89106, "o", "# 1. Capture start time (Unix epoch)\r\n\u001b[?2004l\r"]
[90.891095, "o", "\u001b[?2004h> "]
[90.891163, "o", "START_EPOCH=$(date '+%s')\r\n\u001b[?2004l\r"]
[90.891196, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.891228, "o", "\u001b[?2004h> "]
[90.89141, "o", "echo \"Script started at: $(date)\"  # Optional: for human-readable log\r\n\u001b[?2004l\r"]
[90.891462, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.891506, "o", "> "]
[90.891604, "o", "# 2. Calculate input hash for integrity check\r\n\u001b[?2004l\r"]
[90.891629, "o", "\u001b[?2004h> "]
[90.89195, "o", "INPUT_HASH=$(cat \"${INPUT_DIR}/mock_netstat.txt\" \"${INPUT_DIR}/mock_passwd\" | md5sum - | cut -d' ' -f1)\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.892003, "o", "> "]
[90.892177, "o", "# 3. Process service_names.csv - strip BOM and create lookup database\r\n\u001b[?2004l\r"]
[90.892207, "o", "\u001b[?2004h> "]
[90.892308, "o", "echo \"Processing service names...\"\r\n\u001b[?2004l\r"]
[90.892346, "o", "\u001b[?2004h> "]
[90.892648, "o", "iconv -f UTF-8 -t UTF-8 \"${INPUT_DIR}/service_names.csv\" | sed '1s/^\\xef\\xbb\\xbf//' > \"${TMP_DIR}/service_names_clean.csv\"\r\n\u001b[?2004l\r"]
[90.892685, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.892709, "o", "\u001b[?2004h> "]
[90.892839, "o", "# Create awk-friendly service name lookup database\r\n\u001b[?2004l\r"]
[90.892868, "o", "\u001b[?2004h> "]
[90.893143, "o", "awk -F, '{print $1 \"\\\"\" $2 \"\\\"\"}' \"${TMP_DIR}/service_names_clean.csv\" > \"${TMP_DIR}/service_names.db\"\r\n\u001b[?2004l\r"]
[90.893194, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.893219, "o", "> "]
[90.893322, "o", "echo \"Service names processed successfully.\"\r\n\u001b[?2004l\r"]
[90.893356, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.893394, "o", "\u001b[?2004h"]
[90.893418, "o", "> "]
[90.893519, "o", "# 4. Job 1: Network Exposure Analysis (parallel)\r\n\u001b[?2004l\r"]
[90.89355, "o", "\u001b[?2004h> "]
[90.89366, "o", "echo \"Starting network exposure analysis...\"\r\n\u001b[?2004l\r"]
[90.893689, "o", "\u001b[?2004h"]
[90.893711, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[90.89381, "o", "# Define netstat processing function\r\n\u001b[?2004l\r"]
[90.893834, "o", "\u001b[?2004h"]
[90.893855, "o", "> "]
[90.893896, "o", "process_netstat() {\r\n\u001b[?2004l\r"]
[90.893917, "o", "\u001b[?2004h"]
[90.894002, "o", "> "]
[90.894202, "o", "    awk -v service_db=\"${TMP_DIR}/service_names.db\" -v OFS=',' -F\" \" 'BEGIN {\r\n\u001b[?2004l\r"]
[90.89423, "o", "\u001b[?2004h> "]
[90.894346, "o", "        while (getline < service_db > 0) {\r\n\u001b[?2004l\r"]
[90.894381, "o", "\u001b[?2004h> "]
[90.894484, "o", "            split($0, parts, /\\\"\\\"/);\r\n\u001b[?2004l\r"]
[90.894529, "o", "\u001b[?2004h> "]
[90.894632, "o", "            service_map[parts[1]] = parts[2];\r\n\u001b[?2004l\r"]
[90.894654, "o", "\u001b[?2004h> "]
[90.894691, "o", "        }\r\n\u001b[?2004l\r"]
[90.894726, "o", "\u001b[?2004h>     }\r\n"]
[90.894746, "o", "\u001b[?2004l\r\u001b[?2004h"]
[90.894754, "o", "> "]
[90.89483, "o", "    $NF ~ /LISTEN|udp$/ {\r\n\u001b[?2004l\r"]
[90.894848, "o", "\u001b[?2004h> "]
[90.894956, "o", "        split($4, addr_port, \":\");\r\n\u001b[?2004l\r"]
[90.894975, "o", "\u001b[?2004h> "]
[90.895101, "o", "        port = addr_port[length(addr_port)];\r\n\u001b[?2004l\r"]
[90.895121, "o", "\u001b[?2004h> "]
[90.895223, "o", "        proto_key = ($5 \"/\" $6);\r\n\u001b[?2004l\r"]
[90.895261, "o", "\u001b[?2004h> "]
[90.895473, "o", "        service_name = (proto_key in service_map) ? \",\" service_map[proto_key] : \"\";\r\n\u001b[?2004l\r"]
[90.895511, "o", "\u001b[?2004h> "]
[90.895534, "o", "        \r\n\u001b[?2004l\r"]
[90.89558, "o", "\u001b[?2004h> "]
[90.895653, "o", "        # Scope classification\r\n\u001b[?2004l\r"]
[90.895677, "o", "\u001b[?2004h"]
[90.895703, "o", "> "]
[90.895782, "o", "        if ($4 ~ /^0\\.0\\.0\\.0/) {\r\n\u001b[?2004l\r"]
[90.895816, "o", "\u001b[?2004h> "]
[90.895916, "o", "            proto = \"public-\" $6;\r\n\u001b[?2004l\r"]
[90.89594, "o", "\u001b[?2004h> "]
[90.896059, "o", "        } else if ($4 ~ /^127\\.0\\.0\\.1/) {\r\n\u001b[?2004l\r"]
[90.896097, "o", "\u001b[?2004h> "]
[90.896178, "o", "            proto = \"local-\" $6;\r\n\u001b[?2004l\r"]
[90.896196, "o", "\u001b[?2004h> "]
[90.896249, "o", "        } else {\r\n\u001b[?2004l\r"]
[90.896264, "o", "\u001b[?2004h"]
[90.896284, "o", "> "]
[90.896342, "o", "            proto = $6;\r\n\u001b[?2004l\r"]
[90.896358, "o", "\u001b[?2004h"]
[90.89638, "o", "> "]
[90.896404, "o", "        }\r\n\u001b[?2004l\r"]
[90.896422, "o", "\u001b[?2004h> "]
[90.896448, "o", "        \r\n\u001b[?2004l\r"]
[90.896466, "o", "\u001b[?2004h> "]
[90.896551, "o", "        # Enrichment and output\r\n\u001b[?2004l\r"]
[90.896566, "o", "\u001b[?2004h"]
[90.896586, "o", "> "]
[90.896777, "o", "        gsub(/[()]/, \"\", $0);  # Clean parentheses from original process name\r\n\u001b[?2004l\r"]
[90.896793, "o", "\u001b[?2004h"]
[90.896812, "o", "> "]
[90.896945, "o", "        print port, proto, $NF \",\" $0 service_name;\r\n\u001b[?2004l\r"]
[90.89697, "o", "\u001b[?2004h> "]
[90.897171, "o", "    }' \"${INPUT_DIR}/mock_netstat.txt\" | sort -n > \"${TMP_DIR}/open_ports.csv\"\r\n\u001b[?2004l\r"]
[90.897194, "o", "\u001b[?2004h> "]
[90.897214, "o", "}\r\n\u001b[?2004l\r\u001b[?2004h"]
[90.897234, "o", "> \r\n\u001b[?2004l\r"]
[90.897254, "o", "\u001b[?2004h> "]
[90.897353, "o", "# 5. Job 2: User Audit (parallel)\r\n\u001b[?2004l\r"]
[90.897377, "o", "\u001b[?2004h> "]
[90.897456, "o", "echo \"Starting user audit...\"\r\n\u001b[?2004l\r"]
[90.89748, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.8975, "o", "\u001b[?2004h> "]
[90.897583, "o", "# Define user audit function\r\n\u001b[?2004l\r"]
[90.897603, "o", "\u001b[?2004h> "]
[90.897656, "o", "process_users() {\r\n\u001b[?2004l\r"]
[90.897679, "o", "\u001b[?2004h> "]
[90.897965, "o", "    awk -v uid_limit=${UID_LIMIT} -v blacklist_file=\"${CONFIG_DIR}/user_blacklist.txt\" -v OFS=',' 'BEGIN {\r\n\u001b[?2004l\r"]
[90.897991, "o", "\u001b[?2004h> "]
[90.89813, "o", "        while (getline < blacklist_file > 0) {\r\n\u001b[?2004l\r"]
[90.898154, "o", "\u001b[?2004h> "]
[90.898237, "o", "            blacklist[$0] = 1;\r\n\u001b[?2004l\r"]
[90.898258, "o", "\u001b[?2004h"]
[90.898275, "o", "> "]
[90.898299, "o", "        }\r\n\u001b[?2004l\r"]
[90.898323, "o", "\u001b[?2004h"]
[90.898341, "o", ">     }\r\n\u001b[?2004l\r"]
[90.898358, "o", "\u001b[?2004h> "]
[90.89853, "o", "    $3 < uid_limit && $7 != \"/bin/false\" && !($1 in blacklist) {\r\n\u001b[?2004l\r"]
[90.898547, "o", "\u001b[?2004h"]
[90.898563, "o", "> "]
[90.898605, "o", "        print $1;\r\n\u001b[?2004l\r"]
[90.898619, "o", "\u001b[?2004h"]
[90.898635, "o", "> "]
[90.898823, "o", "    }' \"${INPUT_DIR}/mock_passwd\" | sort > \"${TMP_DIR}/insecure_users.csv\"\r\n\u001b[?2004l\r"]
[90.898844, "o", "\u001b[?2004h"]
[90.898862, "o", "> }\r\n\u001b[?2004l\r"]
[90.898881, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.898898, "o", "\u001b[?2004h> "]
[90.89899, "o", "# Launch both jobs in parallel\r\n\u001b[?2004l\r"]
[90.899011, "o", "\u001b[?2004h"]
[90.899035, "o", "> "]
[90.899061, "o", "process_netstat &\r\n\u001b[?2004l\r"]
[90.89908, "o", "\u001b[?2004h> "]
[90.899125, "o", "PID_NETSTAT=$!\r\n\u001b[?2004l\r"]
[90.899146, "o", "\u001b[?2004h> "]
[90.899192, "o", "process_users &\r\n\u001b[?2004l\r"]
[90.899209, "o", "\u001b[?2004h"]
[90.899226, "o", "> "]
[90.899255, "o", "PID_USERS=$!\r\n\u001b[?2004l\r"]
[90.899276, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.899297, "o", "\u001b[?2004h"]
[90.899315, "o", "> "]
[90.899393, "o", "# Wait for both jobs to complete\r\n\u001b[?2004l\r"]
[90.89941, "o", "\u001b[?2004h"]
[90.899428, "o", "> "]
[90.899549, "o", "echo \"Waiting for background jobs to complete...\"\r\n\u001b[?2004l\r"]
[90.899568, "o", "\u001b[?2004h"]
[90.899585, "o", "> "]
[90.899655, "o", "wait ${PID_NETSTAT} ${PID_USERS}\r\n\u001b[?2004l\r"]
[90.89967, "o", "\u001b[?2004h"]
[90.899687, "o", "> \r\n\u001b[?2004l\r"]
[90.899709, "o", "\u001b[?2004h> "]
[90.899828, "o", "echo \"Background jobs completed successfully.\"\r\n\u001b[?2004l\r"]
[90.899848, "o", "\u001b[?2004h> "]
[90.899873, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[90.90006, "o", "# 6. Generate Artifact A: Mainframe Report (infra_security_report.yml)\r\n\u001b[?2004l\r"]
[90.90008, "o", "\u001b[?2004h"]
[90.900099, "o", "> "]
[90.900206, "o", "echo \"Generating mainframe security report...\"\r\n\u001b[?2004l\r"]
[90.900222, "o", "\u001b[?2004h"]
[90.900239, "o", "> \r\n\u001b[?2004l\r"]
[90.900261, "o", "\u001b[?2004h> "]
[90.900364, "o", "# Create YAML content with proper encoding\r\n\u001b[?2004l\r"]
[90.900383, "o", "\u001b[?2004h> "]
[90.900399, "o", "{\r\n\u001b[?2004l\r"]
[90.900423, "o", "\u001b[?2004h> "]
[90.90046, "o", "    echo \"---\"\r\n\u001b[?2004l\r"]
[90.900477, "o", "\u001b[?2004h"]
[90.900497, "o", "> "]
[90.900538, "o", "    echo \"meta:\"  \r\n\u001b[?2004l\r"]
[90.900557, "o", "\u001b[?2004h> "]
[90.900661, "o", "    echo \"  input_hash: ${INPUT_HASH}\"\r\n\u001b[?2004l\r"]
[90.900679, "o", "\u001b[?2004h"]
[90.900695, "o", "> "]
[90.900778, "o", "    echo \"insecure_users:\"  \r\n\u001b[?2004l\r"]
[90.900797, "o", "\u001b[?2004h"]
[90.900815, "o", "> "]
[90.900891, "o", "    while IFS= read -r user; do\r\n\u001b[?2004l\r"]
[90.900928, "o", "\u001b[?2004h> "]
[90.901, "o", "        echo \"  - ${user}\"\r\n\u001b[?2004l\r"]
[90.90102, "o", "\u001b[?2004h"]
[90.901041, "o", "> "]
[90.901153, "o", "    done < \"${TMP_DIR}/insecure_users.csv\"\r\n\u001b[?2004l\r"]
[90.901173, "o", "\u001b[?2004h> "]
[90.901253, "o", "    echo \"open_ports:\"  \r\n\u001b[?2004l\r"]
[90.901269, "o", "\u001b[?2004h"]
[90.901288, "o", "> "]
[90.90143, "o", "    while IFS=, read -r port protocol process rest; do\r\n\u001b[?2004l\r"]
[90.901453, "o", "\u001b[?2004h> "]
[90.90155, "o", "        echo \"  - port: ${port}\"\r\n\u001b[?2004l\r"]
[90.90157, "o", "\u001b[?2004h> "]
[90.90169, "o", "        echo \"    protocol: ${protocol}\"\r\n\u001b[?2004l\r"]
[90.901706, "o", "\u001b[?2004h"]
[90.901726, "o", "> "]
[90.901829, "o", "        echo \"    process: ${process}\"\r\n\u001b[?2004l\r"]
[90.901846, "o", "\u001b[?2004h"]
[90.901867, "o", "> "]
[90.901988, "o", "    done < \"${TMP_DIR}/open_ports.csv\"\r\n\u001b[?2004l\r"]
[90.902013, "o", "\u001b[?2004h"]
[90.902036, "o", "> "]
[90.902234, "o", "} | iconv -f UTF-8 -t ISO-8859-1 > \"${SCRIPT_DIR}/infra_security_report.yml\"\r\n\u001b[?2004l\r"]
[90.902261, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.902296, "o", "\u001b[?2004h> "]
[90.902449, "o", "echo \"Mainframe security report generated successfully.\"\r\n\u001b[?2004l\r"]
[90.902486, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[90.902505, "o", "\u001b[?2004h> "]
[90.902661, "o", "# 7. Generate Artifact B: SIEM Log (scan_exec_time.log)\r\n\u001b[?2004l\r"]
[90.902684, "o", "\u001b[?2004h> "]
[90.902766, "o", "echo \"Generating SIEM log...\"\r\n\u001b[?2004l\r"]
[90.902786, "o", "\u001b[?2004h> "]
[90.90281, "o", "\r\n\u001b[?2004l\r"]
[90.902834, "o", "\u001b[?2004h> "]
[90.902979, "o", "# Calculate duration and create CSV with CRLF line endings\r\n\u001b[?2004l\r"]
[90.903005, "o", "\u001b[?2004h> "]
[90.903071, "o", "END_EPOCH=$(date '+%s')\r\n\u001b[?2004l\r"]
[90.903093, "o", "\u001b[?2004h"]
[90.903118, "o", "> "]
[90.903194, "o", "DURATION=$((END_EPOCH - START_EPOCH))\r\n\u001b[?2004l\r"]
[90.903216, "o", "\u001b[?2004h"]
[90.903237, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.903263, "o", "> "]
[90.903349, "o", "# Create CSV with CRLF line endings\r\n\u001b[?2004l\r"]
[90.903373, "o", "\u001b[?2004h"]
[90.903397, "o", "> {\r\n\u001b[?2004l\r"]
[90.903419, "o", "\u001b[?2004h> "]
[90.903527, "o", "    echo -n \"start_epoch,end_epoch,duration\\r\"\r\n\u001b[?2004l\r"]
[90.903552, "o", "\u001b[?2004h> "]
[90.903693, "o", "    echo -n \"${START_EPOCH},${END_EPOCH},${DURATION}\\r\"\r\n\u001b[?2004l\r"]
[90.903716, "o", "\u001b[?2004h> "]
[90.903827, "o", "} > \"${SCRIPT_DIR}/scan_exec_time.log\"\r\n\u001b[?2004l\r"]
[90.903854, "o", "\u001b[?2004h"]
[90.903875, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.903895, "o", "> "]
[90.903996, "o", "echo \"SIEM log generated successfully.\"\r\n\u001b[?2004l\r"]
[90.904015, "o", "\u001b[?2004h"]
[90.904037, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[90.904058, "o", "> "]
[90.904105, "o", "# 8. Final status\r\n\u001b[?2004l\r"]
[90.904128, "o", "\u001b[?2004h> "]
[90.904197, "o", "END_EPOCH=$(date '+%s')\r\n\u001b[?2004l\r"]
[90.904219, "o", "\u001b[?2004h> "]
[90.904323, "o", "DURATION=$((END_EPOCH - START_EPOCH))\r\n\u001b[?2004l\r"]
[90.904344, "o", "\u001b[?2004h> "]
[90.904497, "o", "echo \"Script execution completed in ${DURATION} seconds.\"\r\n\u001b[?2004l\r"]
[90.904523, "o", "\u001b[?2004h> "]
[90.904697, "o", "echo \"Final artifacts generated at: $(date '+%Y-%m-%d %H:%M:%S')\"\r\n\u001b[?2004l\r"]
[90.904718, "o", "\u001b[?2004h> "]
[90.904738, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[90.904761, "o", "> "]
[90.904836, "o", "# 9. Make script executable\r\n\u001b[?2004l\r"]
[90.904854, "o", "\u001b[?2004h> "]
[90.90499, "o", "chmod +x \"${SCRIPT_DIR}/run_security_scan.sh\"\r\n\u001b[?2004l\r"]
[90.905013, "o", "\u001b[?2004h> "]
[90.905035, "o", "EOF"]
[91.36104, "i", "chmod +x /home/user/reports/run_security_scan.sh\n"]
[91.361207, "o", "chmod +x /home/user/reports/run_security_scan.sh\r\n\u001b[?2004l\r"]
[91.361236, "o", "\u001b[?2004h"]
[91.361261, "o", "> "]
[91.560111, "i", "ls -la /home/user/reports/\n"]
[91.560327, "o", "ls -la /home/user/reports/\r\n"]
[91.560375, "o", "\u001b[?2004l\r"]
[91.56039, "o", "\u001b[?2004h"]
[91.560438, "o", "> "]
[106.185281, "i", "/home/user/reports/run_security_scan.sh\n"]
[106.185672, "o", "/home/user/reports/run_security_scan.sh\r\n"]
[106.185686, "o", "\u001b[?2004l\r"]
[106.185768, "o", "\u001b[?2004h"]
[106.18581, "o", "> "]
[108.140445, "i", "echo \"--- Verification ---\"\n"]
[108.140562, "o", "echo \"--- Verification ---\"\r\n\u001b[?2004l\r"]
[108.140604, "o", "\u001b[?2004h> "]
[108.310481, "i", "ls -la /home/user/reports/infra_security_report.yml /home/user/reports/scan_exec_time.log\n"]
[108.310754, "o", "ls -la /home/user/reports/infra_security_report.yml /home/user/reports/scan_exec_time.log\r\n\u001b[?2004l\r"]
[108.310806, "o", "\u001b[?2004h> "]
[108.424895, "i", "head -10 /home/user/reports/infra_security_report.yml\n"]
[108.425118, "o", "head -10 /home/user/reports/infra_security_report.yml\r\n"]
[108.425135, "o", "\u001b[?2004l\r"]
[108.425186, "o", "\u001b[?2004h> "]
[108.602567, "i", "file /home/user/reports/infra_security_report.yml\n"]
[108.602753, "o", "file /home/user/reports/infra_security_report.yml\r\n"]
[108.602779, "o", "\u001b[?2004l\r"]
[108.602801, "o", "\u001b[?2004h> "]
[108.74622, "i", "cat /home/user/reports/scan_exec_time.log\n"]
[108.746419, "o", "cat /home/user/reports/scan_exec_time.log\r\n\u001b[?2004l\r"]
[108.746459, "o", "\u001b[?2004h> "]
[108.909735, "i", "file /home/user/reports/scan_exec_time.log\n"]
[108.909891, "o", "file /home/user/reports/scan_exec_time.log\r\n\u001b[?2004l\r"]
[108.90994, "o", "\u001b[?2004h"]
[108.909963, "o", "> "]
