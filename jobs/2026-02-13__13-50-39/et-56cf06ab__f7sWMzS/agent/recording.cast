{"version": 2, "width": 160, "height": 40, "timestamp": 1771009079, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.023329, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[1.055952, "i", "clear\r"]
[1.05608, "o", "clear\r\n\u001b[?2004l\r"]
[1.057184, "o", "\u001b[H\u001b[J"]
[1.057395, "o", "\u001b[?2004h"]
[1.057426, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[59.126954, "i", "mkdir -p /home/user/storage_audit/logs /home/user/storage_audit/summary\n"]
[59.127479, "o", "mkdir -p /home/user/storage_audit/logs /home/user/storage_audit/summary\r\n\u001b[?2004l\r"]
[59.131595, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[59.396248, "i", "find /home/user/storage_audit/raw_reports -type f -iname \"*.json\" ! -name \".*\" -exec basename {} \\; > /home/user/storage_audit/file_list.txt\n"]
[59.396737, "o", "find /home/user/storage_audit/raw_reports -type f -iname \"*.json\" ! -name \".*\" -exec basename {} \\; > /home/user/storage_audit/file_list.txt\r\n\u001b[?2004l\r"]
[59.40608, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[59.896626, "i", "cat > /home/user/storage_audit/validate.sh << 'EOF'\n#!/bin/bash\nSCHEMA=\"/home/user/storage_audit/schema/disk_report.schema.json\"\nLOG=\"/home/user/storage_audit/logs/validation.log\"\n\necho \"\" > \"$LOG\"\n\nwhile read -r file; do\n    if [[ ! -f \"$file\" ]]; then\n        echo \"$file : ERROR : File not found\"\n        continue\n    fi\n    \n    # Validate JSON syntax\n    if ! python3 -c \"import json, sys; json.load(open(sys.argv[1]))\" \"$file\" 2>/dev/null; then\n        echo \"$file : INVALID_JSON\"\n        continue\n    fi\n    \n    # Validate against schema\n    if ! python3 -c \"\nimport json, sys, os\nfrom jsonschema import validate, ValidationError\n\ntry:\n    with open(sys.argv[1], 'r') as f:\n        report = json.load(f)\n    with open(sys.argv[2], 'r') as f:\n        schema = json.load(f)\n    validate(instance=report, schema=schema)\n    print('OK')\nexcept json.JSONDecodeError:\n    print('INVALID_JSON')\nexcept ValidationError as e:\n    print(f'ERROR : {e.message.replace(\":\", \" \").strip()}')\nexcept Exception as e:\n    print(f'ERRO"]
[59.896798, "i", "R : {str(e).replace(\":\", \" \").strip()}')\n\" \"$file\" \"$SCHEMA\" 2>/dev/null; done\n    echo \"$file : $json_result\"\n    if [[ \"$json_result\" == \"OK\" ]]; then\n        echo \"$file : OK\" >> \"$LOG\"\n    else\n        echo \"$file : $json_result\" >> \"$LOG\"\n    fi\ndone < /home/user/storage_audit/file_list.txt\nEOF\n"]
[59.896998, "o", "cat > /home/user/storage_audit/validate.sh << 'EOF'\r\n\u001b[?2004l\r"]
[59.897049, "o", "\u001b[?2004h> "]
[59.897119, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[59.897171, "o", "\u001b[?2004h> "]
[59.897459, "o", "SCHEMA=\"/home/user/storage_audit/schema/disk_report.schema.json\"\r\n\u001b[?2004l\r"]
[59.897503, "o", "\u001b[?2004h> "]
[59.897744, "o", "LOG=\"/home/user/storage_audit/logs/validation.log\"\r\n\u001b[?2004l\r"]
[59.897807, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[59.897836, "o", "> "]
[59.897907, "o", "echo \"\" > \"$LOG\"\r\n\u001b[?2004l\r"]
[59.897926, "o", "\u001b[?2004h"]
[59.897944, "o", "> \r\n\u001b[?2004l\r"]
[59.897961, "o", "\u001b[?2004h"]
[59.897981, "o", "> "]
[59.898084, "o", "while read -r file; do\r\n\u001b[?2004l\r"]
[59.898112, "o", "\u001b[?2004h"]
[59.898129, "o", "> "]
[59.898273, "o", "    if [[ ! -f \"$file\" ]]; then\r\n\u001b[?2004l\r"]
[59.898298, "o", "\u001b[?2004h"]
[59.898317, "o", "> "]
[59.898525, "o", "        echo \"$file : ERROR : File not found\"\r\n\u001b[?2004l\r"]
[59.898561, "o", "\u001b[?2004h"]
[59.898583, "o", "> "]
[59.898657, "o", "        continue\r\n\u001b[?2004l\r"]
[59.898683, "o", "\u001b[?2004h"]
[59.898697, "o", "> "]
[59.898739, "o", "    fi\r\n\u001b[?2004l\r"]
[59.898759, "o", "\u001b[?2004h"]
[59.898778, "o", "> "]
[59.898807, "o", "    \r\n\u001b[?2004l\r"]
[59.89883, "o", "\u001b[?2004h"]
[59.898849, "o", "> "]
[59.898966, "o", "    # Validate JSON syntax\r\n"]
[59.898982, "o", "\u001b[?2004l\r"]
[59.898999, "o", "\u001b[?2004h"]
[59.899015, "o", "> "]
[59.899457, "o", "    if ! python3 -c \"import json, sys; json.load(open(sys.argv[1]))\" \"$file\" 2>/dev/null; then\r\n\u001b[?2004l\r"]
[59.899487, "o", "\u001b[?2004h"]
[59.899503, "o", "> "]
[59.899667, "o", "        echo \"$file : INVALID_JSON\"\r\n\u001b[?2004l\r"]
[59.899695, "o", "\u001b[?2004h"]
[59.899723, "o", "> "]
[59.8998, "o", "        continue\r\n\u001b[?2004l\r"]
[59.899828, "o", "\u001b[?2004h"]
[59.899844, "o", "> "]
[59.899878, "o", "    fi\r\n\u001b[?2004l\r"]
[59.899897, "o", "\u001b[?2004h"]
[59.899914, "o", "> "]
[59.899942, "o", "    \r\n\u001b[?2004l\r"]
[59.899968, "o", "\u001b[?2004h"]
[59.899981, "o", "> "]
[59.900118, "o", "    # Validate against schema\r\n\u001b[?2004l\r"]
[59.900144, "o", "\u001b[?2004h"]
[59.900158, "o", "> "]
[59.900262, "o", "    if ! python3 -c \"\r\n\u001b[?2004l\r"]
[59.900293, "o", "\u001b[?2004h"]
[59.900312, "o", "> "]
[59.900405, "o", "import json, sys, os\r\n\u001b[?2004l\r"]
[59.90043, "o", "\u001b[?2004h"]
[59.900445, "o", "> "]
[59.900672, "o", "from jsonschema import validate, ValidationError\r\n\u001b[?2004l\r"]
[59.900694, "o", "\u001b[?2004h"]
[59.900715, "o", "> \r\n\u001b[?2004l\r"]
[59.900745, "o", "\u001b[?2004h"]
[59.90076, "o", "> "]
[59.900785, "o", "try:\r\n\u001b[?2004l\r"]
[59.90081, "o", "\u001b[?2004h"]
[59.900825, "o", "> "]
[59.901002, "o", "    with open(sys.argv[1], 'r') as f:\r\n\u001b[?2004l\r"]
[59.901028, "o", "\u001b[?2004h"]
[59.901047, "o", "> "]
[59.901183, "o", "        report = json.load(f)\r\n\u001b[?2004l\r"]
[59.901204, "o", "\u001b[?2004h"]
[59.90122, "o", "> "]
[59.901397, "o", "    with open(sys.argv[2], 'r') as f:\r\n\u001b[?2004l\r"]
[59.901421, "o", "\u001b[?2004h"]
[59.901442, "o", "> "]
[59.901586, "o", "        schema = json.load(f)\r\n\u001b[?2004l\r"]
[59.901612, "o", "\u001b[?2004h"]
[59.901628, "o", "> "]
[59.901845, "o", "    validate(instance=report, schema=schema)\r\n\u001b[?2004l\r"]
[59.901866, "o", "\u001b[?2004h"]
[59.901882, "o", "> "]
[59.901958, "o", "    print('OK')\r\n\u001b[?2004l\r"]
[59.901987, "o", "\u001b[?2004h"]
[59.902003, "o", "> "]
[59.902138, "o", "except json.JSONDecodeError:\r\n\u001b[?2004l\r"]
[59.902169, "o", "\u001b[?2004h"]
[59.902183, "o", "> "]
[59.902302, "o", "    print('INVALID_JSON')\r\n\u001b[?2004l\r"]
[59.902328, "o", "\u001b[?2004h"]
[59.902344, "o", "> "]
[59.902477, "o", "except ValidationError as e:\r\n\u001b[?2004l\r"]
[59.902507, "o", "\u001b[?2004h"]
[59.90252, "o", "> "]
[59.902803, "o", "    print(f'ERROR : {e.message.replace(\":\", \" \").strip()}')\r\n\u001b[?2004l\r"]
[59.902833, "o", "\u001b[?2004h"]
[59.902849, "o", "> "]
[59.902953, "o", "except Exception as e:\r\n\u001b[?2004l\r"]
[59.902978, "o", "\u001b[?2004h"]
[59.902992, "o", "> "]
[59.903253, "o", "    print(f'ERROR : {str(e).replace(\":\", \" \").strip()}')\r\n\u001b[?2004l\r"]
[59.903282, "o", "\u001b[?2004h"]
[59.903295, "o", "> "]
[59.903471, "o", "\" \"$file\" \"$SCHEMA\" 2>/dev/null; done\r\n\u001b[?2004l\r"]
[59.903496, "o", "\u001b[?2004h"]
[59.90351, "o", "> "]
[59.903659, "o", "    echo \"$file : $json_result\"\r\n\u001b[?2004l\r"]
[59.903685, "o", "\u001b[?2004h"]
[59.903706, "o", "> "]
[59.903903, "o", "    if [[ \"$json_result\" == \"OK\" ]]; then\r\n\u001b[?2004l\r"]
[59.903922, "o", "\u001b[?2004h"]
[59.903938, "o", "> "]
[59.904109, "o", "        echo \"$file : OK\" >> \"$LOG\"\r\n\u001b[?2004l\r"]
[59.904136, "o", "\u001b[?2004h"]
[59.904153, "o", "> "]
[59.904195, "o", "    else\r\n\u001b[?2004l\r"]
[59.904222, "o", "\u001b[?2004h"]
[59.90424, "o", "> "]
[59.904455, "o", "        echo \"$file : $json_result\" >> \"$LOG\"\r\n\u001b[?2004l\r"]
[59.904479, "o", "\u001b[?2004h"]
[59.904494, "o", "> "]
[59.904532, "o", "    fi\r\n\u001b[?2004l\r"]
[59.904558, "o", "\u001b[?2004h"]
[59.904573, "o", "> "]
[59.904798, "o", "done < /home/user/storage_audit/file_list.txt\r\n\u001b[?2004l\r"]
[59.904822, "o", "\u001b[?2004h"]
[59.904839, "o", "> "]
[59.904858, "o", "EOF\r\n\u001b[?2004l\r"]
[59.906064, "o", "\u001b[?2004h"]
[59.906081, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[60.938488, "i", "chmod +x /home/user/storage_audit/validate.sh\n"]
[60.939002, "o", "chmod +x /home/user/storage_audit/validate.sh\r\n\u001b[?2004l\r"]
[60.9409, "o", "\u001b[?2004h"]
[60.94101, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[61.160213, "i", "/home/user/storage_audit/validate.sh\n"]
[61.160578, "o", "/home/user/storage_audit/validate.sh\r\n\u001b[?2004l\r"]
[61.162879, "o", "/home/user/storage_audit/validate.sh: line 37: syntax error near unexpected token `done'\r\n/home/user/storage_audit/validate.sh: line 37: `\" \"$file\" \"$SCHEMA\" 2>/dev/null; done'\r\n"]
[61.163257, "o", "\u001b[?2004h"]
[61.163294, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[63.204243, "i", "cat > /home/user/storage_audit/process.sh << 'EOF'\n#!/bin/bash\n\n# Load inventory data\ndeclare -A HOST_ENV\ndeclare -A HOST_COST\nwhile IFS=, read -r host env cost; do\n    HOST_ENV[\"$host\"]=\"$env\"\n    HOST_COST[\"$host\"]=\"$cost\"\ndone < <(tail -n +2 /home/user/storage_audit/inventory.csv)\n\n# Read validation log to get valid files\nVALID_FILES=()\nwhile IFS=\" :\" read -r file status _; do\n    if [[ \"$status\" == \"OK\" ]]; then\n        VALID_FILES+=(\"$file\")\n    fi\ndone < /home/user/storage_audit/logs/validation.log\n\n# Process valid files\ntotals_used=0\ntotals_total=0\ntotal_monthly_cost=0\ndetails=()\n\ncat > /home/user/storage_audit/temp.json << 'JSON'\n{\n  \"generatedAt\": \"$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\",\n  \"totals\": {\n    \"totalGB\": 0,\n    \"usedGB\": 0,\n    \"freeGB\": 0,\n    \"usagePercent\": 0,\n    \"totalMonthlyCost\": 0\n  },\n  \"mounts\": []\n}\nJSON\n\nfor report_file in \"${VALID_FILES[@]}\"; do\n    while IFS=$'\\n' read -r mount; do\n        host=$(jq -r '.host' <<< \"$mount\")\n        mount_point=$(jq -r '.mount' <<< \"$mount\")\n     "]
[63.204405, "i", "   total_gb=$(jq -r '.totalGB' <<< \"$mount\" | awk '{printf \"%.2f\", $1}')\n        used_gb=$(jq -r '.usedGB' <<< \"$mount\" | awk '{printf \"%.2f\", $1}')\n        \n        free_gb=$(echo \"$total_gb - $used_gb\" | bc -l | awk '{printf \"%.2f\", $1}')\n        usage_percent=$(echo \"scale=2; ($used_gb / $total_gb) * 100\" | bc -l | awk '{printf \"%.2f\", $1}')\n        \n        env=\"${HOST_ENV[$host]:-Unmanaged}\"\n        cost_per_gb=\"${HOST_COST[$host]:-0}\"\n        monthly_cost=$(echo \"$used_gb * $cost_per_gb\" | bc -l | awk '{printf \"%.2f\", $1}')\n        \n        totals_used=$(echo \"$totals_used + $used_gb\" | bc -l)\n        totals_total=$(echo \"$totals_total + $total_gb\" | bc -l)\n        total_monthly_cost=$(echo \"$total_monthly_cost + $monthly_cost\" | bc -l)\n        \n        details+=(\n            null\n        )\n        jq -c --arg host \"$host\" --arg env \"$env\" --arg mount \"$mount_point\" \\\n           --argjson totalGB \"$total_gb\" --argjson usedGB \"$used_gb\" \\\n           --argjson freeGB \"$free_gb\" --argjson usagePercent \"$us"]
[63.204458, "i", "age_percent\" \\\n           --argjson monthlyCost \"$monthly_cost\" \\\n           '{\n            host: $host,\n            environment: $env,\n            mountPoint: $mount,\n            totalGB: $totalGB,\n            usedGB: $usedGB,\n            freeGB: $freeGB,\n            usagePercent: $usagePercent,\n            monthlyCost: $monthlyCost\n           }' >> /home/user/storage_audit/temp.json\n    done < <(jq -c '.mounts[]' /home/user/storage_audit/raw_reports/\"$report_file\")\ndone\n\n# Calculate totals\ntotals_free_gb=$(echo \"$totals_total - $totals_used\" | bc -l | awk '{printf \"%.2f\", $1}')\ntotals_usage_percent=$(echo \"scale=2; ($totals_used / $totals_total) * 100\" | bc -l | awk '{printf \"%.2f\", $1}')\n\n# Build final JSON with sorted mounts\njq -c --argjson totals_total \"$totals_total\" \\\n   --argjson totals_used \"$totals_used\" \\\n   --argjson totals_free \"${totals_free_gb/./\\.}\" \\\n   --argjson totals_usage \"${totals_usage_percent/./\\.}\" \\\n   --argjson total_monthly_cost \"${total_monthly_cost/./\\.}\" \\\n   '.totals = {\n      "]
[63.204499, "i", "  totalGB: ($totals_total|tonumber),\n        usedGB: ($totals_used|tonumber),\n        freeGB: ($totals_free|tonumber),\n        usagePercent: ($totals_usage|tonumber),\n        totalMonthlyCost: ($total_monthly_cost|tonumber)\n    } | .mounts = (sort_by(-.usagePercent) | .[])' /home/user/storage_audit/temp.json > /home/user/storage_audit/summary/disk_usage_summary.json\n\n# Set permissions\nchmod 644 /home/user/storage_audit/summary/disk_usage_summary.json\n\n# Calculate checksum\nsha256sum /home/user/storage_audit/summary/disk_usage_summary.json | cut -d' ' -f1 > /home/user/storage_audit/summary/checksum.sha256\nchmod 644 /home/user/storage_audit/summary/checksum.sha256\n\n# Print summary path\necho /home/user/storage_audit/summary/disk_usage_summary.json\nEOF\n"]
[63.204576, "o", "cat > /home/user/storage_audit/process.sh << 'EOF'\r\n\u001b[?2004l\r"]
[63.20463, "o", "\u001b[?2004h"]
[63.204671, "o", "> "]
[63.204728, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[63.204771, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[63.204818, "o", "\u001b[?2004h> "]
[63.204907, "o", "# Load inventory data\r\n\u001b[?2004l\r"]
[63.204947, "o", "\u001b[?2004h> "]
[63.205052, "o", "declare -A HOST_ENV\r\n\u001b[?2004l\r"]
[63.20509, "o", "\u001b[?2004h> "]
[63.205184, "o", "declare -A HOST_COST\r\n\u001b[?2004l\r"]
[63.205218, "o", "\u001b[?2004h> "]
[63.205405, "o", "while IFS=, read -r host env cost; do\r\n\u001b[?2004l\r"]
[63.205447, "o", "\u001b[?2004h> "]
[63.205585, "o", "    HOST_ENV[\"$host\"]=\"$env\"\r\n\u001b[?2004l\r"]
[63.205623, "o", "\u001b[?2004h> "]
[63.205786, "o", "    HOST_COST[\"$host\"]=\"$cost\"\r\n\u001b[?2004l\r"]
[63.205825, "o", "\u001b[?2004h> "]
[63.206096, "o", "done < <(tail -n +2 /home/user/storage_audit/inventory.csv)\r\n\u001b[?2004l\r"]
[63.206138, "o", "\u001b[?2004h"]
[63.206171, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[63.206379, "o", "# Read validation log to get valid files\r\n\u001b[?2004l\r"]
[63.206419, "o", "\u001b[?2004h> "]
[63.20649, "o", "VALID_FILES=()\r\n\u001b[?2004l\r"]
[63.206527, "o", "\u001b[?2004h> "]
[63.206731, "o", "while IFS=\" :\" read -r file status _; do\r\n\u001b[?2004l\r"]
[63.206775, "o", "\u001b[?2004h> "]
[63.206953, "o", "    if [[ \"$status\" == \"OK\" ]]; then\r\n\u001b[?2004l\r"]
[63.20699, "o", "\u001b[?2004h> "]
[63.207133, "o", "        VALID_FILES+=(\"$file\")\r\n\u001b[?2004l\r"]
[63.207169, "o", "\u001b[?2004h> "]
[63.207204, "o", "    fi\r\n\u001b[?2004l\r"]
[63.20724, "o", "\u001b[?2004h> "]
[63.207487, "o", "done < /home/user/storage_audit/logs/validation.log\r\n\u001b[?2004l\r"]
[63.207524, "o", "\u001b[?2004h> \r\n"]
[63.207561, "o", "\u001b[?2004l\r\u001b[?2004h"]
[63.207596, "o", "> "]
[63.207681, "o", "# Process valid files\r\n\u001b[?2004l\r"]
[63.207773, "o", "\u001b[?2004h> "]
[63.207818, "o", "totals_used=0\r\n\u001b[?2004l\r\u001b[?2004h"]
[63.207862, "o", "> "]
[63.207901, "o", "totals_total=0\r\n\u001b[?2004l\r"]
[63.207938, "o", "\u001b[?2004h"]
[63.207974, "o", "> "]
[63.208052, "o", "total_monthly_cost=0\r\n\u001b[?2004l\r"]
[63.208087, "o", "\u001b[?2004h> "]
[63.208146, "o", "details=()\r\n\u001b[?2004l\r"]
[63.208183, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[63.208218, "o", "\u001b[?2004h> "]
[63.208465, "o", "cat > /home/user/storage_audit/temp.json << 'JSON'\r\n\u001b[?2004l\r"]
[63.208503, "o", "\u001b[?2004h> "]
[63.208538, "o", "{\r\n\u001b[?2004l\r\u001b[?2004h"]
[63.208574, "o", "> "]
[63.208823, "o", "  \"generatedAt\": \"$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\",\r\n\u001b[?2004l\r"]
[63.208868, "o", "\u001b[?2004h> "]
[63.208922, "o", "  \"totals\": {\r\n\u001b[?2004l\r"]
[63.208957, "o", "\u001b[?2004h> "]
[63.209052, "o", "    \"totalGB\": 0,\r\n\u001b[?2004l\r"]
[63.209088, "o", "\u001b[?2004h> "]
[63.209176, "o", "    \"usedGB\": 0,\r\n\u001b[?2004l\r"]
[63.209214, "o", "\u001b[?2004h> "]
[63.209296, "o", "    \"freeGB\": 0,\r\n\u001b[?2004l\r"]
[63.209332, "o", "\u001b[?2004h> "]
[63.209443, "o", "    \"usagePercent\": 0,\r\n\u001b[?2004l\r"]
[63.209479, "o", "\u001b[?2004h> "]
[63.209606, "o", "    \"totalMonthlyCost\": 0\r\n\u001b[?2004l\r"]
[63.209642, "o", "\u001b[?2004h> "]
[63.209687, "o", "  },\r\n\u001b[?2004l\r"]
[63.209746, "o", "\u001b[?2004h> "]
[63.209791, "o", "  \"mounts\": []\r\n\u001b[?2004l\r"]
[63.209836, "o", "\u001b[?2004h> "]
[63.209879, "o", "}\r\n\u001b[?2004l\r\u001b[?2004h"]
[63.209918, "o", "> JSON\r\n\u001b[?2004l\r"]
[63.209954, "o", "\u001b[?2004h> "]
[63.20999, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[63.210026, "o", "> "]
[63.210202, "o", "for report_file in \"${VALID_FILES[@]}\"; do\r\n\u001b[?2004l\r"]
[63.21024, "o", "\u001b[?2004h> "]
[63.210424, "o", "    while IFS=$'\\n' read -r mount; do\r\n\u001b[?2004l\r"]
[63.21046, "o", "\u001b[?2004h> "]
[63.210664, "o", "        host=$(jq -r '.host' <<< \"$mount\")\r\n\u001b[?2004l\r"]
[63.210701, "o", "\u001b[?2004h> "]
[63.210951, "o", "        mount_point=$(jq -r '.mount' <<< \"$mount\")\r\n\u001b[?2004l\r"]
[63.210989, "o", "\u001b[?2004h> "]
[63.211353, "o", "        total_gb=$(jq -r '.totalGB' <<< \"$mount\" | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.21139, "o", "\u001b[?2004h> "]
[63.211753, "o", "        used_gb=$(jq -r '.usedGB' <<< \"$mount\" | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.211798, "o", "\u001b[?2004h> "]
[63.211842, "o", "        \r\n\u001b[?2004l\r"]
[63.211882, "o", "\u001b[?2004h> "]
[63.21226, "o", "        free_gb=$(echo \"$total_gb - $used_gb\" | bc -l | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.212297, "o", "\u001b[?2004h> "]
[63.212793, "o", "        usage_percent=$(echo \"scale=2; ($used_gb / $total_gb) * 100\" | bc -l | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.212839, "o", "\u001b[?2004h> "]
[63.212879, "o", "        \r\n\u001b[?2004l\r"]
[63.212925, "o", "\u001b[?2004h> "]
[63.21312, "o", "        env=\"${HOST_ENV[$host]:-Unmanaged}\"\r\n\u001b[?2004l\r"]
[63.213163, "o", "\u001b[?2004h> "]
[63.213385, "o", "        cost_per_gb=\"${HOST_COST[$host]:-0}\"\r\n\u001b[?2004l\r"]
[63.213436, "o", "\u001b[?2004h> "]
[63.213879, "o", "        monthly_cost=$(echo \"$used_gb * $cost_per_gb\" | bc -l | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r\u001b[?2004h"]
[63.213927, "o", "> "]
[63.213974, "o", "        \r\n\u001b[?2004l\r\u001b[?2004h> "]
[63.21427, "o", "        totals_used=$(echo \"$totals_used + $used_gb\" | bc -l)\r\n\u001b[?2004l\r"]
[63.214313, "o", "\u001b[?2004h> "]
[63.214608, "o", "        totals_total=$(echo \"$totals_total + $total_gb\" | bc -l)\r\n\u001b[?2004l\r"]
[63.21465, "o", "\u001b[?2004h> "]
[63.21503, "o", "        total_monthly_cost=$(echo \"$total_monthly_cost + $monthly_cost\" | bc -l)\r\n\u001b[?2004l\r"]
[63.215068, "o", "\u001b[?2004h> "]
[63.215114, "o", "        \r\n\u001b[?2004l\r"]
[63.215159, "o", "\u001b[?2004h> "]
[63.21524, "o", "        details+=(\r\n\u001b[?2004l\r"]
[63.215282, "o", "\u001b[?2004h> "]
[63.215363, "o", "            null\r\n\u001b[?2004l\r"]
[63.215405, "o", "\u001b[?2004h> "]
[63.215448, "o", "        )\r\n\u001b[?2004l\r"]
[63.215492, "o", "\u001b[?2004h> "]
[63.215879, "o", "        jq -c --arg host \"$host\" --arg env \"$env\" --arg mount \"$mount_point\" \\\r\n\u001b[?2004l\r"]
[63.215923, "o", "\u001b[?2004h> "]
[63.216238, "o", "           --argjson totalGB \"$total_gb\" --argjson usedGB \"$used_gb\" \\\r\n\u001b[?2004l\r"]
[63.21627, "o", "\u001b[?2004h> "]
[63.216659, "o", "           --argjson freeGB \"$free_gb\" --argjson usagePercent \"$usage_percent\" \\\r\n\u001b[?2004l\r"]
[63.216717, "o", "\u001b[?2004h> "]
[63.216948, "o", "           --argjson monthlyCost \"$monthly_cost\" \\\r\n\u001b[?2004l\r"]
[63.216973, "o", "\u001b[?2004h> "]
[63.217044, "o", "           '{\r\n\u001b[?2004l\r"]
[63.217071, "o", "\u001b[?2004h> "]
[63.217198, "o", "            host: $host,\r\n\u001b[?2004l\r"]
[63.21725, "o", "\u001b[?2004h> "]
[63.217387, "o", "            environment: $env,\r\n\u001b[?2004l\r"]
[63.217434, "o", "\u001b[?2004h> "]
[63.217576, "o", "            mountPoint: $mount,\r\n\u001b[?2004l\r"]
[63.217618, "o", "\u001b[?2004h> "]
[63.217779, "o", "            totalGB: $totalGB,\r\n\u001b[?2004l\r"]
[63.21781, "o", "\u001b[?2004h> "]
[63.217955, "o", "            usedGB: $usedGB,\r\n\u001b[?2004l\r"]
[63.217987, "o", "\u001b[?2004h> "]
[63.218132, "o", "            freeGB: $freeGB,\r\n\u001b[?2004l\r"]
[63.218158, "o", "\u001b[?2004h"]
[63.218203, "o", "> "]
[63.218363, "o", "            usagePercent: $usagePercent,\r\n\u001b[?2004l\r"]
[63.218405, "o", "\u001b[?2004h> "]
[63.218582, "o", "            monthlyCost: $monthlyCost\r\n\u001b[?2004l\r"]
[63.218626, "o", "\u001b[?2004h> "]
[63.218869, "o", "           }' >> /home/user/storage_audit/temp.json\r\n\u001b[?2004l\r"]
[63.218914, "o", "\u001b[?2004h> "]
[63.219294, "o", "    done < <(jq -c '.mounts[]' /home/user/storage_audit/raw_reports/\"$report_file\")\r\n\u001b[?2004l\r"]
[63.219341, "o", "\u001b[?2004h> "]
[63.219393, "o", "done\r\n\u001b[?2004l\r\u001b[?2004h> \r\n"]
[63.219439, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[63.219535, "o", "# Calculate totals\r\n\u001b[?2004l\r"]
[63.219577, "o", "\u001b[?2004h> "]
[63.219997, "o", "totals_free_gb=$(echo \"$totals_total - $totals_used\" | bc -l | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.220042, "o", "\u001b[?2004h> "]
[63.220555, "o", "totals_usage_percent=$(echo \"scale=2; ($totals_used / $totals_total) * 100\" | bc -l | awk '{printf \"%.2f\", $1}')\r\n\u001b[?2004l\r"]
[63.220621, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[63.220667, "o", "> "]
[63.220826, "o", "# Build final JSON with sorted mounts\r\n\u001b[?2004l\r"]
[63.22087, "o", "\u001b[?2004h> "]
[63.221077, "o", "jq -c --argjson totals_total \"$totals_total\" \\\r\n\u001b[?2004l\r"]
[63.221119, "o", "\u001b[?2004h> "]
[63.221314, "o", "   --argjson totals_used \"$totals_used\" \\\r\n\u001b[?2004l\r"]
[63.221356, "o", "\u001b[?2004h> "]
[63.221595, "o", "   --argjson totals_free \"${totals_free_gb/./\\.}\" \\\r\n\u001b[?2004l\r"]
[63.221637, "o", "\u001b[?2004h> "]
[63.221925, "o", "   --argjson totals_usage \"${totals_usage_percent/./\\.}\" \\\r\n\u001b[?2004l\r"]
[63.22197, "o", "\u001b[?2004h> "]
[63.22225, "o", "   --argjson total_monthly_cost \"${total_monthly_cost/./\\.}\" \\\r\n\u001b[?2004l\r"]
[63.222294, "o", "\u001b[?2004h> "]
[63.222368, "o", "   '.totals = {\r\n\u001b[?2004l\r"]
[63.222414, "o", "\u001b[?2004h> "]
[63.222608, "o", "        totalGB: ($totals_total|tonumber),\r\n\u001b[?2004l\r"]
[63.222656, "o", "\u001b[?2004h> "]
[63.222844, "o", "        usedGB: ($totals_used|tonumber),\r\n\u001b[?2004l\r"]
[63.222885, "o", "\u001b[?2004h> "]
[63.22307, "o", "        freeGB: ($totals_free|tonumber),\r\n\u001b[?2004l\r"]
[63.223111, "o", "\u001b[?2004h> "]
[63.223336, "o", "        usagePercent: ($totals_usage|tonumber),\r\n\u001b[?2004l\r"]
[63.223378, "o", "\u001b[?2004h> "]
[63.223636, "o", "        totalMonthlyCost: ($total_monthly_cost|tonumber)\r\n\u001b[?2004l\r"]
[63.223677, "o", "\u001b[?2004h> "]
[63.224355, "o", "    } | .mounts = (sort_by(-.usagePercent) | .[])' /home/user/storage_audit/temp.json > /home/user/storage_audit/summary/disk_usage_summary.json\r\n\u001b[?2004l\r"]
[63.224406, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[63.224457, "o", "\u001b[?2004h> "]
[63.224538, "o", "# Set permissions\r\n\u001b[?2004l\r"]
[63.22457, "o", "\u001b[?2004h> "]
[63.224895, "o", "chmod 644 /home/user/storage_audit/summary/disk_usage_summary.json\r\n\u001b[?2004l\r"]
[63.224939, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[63.224983, "o", "\u001b[?2004h> "]
[63.225083, "o", "# Calculate checksum\r\n\u001b[?2004l\r"]
[63.225125, "o", "\u001b[?2004h> "]
[63.225739, "o", "sha256sum /home/user/storage_audit/summary/disk_usage_summary.json | cut -d' ' -f1 > /home/user/storage_audit/summary/checksum.sha256\r\n\u001b[?2004l\r"]
[63.225763, "o", "\u001b[?2004h"]
[63.225842, "o", "> "]
[63.226061, "o", "chmod 644 /home/user/storage_audit/summary/checksum.sha256\r\n\u001b[?2004l\r"]
[63.226106, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[63.226151, "o", "\u001b[?2004h> "]
[63.226244, "o", "# Print summary path\r\n\u001b[?2004l\r"]
[63.226287, "o", "\u001b[?2004h> "]
[63.226582, "o", "echo /home/user/storage_audit/summary/disk_usage_summary.json\r\n\u001b[?2004l\r"]
[63.226625, "o", "\u001b[?2004h> "]
[63.226669, "o", "EOF\r\n\u001b[?2004l\r"]
[63.228665, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[66.231245, "i", "chmod +x /home/user/storage_audit/process.sh\n"]
[66.23147, "o", "chmod +x /home/user/storage_audit/process.sh\r\n\u001b[?2004l\r"]
[66.233102, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[66.338448, "i", "/home/user/storage_audit/process.sh\n"]
[66.338818, "o", "/home/user/storage_audit/process.sh\r\n\u001b[?2004l\r"]
[66.344797, "o", "/home/user/storage_audit/process.sh: line 78: bc: command not found\r\n"]
[66.34646, "o", "/home/user/storage_audit/process.sh: line 79: bc: command not found\r\n"]
[66.348904, "o", "jq: invalid JSON text passed to --argjson\r\nUse jq --help for help with command-line options,\r\nor see the jq manpage, or online docs  at https://stedolan.github.io/jq\r\n"]
[66.352924, "o", "/home/user/storage_audit/summary/disk_usage_summary.json\r\n"]
[66.353298, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[87.412198, "i", "sed -i 's/\" \\\"$file\\\" \\\"$SCHEMA\\\" 2>\\/dev\\/null; done/ \\\"$file\\\" \\\"$SCHEMA\\\" 2>\\/dev\\/null; done/' /home/user/storage_audit/validate.sh\n"]
[87.413246, "o", "sed -i 's/\" \\\"$file\\\" \\\"$SCHEMA\\\" 2>\\/dev\\/null; done/ \\\"$file\\\" \\\"$SCHEMA\\\" 2>\\/dev\\/null; done/' /home/user/storage_audit/validate.sh\r\n\u001b[?2004l\r"]
[87.415988, "o", "\u001b[?2004h"]
[87.416042, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[87.541643, "i", "apt-get update && apt-get install -y bc\n"]
[87.541957, "o", "apt-get update && apt-get install -y bc\r\n\u001b[?2004l\r"]
[87.603085, "o", "\r0% [Working]"]
[87.755017, "o", "\r            \rHit:1 http://security.ubuntu.com/ubuntu jammy-security InRelease\r\n\r0% [Connecting to archive.ubuntu.com (91.189.92.23)]"]
[87.858171, "o", "\r                                                    \r0% [Waiting for headers]"]
[87.863357, "o", "\r                        \rHit:2 http://archive.ubuntu.com/ubuntu jammy InRelease\r\n"]
[87.863426, "o", "\r                        \r0% [Working]"]
[87.964568, "o", "\r            \rHit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease\r\n\r0% [Working]"]
[87.992481, "o", "\r0% [Waiting for headers]"]
[88.065897, "o", "\r                        \rHit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease\r\n\r                        \r0% [Working]"]
[88.106202, "o", "\r0% [Working]"]
[88.231052, "o", "\r20% [Working]\r             \r"]
[88.241569, "o", "\rReading package lists... 0%\r"]
[88.350728, "o", "\rReading package lists... 0%\r"]
[88.362119, "o", "\rReading package lists... 0%\r"]
[88.389338, "o", "\rReading package lists... 3%\r\rReading package lists... 3%\r"]
[88.406347, "o", "\rReading package lists... 4%\r"]
[88.406474, "o", "\rReading package lists... 4%\r"]
[88.663984, "o", "\rReading package lists... 38%\r\rReading package lists... 38%\r"]
[88.672327, "o", "\rReading package lists... 39%\r\rReading package lists... 39%\r"]
[88.773638, "o", "\rReading package lists... 49%\r\rReading package lists... 49%\r"]
[88.870805, "o", "\rReading package lists... 66%\r\rReading package lists... 66%\r"]
[88.902229, "o", "\rReading package lists... 70%\r"]
[88.902308, "o", "\rReading package lists... 70%\r"]
[88.903763, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[88.905717, "o", "\rReading package lists... 70%\r"]
[88.905753, "o", "\rReading package lists... 70%\r"]
[88.910121, "o", "\rReading package lists... 70%\r"]
[88.910173, "o", "\rReading package lists... 70%\r"]
[88.938088, "o", "\rReading package lists... 79%\r\rReading package lists... 79%\r"]
[88.978731, "o", "\rReading package lists... 96%\r\rReading package lists... 96%\r"]
[88.987643, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[88.988279, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[88.993833, "o", "\rReading package lists... Done\r\r\n"]
[89.054094, "o", "\rReading package lists... 0%\r"]
[89.098577, "o", "\rReading package lists... 0%\r"]
[89.104914, "o", "\rReading package lists... 0%\r"]
[89.124611, "o", "\rReading package lists... 3%\r\rReading package lists... 3%\r"]
[89.142877, "o", "\rReading package lists... 4%\r"]
[89.143289, "o", "\rReading package lists... 4%\r"]
[89.404793, "o", "\rReading package lists... 38%\r\rReading package lists... 38%\r"]
[89.413332, "o", "\rReading package lists... 39%\r\rReading package lists... 39%\r"]
[89.48659, "o", "\rReading package lists... 49%\r\rReading package lists... 49%\r"]
[89.551112, "i", "sed -i 's/\"${totals_free_gb/./.}/\"${totals_free_gb}/' /home/user/storage_audit/process.sh\n"]
[89.551279, "o", "sed -i 's/\"${totals_free_gb/./.}/\"${totals_free_gb}/' /home/user/storage_audit/process.sh\r\n"]
[89.59323, "o", "\rReading package lists... 66%\r\rReading package lists... 66%\r"]
[89.642609, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[89.644395, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[89.646261, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[89.650738, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[89.677794, "o", "\rReading package lists... 79%\r\rReading package lists... 79%\r"]
[89.726487, "o", "\rReading package lists... 96%\r\rReading package lists... 96%\r"]
[89.728885, "i", "sed -i 's/\"${totals_usage_percent/./.}/\"${totals_usage_percent}/' /home/user/storage_audit/process.sh\n"]
[89.728982, "o", "sed -i 's/\"${totals_usage_percent/./.}/\"${totals_usage_percent}/' /home/user/storage_audit/process.sh\r\n"]
[89.735465, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[89.735901, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[89.741545, "o", "\rReading package lists... Done\r\r\n"]
[89.755564, "o", "\rBuilding dependency tree... 0%\r\rBuilding dependency tree... 0%\r"]
[89.817044, "o", "\rBuilding dependency tree... 15%\r"]
[89.836493, "o", "\rBuilding dependency tree... 50%\r\rBuilding dependency tree... 50%\r"]
[89.863035, "i", "sed -i 's/\"${total_monthly_cost/./.}/\"${total_monthly_cost}/' /home/user/storage_audit/process.sh\n"]
[89.863188, "o", "sed -i 's/\"${total_monthly_cost/./.}/\"${total_monthly_cost}/' /home/user/storage_audit/process.sh\r\n"]
[89.985616, "o", "\rBuilding dependency tree... Done\r\r\n\rReading state information... 0% \r\rReading state information... 0%\r"]
[89.985807, "o", "\rReading state information... Done\r\r\n"]
[90.122341, "o", "The following NEW packages will be installed:\r\n"]
[90.122797, "o", "  bc\r\n"]
[90.126198, "o", "0 upgraded, 1 newly installed, 0 to remove and 3 not upgraded.\r\nNeed to get 87.6 kB of archives.\r\nAfter this operation, 220 kB of additional disk space will be used.\r\n"]
[90.136141, "o", "\r0% [Working]"]
[90.217512, "i", "/home/user/storage_audit/validate.sh\n"]
[90.217647, "o", "/home/user/storage_audit/validate.sh\r\n"]
[90.534187, "o", "\r            \rGet:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 bc amd64 1.07.1-3build1 [87.6 kB]\r\n\r5% [1 bc 5421 B/87.6 kB 6%]"]
[90.739819, "o", "\r                           \r100% [Working]\r              \rFetched 87.6 kB in 1s (143 kB/s)\r\n"]
[90.860444, "o", "debconf: delaying package configuration, since apt-utils is not installed\r\n"]
[90.930783, "o", "Selecting previously unselected package bc.\r\n(Reading database ... \r"]
[90.933969, "o", "(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r"]
[90.934042, "o", "(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r"]
[90.936257, "o", "(Reading database ... 65%\r"]
[90.936992, "o", "(Reading database ... 70%\r"]
[90.938119, "o", "(Reading database ... 75%\r"]
[90.939162, "o", "(Reading database ... 80%\r"]
[90.93977, "o", "(Reading database ... 85%\r"]
[90.940302, "o", "(Reading database ... 90%\r"]
[90.94162, "o", "(Reading database ... 95%\r"]
[90.942244, "o", "(Reading database ... 100%\r(Reading database ... 10985 files and directories currently installed.)\r\n"]
[90.942659, "o", "Preparing to unpack .../bc_1.07.1-3build1_amd64.deb ...\r\n"]
[90.943479, "o", "Unpacking bc (1.07.1-3build1) ...\r\n"]
[90.974743, "o", "Setting up bc (1.07.1-3build1) ...\r\n"]
[91.002293, "o", "\u001b[?2004hroot@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
[92.03819, "i", "/home/user/storage_audit/process.sh\n"]
[92.038493, "o", "/home/user/storage_audit/process.sh\r\n\u001b[?2004l\r"]
[92.050175, "o", "Runtime error (func=(main), adr=9): Divide by zero\r\n"]
[92.052157, "o", "jq: invalid JSON text passed to --argjson\r\nUse jq --help for help with command-line options,\r\nor see the jq manpage, or online docs  at https://stedolan.github.io/jq\r\n"]
[92.055792, "o", "/home/user/storage_audit/summary/disk_usage_summary.json\r\n"]
[92.056148, "o", "\u001b[?2004h"]
[92.056206, "o", "root@fc10db9b-3606-4948-aaf1-a649a0cafb53:/home/user# "]
