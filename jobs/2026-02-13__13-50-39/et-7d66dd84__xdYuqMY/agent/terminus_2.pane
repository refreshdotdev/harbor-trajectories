[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:~# clear
[?2004l[H[J[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:~# cd /home/user
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user# mkdir -p projects/website
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user# cd projects/website
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > package.json << 'EOF'
[?2004l[?2004h> {
[?2004l[?2004h>   "name": "website",
[?2004l[?2004h>   "version": "1.2.3",
[?2004l[?2004h>   "description": "Main website project"
[?2004l[?2004h> }
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > config.xml << 'EOF'
[?2004l[?2004h> <?xml version="1.0" encoding="ISO-8859-1"?>
[?2004l[?2004h> <Configuration>
[?2004l[?2004h>   <Version>1.2.3</Version>
[?2004l[?2004h>   <Copyright>Â© 2024 Company Name</Copyright>
[?2004l[?2004h> </Configuration>
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > CHANGELOG.md << 'EOF'
[?2004l[?2004h> 
[?2004l[?2004h> ## [1.2.3] - 2024-05-15
[?2004l[?2004h> 
[?2004l[?2004h> ### Fixed
[?2004l[?2004h> 
[?2004l[?2004h> - Resolved CSS rendering issues
[?2004l[?2004h> 
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sed -i 's/^\s*//g; /^$/d' CHANGELOG.md
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# mkdir -p backups
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# gzip -c package.json > backups/package.json.bak.gz
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# export BUILD_USER="release-bot"
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# head -n 1 CHANGELOG.md | tr -d '\n' > /tmp/first_line.txt
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# md5sum /tmp/first_line.txt | cut -d' ' -f1 > /tmp/md5_hash.txt
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat /tmp/md5_hash.txt | xargs -I {} echo -n "{}1.3.0" | base64 > /tmp/release_token.txt
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# apt-get update && apt-get install -y jq
[?2004l0% [Working]            Hit:1 http://archive.ubuntu.com/ubuntu jammy InRelease
0% [Connecting to security.ubuntu.com (185.125.190.81)]                                                       Hit:2 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
0% [Connecting to security.ubuntu.com (185.125.190.81)]                                                       Hit:3 http://archive.ubuntu.com/ubuntu jammy-backports InRelease
0% [Connecting to security.ubuntu.com (185.125.190.81)]                                                       0% [Waiting for headers]                        Hit:4 http://security.ubuntu.com/ubuntu jammy-security InRelease
                        0% [Working]0% [Working]0% [Working]20% [Working]             Reading package lists... 0%Reading package lists... 0%Reading package lists... 0%Reading package lists... 3%Reading package lists... 3%Reading package lists... 4%Reading package lists... 4%Reading package lists... 38%Reading package lists... 38%Reading package lists... 39%Reading package lists... 39%Reading package lists... 49%Reading package lists... 49%Reading package lists... 66%Reading package lists... 66%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 79%Reading package lists... 79%Reading package lists... 96%Reading package lists... 96%Reading package lists... 99%Reading package lists... 99%Reading package lists... 99%Reading package lists... 99%Reading package lists... Done
Reading package lists... 0%Reading package lists... 0%Reading package lists... 0%Reading package lists... 3%Reading package lists... 3%Reading package lists... 4%Reading package lists... 4%Reading package lists... 38%Reading package lists... 38%Reading package lists... 39%Reading package lists... 39%Reading package lists... 49%Reading package lists... 49%Reading package lists... 66%Reading package lists... 66%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 70%Reading package lists... 79%Reading package lists... 79%Reading package lists... 96%Reading package lists... 96%Reading package lists... 99%Reading package lists... 99%Reading package lists... 99%Reading package lists... 99%Reading package lists... Done
Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 0%jq '.version = "1.3.0"' package.json > package.json.tmp && mv package.json.tmp package.json
Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... Done
Reading state information... 0% Reading state information... 4%Reading state information... Done
The following additional packages will be installed:
  libjq1 libonig5
The following NEW packages will be installed:
  jq libjq1 libonig5
0 upgraded, 3 newly installed, 0 to remove and 4 not upgraded.
Need to get 357 kB of archives.
After this operation, 1,087 kB of additional disk space will be used.
0% [Working]            Get:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 libonig5 amd64 6.9.7.1-2build1 [172 kB]
1% [1 libonig5 5,500 B/172 kB 3%]                                 45% [Working]             Get:2 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libjq1 amd64 1.6-2.1ubuntu3.1 [133 kB]
45% [2 libjq1 0 B/133 kB 0%]                            82% [Working]             Get:3 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 jq amd64 1.6-2.1ubuntu3.1 [52.5 kB]
82% [3 jq 0 B/52.5 kB 0%]sed -i 's/<Version>.*<\/Version>/<Version>1.3.0<\/Version>/' config.xml
                         100% [Working]              Fetched 357 kB in 0s (1,825 kB/s)
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libonig5:amd64.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 7568 files and directories currently installed.)
Preparing to unpack .../libonig5_6.9.7.1-2build1_amd64.deb ...
Unpacking libonig5:amd64 (6.9.7.1-2build1) ...
Selecting previously unselected package libjq1:amd64.
Preparing to unpack .../libjq1_1.6-2.1ubuntu3.1_amd64.deb ...
Unpacking libjq1:amd64 (1.6-2.1ubuntu3.1) ...
Selecting previously unselected package jq.
Preparing to unpack .../jq_1.6-2.1ubuntu3.1_amd64.deb ...
Unpacking jq (1.6-2.1ubuntu3.1) ...
Setting up libonig5:amd64 (6.9.7.1-2build1) ...
Setting up libjq1:amd64 (1.6-2.1ubuntu3.1) ...
Setting up jq (1.6-2.1ubuntu3.1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.11) ...
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sleep 3
[?2004ljq '.version = "1.3.0"' package.json > package.json.tmp && mv package.json.tmp package.json
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# jq '.version = "1.3.0"' package.json > package.json.tmp && mv package.json.tmp package.json
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sed -i 's/<Version>.*<\/Version>/<Version>1.3.0<\/Version>/' config.xml
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# grep '"version"' package.json
[?2004l  [01;31m[K"version"[m[K: "1.3.0",
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# grep '<Version>' config.xml
[?2004l  [01;31m[K<Version>[m[K1.3.0</Version>
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > CHANGELOG.md << 'EOF'
[?2004l[?2004h> 
[?2004l[?2004h> ## [1.3.0] - 2024-06-01
[?2004l[?2004h> 
[?2004l[?2004h> ### Added
[?2004l[?2004h> 
[?2004l[?2004h> - Implemented blog post search feature.
[?2004l[?2004h> 
[?2004l[?2004h> 
[?2004l[?2004h> 
[?2004l[?2004h> ## [1.2.3] - 2024-05-15
[?2004l[?2004h> 
[?2004l[?2004h> ### Fixed
[?2004l[?2004h> 
[?2004l[?2004h> - Resolved CSS rendering issues
[?2004l[?2004h> 
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sed -i -e '/^\r$/d' -e '/^$/d' CHANGELOG.md
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sed -i '1s/^/\n/' CHANGELOG.md
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sha256sum package.json > /tmp/package_sha256.txt
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sha256sum config.xml > /tmp/config_sha256.txt
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > release_manifest.json << 'EOF'
[?2004l[?2004h> {
[?2004l[?2004h>     "release_token": "$(cat /tmp/release_token.txt)",
[?2004l[?2004h>     "package_sha256": "$(cut -d' ' -f1 /tmp/package_sha256.txt)",
[?2004l[?2004h>     "config_sha256": "$(cut -d' ' -f1 /tmp/config_sha256.txt)",
[?2004l[?2004h>     "builder": "${BUILD_USER}"
[?2004l[?2004h> }
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# rm release_manifest.json
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "{
[?2004l[?2004h>     \"release_token\": \"$(cat /tmp/release_token.txt)\",
[?2004l[?2004h>     \"package_sha256\": \"$(cut -d' ' -f1 /tmp/package_sha256.txt)\",
[?2004l[?2004h>     \"config_sha256\": \"$(cut -d' ' -f1 /tmp/config_sha256.txt)\",
[?2004l[?2004h>     \"builder\": \"${BUILD_USER}\"
[?2004l[?2004h> }" > release_manifest.json
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "=== Verification ==="
[?2004l=== Verification ===
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "1. Backup exists:"
[?2004l1. Backup exists:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# ls -la backups/
[?2004ltotal 4
drwxr-xr-x 2 root root  33 Feb 13 18:59 [0m[01;34m.[0m
drwxrwxrwx 1 root root 108 Feb 13 19:00 [34;42m..[0m
-rw-r--r-- 1 root root 101 Feb 13 18:59 [01;31mpackage.json.bak.gz[0m
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "2. Package.json version:"
[?2004l2. Package.json version:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# grep '"version"' package.json
[?2004l  [01;31m[K"version"[m[K: "1.3.0",
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "3. Config.xml version:"
[?2004l3. Config.xml version:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# grep '<Version>' config.xml
[?2004l  [01;31m[K<Version>[m[K1.3.0</Version>
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "4. Config.xml encoding:"
[?2004l4. Config.xml encoding:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# grep -o 'encoding=[^ ]*' config.xml
[?2004l[01;31m[Kencoding="ISO-8859-1"?>[m[K
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "5. Changelog format:"
[?2004l5. Changelog format:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat -A CHANGELOG.md
[?2004l$
## [1.3.0] - 2024-06-01$
### Added$
- Implemented blog post search feature.$
## [1.2.3] - 2024-05-15$
### Fixed$
- Resolved CSS rendering issues$
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# echo "6. Manifest content:"
[?2004l6. Manifest content:
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat release_manifest.json
[?2004l{
    "release_token": "ZDhhZDQ1NGJiNWIyMjliYzE4YTExYTFmODNhYTY4MWIxLjMuMA==",
    "package_sha256": "401193b5a7e130c3cab0ae06404122bc8e2ef30f4e3c4c0aa924a80ae78ede14",
    "config_sha256": "f2f8dff5016f4c461cbbcf2fc4752434b48ddedf298d6b0da08d09976c492394",
    "builder": "release-bot"
}
[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# sed -i 's/$/\r/' CHANGELOG.md
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# rm release_manifest.json
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# cat > release_manifest.json << 'EOF'
[?2004l[?2004h> {
[?2004l[?2004h>     "release_token": "$(cat /tmp/release_token.txt)",
[?2004l[?2004h>     "package_sha256": "$(cut -d' ' -f1 /tmp/package_sha256.txt)",
[?2004l[?2004h>     "config_sha256": "$(cut -d' ' -f1 /tmp/config_sha256.txt)",
[?2004l[?2004h>     "builder": "${BUILD_USER}"
[?2004l[?2004h> }
[?2004l[?2004h> EOF
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# rm release_manifest.json
[?2004l[?2004hroot@a9071053-aced-47c1-8ac7-53cc4428855d:/home/user/projects/website# printf '{\n    "release_token": "'%s'",\n    "package_sha256": "'%s'",\n    "config_sha256": "'%s'",\n    "builder": "'%s"'\n}\n' \n  "$(cat /tmp/release_token.txt)" \\n  "$(cut -d' ' -f1 /tmp/package_sha256.txt)" \\n  "$(cut -d' ' -f1 /tmp/config_sha256.txt)" \\n  "${BUILD_USER}" > release_manifest.json
[?2004l[?2004h> echo "=== Final Verification ==="
[?2004l[?2004h> echo "1. Changelog CRLF verification:"
[?2004l[?2004h> head -c 2 CHANGELOG.md | od -c
[?2004l[?2004h> echo "2. Manifest structure:"
[?2004l[?2004h> cat release_manifest.json
[?2004l[?2004h> echo "=== Final Verification ==="
[?2004l[?2004h> echo "1. Changelog CRLF verification:"
[?2004l[?2004h> head -c 2 CHANGELOG.md | od -c
[?2004l[?2004h> echo "2. Config.xml encoding:"
[?2004l[?2004h> grep -o 'encoding=[^ ]*' config.xml
[?2004l[?2004h> echo "3. Manifest content:"
[?2004l[?2004h> cat release_manifest.json
[?2004l[?2004h> 