[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~# clear
[?2004l[H[J[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~# cd /home/user/k8s
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# ls -la
[?2004ltotal 0
drwxr-xr-x 1 root root 102 Feb 13 18:50 .
drwxr-xr-x 1 root root  49 Feb 13 19:08 ..
drwxr-xr-x 1 root root  10 Feb 13 18:50 audit
drwxr-xr-x 1 root root  77 Feb 13 18:50 config
drwxr-xr-x 1 root root  10 Feb 13 18:50 logs
drwxr-xr-x 1 root root  10 Feb 13 18:50 rendered
drwxr-xr-x 1 root root  41 Feb 13 18:50 templates
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# ls -la config/
[?2004ltotal 4
drwxr-xr-x 1 root root  77 Feb 13 18:50 .
drwxr-xr-x 1 root root 102 Feb 13 18:50 ..
-rw-r--r-- 1 root root   0 Feb 13 18:50 base.env
-rw-r--r-- 1 root root   0 Feb 13 18:50 defaults.env
-rw-r--r-- 1 root root  69 Feb 13 18:50 overlay.env
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# mkdir -p audit rendered logs
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat -v config/overlay.env
[?2004lM-oM-;M-?APP_NAME=titan_omega
ENVIRONMENT=prod_M-BM-'1
API_KEY=secret_agent_99
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# tail -c +5 config/overlay.env > config/overlay.env.cleaned
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat -v config/overlay.env.cleaned
[?2004lPP_NAME=titan_omega
ENVIRONMENT=prod_M-BM-'1
API_KEY=secret_agent_99
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export APP_NAME=$(grep -E '^APP_NAME=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export ENVIRONMENT=$(grep -E '^ENVIRONMENT=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export API_KEY=$(grep -E '^API_KEY=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "APP_NAME: '$APP_NAME'"
[?2004lAPP_NAME: ''
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "ENVIRONMENT: '$ENVIRONMENT'"
[?2004lENVIRONMENT: 'prod_ยง1'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "API_KEY: '$API_KEY'"
[?2004lAPI_KEY: 'secret_agent_99'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# sed -e 's/\xFF\xFE//g' -e 's/\xEF\xBB\xBF//g' config/overlay.env > config/overlay.env.cleaned
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export APP_NAME=$(grep '^APP_NAME=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export ENVIRONMENT=$(grep '^ENVIRONMENT=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export API_KEY=$(grep '^API_KEY=' config/overlay.env.cleaned | cut -d= -f2-)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "APP_NAME: '$APP_NAME'"
[?2004lAPP_NAME: 'titan_omega'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "ENVIRONMENT: '$ENVIRONMENT'"
[?2004lENVIRONMENT: 'prod_ยง1'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "API_KEY: '$API_KEY'"
[?2004lAPI_KEY: 'secret_agent_99'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export API_KEY_REVERSED=$(echo "$API_KEY" | rev)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export API_KEY_PROCESSED=$(echo "$API_KEY_REVERSED" | base64 | tr -d '\n')
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "API_KEY_REVERSED: '$API_KEY_REVERSED'"
[?2004lAPI_KEY_REVERSED: '99_tnega_terces'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "API_KEY_PROCESSED: '$API_KEY_PROCESSED'"
[?2004lAPI_KEY_PROCESSED: 'OTlfdG5lZ2FfdGVyY2VzCg=='
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export TEMPLATE_HASH=$(sha256sum templates/deployment.yaml.tpl | cut -c1-8)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "TEMPLATE_HASH: '$TEMPLATE_HASH'"
[?2004lTEMPLATE_HASH: 'e3b0c442'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat > audit/preflight.json <<EOF
[?2004l[?2004h> {"&quot;app_name&quot;:&quot;titan_omega&quot;,&quot;environment&quot;:&quot;prod_ยง1&quot;,&quot;api_key_processed&quot;:&quot;OTlfdG5lZ2FfdGVyY2VzCg==&quot;,&quot;template_hash&quot;:&quot;e3b0c442&quot;}
[?2004l[?2004h> EOF
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat audit/preflight.json
[?2004l{"&quot;app_name&quot;:&quot;titan_omega&quot;,&quot;environment&quot;:&quot;prod_ยง1&quot;,&quot;api_key_processed&quot;:&quot;OTlfdG5lZ2FfdGVyY2VzCg==&quot;,&quot;template_hash&quot;:&quot;e3b0c442&quot;}
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c audit/preflight.json
[?2004l207 audit/preflight.json
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# rm audit/preflight.json
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# printf '{"app_name":"titan_omega","environment":"prod_ยง1","api_key_processed":"OTlfdG5lZ2FfdGVyY2VzCg==","template_hash":"e3b0c442"}' > audit/preflight.json
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat audit/preflight.json
[?2004l{"app_name":"titan_omega","environment":"prod_ยง1","api_key_processed":"OTlfdG5lZ2FfdGVyY2VzCg==","template_hash":"e3b0c442"}[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c audit/preflight.json
[?2004l125 audit/preflight.json
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export API_KEY_SPECIAL="$API_KEY_PROCESSED"
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export TEMPLATE_HASH="$TEMPLATE_HASH"
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# envsubst < templates/deployment.yaml.tpl | unix2dos > rendered/deployment.yaml
[?2004lbash: unix2dos: command not found
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# file rendered/deployment.yaml
[?2004lbash: file: command not found
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat rendered/deployment.yaml
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat > rendered/deployment.yaml <<EOF
[?2004l[?2004h> apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: ${APP_NAME}\r\n  labels:\r\n    app: ${APP_NAME}\r\n    env: ${ENVIRONMENT}\r\nspec:\r\n  replicas: 1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: ${APP_NAME}\r\n    spec:\r\n      containers:\r\n      - name: main\r\n        image: nginx:alpine\r\n        env:\r\n        - name: API_KEY\r\n          value: "${API_KEY_SPECIAL}"\r\n        - name: TEMPLATE_HASH\r\n          value: "${TEMPLATE_HASH}"
[?2004l[?2004h> EOF
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat -v rendered/deployment.yaml
[?2004lapiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: titan_omega\r\n  labels:\r\n    app: titan_omega\r\n    env: prod_M-BM-'1\r\nspec:\r\n  replicas: 1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: titan_omega\r\n    spec:\r\n      containers:\r\n      - name: main\r\n        image: nginx:alpine\r\n        env:\r\n        - name: API_KEY\r\n          value: "OTlfdG5lZ2FfdGVyY2VzCg=="\r\n        - name: TEMPLATE_HASH\r\n          value: "e3b0c442"
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c rendered/deployment.yaml
[?2004l478 rendered/deployment.yaml
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export PREFLIGHT_HASH=$(md5sum audit/preflight.json | cut -d' ' -f1)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# export MANIFEST_HASH=$(sha256sum rendered/deployment.yaml | cut -d' ' -f1)
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "PREFLIGHT_HASH: '$PREFLIGHT_HASH'"
[?2004lPREFLIGHT_HASH: '43fbefa8a10810ff2ec72db5389343e1'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "MANIFEST_HASH: '$MANIFEST_HASH'"
[?2004lMANIFEST_HASH: '7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12'
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat > logs/render.log <<EOF
[?2004l[?2004h> APP_NAME=titan_omega
[?2004l[?2004h> ENVIRONMENT=prod_ยง1
[?2004l[?2004h> PREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1
[?2004l[?2004h> MANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12
[?2004l[?2004h> EOF
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# iconv -f UTF-8 -t ISO-8859-1 logs/render.log > logs/render.log.iso88591
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# mv logs/render.log.iso88591 logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat logs/render.log
[?2004lAPP_NAME=titan_omega
ENVIRONMENT=prod_ง1
PREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1
MANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c logs/render.log
[?2004l168 logs/render.log
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# file -bi logs/render.log
[?2004lbash: file: command not found
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo -e "APP_NAME=titan_omega\nENVIRONMENT=prod_\xA7\n1\nPREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1\nMANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12" > logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# iconv -f UTF-8 -t ISO-8859-1 logs/render.log > logs/render.log.iso88591
[?2004liconv: illegal input sequence at position 38
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# mv logs/render.log.iso88591 logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat logs/render.log
[?2004lAPP_NAME=titan_omega
ENVIRONMENT=prod_[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c logs/render.log
[?2004l38 logs/render.log
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# rm logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# printf "APP_NAME=titan_omega\nENVIRONMENT=prod_ยง1\nPREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1\nMANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12\n" > logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# iconv -f UTF-8 -t ISO-8859-1 logs/render.log > logs/render.log.iso88591
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# mv logs/render.log.iso88591 logs/render.log
[?2004l[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat logs/render.log
[?2004lAPP_NAME=titan_omega
ENVIRONMENT=prod_ง1
PREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1
MANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# wc -c logs/render.log
[?2004l168 logs/render.log
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "=== Verification of Deliverables ==="
[?2004l=== Verification of Deliverables ===
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "1. Pre-flight JSON:"
[?2004l1. Pre-flight JSON:
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat audit/preflight.json
[?2004l{"app_name":"titan_omega","environment":"prod_ยง1","api_key_processed":"OTlfdG5lZ2FfdGVyY2VzCg==","template_hash":"e3b0c442"}[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "Size: $(wc -c < audit/preflight.json) bytes"
[?2004lSize: 125 bytes
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo ""
[?2004l
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "2. Rendered Manifest:"
[?2004l2. Rendered Manifest:
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat -v rendered/deployment.yaml
[?2004lapiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: titan_omega\r\n  labels:\r\n    app: titan_omega\r\n    env: prod_M-BM-'1\r\nspec:\r\n  replicas: 1\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: titan_omega\r\n    spec:\r\n      containers:\r\n      - name: main\r\n        image: nginx:alpine\r\n        env:\r\n        - name: API_KEY\r\n          value: "OTlfdG5lZ2FfdGVyY2VzCg=="\r\n        - name: TEMPLATE_HASH\r\n          value: "e3b0c442"
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "Size: $(wc -c < rendered/deployment.yaml) bytes"
[?2004lSize: 478 bytes
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo ""
[?2004l
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "3. Deployment Log:"
[?2004l3. Deployment Log:
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# cat logs/render.log
[?2004lAPP_NAME=titan_omega
ENVIRONMENT=prod_ง1
PREFLIGHT_HASH=43fbefa8a10810ff2ec72db5389343e1
MANIFEST_HASH=7cfe8221a3cdd68ed52495ec59a3f8b418382d69dee8c344f88a8837d4c0eb12
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# echo "Size: $(wc -c < logs/render.log) bytes"
[?2004lSize: 168 bytes
[?2004hroot@0f971dc2-bfc7-43c6-980c-90cefafc3535:~/k8s# 