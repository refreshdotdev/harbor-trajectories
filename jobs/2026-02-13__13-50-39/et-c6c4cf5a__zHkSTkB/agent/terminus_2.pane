[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# clear
[?2004l[H[J[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# grep -E "^(ROOT_DIR|REPORT_PATH) =" /etc/oldguard/scanner.ini | awk -F'=' '{print $2}' | tr -d ' 
[?2004l[?2004h> '
[?2004l/home/user/release/home/user/audit/scan_report.dat[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# ROOT_DIR="/home/user/release" && REPORT_PATH="/home/user/audit/scan_report.dat"
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# test -d "$ROOT_DIR" && echo "ROOT_DIR exists" || echo "ROOT_DIR does not exist."
[?2004lROOT_DIR exists
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# WORLD_WRITABLE_FILES=$(find "$ROOT_DIR" -type f -not -path "*/.*" -perm -o=w ! -type l -exec ls -l {} \; | sort -k 5 -n -r -s | awk '{$1=$2=$3=$4=""; print $0}' | xargs -I {} find $(dirname '{}') -samefile '{}' | sort -k1,1nr -k2,2)
[?2004lfind: ‚Äò100 Feb 13 18:51 /home/user/release/src/z_large_ww.txt‚Äô: No such file or directory
find: ‚Äò100 Feb 13 18:51 /home/user/release/src/large_ww.txt‚Äô: No such file or directory
find: ‚Äò50 Feb 13 18:51 /home/user/release/src/small_ww.txt‚Äô: No such file or directory
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# find "$ROOT_DIR" -type f -not -path '*/.*' -perm -o=w ! -type l -print0 | xargs -0 ls -l > /tmp/ww_find_output.txt
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# WORLD_WRITABLE_FORMATTED=$(awk 'NR>1 {print $5 "  " $9}' /tmp/ww_find_output.txt | sort -k1,1nr -k2,2)
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo "=== World Writable Files (Preview) ===" && echo "$WORLD_WRITABLE_FORMATTED" | head -3
[?2004l=== World Writable Files (Preview) ===
100  /home/user/release/src/z_large_ww.txt
50  /home/user/release/src/small_ww.txt
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# TODO_HITS=$(find "$ROOT_DIR" -type f \( -name "*.py" -o -name "*.log" \) -not -path '*/.*' -size -10k -exec grep -Hn --text "TODO" {} \; | grep -v "NO_FIX" | awk -F: '{rel_path=""; sub("$ROOT_DIR/", "/", $1); if (sub("^/", "", rel_path) || 1) {print rel_path " [" $2 "] " substr($0, index($0,$3))}}' | sort -k1,1 -k2,2n)
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo "=== TODO Hits (Preview) ===" && echo "$TODO_HITS" | head -3
[?2004l=== TODO Hits (Preview) ===
 [1] def foo(): pass # TODO: Implement this function
 [1] # TODO: Fix the bug üêõ in the logic
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# BUILD_ID=${BUILD_ID:-"unknown_build_id"} && echo "BUILD_ID is: ${BUILD_ID}"
[?2004lBUILD_ID is: CI-BUILD-9942
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# REPORT_CONTENT_SANITIZED=$(cat << EOF
[?2004l[?2004h> SCAN_ID: ${BUILD_ID}
[?2004l[?2004h> -----BEGIN WORLD_WRITABLE-----
[?2004l[?2004h> ${WORLD_WRITABLE_FORMATTED}
[?2004l[?2004h> -----END WORLD_WRITABLE-----
[?2004l[?2004h> 
[?2004l[?2004h> -----BEGIN TODO_LINES-----
[?2004l[?2004h> ${TODO_HITS}
[?2004l[?2004h> -----END TODO_LINES-----
[?2004l[?2004h> EOF
[?2004l[?2004h> )
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo -n "${REPORT_CONTENT_SANITIZED}" | iconv -f UTF-8 -t ISO-8859-1//TRANSLIT > "${REPORT_PATH}"
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# REPORT_BODY=$(head -n -1 "${REPORT_PATH}")
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# REPORT_CHECKSUM=$(echo -n "${REPORT_BODY}" | md5sum | awk '{print $1}')
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo "MD5: ${REPORT_CHECKSUM}" >> "${REPORT_PATH}"
[?2004l[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo "=== Report Verification (First and Last Few Lines) ===" && head -3 "${REPORT_PATH}" && echo "..." && tail -2 "${REPORT_PATH}"
[?2004l=== Report Verification (First and Last Few Lines) ===
SCAN_ID: CI-BUILD-9942
-----BEGIN WORLD_WRITABLE-----
100  /home/user/release/src/z_large_ww.txt
...
 [1] # TODO: Fix the bug ? in the logic
-----END TODO_LINES-----MD5: cb5800630a8c4ae3853a967379738ba9
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# echo "{\"status\": \"complete\", \"report_file\": \"${REPORT_PATH}\"}" || echo '{"status": "error", "report_file": "${REPORT_PATH}", "message": "Failed to write JSON status"}'
[?2004l{"status": "complete", "report_file": "/home/user/audit/scan_report.dat"}
[?2004hroot@0d99e65e-9fae-42cb-8d2f-048d2ac05b23:~# 