[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:~# clear
[?2004l[H[J[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:~# cd /home/user/etl_workspace
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# ls -la
[?2004ltotal 0
drwxrwxrwx 1 root root  49 Feb 13 18:50 [0m[34;42m.[0m
drwxr-xr-x 1 root root  35 Feb 13 18:50 [01;34m..[0m
drwxrwxrwx 1 root root  10 Feb 13 18:50 [34;42mbackups[0m
drwxrwxrwx 1 root root 181 Jan  1  2020 [34;42mincoming[0m
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# mkdir -p backups
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# mkdir -p tmp_archive_staging
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# ls -la incoming/
[?2004ltotal 24
drwxrwxrwx 1 root root 181 Jan  1  2020 [0m[34;42m.[0m
drwxrwxrwx 1 root root  41 Feb 13 18:53 [34;42m..[0m
-rw-rw-rw- 1 root root  42 Apr  1  2023 config.json
drwxrwxrwx 1 root root  75 Jan  1  2020 [34;42mextras[0m
-rw-rw-rw- 1 root root  22 Jan  1  2020 february.csv
-rw-rw-rw- 1 root root  22 Jan  1  2023 january.csv
lrwxrwxrwx 1 root root   9 Jan  1  2020 [01;36mlatest.csv[0m -> march.csv
-rw-rw-rw- 1 root root  22 Mar  1  2023 march.csv
-rw-rw-rw- 1 root root   8 Jan  1  2020 .meta
drwxrwxrwx 1 root root  47 Jan  1  2020 [34;42mstaging[0m
-rw-rw-rw- 1 root root  15 Jan  1  2020 temp_cache.log
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# mkdir -p tmp_archive_staging/incoming
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cp -p incoming/.meta tmp_archive_staging/incoming/
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cp -p incoming/january.csv tmp_archive_staging/incoming/
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cp -p incoming/february.csv tmp_archive_staging/incoming/
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# sed -e 's/,\s*\($\|\s*\)\s*\}/}' -e 's/,\s*\($\|\s*\)\s*\]$/]/' incoming/config.json > tmp_archive_staging/incoming/config.json
[?2004lsed: -e expression #1, char 23: unterminated `s' command
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# iconv -f ISO-8859-1 -t UTF-8 incoming/march.csv > tmp_archive_staging/incoming/march.csv
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# touch -r incoming/config.json tmp_archive_staging/incoming/config.json
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# touch -r incoming/march.csv tmp_archive_staging/incoming/march.csv
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# sed -e 's/,\s*\($\|[^{}]\)\s*\}/}' -e 's/,\s*\($\|[^\[\]]\)\s*\]$/]/' incoming/config.json > tmp_archive_staging/incoming/config.json
[?2004lsed: -e expression #1, char 25: unterminated `s' command
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# jq . tmp_archive_staging/incoming/config.json
[?2004lbash: jq: command not found
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cp -P incoming/latest.csv tmp_archive_staging/incoming/
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# sed -e 's/,[ \t]*\([}][^}]*\)$/\1/' -e 's/,[ \t]*\([}]\)$/\1/' incoming/config.json > tmp_archive_staging/incoming/config.json
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat tmp_archive_staging/incoming/config.json
[?2004l{
    "source": "web",
    "retries": 3,
}[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# find tmp_archive_staging/incoming -type f -exec sha256sum {} \; | sed 's|tmp_archive_staging/incoming/||' > /tmp/sha_sums.txt
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat /tmp/sha_sums.txt
[?2004l45447b7afbd5e544f7d0f1df0fccd26014d9850130abd3f020b89ff96b82079f  .meta
92e92af2b348dcf1480bf9d4e9fc5fb157e00a3ce4ef0623021b04776e076a25  january.csv
37e802a43a59b3e68c810c607801e7748d1e174c14bc79465237bcc7a8068468  february.csv
a885725dfeb89ab95aecd26ae4314cd9a02d521085544a7f66e976af712258f0  config.json
8f7325b7da9c54a9b9a5e997a9668adf1d60dd46b0911ebc326136dd3c65d00e  march.csv
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# awk -F" " '{print "\"" $2 "\": \"" $1 "\""}' /tmp/sha_sums.txt | jq -s -c '. | add | to_entries | sort_by(.key) | map({key: .key, value: .value}) | from_entries' | jq . > backups/manifest.json
[?2004lbash: jq: command not found
awk: close failed on file /dev/stdout (Broken pipe)
bash: jq: command not found
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat backups/manifest.json
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# awk -F" " 'BEGIN {print "{"} {printf "\"%s\": \"%s\"", $2, $1} END {printf "\n}"}' /tmp/sha_sums.txt | sed '1d;$d;s/,/,
[?2004l[?2004h> /g' | awk 'BEGIN {print "{"} {printf "  \"%s\": \"%s\"", $1, $2} END {print "}"}' | sed 's/}, {/,/g' | sed 's/^  "/    "/g' > backups/manifest.json
[?2004lsed: -e expression #1, char 11: unterminated `s' command
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat backups/manifest.json
[?2004l{
}
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# awk -F" " 'BEGIN {print "{"} {printf "    \"%s\": \"%s\"", $2, $1;} END {print "}"}' /tmp/sha_sums.txt | sed 's/} {/,/g' > backups/manifest.json
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat backups/manifest.json
[?2004l{
    ".meta": "45447b7afbd5e544f7d0f1df0fccd26014d9850130abd3f020b89ff96b82079f"    "january.csv": "92e92af2b348dcf1480bf9d4e9fc5fb157e00a3ce4ef0623021b04776e076a25"    "february.csv": "37e802a43a59b3e68c810c607801e7748d1e174c14bc79465237bcc7a8068468"    "config.json": "a885725dfeb89ab95aecd26ae4314cd9a02d521085544a7f66e976af712258f0"    "march.csv": "8f7325b7da9c54a9b9a5e997a9668adf1d60dd46b0911ebc326136dd3c65d00e"}
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# find tmp_archive_staging/incoming -type f -printf '%%T@ %p\n' | sort -nr | head -1 | cut -d' ' -f2- | xargs -I {} stat -c '%Y' {} > /tmp/newest_time.txt
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# cat /tmp/newest_time.txt
[?2004l1577880000
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# tar -czvf backups/incoming_backup.tar.gz -C tmp_archive_staging/incoming .
[?2004l./
./.meta
./january.csv
./february.csv
./config.json
./march.csv
./latest.csv
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# touch -m -d @$(cat /tmp/newest_time.txt) backups/incoming_backup.tar.gz
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# tar -tzf backups/incoming_backup.tar.gz
[?2004l./
./.meta
./january.csv
./february.csv
./config.json
./march.csv
./latest.csv
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# ls -la backups/
[?2004ltotal 8
drwxrwxrwx 1 root root  57 Feb 13 18:55 [0m[34;42m.[0m
drwxrwxrwx 1 root root  60 Feb 13 18:53 [34;42m..[0m
-rw-r--r-- 1 root root 384 Jan  1  2020 [01;31mincoming_backup.tar.gz[0m
-rw-r--r-- 1 root root 422 Feb 13 18:54 manifest.json
[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# rm -rf tmp_archive_staging/
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# rm /tmp/sha_sums.txt /tmp/newest_time.txt
[?2004l[?2004hroot@5019f0b4-191d-4aef-95f1-9671ae925d4a:/home/user/etl_workspace# 