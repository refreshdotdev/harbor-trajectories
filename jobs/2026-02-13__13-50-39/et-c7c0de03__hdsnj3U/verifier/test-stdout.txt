downloading uv 0.9.5 x86_64-unknown-linux-gnu
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Downloading cpython-3.12.12-linux-x86_64-gnu (download) (31.1MiB)
 Downloading cpython-3.12.12-linux-x86_64-gnu (download)
Downloading pygments (1.2MiB)
 Downloading pygments
Installed 5 packages in 35ms
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.1, pluggy-1.6.0 -- /root/.cache/uv/archive-v0/k9Nj-h82aFV3H9FQlJVMZ/bin/python
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 8 items

../../tests/test_final_state.py::test_archive_and_manifest_exist PASSED  [ 12%]
../../tests/test_final_state.py::test_march_csv_transcoded FAILED        [ 25%]
../../tests/test_final_state.py::test_config_json_sanitized FAILED       [ 37%]
../../tests/test_final_state.py::test_exclusions PASSED                  [ 50%]
../../tests/test_final_state.py::test_hidden_files_logic FAILED          [ 62%]
../../tests/test_final_state.py::test_manifest_correctness FAILED        [ 75%]
../../tests/test_final_state.py::test_timestamp_preservation_on_modified_files FAILED [ 87%]
../../tests/test_final_state.py::test_archive_mtime_is_newest_file FAILED [100%]

=================================== FAILURES ===================================
__________________________ test_march_csv_transcoded ___________________________

extracted_archive = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0')

    def test_march_csv_transcoded(extracted_archive):
        # Source was Latin-1, Archive must be UTF-8
        target = extracted_archive / "incoming/march.csv"
>       assert target.exists()
E       AssertionError: assert False
E        +  where False = exists()
E        +    where exists = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0/incoming/march.csv').exists

/tests/test_final_state.py:37: AssertionError
__________________________ test_config_json_sanitized __________________________

extracted_archive = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0')

    def test_config_json_sanitized(extracted_archive):
        target = extracted_archive / "incoming/config.json"
>       assert target.exists()
E       AssertionError: assert False
E        +  where False = exists()
E        +    where exists = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0/incoming/config.json').exists

/tests/test_final_state.py:49: AssertionError
___________________________ test_hidden_files_logic ____________________________

extracted_archive = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0')

    def test_hidden_files_logic(extracted_archive):
        # .meta in root -> INCLUDED
>       assert (extracted_archive / "incoming/.meta").exists(), ".meta in root should be included"
E       AssertionError: .meta in root should be included
E       assert False
E        +  where False = exists()
E        +    where exists = (PosixPath('/tmp/pytest-of-root/pytest-0/extracted0') / 'incoming/.meta').exists

/tests/test_final_state.py:70: AssertionError
__________________________ test_manifest_correctness ___________________________

extracted_archive = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0')

    def test_manifest_correctness(extracted_archive):
        with open(MANIFEST) as f:
>           manifest = json.load(f)
                       ^^^^^^^^^^^^

/tests/test_final_state.py:77: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/json/__init__.py:293: in load
    return loads(fp.read(),
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/json/__init__.py:346: in loads
    return _default_decoder.decode(s)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/json/decoder.py:338: in decode
    obj, end = self.raw_decode(s, idx=_w(s, 0).end())
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <json.decoder.JSONDecoder object at 0x71540a72b1d0>
s = '{\n    ".meta": "45447b7afbd5e544f7d0f1df0fccd26014d9850130abd3f020b89ff96b82079f"    "january.csv": "92e92af2b348dcf...02d521085544a7f66e976af712258f0"    "march.csv": "8f7325b7da9c54a9b9a5e997a9668adf1d60dd46b0911ebc326136dd3c65d00e"}\n'
idx = 0

    def raw_decode(self, s, idx=0):
        """Decode a JSON document from ``s`` (a ``str`` beginning with
        a JSON document) and return a 2-tuple of the Python
        representation and the index in ``s`` where the document ended.
    
        This can be used to decode a JSON document from a string that may
        have extraneous data at the end.
    
        """
        try:
>           obj, end = self.scan_once(s, idx)
                       ^^^^^^^^^^^^^^^^^^^^^^
E           json.decoder.JSONDecodeError: Expecting ',' delimiter: line 2 column 84 (char 85)

/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/json/decoder.py:354: JSONDecodeError
________________ test_timestamp_preservation_on_modified_files _________________

extracted_archive = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0')

    def test_timestamp_preservation_on_modified_files(extracted_archive):
        # march.csv was modified (transcoded), but should keep original mtime (2023-03-01)
        archived_march = extracted_archive / "incoming/march.csv"
        # We allow a small epsilon for filesystem weirdness, but it shouldn't be "now"
        # 2023-03-01 12:00:00 is 1677672000
>       mtime = archived_march.stat().st_mtime
                ^^^^^^^^^^^^^^^^^^^^^

/tests/test_final_state.py:104: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = PosixPath('/tmp/pytest-of-root/pytest-0/extracted0/incoming/march.csv')

    def stat(self, *, follow_symlinks=True):
        """
        Return the result of the stat() system call on this path, like
        os.stat() does.
        """
>       return os.stat(self, follow_symlinks=follow_symlinks)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       FileNotFoundError: [Errno 2] No such file or directory: '/tmp/pytest-of-root/pytest-0/extracted0/incoming/march.csv'

/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/pathlib.py:840: FileNotFoundError
______________________ test_archive_mtime_is_newest_file _______________________

    def test_archive_mtime_is_newest_file():
        # The newest file in the set is config.json (April 1st 2023)
        # The archive itself should have this mtime
        archive_mtime = ARCHIVE.stat().st_mtime
>       assert 1680350000 < archive_mtime < 1680355000, "Archive file mtime does not match the newest file inside it"
E       AssertionError: Archive file mtime does not match the newest file inside it
E       assert 1680350000 < 1577880000.0

/tests/test_final_state.py:111: AssertionError
=========================== short test summary info ============================
FAILED ../../tests/test_final_state.py::test_march_csv_transcoded - Assertion...
FAILED ../../tests/test_final_state.py::test_config_json_sanitized - Assertio...
FAILED ../../tests/test_final_state.py::test_hidden_files_logic - AssertionEr...
FAILED ../../tests/test_final_state.py::test_manifest_correctness - json.deco...
FAILED ../../tests/test_final_state.py::test_timestamp_preservation_on_modified_files
FAILED ../../tests/test_final_state.py::test_archive_mtime_is_newest_file - A...
========================= 6 failed, 2 passed in 0.06s ==========================
