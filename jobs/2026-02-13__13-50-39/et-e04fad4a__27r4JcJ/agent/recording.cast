{"version": 2, "width": 160, "height": 40, "timestamp": 1771009177, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.007984, "o", "\u001b[?2004h"]
[0.00861, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user# "]
[0.961035, "i", "clear\r"]
[0.961216, "o", "clear\r\n\u001b[?2004l\r"]
[0.96248, "o", "\u001b[H\u001b[J"]
[0.962707, "o", "\u001b[?2004h"]
[0.96273, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user# "]
[12.235661, "i", "mkdir -p /home/user/cert_analysis\n"]
[12.236061, "o", "mkdir -p /home/user/cert_analysis\r\n\u001b[?2004l\r"]
[12.248924, "o", "\u001b[?2004h"]
[12.249008, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user# "]
[12.327804, "i", "cd /home/user/certs_incoming\n"]
[12.328055, "o", "cd /home/user/certs_incoming\r\n\u001b[?2004l\r"]
[12.328253, "o", "\u001b[?2004h"]
[12.328284, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user/certs_incoming# "]
[19.978673, "i", "ls -la\n"]
[19.978844, "o", "ls -la\r\n\u001b[?2004l\r"]
[19.980325, "o", "total 0\r\n"]
[19.980398, "o", "drwxr-xr-x 1 1000 1000 109 Feb 12 23:59 \u001b[0m\u001b[01;34m.\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  35 Feb 13 18:59 \u001b[01;34m..\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  73 Feb 12 23:59 \u001b[01;34mbroken\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  65 Feb 12 23:59 \u001b[01;34mdb\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  45 Feb 12 23:59 \u001b[01;34mghost\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  71 Feb 12 23:59 \u001b[01;34mlegacy\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  61 Feb 12 23:59 \u001b[01;34mweb\u001b[0m\r\ndrwxr-xr-x 1 1000 1000  73 Feb 12 23:59 \u001b[01;34mweird\u001b[0m\r\n"]
[19.980623, "o", "\u001b[?2004h"]
[19.980636, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user/certs_incoming# "]
[29.706129, "i", "find . -name \"*.meta\" -print\n"]
[29.706249, "o", "find . -name \"*.meta\" -print\r\n\u001b[?2004l\r"]
[29.708405, "o", "./broken/server_bad_hash.meta\r\n"]
[29.708474, "o", "./db/server_soon.meta\r\n"]
[29.708487, "o", "./ghost/server_missing_crt.meta\r\n"]
[29.708529, "o", "./legacy/server_expired.meta\r\n"]
[29.708569, "o", "./web/server_ok.meta\r\n"]
[29.70861, "o", "./weird/server_bad_date.meta\r\n"]
[29.708938, "o", "\u001b[?2004h"]
[29.70895, "o", "root@291289b1-48f3-4fe5-8785-032bb0293e75:/home/user/certs_incoming# "]
[65.723803, "i", "cat > /tmp/process_certs.sh << 'EOF'\n#!/bin/bash\n\n# Initialize output files\nCSV_HEADER=\"filename,subject,issuer,not_before,not_after,days_until_expiry,status\"\necho \"$CSV_HEADER\" > /home/user/cert_analysis/expiring_certs.csv\ntouch /home/user/cert_analysis/analysis.log\ntouch /home/user/cert_analysis/errors.json\n\n# Function to validate date format (YYYY-MM-DD)\nvalidate_date() {\n    if [[ ! $1 =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then\n        return 1\n    fi\n    return 0\n}\n\n# Get current date for calculating days until expiry\ntoday=$(date +%Y-%m-%d)\n\n# Process each .meta file\nfor meta_file in $(find . -name \"*.meta\"); do\n    # Extract base filename without extension\n    base_name=$(basename \"$meta_file\" .meta)\n    crt_file=\"${meta_file%.meta}.crt\"\n    \n    # Check if corresponding .crt file exists\n    if [ ! -f \"$crt_file\" ]; then\n        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"MISSING_CRT\\\"}\" >> /home/user/cert_analysis/errors.json\n        # Ensure proper JSON array formatting by removing last comma la"]
[65.723985, "i", "ter\n        continue\n    fi\n    \n    # Read metadata from .meta file\n    if [ ! -f \"$meta_file\" ]; then\n        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"MISSING_META_FILE\\\"}\" >> /home/user/cert_analysis/errors.json\n        continue\n    fi\n    \n    # Read and parse the metadata line\n    IFS='|' read -r subject issuer not_before not_after checksum < \"$meta_file\"\n    \n    # Validate date formats\n    if ! validate_date \"$not_before\" || ! validate_date \"$not_after\"; then\n        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"INVALID_DATE\\\"}\" >> /home/user/cert_analysis/errors.json\n        continue\n    fi\n    \n    # Calculate checksum of .crt file and compare\n    crt_checksum=$(sha256sum \"$crt_file\" | awk '{print $1}')\n    if [ \"$crt_checksum\" != \"$checksum\" ]; then\n        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"CHECKSUM_MISMATCH\\\"}\" >> /home/user/cert_analysis/errors.json\n        continue\n    fi\n    \n    # Calculate days until expiry\n    days_until_expiry=$(date -d \"$not_after\" +%s -d \"$t"]
[65.724038, "i", "oday\" +%s | awk '{print ($1 - $2)/86400}')\n    \n    # Determine status based on days remaining\n    if [ \"$days_until_expiry\" -gt 30 ]; then\n        status=\"OK\"\n    elif [ \"$days_until_expiry\" -ge 0 ]; then\n        status=\"EXPIRING_SOON\"\n    else\n        status=\"EXPIRED\"\n    fi\n    \n    # Append valid certificate to CSV\n    echo \"$base_name,$subject,$issuer,$not_before,$not_after,$days_until_expiry,$status\" >> /home/user/cert_analysis/expiring_certs.csv\n    \n    # Log the processed certificate\n    timestamp=$(date +\"%Y-%m-%d %H:%M:%S\")\n    echo \"$timestamp Processed $base_name - $status\" >> /home/user/cert_analysis/analysis.log\ndone\n\n# Clean up JSON file by removing trailing comma and adding proper array formatting\nsed -i '1s/^/[/;$s/,$/]/' /home/user/cert_analysis/errors.json\n\n# Sort CSV by days_until_expiry ascending\nsort -t, -k5n /home/user/cert_analysis/expiring_certs.csv -o /home/user/cert_analysis/expiring_certs.csv\nEOF"]
[65.724136, "o", "cat > /tmp/process_certs.sh << 'EOF'\r\n"]
[65.724177, "o", "\u001b[?2004l\r"]
[65.724226, "o", "\u001b[?2004h"]
[65.724265, "o", "> "]
[65.724334, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[65.724375, "o", "\u001b[?2004h"]
[65.724413, "o", "> \r\n\u001b[?2004l\r"]
[65.724451, "o", "\u001b[?2004h> "]
[65.724613, "o", "# Initialize output files\r\n\u001b[?2004l\r"]
[65.724669, "o", "\u001b[?2004h"]
[65.724708, "o", "> "]
[65.725223, "o", "CSV_HEADER=\"filename,subject,issuer,not_before,not_after,days_until_expiry,status\"\r\n\u001b[?2004l\r"]
[65.725272, "o", "\u001b[?2004h> "]
[65.725683, "o", "echo \"$CSV_HEADER\" > /home/user/cert_analysis/expiring_certs.csv\r\n\u001b[?2004l\r"]
[65.72578, "o", "\u001b[?2004h> "]
[65.726091, "o", "touch /home/user/cert_analysis/analysis.log\r\n\u001b[?2004l\r"]
[65.726147, "o", "\u001b[?2004h"]
[65.726185, "o", "> "]
[65.726471, "o", "touch /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.726505, "o", "\u001b[?2004h"]
[65.726537, "o", "> \r\n"]
[65.726569, "o", "\u001b[?2004l\r"]
[65.726602, "o", "\u001b[?2004h> "]
[65.726979, "o", "# Function to validate date format (YYYY-MM-DD)\r\n\u001b[?2004l\r"]
[65.727024, "o", "\u001b[?2004h> "]
[65.727181, "o", "validate_date() {\r\n\u001b[?2004l\r"]
[65.727215, "o", "\u001b[?2004h"]
[65.727248, "o", "> "]
[65.727629, "o", "    if [[ ! $1 =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then\r\n\u001b[?2004l\r"]
[65.727669, "o", "\u001b[?2004h"]
[65.727702, "o", "> "]
[65.727835, "o", "        return 1\r\n\u001b[?2004l\r"]
[65.727868, "o", "\u001b[?2004h"]
[65.727914, "o", "> "]
[65.727976, "o", "    fi\r\n\u001b[?2004l\r"]
[65.728023, "o", "\u001b[?2004h"]
[65.728055, "o", "> "]
[65.72816, "o", "    return 0\r\n\u001b[?2004l\r"]
[65.728192, "o", "\u001b[?2004h"]
[65.728226, "o", "> "]
[65.728253, "o", "}\r\n\u001b[?2004l\r"]
[65.728289, "o", "\u001b[?2004h"]
[65.728321, "o", "> \r\n\u001b[?2004l\r"]
[65.728375, "o", "\u001b[?2004h"]
[65.728407, "o", "> "]
[65.72876, "o", "# Get current date for calculating days until expiry\r\n\u001b[?2004l\r"]
[65.728807, "o", "\u001b[?2004h"]
[65.728847, "o", "> "]
[65.729019, "o", "today=$(date +%Y-%m-%d)\r\n\u001b[?2004l\r"]
[65.729071, "o", "\u001b[?2004h> \r\n"]
[65.72917, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[65.729338, "o", "# Process each .meta file\r\n\u001b[?2004l\r"]
[65.72939, "o", "\u001b[?2004h"]
[65.729443, "o", "> "]
[65.729724, "o", "for meta_file in $(find . -name \"*.meta\"); do\r\n"]
[65.729772, "o", "\u001b[?2004l\r"]
[65.729838, "o", "\u001b[?2004h> "]
[65.730135, "o", "    # Extract base filename without extension\r\n\u001b[?2004l\r"]
[65.730198, "o", "\u001b[?2004h"]
[65.730247, "o", "> "]
[65.730512, "o", "    base_name=$(basename \"$meta_file\" .meta)\r\n\u001b[?2004l\r"]
[65.730567, "o", "\u001b[?2004h> "]
[65.730845, "o", "    crt_file=\"${meta_file%.meta}.crt\"\r\n\u001b[?2004l\r"]
[65.730922, "o", "\u001b[?2004h> "]
[65.730988, "o", "    \r\n\u001b[?2004l\r"]
[65.73108, "o", "\u001b[?2004h> "]
[65.73135, "o", "    # Check if corresponding .crt file exists\r\n\u001b[?2004l\r"]
[65.731412, "o", "\u001b[?2004h> "]
[65.73167, "o", "    if [ ! -f \"$crt_file\" ]; then\r\n\u001b[?2004l\r"]
[65.731728, "o", "\u001b[?2004h> "]
[65.732485, "o", "        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"MISSING_CRT\\\"}\" >> /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.732532, "o", "\u001b[?2004h"]
[65.732587, "o", "> "]
[65.733077, "o", "        # Ensure proper JSON array formatting by removing last comma later\r\n\u001b[?2004l\r"]
[65.733137, "o", "\u001b[?2004h> "]
[65.733279, "o", "        continue\r\n\u001b[?2004l\r"]
[65.733324, "o", "\u001b[?2004h"]
[65.733369, "o", "> "]
[65.733413, "o", "    fi\r\n\u001b[?2004l\r"]
[65.733467, "o", "\u001b[?2004h"]
[65.733519, "o", ">     "]
[65.733567, "o", "\r\n\u001b[?2004l\r"]
[65.73361, "o", "\u001b[?2004h> "]
[65.733861, "o", "    # Read metadata from .meta file\r\n\u001b[?2004l\r"]
[65.733916, "o", "\u001b[?2004h"]
[65.734025, "o", "> "]
[65.734211, "o", "    if [ ! -f \"$meta_file\" ]; then\r\n\u001b[?2004l\r"]
[65.734249, "o", "\u001b[?2004h"]
[65.734293, "o", "> "]
[65.735071, "o", "        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"MISSING_META_FILE\\\"}\" >> /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.735118, "o", "\u001b[?2004h"]
[65.735131, "o", "> "]
[65.735281, "o", "        continue\r\n\u001b[?2004l\r"]
[65.735323, "o", "\u001b[?2004h"]
[65.735369, "o", "> "]
[65.735412, "o", "    fi\r\n\u001b[?2004l\r"]
[65.73546, "o", "\u001b[?2004h"]
[65.735507, "o", "> "]
[65.735522, "o", "    \r\n"]
[65.735538, "o", "\u001b[?2004l\r"]
[65.735605, "o", "\u001b[?2004h> "]
[65.735882, "o", "    # Read and parse the metadata line\r\n\u001b[?2004l\r"]
[65.735938, "o", "\u001b[?2004h"]
[65.735951, "o", "> "]
[65.736487, "o", "    IFS='|' read -r subject issuer not_before not_after checksum < \"$meta_file\"\r\n\u001b[?2004l\r"]
[65.736535, "o", "\u001b[?2004h"]
[65.736548, "o", "> "]
[65.736599, "o", "    \r\n\u001b[?2004l\r"]
[65.736656, "o", "\u001b[?2004h"]
[65.736703, "o", "> "]
[65.736892, "o", "    # Validate date formats\r\n\u001b[?2004l\r"]
[65.736939, "o", "\u001b[?2004h"]
[65.736985, "o", "> "]
[65.73748, "o", "    if ! validate_date \"$not_before\" || ! validate_date \"$not_after\"; then\r\n\u001b[?2004l\r"]
[65.737545, "o", "\u001b[?2004h> "]
[65.738285, "o", "        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"INVALID_DATE\\\"}\" >> /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.738342, "o", "\u001b[?2004h> "]
[65.738477, "o", "        continue\r\n\u001b[?2004l\r"]
[65.738524, "o", "\u001b[?2004h> "]
[65.738599, "o", "    fi\r\n\u001b[?2004l\r"]
[65.738691, "o", "\u001b[?2004h> "]
[65.738743, "o", "    \r\n\u001b[?2004l\r"]
[65.73881, "o", "\u001b[?2004h> "]
[65.739149, "o", "    # Calculate checksum of .crt file and compare\r\n\u001b[?2004l\r"]
[65.739228, "o", "\u001b[?2004h> "]
[65.739648, "o", "    crt_checksum=$(sha256sum \"$crt_file\" | awk '{print $1}')\r\n\u001b[?2004l\r"]
[65.739702, "o", "\u001b[?2004h> "]
[65.740069, "o", "    if [ \"$crt_checksum\" != \"$checksum\" ]; then\r\n\u001b[?2004l\r"]
[65.740134, "o", "\u001b[?2004h> "]
[65.740881, "o", "        echo \"{\\\"filename\\\": \\\"$meta_file\\\", \\\"reason\\\": \\\"CHECKSUM_MISMATCH\\\"}\" >> /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.740973, "o", "\u001b[?2004h> "]
[65.741086, "o", "        continue\r\n\u001b[?2004l\r"]
[65.741151, "o", "\u001b[?2004h> "]
[65.741218, "o", "    fi\r\n\u001b[?2004l\r"]
[65.741298, "o", "\u001b[?2004h> "]
[65.741348, "o", "    \r\n\u001b[?2004l\r"]
[65.741392, "o", "\u001b[?2004h> "]
[65.741631, "o", "    # Calculate days until expiry\r\n\u001b[?2004l\r"]
[65.741689, "o", "\u001b[?2004h> "]
[65.742357, "o", "    days_until_expiry=$(date -d \"$not_after\" +%s -d \"$today\" +%s | awk '{print ($1 - $2)/86400}')\r\n\u001b[?2004l\r"]
[65.74241, "o", "\u001b[?2004h"]
[65.742461, "o", ">     "]
[65.742506, "o", "\r\n\u001b[?2004l\r"]
[65.742553, "o", "\u001b[?2004h> "]
[65.742869, "o", "    # Determine status based on days remaining\r\n\u001b[?2004l\r"]
[65.742926, "o", "\u001b[?2004h"]
[65.743007, "o", "> "]
[65.743263, "o", "    if [ \"$days_until_expiry\" -gt 30 ]; then\r\n\u001b[?2004l\r"]
[65.743304, "o", "\u001b[?2004h"]
[65.743352, "o", "> "]
[65.743482, "o", "        status=\"OK\"\r\n\u001b[?2004l\r"]
[65.743523, "o", "\u001b[?2004h"]
[65.743589, "o", "> "]
[65.743894, "o", "    elif [ \"$days_until_expiry\" -ge 0 ]; then\r\n\u001b[?2004l\r"]
[65.743968, "o", "\u001b[?2004h"]
[65.744011, "o", "> "]
[65.744198, "o", "        status=\"EXPIRING_SOON\"\r\n\u001b[?2004l\r"]
[65.744256, "o", "\u001b[?2004h> "]
[65.744345, "o", "    else\r\n\u001b[?2004l\r"]
[65.744389, "o", "\u001b[?2004h"]
[65.744431, "o", "> "]
[65.744596, "o", "        status=\"EXPIRED\"\r\n\u001b[?2004l\r"]
[65.744637, "o", "\u001b[?2004h"]
[65.744669, "o", "> "]
[65.744799, "o", "    fi\r\n\u001b[?2004l\r\u001b[?2004h> "]
[65.744853, "o", "    \r\n\u001b[?2004l\r"]
[65.744926, "o", "\u001b[?2004h> "]
[65.745175, "o", "    # Append valid certificate to CSV\r\n\u001b[?2004l\r"]
[65.745236, "o", "\u001b[?2004h> "]
[65.746113, "o", "    echo \"$base_name,$subject,$issuer,$not_before,$not_after,$days_until_expiry,$status\" >> /home/user/cert_analysis/expiring_certs.csv\r\n\u001b[?2004l\r"]
[65.746184, "o", "\u001b[?2004h> "]
[65.746232, "o", "    \r\n\u001b[?2004l\r"]
[65.746278, "o", "\u001b[?2004h> "]
[65.746526, "o", "    # Log the processed certificate\r\n\u001b[?2004l\r"]
[65.746574, "o", "\u001b[?2004h> "]
[65.746873, "o", "    timestamp=$(date +\"%Y-%m-%d %H:%M:%S\")\r\n\u001b[?2004l\r"]
[65.746926, "o", "\u001b[?2004h"]
[65.74698, "o", "> "]
[65.747555, "o", "    echo \"$timestamp Processed $base_name - $status\" >> /home/user/cert_analysis/analysis.log\r\n\u001b[?2004l\r"]
[65.747609, "o", "\u001b[?2004h"]
[65.747657, "o", "> done"]
[65.747704, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[65.74775, "o", "> \r\n\u001b[?2004l\r"]
[65.747796, "o", "\u001b[?2004h> "]
[65.748364, "o", "# Clean up JSON file by removing trailing comma and adding proper array formatting\r\n\u001b[?2004l\r"]
[65.748417, "o", "\u001b[?2004h"]
[65.748477, "o", "> "]
[65.748936, "o", "sed -i '1s/^/[/;$s/,$/]/' /home/user/cert_analysis/errors.json\r\n\u001b[?2004l\r"]
[65.748986, "o", "\u001b[?2004h"]
[65.74901, "o", "> "]
[65.749028, "o", "\r\n\u001b[?2004l\r"]
[65.749084, "o", "\u001b[?2004h> "]
[65.749399, "o", "# Sort CSV by days_until_expiry ascending\r\n\u001b[?2004l\r"]
[65.749434, "o", "\u001b[?2004h"]
[65.749452, "o", "> "]
[65.750172, "o", "sort -t, -k5n /home/user/cert_analysis/expiring_certs.csv -o /home/user/cert_analysis/expiring_certs.csv\r\n\u001b[?2004l\r"]
[65.750212, "o", "\u001b[?2004h"]
[65.750231, "o", "> "]
[65.750254, "o", "EOF"]
[65.958566, "i", "chmod +x /tmp/process_certs.sh\n"]
[65.958838, "o", "chmod +x /tmp/process_certs.sh\r\n\u001b[?2004l\r"]
[65.958917, "o", "\u001b[?2004h"]
[65.958952, "o", "> "]
[66.157102, "i", "/tmp/process_certs.sh\n"]
[66.157364, "o", "/tmp/process_certs.sh\r\n"]
[66.157393, "o", "\u001b[?2004l\r"]
[66.15745, "o", "\u001b[?2004h"]
[66.157475, "o", "> "]
