Previous response had warnings:
WARNINGS: - Extra text detected before JSON object
- Extra text detected after JSON object
- Command 1 should end with newline when followed by another command. Otherwise the two commands will be concatenated together on the same line.

New Terminal Output:

root@82416666-6c44-49e4-ac45-f5685ae8f95f:/home/user/certs_incoming# cat > process_certs.sh << 'EOF'
> #!/bin/bash
>
> # Initialize output files
> echo "filename,subject,issuer,not_before,not_after,days_until_expiry,status" > /home/user/cert_analysis/expiring_certs.csv
> echo "" > /home/user/cert_analysis/analysis.log
> printf "[]" > /home/user/cert_analysis/errors.json
>
> today_ts=$(date +%s)
>
> # Process each .meta file
> for meta_file in $(find . -name "*.meta"); do
>     # Extract filename and path components
>     crt_file="${meta_file%.*}.crt"
>     base_name=$(basename -- "${meta_file%.*}")
>
>     # Read metadata line
>     if ! read -r line < "${meta_file}"; then
>         echo "Error reading ${meta_file}" >> /home/user/cert_analysis/errors.json
>         continue
>     fi
>
>     # Parse metadata fields
>     IFS='|' read -ra fields <<< "${line}"
>     subject="${fields[0]}"
>     issuer="${fields[1]}"
>     not_before="${fields[2]}"
>     not_after="${fields[3]}"
>     checksum_meta="${fields[4]}"
>
>     # Validation 1: Check if .crt file exists
>     if [ ! -f "${crt_file}" ]; then
>         # Update errors.json
>         tmp_json="$(cat /home/user/cert_analysis/errors.json)"
>         echo "${tmp_json%,*},\n\t{\"filename\": \"${base_name}.meta\", \"reason\": \"MISSING_CRT\"}" > /home/user/cert_analysis/errors.json
>         continue
>     fi
>
>     # Validation 2: Verify dates are valid
>     if ! date -d "${not_before}" +%F >/dev/null 2>&1 || ! date -d "${not_after}" +%F >/dev/null 2>&1; then
>         tmp_json="$(cat /home/user/cert_analysis/errors.json)"
>         echo "${tmp_json%,*},\n\t{\"filename\": \"${base_name}.meta\", \"reason\": \"INVALID_DATE\"}" > /home/user/cert_analysis/errors.json
>         continue
>     fi
>
>     # Convert dates to timestamps
>     not_before_ts=$(date -d "${not_before}" +%s)
>     not_after_ts=$(date -d "${not_after}" +%s)
>
>     # Validation 3: Verify checksum
>     checksum_actual=$(sha256sum "${crt_file}" | awk '{print $1}')
>     if [ "${checksum_actual}" != "${checksum_meta}" ]; then
>         tmp_json="$(cat /home/user/cert_analysis/errors.json)"
>         echo "${tmp_json%,*},\n\t{\"filename\": \"${base_name}.meta\", \"reason\": \"CHECKSUM_MISMATCH\"}" > /home/user/cert_analysis/errors.json
>         continue
>     fi
>
>     # Calculate days until expiry
>     days_until_expiry=$(((not_after_ts - today_ts) / 86400))
>
>     # Determine status
>     if [ ${days_until_expiry} -gt 30 ]; then
>         status="OK"
>     elif [ ${days_until_expiry} -ge 0 ]; then
>         status="EXPIRING_SOON"
>     else
>         status="EXPIRED"
>     fi
>
>     # Add to CSV
>     echo "${base_name}.crt,${subject},${issuer},${not_before},${not_after},${days_until_expiry},${status}" >> /home/user/cert_analysis/expiring_certs.csv
>
>     # Add to log
>     timestamp=$(date '+%Y-%m-%d %H:%M:%S')
>     echo "${timestamp} Processed ${base_name}.crt - ${status}" >> /home/user/cert_analysis/analysis.log
> done
>
> # Sort CSV by days_until_expiry ascending
> sort -t, -k5n /home/user/cert_analysis/expiring_certs.csv -o /home/user/cert_analysis/expiring_certs.csv
>
> # Fix JSON formatting
> tmp_json="$(cat /home/user/cert_analysis/errors.json)"
> echo "${tmp_json%,*}]" > /home/user/cert_analysis/errors.json
> EOFchmod +x process_certs.sh
> ./process_certs.sh
>
