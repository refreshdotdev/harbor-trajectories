[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# clear
[?2004l[H[J[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cd /home/user
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# mkdir -m 700 audit_2023Q4
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# START_TIME=$(date -u +%Y-%m-%dT%H:%M:%SZ)
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# SECRET_CONTENT=$(cat /home/user/source_files/.secret | tr -d '\n\r\t ')
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# CURRENT_UTC_DATE=$(date -u +%Y%m%d)
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# find /home/user/source_files/ -maxdepth 1 -type f,l \( -name "*.txt" -o -size +1023c \) ! -name "./.*" -print
[?2004lfind: warning: ‚Äò-name‚Äô matches against basenames only, but the given pattern contains a directory separator (‚Äò/‚Äô), thus the expression will evaluate to false all the time.  Did you mean ‚Äò-wholename‚Äô?
/home/user/source_files/caf√©_notes.txt
/home/user/source_files/financials Q4.csv
/home/user/source_files/policy_doc.txt
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# VALID_FILES=()
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# for path in /home/user/source_files/caf√©_notes.txt /home/user/source_files/financials Q4.csv /home/user/source_files/policy_doc.txt; do
[?2004l[?2004h>   if [ -L "$path" ]; then
[?2004l[?2004h>     target=$(readlink -f "$path")
[?2004l[?2004h>     if [ -f "$target" ]; then
[?2004l[?2004h>       if [ "${target##*.}" = "txt" ] || [ $(stat -c%s "$target" 2>/dev/null || echo 0) -ge 1024 ]; then
[?2004l[?2004h>         VALID_FILES+=("$path")
[?2004l[?2004h>       fi
[?2004l[?2004h>     fi
[?2004l[?2004h>   else
[?2004l[?2004h>     if [ -f "$path" ]; then
[?2004l[?2004h>       if [ "${path##*.}" = "txt" ] || [ $(stat -c%s "$path" 2>/dev/null || echo 0) -ge 1024 ]; then
[?2004l[?2004h>         VALID_FILES+=("$path")
[?2004l[?2004h>       fi
[?2004l[?2004h>     fi
[?2004l[?2004h>   fi
[?2004l[?2004h> done
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# declare -p VALID_FILES
[?2004ldeclare -a VALID_FILES=([0]="/home/user/source_files/caf√©_notes.txt" [1]="/home/user/source_files/policy_doc.txt")
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "START       : 2023-Q4 checksum verification" > audit_2023Q4/checksum_audit.logecho "START_TIME  : ${START_TIME}" >> audit_2023Q4/checksum_audit.logecho "FILE_RECORDS" >> audit_2023Q4/checksum_audit.logcat audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "/home/user/source_files/caf√©_notes.txt " >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# sha256sum "/home/user/source_files/caf√©_notes.txt" >> audit_2023Q4/checksum_audit.log.tmp
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# md5sum "/home/user/source_files/caf√©_notes.txt" >> audit_2023Q4/checksum_audit.log.tmp
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# rm audit_2023Q4/checksum_audit.log audit_2023Q4/checksum_audit.log.tmp 2>/dev/null
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "START       : 2023-Q4 checksum verification" > audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "START_TIME  : ${START_TIME}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "FILE_RECORDS" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# record_file="/home/user/source_files/caf√©_notes.txt"
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "${record_file} " >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# sha256sum "${record_file}" | cut -d' ' -f1 >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# md5sum "${record_file}" | cut -d' ' -f1 > tmp_hash.txt
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat tmp_hash.txt >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "  " >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat tmp_hash.txt >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# record_file="/home/user/source_files/policy_doc.txt"
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "${record_file} " >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# sha256sum "${record_file}" | cut -d' ' -f1 >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# md5sum "${record_file}" | cut -d' ' -f1 > tmp_hash.txt
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat tmp_hash.txt >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "  " >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat tmp_hash.txt >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat audit_2023Q4/checksum_audit.log
[?2004lSTART       : 2023-Q4 checksum verification
START_TIME  : 2026-02-13T18:56:59Z
FILE_RECORDS
/home/user/source_files/caf√©_notes.txt fd3c698f04a2c6fe7b4773f84f43766bb4758d5fe9b4a23d7980002a265dd36f
857fa9f81312b4cf125750b943ce8cff
  857fa9f81312b4cf125750b943ce8cff
/home/user/source_files/policy_doc.txt cf5d044d50e49313985afde22f95890f7e187b15e29f4bf8ecd0747b27b836db
29f338772e112c3d08477422329f8fe5
  29f338772e112c3d08477422329f8fe5
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# LOG_CHECKSUM=$(sha256sum audit_2023Q4/checksum_audit.log | cut -d' ' -f1)
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# HMAC_KEY="${SECRET_CONTENT}${CURRENT_UTC_DATE}"
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo -n "${HMAC_KEY}" | xxd -p
[?2004lbash: xxd: command not found
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# SIGNATURE=$(echo -n "${LOG_CHECKSUM}" | hmac_sha256 "${HMAC_KEY}" | cut -d' ' -f1)
[?2004lbash: hmac_sha256: command not found
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# SIGNATURE=$(echo -n "${LOG_CHECKSUM}" | openssl dgst -sha256 -hmac "${HMAC_KEY}" | cut -d' ' -f2 | tr -d ':')
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat > audit_2023Q4/summary.json << EOF
[?2004l[?2004h> {
[?2004l[?2004h>   "period": "2023-Q4",
[?2004l[?2004h>   "file_count": ${#VALID_FILES[@]},
[?2004l[?2004h>   "total_bytes": $(stat -c %s "${VALID_FILES[0]}" 2>/dev/null || echo 0),
[?2004l[?2004h>   "start_time": "${START_TIME}",
[?2004l[?2004h>   "end_time": "${START_TIME}",
[?2004l[?2004h>   "status": "COMPLETED",
[?2004l[?2004h>   "log_checksum": "${LOG_CHECKSUM}",
[?2004l[?2004h>   "signature": "${SIGNATURE}"
[?2004l[?2004h> }
[?2004l[?2004h> EOF
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# VERIFICATION_RESULT="VERIFICATION_PASSED"
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# for file in "${VALID_FILES[@]}"; do
[?2004l[?2004h>   if ! grep -q "${file}.*$(sha256sum "${file}" | cut -d' ' -f1)" audit_2023Q4/checksum_audit.log; then
[?2004l[?2004h>     VERIFICATION_RESULT="VERIFICATION_FAILED"
[?2004l[?2004h>     break
[?2004l[?2004h>   fi
[?2004l[?2004h> done
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# END_TIME=$(date -u +%Y-%m-%dT%H:%M:%SZ)
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "END_TIME    : ${END_TIME}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "END         : 2023-Q4 checksum verification" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "${VERIFICATION_RESULT}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# ls -la audit_2023Q4/
[?2004ltotal 12
drwx------ 2 root root 131 Feb 13 18:59 [0m[01;34m.[0m
drwxr-xr-x 1 root root  58 Feb 13 18:58 [01;34m..[0m
-rw-r--r-- 1 root root 536 Feb 13 18:59 checksum_audit.log
-rw-r--r-- 1 root root 124 Feb 13 18:57 checksum_audit.logcat
-rw-r--r-- 1 root root   0 Feb 13 18:57 checksum_audit.logecho
-rw-r--r-- 1 root root 338 Feb 13 18:59 summary.json
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# rm -f audit_2023Q4/checksum_audit.log* audit_2023Q4/checksum_audit.logecho audit_2023Q4/checksum_audit.logtmp tmp_hash.txt 2>/dev/null
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat audit_2023Q4/checksum_audit.log
[?2004lcat: audit_2023Q4/checksum_audit.log: No such file or directory
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat audit_2023Q4/summary.json
[?2004l{
  "period": "2023-Q4",
  "file_count": 2,
  "total_bytes": 28,
  "start_time": "2026-02-13T18:56:59Z",
  "end_time": "2026-02-13T18:56:59Z",
  "status": "COMPLETED",
  "log_checksum": "e5d81768a6e1e7fa7e2b879b80149af71153666c85d41a887131a44d84aef9b2",
  "signature": "ae6d8d192d426173aba97f7b04b51ab52e632be461a411fb5bfe50bbd68148e3"
}
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "START       : 2023-Q4 checksum verification" > audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "START_TIME  : ${START_TIME}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "FILE_RECORDS" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "/home/user/source_files/caf√©_notes.txt fd3c698f04a2c6fe7b4773f84f43766bb4758d5fe9b4a23d7980002a265dd36f  857fa9f81312b4cf125750b943ce8cff" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "/home/user/source_files/policy_doc.txt cf5d044d50e49313985afde22f95890f7e187b15e29f4bf8ecd0747b27b836db  29f338772e112c3d08477422329f8fe5" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "END_TIME    : ${END_TIME}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "END         : 2023-Q4 checksum verification" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# echo "${VERIFICATION_RESULT}" >> audit_2023Q4/checksum_audit.log
[?2004l[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# cat audit_2023Q4/checksum_audit.log
[?2004lSTART       : 2023-Q4 checksum verification
START_TIME  : 2026-02-13T18:56:59Z
FILE_RECORDS
/home/user/source_files/caf√©_notes.txt fd3c698f04a2c6fe7b4773f84f43766bb4758d5fe9b4a23d7980002a265dd36f  857fa9f81312b4cf125750b943ce8cff
/home/user/source_files/policy_doc.txt cf5d044d50e49313985afde22f95890f7e187b15e29f4bf8ecd0747b27b836db  29f338772e112c3d08477422329f8fe5
END_TIME    : 2026-02-13T18:59:22Z
END         : 2023-Q4 checksum verification
VERIFICATION_PASSED
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# ls -la audit_2023Q4/
[?2004ltotal 8
drwx------ 2 root root  64 Feb 13 18:59 [0m[01;34m.[0m
drwxr-xr-x 1 root root  34 Feb 13 18:59 [01;34m..[0m
-rw-r--r-- 1 root root 468 Feb 13 19:00 checksum_audit.log
-rw-r--r-- 1 root root 338 Feb 13 18:59 summary.json
[?2004hroot@9b24e8d8-0aaf-4668-b353-9dd60bd24a9f:/home/user# 