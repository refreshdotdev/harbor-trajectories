{"version": 2, "width": 160, "height": 40, "timestamp": 1771008648, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005063, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[0.952375, "i", "clear\r"]
[0.952499, "o", "clear\r\n\u001b[?2004l\r"]
[0.953627, "o", "\u001b[H\u001b[J"]
[0.953787, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.108697, "i", "mkdir -p /home/user/storage/incoming /home/user/storage/archive\n"]
[50.108918, "o", "mkdir -p /home/user/storage/incoming /home/user/storage/archive\r\n\u001b[?2004l\r"]
[50.11007, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.260361, "i", "cat > /home/user/storage/params.conf << 'EOF'\ncutoff_days = 30\nmax_bak_kb = 1024\n# This is a comment explaining the parameters\nEOF\n"]
[50.260524, "o", "cat > /home/user/storage/params.conf << 'EOF'\r\n\u001b[?2004l\r"]
[50.260561, "o", "\u001b[?2004h> "]
[50.260613, "o", "cutoff_days = 30\r\n\u001b[?2004l\r"]
[50.260638, "o", "\u001b[?2004h> "]
[50.260683, "o", "max_bak_kb = 1024\r\n\u001b[?2004l\r"]
[50.260706, "o", "\u001b[?2004h> "]
[50.26082, "o", "# This is a comment explaining the parameters\r\n\u001b[?2004l\r"]
[50.260862, "o", "\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[50.262495, "o", "\u001b[?2004h"]
[50.262537, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.462323, "i", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\n#!/bin/bash\n\n# Phase 1: Configuration\nCONFIG_FILE=\"/home/user/storage/params.conf\"\nif [[ ! -f \"$CONFIG_FILE\" ]]; then\n    echo \"Configuration file missing: $CONFIG_FILE\"\n    exit 1\nfi\n\ndeclare -A PARAMS\nwhile IFS='=' read -r key value; do\n    if [[ ! \"$key\" =~ ^# && -n \"$key\" ]]; then\n        PARAMS[$key]=$(echo \"$value\" | xargs)\n    fi\ndone < \"$CONFIG_FILE\"\n\ncutoff_days=${PARAMS[cutoff_days]:-0}\nmax_bak_kb=${PARAMS[max_bak_kb]:-0}\n\necho \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\n\n# Phase 2: Pruning .bak files\ndeleted_bytes=0\ncorrupt_count=0\n\nfind /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\n    filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\n    if [[ $filesize_kb -gt $max_bak_kb ]]; then\n        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)\n        rm \"$bakfile\"\n        deleted_bytes=$((deleted_bytes + bytes_deleted))\n        echo \"Deleted large .bak"]
[50.462441, "i", " file: $bakfile (${filesize_kb}KB)\"\n    fi\ndone\n\n# Phase 3: Archival of .txt files\ncutoff_time=$(date -d \"-$cutoff_days days\" +%s)\nfind /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\n    if [[ -n $(file -i \"$txtfile\" | grep -v 'charset=utf-8') ]]; then\n        corrupt_count=$((corrupt_count + 1))\n        mv \"$txtfile\" \"${txtfile}.corrupt\"\n        echo \"Renamed corrupt file: $txtfile\"\n    else\n        mv \"$txtfile\" /home/user/storage/archive/\n        echo \"Archived valid UTF-8 file: $txtfile\"\n    fi\ndone\n\n# Phase 4: Manifest Generation\nARCHIVE_DIR=\"/home/user/storage/archive\"\nMANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\n\n# Create manifest with CRLF line endings\n{ echo -e \"Filename,Size,MD5\"\nfind \"$ARCHIVE_DIR\" -type f -exec sh -c 'for f; do printf \"%s,%d,%s\\r\\n\" \"\\$f\" \"\\$(du -b \\\"\\$f\\\" | cut -f1)\" \"\\$(md5sum \\\"\\$f\\\" | cut -d' ' -f1)\"; done' sh {} +\n} | sort -t, -k3 > \"$MANIFEST_FILE\"\n\n# Phase 5: Audit Report\ncat > /home/user/storage/summary.xml << EOF\n<?xml versio"]
[50.462471, "i", "n=\"1.0\" encoding=\"ISO-8859-1\"?>\n<audit>\n    <deleted_bytes>$deleted_bytes</deleted_bytes>\n    <corrupt_files>$corrupt_count</corrupt_files>\n    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\n</audit>\nEOF\n\n# Final Cleanup\nfind /home/user/storage/incoming -type d -empty -delete\n\necho \"Maintenance complete. Deleted bytes: $deleted_bytes, Corrupt files: $corrupt_count\"\nEOF\n"]
[50.462502, "o", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\r\n\u001b[?2004l\r"]
[50.46256, "o", "\u001b[?2004h> "]
[50.462621, "o", "#!/bin/bash\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[50.462649, "o", "\u001b[?2004h> "]
[50.462696, "o", "# Phase 1: Configuration\r\n\u001b[?2004l\r"]
[50.462714, "o", "\u001b[?2004h> "]
[50.462826, "o", "CONFIG_FILE=\"/home/user/storage/params.conf\"\r\n\u001b[?2004l\r"]
[50.462848, "o", "\u001b[?2004h> "]
[50.462956, "o", "if [[ ! -f \"$CONFIG_FILE\" ]]; then\r\n\u001b[?2004l\r\u001b[?2004h"]
[50.462982, "o", "> "]
[50.463095, "o", "    echo \"Configuration file missing: $CONFIG_FILE\"\r\n\u001b[?2004l\r"]
[50.463122, "o", "\u001b[?2004h> "]
[50.46314, "o", "    exit 1\r\n\u001b[?2004l\r"]
[50.46316, "o", "\u001b[?2004h> "]
[50.463166, "o", "fi\r\n\u001b[?2004l\r"]
[50.463222, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[50.46326, "o", "declare -A PARAMS\r\n\u001b[?2004l\r"]
[50.46328, "o", "\u001b[?2004h> "]
[50.463368, "o", "while IFS='=' read -r key value; do\r\n\u001b[?2004l\r"]
[50.46339, "o", "\u001b[?2004h> "]
[50.463498, "o", "    if [[ ! \"$key\" =~ ^# && -n \"$key\" ]]; then\r\n\u001b[?2004l\r"]
[50.463521, "o", "\u001b[?2004h> "]
[50.463634, "o", "        PARAMS[$key]=$(echo \"$value\" | xargs)\r\n\u001b[?2004l\r"]
[50.463657, "o", "\u001b[?2004h> "]
[50.46368, "o", "    fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[50.46371, "o", "> "]
[50.463745, "o", "done < \"$CONFIG_FILE\"\r\n\u001b[?2004l\r"]
[50.463769, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[50.463788, "o", "\u001b[?2004h> "]
[50.463887, "o", "cutoff_days=${PARAMS[cutoff_days]:-0}\r\n\u001b[?2004l\r"]
[50.463918, "o", "\u001b[?2004h> "]
[50.463998, "o", "max_bak_kb=${PARAMS[max_bak_kb]:-0}\r\n\u001b[?2004l\r"]
[50.46402, "o", "\u001b[?2004h"]
[50.464047, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[50.464239, "o", "echo \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[50.464259, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[50.46428, "o", "> "]
[50.464351, "o", "# Phase 2: Pruning .bak files\r\n\u001b[?2004l\r"]
[50.464373, "o", "\u001b[?2004h> "]
[50.464406, "o", "deleted_bytes=0\r\n\u001b[?2004l\r"]
[50.464428, "o", "\u001b[?2004h> "]
[50.464474, "o", "corrupt_count=0\r\n\u001b[?2004l\r"]
[50.464498, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[50.46452, "o", "\u001b[?2004h> "]
[50.464803, "o", "find /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\r\n\u001b[?2004l\r"]
[50.464831, "o", "\u001b[?2004h> "]
[50.464982, "o", "    filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r"]
[50.465027, "o", "\u001b[?2004h> "]
[50.465119, "o", "    if [[ $filesize_kb -gt $max_bak_kb ]]; then\r\n\u001b[?2004l\r"]
[50.465141, "o", "\u001b[?2004h> "]
[50.465277, "o", "        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r"]
[50.46532, "o", "\u001b[?2004h> "]
[50.46535, "o", "        rm \"$bakfile\"\r\n\u001b[?2004l\r"]
[50.465371, "o", "\u001b[?2004h> "]
[50.465512, "o", "        deleted_bytes=$((deleted_bytes + bytes_deleted))\r\n\u001b[?2004l\r"]
[50.465533, "o", "\u001b[?2004h> "]
[50.4657, "o", "        echo \"Deleted large .bak file: $bakfile (${filesize_kb}KB)\"\r\n\u001b[?2004l\r"]
[50.465744, "o", "\u001b[?2004h>     fi\r\n\u001b[?2004l\r"]
[50.465767, "o", "\u001b[?2004h> done\r\n"]
[50.465786, "o", "\u001b[?2004l\r\u001b[?2004h"]
[50.465806, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[50.465822, "o", "> "]
[50.465904, "o", "# Phase 3: Archival of .txt files\r\n\u001b[?2004l\r"]
[50.465931, "o", "\u001b[?2004h> "]
[50.466045, "o", "cutoff_time=$(date -d \"-$cutoff_days days\" +%s)\r\n\u001b[?2004l\r"]
[50.466066, "o", "\u001b[?2004h> "]
[50.466311, "o", "find /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\r\n\u001b[?2004l\r"]
[50.466333, "o", "\u001b[?2004h> "]
[50.466506, "o", "    if [[ -n $(file -i \"$txtfile\" | grep -v 'charset=utf-8') ]]; then\r\n\u001b[?2004l\r"]
[50.466536, "o", "\u001b[?2004h> "]
[50.466636, "o", "        corrupt_count=$((corrupt_count + 1))\r\n\u001b[?2004l\r"]
[50.466658, "o", "\u001b[?2004h> "]
[50.466761, "o", "        mv \"$txtfile\" \"${txtfile}.corrupt\"\r\n\u001b[?2004l\r"]
[50.466784, "o", "\u001b[?2004h> "]
[50.466895, "o", "        echo \"Renamed corrupt file: $txtfile\"\r\n\u001b[?2004l\r"]
[50.466921, "o", "\u001b[?2004h> "]
[50.46694, "o", "    else\r\n\u001b[?2004l\r"]
[50.466958, "o", "\u001b[?2004h> "]
[50.467081, "o", "        mv \"$txtfile\" /home/user/storage/archive/\r\n\u001b[?2004l\r"]
[50.467102, "o", "\u001b[?2004h> "]
[50.467233, "o", "        echo \"Archived valid UTF-8 file: $txtfile\"\r\n\u001b[?2004l\r"]
[50.467265, "o", "\u001b[?2004h> "]
[50.46729, "o", "    fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[50.467313, "o", "> done\r\n\u001b[?2004l\r"]
[50.467335, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[50.467355, "o", "\u001b[?2004h> "]
[50.467429, "o", "# Phase 4: Manifest Generation\r\n\u001b[?2004l\r"]
[50.467443, "o", "\u001b[?2004h> "]
[50.467547, "o", "ARCHIVE_DIR=\"/home/user/storage/archive\"\r\n\u001b[?2004l\r"]
[50.467563, "o", "\u001b[?2004h> "]
[50.467669, "o", "MANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\r\n\u001b[?2004l\r"]
[50.467689, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[50.46771, "o", "\u001b[?2004h"]
[50.467728, "o", "> "]
[50.467812, "o", "# Create manifest with CRLF line endings\r\n\u001b[?2004l\r"]
[50.467831, "o", "\u001b[?2004h> "]
[50.467939, "o", "{ echo -e \"Filename,Size,MD5\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[50.468312, "o", "find \"$ARCHIVE_DIR\" -type f -exec sh -c 'for f; do printf \"%s,%d,%s\\r\\n\" \"\\$f\" \"\\$(du -b \\\"\\$f\\\" | cut -f1)\" \"\\$(md5sum \\\"\\$f\\\" | cut -d' ' -f1)\"; done' sh {} +\r\n\u001b[?2004l\r"]
[50.46833, "o", "\u001b[?2004h> "]
[50.468418, "o", "} | sort -t, -k3 > \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[50.468434, "o", "\u001b[?2004h"]
[50.468451, "o", "> \r\n\u001b[?2004l\r"]
[50.468469, "o", "\u001b[?2004h> "]
[50.468523, "o", "# Phase 5: Audit Report\r\n\u001b[?2004l\r"]
[50.468541, "o", "\u001b[?2004h> "]
[50.46865, "o", "cat > /home/user/storage/summary.xml << EOF\r\n\u001b[?2004l\r"]
[50.468666, "o", "\u001b[?2004h> "]
[50.468776, "o", "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n\u001b[?2004l\r"]
[50.4688, "o", "\u001b[?2004h> "]
[50.468818, "o", "<audit>\r\n\u001b[?2004l\r"]
[50.468835, "o", "\u001b[?2004h> "]
[50.468968, "o", "    <deleted_bytes>$deleted_bytes</deleted_bytes>\r\n\u001b[?2004l\r"]
[50.468995, "o", "\u001b[?2004h> "]
[50.469111, "o", "    <corrupt_files>$corrupt_count</corrupt_files>\r\n\u001b[?2004l\r"]
[50.469141, "o", "\u001b[?2004h> "]
[50.46935, "o", "    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\r\n\u001b[?2004l\r"]
[50.469397, "o", "\u001b[?2004h> </audit>\r\n\u001b[?2004l\r"]
[50.469419, "o", "\u001b[?2004h"]
[50.469442, "o", "> EOF\r\n\u001b[?2004l\r"]
[50.470535, "o", "\u001b[?2004h"]
[50.470562, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.470589, "o", "\r\n\u001b[?2004l\r\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.470615, "o", "# Final Cleanup\r\n\u001b[?2004l\r"]
[50.470636, "o", "\u001b[?2004h"]
[50.470654, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.470782, "o", "find /home/user/storage/incoming -type d -empty -delete\r\n\u001b[?2004l\r"]
[50.472201, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# \r\n\u001b[?2004l\r"]
[50.472244, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.472467, "o", "echo \"Maintenance complete. Deleted bytes: $deleted_bytes, Corrupt files: $corrupt_count\"\r\n\u001b[?2004l\r"]
[50.472494, "o", "Maintenance complete. Deleted bytes: , Corrupt files: \r\n"]
[50.472511, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[50.47253, "o", "EOF\r\n\u001b[?2004l\r"]
[50.472878, "o", "bash: EOF: command not found\r\n"]
[50.473027, "o", "\u001b[?2004h"]
[50.473053, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[51.00216, "i", "chmod +x /usr/local/bin/storage_maintenance.sh\n"]
[51.002324, "o", "chmod +x /usr/local/bin/storage_maintenance.sh\r\n\u001b[?2004l\r"]
[51.003237, "o", "\u001b[?2004h"]
[51.00325, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[51.118443, "i", "/usr/local/bin/storage_maintenance.sh\n"]
[51.11859, "o", "/usr/local/bin/storage_maintenance.sh\r\n\u001b[?2004l\r"]
[51.124917, "o", "Loaded parameters: cutoff_days=0, max_bak_kb=0 KB\r\n"]
[51.131388, "o", "Deleted large .bak file: /home/user/storage/incoming/project1/delete_me.bak (2560KB)\r\n"]
[51.134859, "o", "Deleted large .bak file: /home/user/storage/incoming/project1/small.bak (1KB)\r\n"]
[51.138191, "o", "/usr/local/bin/storage_maintenance.sh: line 39: file: command not found\r\n"]
[51.143995, "o", "Archived valid UTF-8 file: /home/user/storage/incoming/project2/invalid_utf8.txt\r\n"]
[51.144635, "o", "/usr/local/bin/storage_maintenance.sh: line 39: file: command not found\r\n"]
[51.147466, "o", "Archived valid UTF-8 file: /home/user/storage/incoming/project2/new.txt\r\n"]
[51.148026, "o", "/usr/local/bin/storage_maintenance.sh: line 39: file: command not found\r\n"]
[51.15076, "o", "Archived valid UTF-8 file: /home/user/storage/incoming/project2/valid_old.txt\r\n"]
[51.151416, "o", "/usr/local/bin/storage_maintenance.sh: line 39: file: command not found\r\n"]
[51.154332, "o", "Archived valid UTF-8 file: /home/user/storage/incoming/space dir/file\r\nname.txt\r\n"]
[51.156384, "o", " -f1)\"; done: 1: Syntax error: Unterminated quoted string\r\n"]
[51.157069, "o", "/usr/local/bin/storage_maintenance.sh: line 65: warning: here-document at line 59 delimited by end-of-file (wanted `EOF')\r\n"]
[51.160184, "o", "\u001b[?2004h"]
[51.160214, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[53.154365, "i", "ls -la /home/user/storage/\n"]
[53.154505, "o", "ls -la /home/user/storage/\r\n\u001b[?2004l\r"]
[53.155969, "o", "total 8\r\ndrwxr-xr-x 1 root root  95 Feb 13 18:51 \u001b[0m\u001b[01;34m.\u001b[0m\r\ndrwxrwxrwx 1 root root  29 Feb 13 18:50 \u001b[34;42m..\u001b[0m\r\ndrwxr-xr-x 1 root root 107 Feb 13 18:51 \u001b[01;34marchive\u001b[0m\r\ndrwxr-xr-x 1 root root  91 Feb 13 18:51 \u001b[01;34mincoming\u001b[0m\r\n-rw-r--r-- 1 root root  81 Feb 13 18:51 params.conf\r\n-rw-r--r-- 1 root root 211 Feb 13 18:51 summary.xml\r\n"]
[53.156177, "o", "\u001b[?2004h"]
[53.156203, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.636087, "i", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\n#!/bin/bash\n\n# Phase 1: Configuration\nCONFIG_FILE=\"/home/user/storage/params.conf\"\nif [[ ! -f \"$CONFIG_FILE\" ]]; then\n    echo \"Configuration file missing: $CONFIG_FILE\"\n    exit 1\nfi\n\n# Parse parameters using awk to handle potential spaces and special characters\nsource <(awk -F'=' '/^[^#]/ && NF==2 {print $1 \"=\" $2}' \"$CONFIG_FILE\" 2>/dev/null)\n\ncutoff_days=${cutoff_days:-0}\nmax_bak_kb=${max_bak_kb:-0}\n\nif [[ -z \"$cutoff_days\" || -z \"$max_bak_kb\" ]]; then\n    echo \"Warning: Failed to load all parameters from config file. Using defaults.\"\nfi\n\necho \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\n\ndeleted_bytes=0\ncorrupt_count=0\n\n# Phase 2: Pruning .bak files\nfind /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\n    filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\n    if [[ $filesize_kb -gt $max_bak_kb ]]; then\n        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)"]
[80.636193, "i", "\n        rm \"$bakfile\"\n        deleted_bytes=$((deleted_bytes + bytes_deleted))\n        echo \"Deleted large .bak file: $bakfile (${filesize_kb}KB)\"\n    fi\ndone\n\n# Phase 3: Archival of .txt files\ncutoff_time=$(date -d \"-$cutoff_days days\" +%s)\nfind /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\n    # Validate UTF-8 using iconv (more portable than file command)\n    if ! iconv -f UTF-8 -t UTF-8 \"$txtfile\" >/dev/null 2>&1; then\n        corrupt_count=$((corrupt_count + 1))\n        mv \"$txtfile\" \"${txtfile}.corrupt\"\n        echo \"Renamed corrupt file: $txtfile\"\n    else\n        mv \"$txtfile\" /home/user/storage/archive/\n        echo \"Archived valid UTF-8 file: $txtfile\"\n    fi\ndone\n\n# Phase 4: Manifest Generation\nARCHIVE_DIR=\"/home/user/storage/archive\"\nMANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\n\n# Create manifest with CRLF line endings - fixed syntax\nrm -f \"$MANIFEST_FILE\"\nfind \"$ARCHIVE_DIR\" -type f -print0 | while IFS= read -r -d '' file; do\n    size=$(du -b \"$file"]
[80.636244, "i", "\" | cut -f1)\n    md5=$(md5sum \"$file\" | cut -d' ' -f1)\n    # Escape commas, quotes, and newlines in filenames\n    filename=$(echo \"$file\" | sed -e 's/,/\\,/g' -e \"s/\\\\\\\"/'\\\\\\\\\"'/g\" -e ':a;N;s/\\\\n/\\\\\\n/g;ta\")\n    printf \"%s,%d,%s\\r\\n\" \"$filename\" \"$size\" \"$md5\" >> \"$MANIFEST_FILE\"\ndone\n\n# Sort the manifest by MD5 hash\nsort -t, -k3 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\n\n# Phase 5: Audit Report\ncat > /home/user/storage/summary.xml << EOF\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<audit>\n    <deleted_bytes>$deleted_bytes</deleted_bytes>\n    <corrupt_files>$corrupt_count</corrupt_files>\n    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\n</audit>\nEOF\n\n# Ensure ISO-8859-1 encoding for XML file\niconv -f UTF-8 -t ISO-8859-1 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\niconv -f UTF-8 -t ISO-8859-1 \"/home/user/storage/summary.xml\" -o \"/home/user/storage/summary.xml\"\n\n# Final Cleanup\nfind /home/user/storage/incoming -type d -empty -delete\n\necho \"Maintenance complete. Deleted bytes: $deleted_bytes, Cor"]
[80.63627, "i", "rupt files: $corrupt_count\"\nEOF\n"]
[80.636292, "o", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\r\n\u001b[?2004l\r"]
[80.636334, "o", "\u001b[?2004h> "]
[80.636373, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[80.636395, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[80.636415, "o", "\u001b[?2004h> "]
[80.636483, "o", "# Phase 1: Configuration\r\n\u001b[?2004l\r"]
[80.636509, "o", "\u001b[?2004h> "]
[80.636611, "o", "CONFIG_FILE=\"/home/user/storage/params.conf\"\r\n\u001b[?2004l\r"]
[80.636637, "o", "\u001b[?2004h> "]
[80.636767, "o", "if [[ ! -f \"$CONFIG_FILE\" ]]; then\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.636875, "o", "    echo \"Configuration file missing: $CONFIG_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.636916, "o", "> "]
[80.636976, "o", "    exit 1\r\n\u001b[?2004l\r\u001b[?2004h> fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.637022, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.637203, "o", "# Parse parameters using awk to handle potential spaces and special characters\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.637245, "o", "> "]
[80.637434, "o", "source <(awk -F'=' '/^[^#]/ && NF==2 {print $1 \"=\" $2}' \"$CONFIG_FILE\" 2>/dev/null)\r\n\u001b[?2004l\r"]
[80.637464, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[80.637516, "o", "> "]
[80.637571, "o", "cutoff_days=${cutoff_days:-0}\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.637766, "o", "max_bak_kb=${max_bak_kb:-0}\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.638111, "o", "if [[ -z \"$cutoff_days\" || -z \"$max_bak_kb\" ]]; then\r\n\u001b[?2004l\r\u001b[?2004h>     echo \"Warning: Failed to load all parameters from config file. Using defaults.\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.638172, "o", "> fi\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.638816, "o", "echo \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> deleted_bytes=0\r\n\u001b[?2004l\r"]
[80.639216, "o", "\u001b[?2004h> corrupt_count=0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Phase 2: Pruning .bak files\r\n\u001b[?2004l\r\u001b[?2004h> find /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\r\n\u001b[?2004l\r"]
[80.639415, "o", "\u001b[?2004h>     filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.639542, "o", "    if [[ $filesize_kb -gt $max_bak_kb ]]; then\r\n\u001b[?2004l\r"]
[80.639668, "o", "\u001b[?2004h> "]
[80.639708, "o", "        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r"]
[80.639802, "o", "\u001b[?2004h> "]
[80.639848, "o", "        rm \"$bakfile\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.639937, "o", "> "]
[80.640027, "o", "        deleted_bytes=$((deleted_bytes + bytes_deleted))\r\n"]
[80.640056, "o", "\u001b[?2004l\r\u001b[?2004h"]
[80.640078, "o", "> "]
[80.640242, "o", "        echo \"Deleted large .bak file: $bakfile (${filesize_kb}KB)\"\r\n"]
[80.640272, "o", "\u001b[?2004l\r\u001b[?2004h"]
[80.640291, "o", "> "]
[80.640355, "o", "    fi\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.640386, "o", "done\r\n\u001b[?2004l\r"]
[80.640408, "o", "\u001b[?2004h> "]
[80.640425, "o", "\r\n\u001b[?2004l\r"]
[80.64045, "o", "\u001b[?2004h"]
[80.640471, "o", "> "]
[80.64056, "o", "# Phase 3: Archival of .txt files\r\n"]
[80.640608, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[80.640723, "o", "cutoff_time=$(date -d \"-$cutoff_days days\" +%s)\r\n"]
[80.640753, "o", "\u001b[?2004l\r"]
[80.640775, "o", "\u001b[?2004h> "]
[80.641054, "o", "find /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\r\n"]
[80.641125, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[80.641324, "o", "    # Validate UTF-8 using iconv (more portable than file command)"]
[80.641369, "o", "\r\n"]
[80.641414, "o", "\u001b[?2004l\r"]
[80.641468, "o", "\u001b[?2004h"]
[80.641514, "o", "> "]
[80.641721, "o", "    if ! iconv -f UTF-8 -t UTF-8 \"$txtfile\" >/dev/null 2>&1; then"]
[80.641764, "o", "\r\n\u001b[?2004l\r"]
[80.64181, "o", "\u001b[?2004h"]
[80.641972, "o", ">         corrupt_count=$((corrupt_count + 1))"]
[80.642008, "o", "\r\n"]
[80.642046, "o", "\u001b[?2004l\r"]
[80.642102, "o", "\u001b[?2004h"]
[80.642181, "o", "> "]
[80.642318, "o", "        mv \"$txtfile\" \"${txtfile}.corrupt\""]
[80.642368, "o", "\r\n"]
[80.64241, "o", "\u001b[?2004l\r"]
[80.642462, "o", "\u001b[?2004h"]
[80.64252, "o", "> "]
[80.642684, "o", "        echo \"Renamed corrupt file: $txtfile\""]
[80.642745, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.642781, "o", "    else\r\n"]
[80.64279, "o", "\u001b[?2004l\r"]
[80.64282, "o", "\u001b[?2004h"]
[80.642858, "o", "> "]
[80.643389, "o", "        mv \"$txtfile\" /home/user/storage/archive/\r\n\u001b[?2004l\r\u001b[?2004h>         echo \"Archived valid UTF-8 file: $txtfile\"\r\n\u001b[?2004l\r\u001b[?2004h>     fi\r\n\u001b[?2004l\r\u001b[?2004h> done\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> # Phase 4: Manifest Generation\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.64346, "o", "ARCHIVE_DIR=\"/home/user/storage/archive\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.643569, "o", "MANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\r\n\u001b[?2004l\r"]
[80.643584, "o", "\u001b[?2004h> "]
[80.643593, "o", "\r\n\u001b[?2004l\r"]
[80.643663, "o", "\u001b[?2004h> "]
[80.643757, "o", "# Create manifest with CRLF line endings - fixed syntax\r\n\u001b[?2004l\r"]
[80.643792, "o", "\u001b[?2004h> "]
[80.643842, "o", "rm -f \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[80.643864, "o", "\u001b[?2004h> "]
[80.644048, "o", "find \"$ARCHIVE_DIR\" -type f -print0 | while IFS= read -r -d '' file; do\r\n\u001b[?2004l\r"]
[80.644081, "o", "\u001b[?2004h"]
[80.644104, "o", "> "]
[80.64416, "o", "    size=$(du -b \"$file\" | cut -f1)\r\n\u001b[?2004l\r"]
[80.644176, "o", "\u001b[?2004h> "]
[80.644292, "o", "    md5=$(md5sum \"$file\" | cut -d' ' -f1)\r\n\u001b[?2004l\r"]
[80.644309, "o", "\u001b[?2004h> "]
[80.644448, "o", "    # Escape commas, quotes, and newlines in filenames\r\n\u001b[?2004l\r"]
[80.644458, "o", "\u001b[?2004h"]
[80.644514, "o", "> "]
[80.644709, "o", "    filename=$(echo \"$file\" | sed -e 's/,/\\,/g' -e \"s/\\\\\\\"/'\\\\\\\\\"'/g\" -e ':a;N;s/\\\\n/\\\\\\n/g;ta\")\r\n\u001b[?2004l\r"]
[80.644727, "o", "\u001b[?2004h> "]
[80.644917, "o", "    printf \"%s,%d,%s\\r\\n\" \"$filename\" \"$size\" \"$md5\" >> \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r\u001b[?2004h"]
[80.644939, "o", "> done\r\n"]
[80.64496, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[80.644988, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.645069, "o", "# Sort the manifest by MD5 hash\r\n\u001b[?2004l\r"]
[80.645107, "o", "\u001b[?2004h"]
[80.645131, "o", "> "]
[80.645212, "o", "sort -t, -k3 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[80.645232, "o", "\u001b[?2004h> "]
[80.645261, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[80.645317, "o", "# Phase 5: Audit Report\r\n\u001b[?2004l\r"]
[80.645335, "o", "\u001b[?2004h> "]
[80.645445, "o", "cat > /home/user/storage/summary.xml << EOF\r\n\u001b[?2004l\r"]
[80.645468, "o", "\u001b[?2004h> "]
[80.645573, "o", "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n\u001b[?2004l\r"]
[80.64559, "o", "\u001b[?2004h> "]
[80.645617, "o", "<audit>\r\n\u001b[?2004l\r"]
[80.645632, "o", "\u001b[?2004h> "]
[80.645781, "o", "    <deleted_bytes>$deleted_bytes</deleted_bytes>\r\n\u001b[?2004l\r"]
[80.645803, "o", "\u001b[?2004h> "]
[80.645929, "o", "    <corrupt_files>$corrupt_count</corrupt_files>\r\n\u001b[?2004l\r"]
[80.64595, "o", "\u001b[?2004h> "]
[80.646141, "o", "    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\r\n\u001b[?2004l\r"]
[80.646164, "o", "\u001b[?2004h> "]
[80.646184, "o", "</audit>\r\n\u001b[?2004l\r"]
[80.646207, "o", "\u001b[?2004h> EOF\r\n"]
[80.646226, "o", "\u001b[?2004l\r"]
[80.647401, "o", "\u001b[?2004h"]
[80.647441, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.647459, "o", "\r\n\u001b[?2004l\r"]
[80.647474, "o", "\u001b[?2004h"]
[80.647489, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.647689, "o", "# Ensure ISO-8859-1 encoding for XML file\r\n"]
[80.647705, "o", "\u001b[?2004l\r"]
[80.647734, "o", "\u001b[?2004h"]
[80.647751, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.648017, "o", "iconv -f UTF-8 -t ISO-8859-1 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[80.648991, "o", "iconv: cannot open input file `': No such file or directory\r\n"]
[80.649142, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.649413, "o", "iconv -f UTF-8 -t ISO-8859-1 \"/home/user/storage/summary.xml\" -o \"/home/user/storage/summary.xml\"\r\n\u001b[?2004l\r"]
[80.650558, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.650595, "o", "\r\n\u001b[?2004l\r\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.650637, "o", "# Final Cleanup\r\n\u001b[?2004l\r"]
[80.65066, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.650805, "o", "find /home/user/storage/incoming -type d -empty -delete\r\n\u001b[?2004l\r"]
[80.652396, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.652406, "o", "\r\n\u001b[?2004l\r"]
[80.65245, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[80.652657, "o", "echo \"Maintenance complete. Deleted bytes: $deleted_bytes, Corrupt files: $corrupt_count\"\r\n\u001b[?2004l\r"]
[80.652687, "o", "Maintenance complete. Deleted bytes: , Corrupt files: \r\n"]
[80.652709, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# EOF\r\n\u001b[?2004l\r"]
[80.653121, "o", "bash: EOF: command not found\r\n"]
[80.653305, "o", "\u001b[?2004h"]
[80.653324, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[81.024644, "i", "chmod +x /usr/local/bin/storage_maintenance.sh\n"]
[81.024821, "o", "chmod +x /usr/local/bin/storage_maintenance.sh\r\n\u001b[?2004l\r"]
[81.025759, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[81.137774, "i", "/usr/local/bin/storage_maintenance.sh\n"]
[81.138149, "o", "/usr/local/bin/storage_maintenance.sh\r\n\u001b[?2004l\r"]
[81.141188, "o", "/dev/fd/63: line 1: cutoff_days: command not found\r\n"]
[81.1422, "o", "/dev/fd/63: line 2: max_bak_kb: command not found\r\n"]
[81.142428, "o", "Loaded parameters: cutoff_days=0, max_bak_kb=0 KB\r\n"]
[81.147432, "o", "/usr/local/bin/storage_maintenance.sh: line 69: unexpected EOF while looking for matching `\"'\r\n/usr/local/bin/storage_maintenance.sh: line 75: syntax error: unexpected end of file\r\n"]
[81.147806, "o", "\u001b[?2004h"]
[81.147833, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[83.162619, "i", "ls -la /home/user/storage/\n"]
[83.162744, "o", "ls -la /home/user/storage/\r\n\u001b[?2004l\r"]
[83.164096, "o", "total 8\r\n"]
[83.16414, "o", "drwxr-xr-x 1 root root  95 Feb 13 18:51 \u001b[0m\u001b[01;34m.\u001b[0m\r\ndrwxrwxrwx 1 root root  29 Feb 13 18:50 \u001b[34;42m..\u001b[0m\r\ndrwxr-xr-x 1 root root  87 Feb 13 18:52 \u001b[01;34marchive\u001b[0m\r\ndrwxr-xr-x 1 root root  91 Feb 13 18:52 \u001b[01;34mincoming\u001b[0m\r\n"]
[83.164165, "o", "-rw-r--r-- 1 root root  81 Feb 13 18:51 params.conf\r\n-rw-r--r-- 1 root root 211 Feb 13 18:52 summary.xml\r\n"]
[83.164365, "o", "\u001b[?2004h"]
[83.164384, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[83.652953, "i", "head -10 /home/user/storage/summary.xml\n"]
[83.653103, "o", "head -10 /home/user/storage/summary.xml\r\n\u001b[?2004l\r"]
[83.654013, "o", "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n<audit>\r\n    <deleted_bytes>0</deleted_bytes>\r\n    <corrupt_files>0</corrupt_files>\r\n    <manifest_sha1>404802f27eb0da1ba59af6e8ef18a70ec05c2254</manifest_sha1>\r\n</audit>\r\n"]
[83.654191, "o", "\u001b[?2004h"]
[83.654212, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[84.153405, "i", "head -10 /home/user/storage/archive/manifest.csv\n"]
[84.153579, "o", "head -10 /home/user/storage/archive/manifest.csv\r\n\u001b[?2004l\r"]
[84.154328, "o", "head: cannot open '/home/user/storage/archive/manifest.csv' for reading: No such file or directory\r\n"]
[84.15447, "o", "\u001b[?2004h"]
[84.154504, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.075007, "i", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\n#!/bin/bash\n\n# Phase 1: Configuration\nCONFIG_FILE=\"/home/user/storage/params.conf\"\nif [[ ! -f \"$CONFIG_FILE\" ]]; then\n    echo \"Configuration file missing: $CONFIG_FILE\"\n    exit 1\nfi\n\n# Parse parameters using awk with proper quoting\nsource <(awk -F'=' \"/^[^#]/ && NF==2 {gsub(/\\\\\\\"/, \"\\\\\\\\\\\"\"); gsub(/\\\\\\\\\\\\\\\\/, \"\\\\\\\\\\\\\\\"\\\"); print \\$1 \\\"=\\\" \\$2}\" \"$CONFIG_FILE\" 2>/dev/null)\n\ncutoff_days=${cutoff_days:-0}\nmax_bak_kb=${max_bak_kb:-0}\n\necho \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\n\ndeleted_bytes=0\ncorrupt_count=0\n\n# Phase 2: Pruning .bak files\nfind /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\n    filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\n    if [[ $filesize_kb -gt $max_bak_kb ]]; then\n        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)\n        rm \"$bakfile\"\n        deleted_bytes=$((deleted_bytes + bytes_deleted))\n        echo \"Deleted large .bak"]
[108.075151, "i", " file: $bakfile (${filesize_kb}KB)\"\n    fi\ndone\n\n# Phase 3: Archival of .txt files\ncutoff_time=$(date -d \"-$cutoff_days days\" +%s)\nfind /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\n    if ! iconv -f UTF-8 -t UTF-8 \"$txtfile\" >/dev/null 2>&1; then\n        corrupt_count=$((corrupt_count + 1))\n        mv \"$txtfile\" \"${txtfile}.corrupt\"\n        echo \"Renamed corrupt file: $txtfile\"\n    else\n        mv \"$txtfile\" /home/user/storage/archive/\n        echo \"Archived valid UTF-8 file: $txtfile\"\n    fi\ndone\n\n# Phase 4: Manifest Generation\nARCHIVE_DIR=\"/home/user/storage/archive\"\nMANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\n\n# Create manifest with CRLF line endings\nfind \"$ARCHIVE_DIR\" -type f -print0 | while IFS= read -r -d '' file; do\n    size=$(du -b \"$file\" | cut -f1)\n    md5=$(md5sum \"$file\" | cut -d' ' -f1)\n    filename=$(echo \"$file\" | sed 's/,/\\,/g; s/\"/\\\"/g')\n    printf \"%s,%d,%s\\r\\n\" \"$filename\" \"$size\" \"$md5\" >> \"$MANIFEST_FILE\"\ndone\n\n# Sort the manifest by MD5 "]
[108.075187, "i", "hash\nsort -t, -k3 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\n\n# Phase 5: Audit Report\ncat > /home/user/storage/summary.xml << EOF\n<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\n<audit>\n    <deleted_bytes>$deleted_bytes</deleted_bytes>\n    <corrupt_files>$corrupt_count</corrupt_files>\n    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\n</audit>\nEOF\n\n# Final Cleanup\nfind /home/user/storage/incoming -type d -empty -delete\n\necho \"Maintenance complete. Deleted bytes: $deleted_bytes, Corrupt files: $corrupt_count\"\nEOF\n"]
[108.075217, "o", "cat > /usr/local/bin/storage_maintenance.sh << 'EOF'\r\n\u001b[?2004l\r"]
[108.07525, "o", "\u001b[?2004h> "]
[108.075284, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[108.075313, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[108.075341, "o", "\u001b[?2004h> "]
[108.07543, "o", "# Phase 1: Configuration\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.075523, "o", "CONFIG_FILE=\"/home/user/storage/params.conf\"\r\n\u001b[?2004l\r"]
[108.075552, "o", "\u001b[?2004h> "]
[108.075641, "o", "if [[ ! -f \"$CONFIG_FILE\" ]]; then\r\n\u001b[?2004l\r\u001b[?2004h"]
[108.07568, "o", "> "]
[108.075776, "o", "    echo \"Configuration file missing: $CONFIG_FILE\"\r\n\u001b[?2004l\r"]
[108.075807, "o", "\u001b[?2004h> "]
[108.075834, "o", "    exit 1\r\n\u001b[?2004l\r"]
[108.075863, "o", "\u001b[?2004h> fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[108.07589, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.076025, "o", "# Parse parameters using awk with proper quoting\r\n\u001b[?2004l\r"]
[108.076052, "o", "\u001b[?2004h> "]
[108.076394, "o", "source <(awk -F'=' \"/^[^#]/ && NF==2 {gsub(/\\\\\\\"/, \"\\\\\\\\\\\"\"); gsub(/\\\\\\\\\\\\\\\\/, \"\\\\\\\\\\\\\\\"\\\"); print \\$1 \\\"=\\\" \\$2}\" \"$CONFIG_FILE\" 2>/dev/null)\r\n\u001b[?2004l\r"]
[108.076426, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[108.076454, "o", "> "]
[108.07651, "o", "cutoff_days=${cutoff_days:-0}\r\n\u001b[?2004l\r"]
[108.076527, "o", "\u001b[?2004h> "]
[108.076602, "o", "max_bak_kb=${max_bak_kb:-0}\r\n\u001b[?2004l\r"]
[108.07663, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[108.076656, "o", "> "]
[108.07683, "o", "echo \"Loaded parameters: cutoff_days=$cutoff_days, max_bak_kb=$max_bak_kb KB\"\r\n\u001b[?2004l\r"]
[108.076867, "o", "\u001b[?2004h"]
[108.076893, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.076965, "o", "deleted_bytes=0\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.076998, "o", "corrupt_count=0\r\n\u001b[?2004l\r\u001b[?2004h> \r\n\u001b[?2004l\r"]
[108.077026, "o", "\u001b[?2004h> "]
[108.077107, "o", "# Phase 2: Pruning .bak files\r\n\u001b[?2004l\r\u001b[?2004h"]
[108.077141, "o", "> "]
[108.0774, "o", "find /home/user/storage/incoming -type f -name \"*.bak\" ! -name \"_*.bak\" -print0 | while IFS= read -r -d '' bakfile; do\r\n\u001b[?2004l\r"]
[108.07743, "o", "\u001b[?2004h"]
[108.077458, "o", "> "]
[108.07757, "o", "    filesize_kb=$(du -k --apparent-size \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r"]
[108.077603, "o", "\u001b[?2004h"]
[108.07763, "o", "> "]
[108.077705, "o", "    if [[ $filesize_kb -gt $max_bak_kb ]]; then\r\n\u001b[?2004l\r"]
[108.077732, "o", "\u001b[?2004h"]
[108.077759, "o", "> "]
[108.077854, "o", "        bytes_deleted=$(du -b \"$bakfile\" | cut -f1)\r\n\u001b[?2004l\r"]
[108.077879, "o", "\u001b[?2004h"]
[108.077954, "o", ">         rm \"$bakfile\"\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.078093, "o", "        deleted_bytes=$((deleted_bytes + bytes_deleted))\r\n\u001b[?2004l\r"]
[108.078137, "o", "\u001b[?2004h"]
[108.078176, "o", "> "]
[108.078277, "o", "        echo \"Deleted large .bak file: $bakfile (${filesize_kb}KB)\"\r\n\u001b[?2004l\r"]
[108.078306, "o", "\u001b[?2004h> "]
[108.078337, "o", "    fi\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.078365, "o", "done\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.078392, "o", "\r\n\u001b[?2004l\r\u001b[?2004h> "]
[108.078483, "o", "# Phase 3: Archival of .txt files\r\n\u001b[?2004l\r"]
[108.078511, "o", "\u001b[?2004h> "]
[108.078621, "o", "cutoff_time=$(date -d \"-$cutoff_days days\" +%s)\r\n\u001b[?2004l\r"]
[108.078652, "o", "\u001b[?2004h> "]
[108.078881, "o", "find /home/user/storage/incoming -type f -name \"*.txt\" -print0 | while IFS= read -r -d '' txtfile; do\r\n\u001b[?2004l\r"]
[108.078921, "o", "\u001b[?2004h"]
[108.078951, "o", "> "]
[108.0791, "o", "    if ! iconv -f UTF-8 -t UTF-8 \"$txtfile\" >/dev/null 2>&1; then\r\n\u001b[?2004l\r"]
[108.079127, "o", "\u001b[?2004h"]
[108.079139, "o", "> "]
[108.07923, "o", "        corrupt_count=$((corrupt_count + 1))\r\n\u001b[?2004l\r"]
[108.079258, "o", "\u001b[?2004h"]
[108.079287, "o", "> "]
[108.079363, "o", "        mv \"$txtfile\" \"${txtfile}.corrupt\"\r\n\u001b[?2004l\r"]
[108.079389, "o", "\u001b[?2004h"]
[108.079401, "o", "> "]
[108.079494, "o", "        echo \"Renamed corrupt file: $txtfile\"\r\n\u001b[?2004l\r"]
[108.07952, "o", "\u001b[?2004h"]
[108.079546, "o", ">     else\r\n\u001b[?2004l\r"]
[108.079572, "o", "\u001b[?2004h> "]
[108.079681, "o", "        mv \"$txtfile\" /home/user/storage/archive/\r\n\u001b[?2004l\r"]
[108.079695, "o", "\u001b[?2004h"]
[108.0797, "o", "> "]
[108.079824, "o", "        echo \"Archived valid UTF-8 file: $txtfile\"\r\n\u001b[?2004l\r"]
[108.079846, "o", "\u001b[?2004h> "]
[108.079864, "o", "    fi\r\n\u001b[?2004l\r"]
[108.079883, "o", "\u001b[?2004h> "]
[108.079911, "o", "done\r\n\u001b[?2004l\r"]
[108.07993, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[108.079948, "o", "\u001b[?2004h"]
[108.079966, "o", "> "]
[108.080031, "o", "# Phase 4: Manifest Generation\r\n\u001b[?2004l\r"]
[108.080051, "o", "\u001b[?2004h> "]
[108.08015, "o", "ARCHIVE_DIR=\"/home/user/storage/archive\"\r\n\u001b[?2004l\r"]
[108.08017, "o", "\u001b[?2004h> "]
[108.080272, "o", "MANIFEST_FILE=\"$ARCHIVE_DIR/manifest.csv\"\r\n\u001b[?2004l\r"]
[108.080287, "o", "\u001b[?2004h"]
[108.080303, "o", "> \r\n\u001b[?2004l\r"]
[108.080323, "o", "\u001b[?2004h> "]
[108.080416, "o", "# Create manifest with CRLF line endings\r\n\u001b[?2004l\r"]
[108.080437, "o", "\u001b[?2004h> "]
[108.08061, "o", "find \"$ARCHIVE_DIR\" -type f -print0 | while IFS= read -r -d '' file; do\r\n\u001b[?2004l\r"]
[108.08065, "o", "\u001b[?2004h> "]
[108.080722, "o", "    size=$(du -b \"$file\" | cut -f1)\r\n\u001b[?2004l\r"]
[108.080739, "o", "\u001b[?2004h"]
[108.080758, "o", "> "]
[108.080849, "o", "    md5=$(md5sum \"$file\" | cut -d' ' -f1)\r\n\u001b[?2004l\r"]
[108.080866, "o", "\u001b[?2004h> "]
[108.081009, "o", "    filename=$(echo \"$file\" | sed 's/,/\\,/g; s/\"/\\\"/g')\r\n\u001b[?2004l\r"]
[108.081025, "o", "\u001b[?2004h"]
[108.081041, "o", "> "]
[108.081207, "o", "    printf \"%s,%d,%s\\r\\n\" \"$filename\" \"$size\" \"$md5\" >> \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[108.081223, "o", "\u001b[?2004h> "]
[108.08124, "o", "done\r\n\u001b[?2004l\r"]
[108.081259, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[108.081285, "o", "\u001b[?2004h"]
[108.081303, "o", "> "]
[108.081363, "o", "# Sort the manifest by MD5 hash\r\n\u001b[?2004l\r"]
[108.081402, "o", "\u001b[?2004h> "]
[108.081504, "o", "sort -t, -k3 \"$MANIFEST_FILE\" -o \"$MANIFEST_FILE\"\r\n\u001b[?2004l\r"]
[108.081527, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[108.081545, "o", "\u001b[?2004h> "]
[108.081607, "o", "# Phase 5: Audit Report\r\n\u001b[?2004l\r"]
[108.08163, "o", "\u001b[?2004h"]
[108.081647, "o", "> "]
[108.081735, "o", "cat > /home/user/storage/summary.xml << EOF\r\n\u001b[?2004l\r"]
[108.081757, "o", "\u001b[?2004h> "]
[108.081861, "o", "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n\u001b[?2004l\r"]
[108.081882, "o", "\u001b[?2004h> "]
[108.08191, "o", "<audit>\r\n\u001b[?2004l\r"]
[108.081932, "o", "\u001b[?2004h> "]
[108.08205, "o", "    <deleted_bytes>$deleted_bytes</deleted_bytes>\r\n\u001b[?2004l\r"]
[108.082072, "o", "\u001b[?2004h"]
[108.082091, "o", "> "]
[108.082192, "o", "    <corrupt_files>$corrupt_count</corrupt_files>\r\n\u001b[?2004l\r"]
[108.082225, "o", "\u001b[?2004h> "]
[108.082404, "o", "    <manifest_sha1>$(sha1sum \"$MANIFEST_FILE\" | cut -d' ' -f1)</manifest_sha1>\r\n\u001b[?2004l\r"]
[108.082419, "o", "\u001b[?2004h"]
[108.082438, "o", "> "]
[108.082456, "o", "</audit>\r\n\u001b[?2004l\r"]
[108.082474, "o", "\u001b[?2004h> "]
[108.082493, "o", "EOF\r\n\u001b[?2004l\r"]
[108.083477, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# \r\n\u001b[?2004l\r"]
[108.083498, "o", "\u001b[?2004h"]
[108.083526, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.083548, "o", "# Final Cleanup\r\n\u001b[?2004l\r"]
[108.083568, "o", "\u001b[?2004h"]
[108.083584, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.083713, "o", "find /home/user/storage/incoming -type d -empty -delete\r\n\u001b[?2004l\r"]
[108.084838, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# \r\n\u001b[?2004l\r"]
[108.084878, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.085118, "o", "echo \"Maintenance complete. Deleted bytes: $deleted_bytes, Corrupt files: $corrupt_count\"\r\n\u001b[?2004l\r"]
[108.085141, "o", "Maintenance complete. Deleted bytes: , Corrupt files: \r\n"]
[108.085163, "o", "\u001b[?2004h"]
[108.085189, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# EOF\r\n\u001b[?2004l\r"]
[108.085513, "o", "bash: EOF: command not found\r\n"]
[108.085673, "o", "\u001b[?2004h"]
[108.085692, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.234241, "i", "chmod +x /usr/local/bin/storage_maintenance.sh\n"]
[108.234413, "o", "chmod +x /usr/local/bin/storage_maintenance.sh\r\n"]
[108.234436, "o", "\u001b[?2004l\r"]
[108.235287, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[108.49997, "i", "/usr/local/bin/storage_maintenance.sh\n"]
[108.500125, "o", "/usr/local/bin/storage_maintenance.sh\r\n\u001b[?2004l\r"]
[108.501431, "o", "/usr/local/bin/storage_maintenance.sh: line 28: syntax error near unexpected token `('\r\n/usr/local/bin/storage_maintenance.sh: line 28: `        echo \"Deleted large .bak file: $bakfile (${filesize_kb}KB)\"'\r\n"]
[108.50164, "o", "\u001b[?2004hroot@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[110.502198, "i", "ls -la /home/user/storage/\n"]
[110.502315, "o", "ls -la /home/user/storage/\r\n\u001b[?2004l\r"]
[110.503602, "o", "total 8\r\n"]
[110.503654, "o", "drwxr-xr-x 1 root root  95 Feb 13 18:51 \u001b[0m\u001b[01;34m.\u001b[0m\r\ndrwxrwxrwx 1 root root  29 Feb 13 18:50 \u001b[34;42m..\u001b[0m\r\ndrwxr-xr-x 1 root root  87 Feb 13 18:52 \u001b[01;34marchive\u001b[0m\r\ndrwxr-xr-x 1 root root  91 Feb 13 18:52 \u001b[01;34mincoming\u001b[0m\r\n"]
[110.50368, "o", "-rw-r--r-- 1 root root  81 Feb 13 18:51 params.conf\r\n-rw-r--r-- 1 root root 211 Feb 13 18:52 summary.xml\r\n"]
[110.503913, "o", "\u001b[?2004h"]
[110.50395, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[111.006348, "i", "head -10 /home/user/storage/summary.xml\n"]
[111.006504, "o", "head -10 /home/user/storage/summary.xml\r\n\u001b[?2004l\r"]
[111.007246, "o", "<?xml version=\"1.0\" encoding=\"ISO-8859-1\"?>\r\n<audit>\r\n    <deleted_bytes>0</deleted_bytes>\r\n    <corrupt_files>0</corrupt_files>\r\n    <manifest_sha1>404802f27eb0da1ba59af6e8ef18a70ec05c2254</manifest_sha1>\r\n</audit>\r\n"]
[111.007396, "o", "\u001b[?2004h"]
[111.007427, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[111.507498, "i", "head -10 /home/user/storage/archive/manifest.csv\n"]
[111.507672, "o", "head -10 /home/user/storage/archive/manifest.csv\r\n"]
[111.507704, "o", "\u001b[?2004l\r"]
[111.508457, "o", "head: cannot open '/home/user/storage/archive/manifest.csv' for reading"]
[111.508508, "o", ": No such file or directory\r\n"]
[111.508636, "o", "\u001b[?2004h"]
[111.508662, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
[112.001282, "i", "file /home/user/storage/summary.xml\n"]
[112.001432, "o", "file /home/user/storage/summary.xml\r\n\u001b[?2004l\r"]
[112.001856, "o", "bash: file: command not found\r\n"]
[112.002137, "o", "\u001b[?2004h"]
[112.002156, "o", "root@29372756-c152-4945-afbf-6ac4c6f58d37:~# "]
