{"version": 2, "width": 160, "height": 40, "timestamp": 1771009262, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.008355, "o", "\u001b[?2004hroot@ce601f82-7746-4839-81ca-34136a84ecde:~# "]
[0.93914, "i", "clear\r"]
[0.939353, "o", "clear\r\n"]
[0.939485, "o", "\u001b[?2004l\r"]
[0.940414, "o", "\u001b[H\u001b[J"]
[0.940573, "o", "\u001b[?2004hroot@ce601f82-7746-4839-81ca-34136a84ecde:~# "]
[32.433969, "i", "cd /home/user/hardening_test\n"]
[32.434104, "o", "cd /home/user/hardening_test\r\n\u001b[?2004l\r"]
[32.434251, "o", "\u001b[?2004hroot@ce601f82-7746-4839-81ca-34136a84ecde:/home/user/hardening_test# "]
[32.621812, "i", "cat > apply_hardening.sh << 'EOF'\n#!/bin/sh\n\n# POSIX-compliant hardening automation script\n# Ensure we're in the correct directory\nif [ \"$(basename \"$PWD\")\" != \"hardening_test\" ]; then\n    echo \"Error: Script must be run from /home/user/hardening_test/\" >&2\n    exit 1\nfi\n\nset -e\n\n# Initialize empty log file\nlog_file=\"hardening.log\"\necho -n > \"$log_file\"\n\n# Process each rule from rules.txt\nwhile IFS='|' read -r filename search_pattern enforced_line; do\n    # Skip empty or comment lines\n    if [ -z \"$filename\" ] || [ \"${filename:0:1}\" = \"#\" ]; then\n        continue\n    fi\n    \n    # Safety backup: only create if doesn't exist\n    if [ ! -f \"${filename}.bak\" ]; then\n        if [ -f \"$filename\" ]; then\n            cp \"$filename\" \"${filename}.bak\"\n        else\n            echo \"$filename: File not found, skipping backup\" >> \"$log_file\"\n            continue\n        fi\n    fi\n\n    # Trim enforced_line to avoid trailing newline issues\n    enforced_line=\"${enforced_line%\\n}\"\n\n    # Check if enforced_line already exist"]
[32.621927, "i", "s exactly\n    if grep -Fxq \"$enforced_line\" \"$filename\" 2>/dev/null; then\n        echo \"$filename:SKIPPED\" >> \"$log_file\"\n        chmod 0600 \"$filename\"\n        continue\n    fi\n\n    # Try to repair by replacing matching pattern line\n    if grep -qE \"^$search_pattern\" \"$filename\" 2>/dev/null; then\n        # Create temp file for atomic replacement\n        temp_file=\"$(mktemp)\"\n        # Use sed to replace the matching line\n        sed -E \"s/^\\($search_pattern\\)/$enforced_line/\" \"$filename\" > \"$temp_file\"\n        # Atomic replacement\n        mv \"$temp_file\" \"$filename\"\n        echo \"$filename:REPAIRED\" >> \"$log_file\"\n    else\n        # Append the enforced line\n        echo \"$enforced_line\" >> \"$filename\"\n        echo \"$filename:APPENDED\" >> \"$log_file\"\n    fi\n\n    # Set strict permissions\n    case \"$filename\" in\n        \"sshd_config\") chmod 0600 \"$filename\" ;;\n        *) chmod 0644 \"$filename\" ;;\n    esac\n\ndone < \"rules.txt\"\n\n# Sort the log file alphabetically by filename\nsort \"$log_file\" -o \"$log_file\"\n\n# Final"]
[32.621955, "i", " user feedback\necho \"Hardening completed\"\nEOF\n"]
[32.622128, "o", "cat > apply_hardening.sh << 'EOF'\r\n\u001b[?2004l\r"]
[32.622201, "o", "\u001b[?2004h"]
[32.622231, "o", "> "]
[32.622289, "o", "#!/bin/sh\r\n\u001b[?2004l\r"]
[32.622331, "o", "\u001b[?2004h"]
[32.622352, "o", "> \r\n"]
[32.622383, "o", "\u001b[?2004l\r"]
[32.622401, "o", "\u001b[?2004h"]
[32.622421, "o", "> "]
[32.622719, "o", "# POSIX-compliant hardening automation script\r\n\u001b[?2004l\r"]
[32.62278, "o", "\u001b[?2004h"]
[32.622811, "o", "> "]
[32.623044, "o", "# Ensure we're in the correct directory\r\n"]
[32.623062, "o", "\u001b[?2004l\r"]
[32.623085, "o", "\u001b[?2004h"]
[32.623102, "o", "> "]
[32.623446, "o", "if [ \"$(basename \"$PWD\")\" != \"hardening_test\" ]; then\r\n\u001b[?2004l\r"]
[32.623499, "o", "\u001b[?2004h"]
[32.623517, "o", "> "]
[32.623994, "o", "    echo \"Error: Script must be run from /home/user/hardening_test/\" >&2\r\n\u001b[?2004l\r"]
[32.624032, "o", "\u001b[?2004h"]
[32.624054, "o", "> "]
[32.624122, "o", "    exit 1\r\n\u001b[?2004l\r"]
[32.624158, "o", "\u001b[?2004h"]
[32.624181, "o", "> "]
[32.624201, "o", "fi\r\n\u001b[?2004l\r"]
[32.624241, "o", "\u001b[?2004h"]
[32.624264, "o", "> \r\n\u001b[?2004l\r"]
[32.6243, "o", "\u001b[?2004h"]
[32.624322, "o", "> "]
[32.624363, "o", "set -e\r\n"]
[32.624384, "o", "\u001b[?2004l\r"]
[32.624403, "o", "\u001b[?2004h"]
[32.624423, "o", "> "]
[32.624441, "o", "\r\n\u001b[?2004l\r"]
[32.624464, "o", "\u001b[?2004h"]
[32.624489, "o", "> "]
[32.624664, "o", "# Initialize empty log file\r\n\u001b[?2004l\r"]
[32.624698, "o", "\u001b[?2004h"]
[32.624723, "o", "> "]
[32.624884, "o", "log_file=\"hardening.log\"\r\n"]
[32.624905, "o", "\u001b[?2004l\r"]
[32.624931, "o", "\u001b[?2004h"]
[32.62495, "o", "> "]
[32.625091, "o", "echo -n > \"$log_file\"\r\n\u001b[?2004l\r"]
[32.625127, "o", "\u001b[?2004h"]
[32.625148, "o", "> \r\n"]
[32.625165, "o", "\u001b[?2004l\r"]
[32.625193, "o", "\u001b[?2004h"]
[32.625212, "o", "> "]
[32.625432, "o", "# Process each rule from rules.txt\r\n\u001b[?2004l\r"]
[32.625468, "o", "\u001b[?2004h"]
[32.625488, "o", "> "]
[32.625901, "o", "while IFS='|' read -r filename search_pattern enforced_line; do\r\n"]
[32.62594, "o", "\u001b[?2004l\r\u001b[?2004h"]
[32.625962, "o", "> "]
[32.626177, "o", "    # Skip empty or comment lines\r\n\u001b[?2004l\r"]
[32.626212, "o", "\u001b[?2004h"]
[32.626237, "o", "> "]
[32.626685, "o", "    if [ -z \"$filename\" ] || [ \"${filename:0:1}\" = \"#\" ]; then\r\n\u001b[?2004l\r\u001b[?2004h"]
[32.626799, "o", "> "]
[32.626853, "o", "        continue\r\n\u001b[?2004l\r"]
[32.626902, "o", "\u001b[?2004h"]
[32.626948, "o", "> "]
[32.626995, "o", "    fi\r\n\u001b[?2004l\r"]
[32.627053, "o", "\u001b[?2004h> "]
[32.627099, "o", "    \r\n\u001b[?2004l\r"]
[32.627146, "o", "\u001b[?2004h"]
[32.627192, "o", "> "]
[32.627511, "o", "    # Safety backup: only create if doesn't exist\r\n\u001b[?2004l\r"]
[32.627558, "o", "\u001b[?2004h> "]
[32.627861, "o", "    if [ ! -f \"${filename}.bak\" ]; then\r\n\u001b[?2004l\r"]
[32.627909, "o", "\u001b[?2004h> "]
[32.628164, "o", "        if [ -f \"$filename\" ]; then\r\n\u001b[?2004l\r"]
[32.628213, "o", "\u001b[?2004h"]
[32.628267, "o", "> "]
[32.628608, "o", "            cp \"$filename\" \"${filename}.bak\"\r\n\u001b[?2004l\r"]
[32.628664, "o", "\u001b[?2004h> "]
[32.628835, "o", "        else\r\n\u001b[?2004l\r\u001b[?2004h> "]
[32.629341, "o", "            echo \"$filename: File not found, skipping backup\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[32.629392, "o", "\u001b[?2004h"]
[32.629425, "o", "> "]
[32.629574, "o", "            continue\r\n\u001b[?2004l\r"]
[32.629647, "o", "\u001b[?2004h> "]
[32.629755, "o", "        fi\r\n\u001b[?2004l\r"]
[32.629798, "o", "\u001b[?2004h"]
[32.629847, "o", "> "]
[32.62989, "o", "    fi\r\n\u001b[?2004l\r"]
[32.62993, "o", "\u001b[?2004h"]
[32.629971, "o", "> \r\n\u001b[?2004l\r"]
[32.63002, "o", "\u001b[?2004h> "]
[32.630412, "o", "    # Trim enforced_line to avoid trailing newline issues\r\n\u001b[?2004l\r"]
[32.63047, "o", "\u001b[?2004h"]
[32.630511, "o", "> "]
[32.630776, "o", "    enforced_line=\"${enforced_line%\\n}\"\r\n\u001b[?2004l\r"]
[32.63083, "o", "\u001b[?2004h> "]
[32.630875, "o", "\r\n\u001b[?2004l\r"]
[32.63092, "o", "\u001b[?2004h> "]
[32.631266, "o", "    # Check if enforced_line already exists exactly\r\n\u001b[?2004l\r"]
[32.631309, "o", "\u001b[?2004h"]
[32.63135, "o", "> "]
[32.631771, "o", "    if grep -Fxq \"$enforced_line\" \"$filename\" 2>/dev/null; then\r\n\u001b[?2004l\r"]
[32.63184, "o", "\u001b[?2004h"]
[32.631888, "o", "> "]
[32.632187, "o", "        echo \"$filename:SKIPPED\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[32.632229, "o", "\u001b[?2004h"]
[32.632269, "o", "> "]
[32.632475, "o", "        chmod 0600 \"$filename\"\r\n\u001b[?2004l\r"]
[32.632516, "o", "\u001b[?2004h"]
[32.632557, "o", "> "]
[32.632671, "o", "        continue\r\n\u001b[?2004l\r"]
[32.632724, "o", "\u001b[?2004h"]
[32.632768, "o", "> "]
[32.632831, "o", "    fi\r\n\u001b[?2004l\r"]
[32.632864, "o", "\u001b[?2004h"]
[32.632921, "o", "> \r\n\u001b[?2004l\r"]
[32.632968, "o", "\u001b[?2004h> "]
[32.633325, "o", "    # Try to repair by replacing matching pattern line\r\n\u001b[?2004l\r"]
[32.63337, "o", "\u001b[?2004h"]
[32.633402, "o", "> "]
[32.63386, "o", "    if grep -qE \"^$search_pattern\" \"$filename\" 2>/dev/null; then\r\n\u001b[?2004l\r"]
[32.633908, "o", "\u001b[?2004h"]
[32.63394, "o", "> "]
[32.634263, "o", "        # Create temp file for atomic replacement\r\n\u001b[?2004l\r"]
[32.634311, "o", "\u001b[?2004h"]
[32.634351, "o", "> "]
[32.634547, "o", "        temp_file=\"$(mktemp)\"\r\n\u001b[?2004l\r"]
[32.634588, "o", "\u001b[?2004h"]
[32.634627, "o", "> "]
[32.634951, "o", "        # Use sed to replace the matching line\r\n\u001b[?2004l\r"]
[32.634994, "o", "\u001b[?2004h"]
[32.635034, "o", "> "]
[32.635549, "o", "        sed -E \"s/^\\($search_pattern\\)/$enforced_line/\" \"$filename\" > \"$temp_file\"\r\n\u001b[?2004l\r"]
[32.635598, "o", "\u001b[?2004h"]
[32.635644, "o", "> "]
[32.635837, "o", "        # Atomic replacement\r\n\u001b[?2004l\r"]
[32.635883, "o", "\u001b[?2004h"]
[32.635922, "o", "> "]
[32.636152, "o", "        mv \"$temp_file\" \"$filename\"\r\n\u001b[?2004l\r"]
[32.636197, "o", "\u001b[?2004h"]
[32.636229, "o", "> "]
[32.636543, "o", "        echo \"$filename:REPAIRED\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[32.636592, "o", "\u001b[?2004h"]
[32.636625, "o", "> "]
[32.636688, "o", "    else\r\n\u001b[?2004l\r"]
[32.636734, "o", "\u001b[?2004h"]
[32.636788, "o", "> "]
[32.637006, "o", "        # Append the enforced line\r\n\u001b[?2004l\r"]
[32.637054, "o", "\u001b[?2004h"]
[32.637099, "o", "> "]
[32.637378, "o", "        echo \"$enforced_line\" >> \"$filename\"\r\n\u001b[?2004l\r"]
[32.637431, "o", "\u001b[?2004h"]
[32.637482, "o", "> "]
[32.637799, "o", "        echo \"$filename:APPENDED\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[32.637866, "o", "\u001b[?2004h> "]
[32.637923, "o", "    fi\r\n\u001b[?2004l\r"]
[32.637971, "o", "\u001b[?2004h"]
[32.638014, "o", "> \r\n\u001b[?2004l\r"]
[32.638054, "o", "\u001b[?2004h> "]
[32.638262, "o", "    # Set strict permissions\r\n\u001b[?2004l\r"]
[32.638309, "o", "\u001b[?2004h"]
[32.638353, "o", "> "]
[32.638505, "o", "    case \"$filename\" in\r\n\u001b[?2004l\r"]
[32.63855, "o", "\u001b[?2004h"]
[32.638581, "o", "> "]
[32.638911, "o", "        \"sshd_config\") chmod 0600 \"$filename\" ;;\r\n\u001b[?2004l\r"]
[32.638957, "o", "\u001b[?2004h"]
[32.639003, "o", "> "]
[32.639234, "o", "        *) chmod 0644 \"$filename\" ;;\r\n\u001b[?2004l\r"]
[32.639279, "o", "\u001b[?2004h"]
[32.63932, "o", "> "]
[32.639383, "o", "    esac\r\n\u001b[?2004l\r"]
[32.639432, "o", "\u001b[?2004h"]
[32.639464, "o", "> \r\n\u001b[?2004l\r"]
[32.639509, "o", "\u001b[?2004h"]
[32.639541, "o", "> "]
[32.639667, "o", "done < \"rules.txt\"\r\n\u001b[?2004l\r"]
[32.639715, "o", "\u001b[?2004h"]
[32.639755, "o", "> \r\n\u001b[?2004l\r"]
[32.639809, "o", "\u001b[?2004h> "]
[32.640141, "o", "# Sort the log file alphabetically by filename\r\n\u001b[?2004l\r"]
[32.640182, "o", "\u001b[?2004h"]
[32.640228, "o", "> "]
[32.640438, "o", "sort \"$log_file\" -o \"$log_file\"\r\n\u001b[?2004l\r"]
[32.640483, "o", "\u001b[?2004h"]
[32.640517, "o", "> \r\n\u001b[?2004l\r"]
[32.640559, "o", "\u001b[?2004h"]
[32.640591, "o", "> "]
[32.64075, "o", "# Final user feedback\r\n\u001b[?2004l\r"]
[32.640796, "o", "\u001b[?2004h"]
[32.640842, "o", "> "]
[32.641019, "o", "echo \"Hardening completed\"\r\n\u001b[?2004l\r"]
[32.641064, "o", "\u001b[?2004h"]
[32.641109, "o", "> "]
[32.641142, "o", "EOF\r\n\u001b[?2004l\r"]
[32.654408, "o", "\u001b[?2004hroot@ce601f82-7746-4839-81ca-34136a84ecde:/home/user/hardening_test# "]
[32.819501, "i", "chmod +x apply_hardening.sh\n"]
[32.8197, "o", "chmod +x apply_hardening.sh\r\n\u001b[?2004l\r"]
[32.821015, "o", "\u001b[?2004h"]
[32.821075, "o", "root@ce601f82-7746-4839-81ca-34136a84ecde:/home/user/hardening_test# "]
