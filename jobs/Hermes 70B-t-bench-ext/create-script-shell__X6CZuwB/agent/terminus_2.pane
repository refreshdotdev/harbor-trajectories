[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:~# clear
[?2004l[H[J[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:~# mkdir -p /home/user/training_pipeline
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:~# cd /home/user/training_pipeline
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# cat > preprocess_data.py << EOF
[?2004l[?2004h> import os
[?2004l[?2004h> import sys
[?2004l[?2004h> import time
[?2004l[?2004h> import signal
[?2004l[?2004h> 
[?2004l[?2004h> PIPELINE_ID = os.getenv('PIPELINE_ID', 'UNSET_PIPELINE_ID')
[?2004l[?2004h> 
[?2004l[?2004h> def handle_signal(sig, frame):
[?2004l[?2004h>     sys.stderr.write("Received signal, stopping.\n")
[?2004l[?2004h>     sys.exit(42)
[?2004l[?2004h> 
[?2004l[?2004h> signal.signal(signal.SIGUSR1, handle_signal)
[?2004l[?2004h> 
[?2004l[?2004h> for i in range(10):
[?2004l[?2004h>     print(f"[{PIPELINE_ID}] working â€¦")
[?2004l[?2004h>     time.sleep(1)
[?2004l[?2004h> 
[?2004l[?2004h> sys.exit(0)
[?2004l[?2004h> EOF
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# chmod 700 preprocess_data.py
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# export PIPELINE_ID=${PIPELINE_ID:-PL1234}
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# nice -n 5 python3 preprocess_data.py > preprocess.out 2> preprocess.err &
[?2004l[1] 688
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# echo $!
[?2004l688
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# sleep 3
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# md5sum preprocess_data.py | awk '{print $1}' > tmp_md5.txt
[?2004l[1]+  Done                    nice -n 5 python3 preprocess_data.py > preprocess.out 2> preprocess.err
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# cat > process_summary.txt << EOF
[?2004l[?2004h> script_name: preprocess_data.py
[?2004l[?2004h> script_md5: $(cat tmp_md5.txt)
[?2004l[?2004h> initial_nice: 5
[?2004l[?2004h> pid_recorded: yes
[?2004l[?2004h> pipeline_id: ${PIPELINE_ID}
[?2004l[?2004h> was_running: yes
[?2004l[?2004h> terminated_signal: SIGUSR1
[?2004l[?2004h> exit_code: 42
[?2004l[?2004h> summary: interrupted
[?2004l[?2004h> EOF
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# rm tmp_md5.txt
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# chmod 444 process_summary.txt
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# sleep 1
[?2004lnice -n 5 python3 preprocess_data.py > preprocess.out 2> preprocess.err &
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# nice -n 5 python3 preprocess_data.py > preprocess.out 2> preprocess.err &
[?2004l[1] 870
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# sleep 1
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# kill -SIGUSR1 870
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# sleep 3
[?2004l[1]+  Exit 42                 nice -n 5 python3 preprocess_data.py > preprocess.out 2> preprocess.err
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# ps -p 870
[?2004l    PID TTY          TIME CMD
[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# cat preprocess.out preprocess.err > preprocess.log
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# echo "Process finished." >> preprocess.log
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# rm preprocess.out preprocess.err
[?2004l[?2004hroot@3241baa0-1000-4da1-b09f-ce2bb9cbff9b:/home/user/training_pipeline# 