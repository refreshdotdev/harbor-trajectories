[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:~# clear
[?2004l[H[J[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:~# cd /home/user/edge_source
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/edge_source# ls -la
[?2004ltotal 20
drwxrwxrwx 2 root root 120 Feb 13 18:50 [0m[34;42m.[0m
drwxrwxrwx 4 root root  55 Feb 13 18:50 [34;42m..[0m
-rwxrwxrwx 1 root root  25 Feb 13 18:50 [01;32mapp.py[0m
-rwxrwxrwx 1 root root  40 Feb 13 18:50 [01;32mconfig.yaml[0m
-rwxrwxrwx 1 root root  11 Feb 13 18:50 [01;32mdebug.log[0m
-rwxrwxrwx 1 root root  10 Feb 13 18:50 [01;32mtemp_data.tmp[0m
-rwxrwxrwx 1 root root   6 Feb 13 18:50 [01;32mversion.txt[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/edge_source# ls -la /home/user/iot_device/edge_app/
[?2004ltotal 12
drwxrwxrwx 2 root root 54 Feb 13 18:50 [0m[34;42m.[0m
drwxrwxrwx 3 root root 30 Feb 13 18:50 [34;42m..[0m
-rwxrwxrwx 1 root root 25 Feb 13 18:50 [01;32mapp.py[0m
-rwxrwxrwx 1 root root  7 Feb 13 18:50 [01;32mold.tmp[0m
-rwxrwxrwx 1 root root  6 Feb 13 18:50 [01;32mversion.txt[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/edge_source# rsync -av --delete --exclude="*.log" --exclude="*.tmp" /home/user/edge_source/ /home/user/iot_device/edge_app/
[?2004lsending incremental file list
config.yaml

sent 183 bytes  received 35 bytes  436.00 bytes/sec
total size is 71  speedup is 0.33
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/edge_source# cat /etc/iot_serial | xargs
[?2004lSN-314159
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/edge_source# cd /home/user/iot_device/edge_app
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat config.yaml
[?2004lsetting: prod
serial: {{SERIAL_NUMBER}}
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# sed -i 's/{{SERIAL_NUMBER}}/SN-314159/g' config.yaml
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat config.yaml
[?2004lsetting: prod
serial: SN-314159
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# find . -name "*.py" -exec chmod 755 {} \;
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# chmod 400 config.yaml
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# ls -la
[?2004ltotal 16
drwxrwxrwx 1 root root 51 Feb 13 19:02 [0m[34;42m.[0m
drwxrwxrwx 1 root root 30 Feb 13 18:50 [34;42m..[0m
-rwxr-xr-x 1 root root 25 Feb 13 18:50 [01;32mapp.py[0m
-r-------- 1 root root 32 Feb 13 19:02 config.yaml
-rwxrwxrwx 1 root root  7 Feb 13 18:50 [01;32mold.tmp[0m
-rwxrwxrwx 1 root root  6 Feb 13 18:50 [01;32mversion.txt[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# rm old.tmp
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# ls -la
[?2004ltotal 12
drwxrwxrwx 1 root root 70 Feb 13 19:02 [0m[34;42m.[0m
drwxrwxrwx 1 root root 30 Feb 13 18:50 [34;42m..[0m
-rwxr-xr-x 1 root root 25 Feb 13 18:50 [01;32mapp.py[0m
-r-------- 1 root root 32 Feb 13 19:02 config.yaml
-rwxrwxrwx 1 root root  6 Feb 13 18:50 [01;32mversion.txt[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# (for file in *; do if [ "$file" != "manifest.txt" ]; then echo -n "$file: "; sha256sum "$file"; fi; done) > manifest.txt.tmp
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# sed 's/\([^ ]*\) *\([^ ]*\) .*/\2  \1/' manifest.txt.tmp > manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# sort manifest.txt -o manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat manifest.txt
[?2004l0dbaf9c9cce76dbfb8fdab14b28ac9e9aee646c7802714b6f03eda01b65d4962  app.py:
59854984853104df5c353e2f681a15fc7924742f9a2e468c29af248dce45ce03  version.txt:
9aefdd43a4628f0682d099e20cf6bbe23c3a56c4d5cd1ad12c7afd0bfd09f727  manifest.txt.tmp:
d80749e4e4db3ef08d3b2e3953095f447f98a479cf2157a01c6a6fb111ae0b56  config.yaml:
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# rm manifest.txt manifest.txt.tmp
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# find . -maxdepth 1 -type f -not -name 'manifest.txt' -exec sha256sum {} \; > manifest.txt.tmp
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# sed 's|./||' manifest.txt.tmp | awk '{print $1 "  " substr($2, 3)}' | sort > manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat manifest.txt
[?2004l0dbaf9c9cce76dbfb8fdab14b28ac9e9aee646c7802714b6f03eda01b65d4962  p.py
1da27969ea09d7e39ab2c00433a8757b0cf2aa4d0a4d270855ab503a8aa4526a  nifest.txt.tmp
59854984853104df5c353e2f681a15fc7924742f9a2e468c29af248dce45ce03  rsion.txt
d80749e4e4db3ef08d3b2e3953095f447f98a479cf2157a01c6a6fb111ae0b56  nfig.yaml
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# rm -f manifest.txt manifest.txt.tmp
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# touch manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# for file in app.py config.yaml version.txt; do sha256sum "$file" | sed 's|.* \(.*\)|\1  \2|' >> manifest.txt; done
[?2004lsed: -e expression #1, char 19: invalid reference \2 on `s' command's RHS
sed: -e expression #1, char 19: invalid reference \2 on `s' command's RHS
sed: -e expression #1, char 19: invalid reference \2 on `s' command's RHS
sha256sum: write error
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# sort manifest.txt -o manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# rm manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# find . -maxdepth 1 -type f \( -name 'app.py' -o -name 'config.yaml' -o -name 'version.txt' \) -exec sha256sum {} \; | awk '{print $1 "  " substr($2, 3)}' | sort > manifest.txt
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat manifest.txt
[?2004l0dbaf9c9cce76dbfb8fdab14b28ac9e9aee646c7802714b6f03eda01b65d4962  app.py
59854984853104df5c353e2f681a15fc7924742f9a2e468c29af248dce45ce03  version.txt
d80749e4e4db3ef08d3b2e3953095f447f98a479cf2157a01c6a6fb111ae0b56  config.yaml
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# mkdir -p /home/user/deployment_logs
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat > /home/user/deployment_logs/sync_2024.log << EOF
[?2004l[?2004h> SYNC COMPLETE
[?2004l[?2004h> SOURCE: /home/user/edge_source/
[?2004l[?2004h> DESTINATION: /home/user/iot_device/edge_app/
[?2004l[?2004h> EOF
[?2004l[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# cat /home/user/deployment_logs/sync_2024.log
[?2004lSYNC COMPLETE
SOURCE: /home/user/edge_source/
DESTINATION: /home/user/iot_device/edge_app/
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# ls -la /home/user/iot_device/edge_app/
[?2004ltotal 16
drwxrwxrwx 1 root root  94 Feb 13 19:03 [0m[34;42m.[0m
drwxrwxrwx 1 root root  30 Feb 13 18:50 [34;42m..[0m
-rwxr-xr-x 1 root root  25 Feb 13 18:50 [01;32mapp.py[0m
-r-------- 1 root root  32 Feb 13 19:02 config.yaml
-rw-r--r-- 1 root root 229 Feb 13 19:03 manifest.txt
-rwxrwxrwx 1 root root   6 Feb 13 18:50 [01;32mversion.txt[0m
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# echo "=== Verification Complete ==="
[?2004l=== Verification Complete ===
[?2004hroot@54db7936-8f3f-4d99-8485-d3b6c0c107a3:/home/user/iot_device/edge_app# 