Hit:1 http://archive.ubuntu.com/ubuntu jammy InRelease
Hit:2 http://security.ubuntu.com/ubuntu jammy-security InRelease
Hit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
curl is already the newest version (7.81.0-1ubuntu1.21).
0 upgraded, 0 newly installed, 0 to remove and 4 not upgraded.
downloading uv 0.9.5 x86_64-unknown-linux-gnu
no checksums to verify
installing to /root/.local/bin
  uv
  uvx
everything's installed!

To add $HOME/.local/bin to your PATH, either restart your shell or run:

    source $HOME/.local/bin/env (sh, bash, zsh)
    source $HOME/.local/bin/env.fish (fish)
Downloading cpython-3.12.12-linux-x86_64-gnu (download) (31.1MiB)
 Downloading cpython-3.12.12-linux-x86_64-gnu (download)
Downloading pygments (1.2MiB)
 Downloading pygments
Installed 5 packages in 21ms
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.1, pluggy-1.6.0 -- /root/.cache/uv/archive-v0/zEAsoBOjSovqKMS46fszX/bin/python
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 4 items

../../tests/test_final_state.py::TestFilesystem::test_webroot_permissions PASSED [ 25%]
../../tests/test_final_state.py::TestFilesystem::test_index_content_and_encoding FAILED [ 50%]
../../tests/test_final_state.py::TestServiceAndManifest::test_service_running_and_serving FAILED [ 75%]
../../tests/test_final_state.py::TestServiceAndManifest::test_manifest_file FAILED [100%]

=================================== FAILURES ===================================
________________ TestFilesystem.test_index_content_and_encoding ________________

self = <test_final_state.TestFilesystem object at 0x7b91088d0080>

    def test_index_content_and_encoding(self):
>       assert INDEX_FILE.is_file(), "index.html missing"
E       AssertionError: index.html missing
E       assert False
E        +  where False = is_file()
E        +    where is_file = PosixPath('/home/user/microservices/webroot/index.html').is_file

/tests/test_final_state.py:41: AssertionError
___________ TestServiceAndManifest.test_service_running_and_serving ____________

self = <test_final_state.TestServiceAndManifest object at 0x7b91088cdb20>

    def test_service_running_and_serving(self):
        url = "http://localhost:9000/index.html"
        try:
>           with urllib.request.urlopen(url) as response:
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^

/tests/test_final_state.py:62: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:215: in urlopen
    return opener.open(url, data, timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:521: in open
    response = meth(req, response)
               ^^^^^^^^^^^^^^^^^^^
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:630: in http_response
    response = self.parent.error(
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:559: in error
    return self._call_chain(*args)
           ^^^^^^^^^^^^^^^^^^^^^^^
/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:492: in _call_chain
    result = func(*args)
             ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <urllib.request.HTTPDefaultErrorHandler object at 0x7b9108675250>
req = <urllib.request.Request object at 0x7b9108a0ffe0>
fp = <http.client.HTTPResponse object at 0x7b91088c8bb0>, code = 404
msg = 'File not found'
hdrs = <http.client.HTTPMessage object at 0x7b9108675be0>

    def http_error_default(self, req, fp, code, msg, hdrs):
>       raise HTTPError(req.full_url, code, msg, hdrs, fp)
E       urllib.error.HTTPError: HTTP Error 404: File not found

/root/.local/share/uv/python/cpython-3.12.12-linux-x86_64-gnu/lib/python3.12/urllib/request.py:639: HTTPError

During handling of the above exception, another exception occurred:

self = <test_final_state.TestServiceAndManifest object at 0x7b91088cdb20>

    def test_service_running_and_serving(self):
        url = "http://localhost:9000/index.html"
        try:
            with urllib.request.urlopen(url) as response:
                data = response.read()
                headers = response.info()
    
                assert data == EXPECTED_BYTES, "Server returned incorrect bytes"
                assert int(headers['Content-Length']) == len(EXPECTED_BYTES), "Content-Length header mismatch"
        except Exception as e:
>           pytest.fail(f"Could not reach service at {url}: {e}")
E           Failed: Could not reach service at http://localhost:9000/index.html: HTTP Error 404: File not found

/tests/test_final_state.py:69: Failed
__________________ TestServiceAndManifest.test_manifest_file ___________________

self = <test_final_state.TestServiceAndManifest object at 0x7b9108674950>

    def test_manifest_file(self):
>       assert MANIFEST.is_file(), "Manifest file missing"
E       AssertionError: Manifest file missing
E       assert False
E        +  where False = is_file()
E        +    where is_file = PosixPath('/home/user/output/audit_manifest.txt').is_file

/tests/test_final_state.py:72: AssertionError
=============================== warnings summary ===============================
../../tests/test_final_state.py:30
  /tests/test_final_state.py:30: PytestUnknownMarkWarning: Unknown pytest.mark.describe - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.describe("Filesystem Requirements")

../../tests/test_final_state.py:57
  /tests/test_final_state.py:57: PytestUnknownMarkWarning: Unknown pytest.mark.describe - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.describe("Service & Output")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED ../../tests/test_final_state.py::TestFilesystem::test_index_content_and_encoding
FAILED ../../tests/test_final_state.py::TestServiceAndManifest::test_service_running_and_serving
FAILED ../../tests/test_final_state.py::TestServiceAndManifest::test_manifest_file
=================== 3 failed, 1 passed, 2 warnings in 0.15s ====================
