{"version": 2, "width": 160, "height": 40, "timestamp": 1771009321, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.0078, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[0.94319, "i", "clear\r"]
[0.943526, "o", "clear\r\n\u001b[?2004l\r"]
[0.945739, "o", "\u001b[H\u001b[J"]
[0.945982, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[21.537053, "i", "mkdir -p /home/user/ingest\n"]
[21.537199, "o", "mkdir -p /home/user/ingest\r\n\u001b[?2004l\r"]
[21.539423, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[32.228593, "i", "find /home/user/scan_logs /home/user/scan_logs/archive -type f -iname '*.log' -not -path '*backup*' -print > /tmp/candidate_logs.txt\n"]
[32.229022, "o", "find /home/user/scan_logs /home/user/scan_logs/archive -type f -iname '*.log' -not -path '*backup*' -print > /tmp/candidate_logs.txt\r\n\u001b[?2004l\r"]
[32.231054, "o", "\u001b[?2004h"]
[32.231116, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.589664, "i", "TMP_WORK_DIR=$(mktemp -d)\n"]
[92.589782, "o", "TMP_WORK_DIR=$(mktemp -d)\r\n\u001b[?2004l\r"]
[92.591746, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.69865, "i", "VALID_LOG_FILES=()\nCHECKSUM_FILE=\"${TMP_WORK_DIR}/checksums.txt\"\ntouch \"$CHECKSUM_FILE\"\n\nwhile IFS= read -r log_file_path; do\n  echo \"Processing $log_file_path...\"\n  # Extract scan date from Nmap header\n  scan_date_line=$(grep -m 1 \"Starting Nmap.*at\" \"$log_file_path\" || true)\n  if [ -z \"$scan_date_line\" ]; then\n    echo \"Warning: No Nmap start line in $log_file_path. Skipping.\"\n    continue\n  fi\n  \n  extracted_date=$(echo \"$scan_date_line\" | awk -F\"at \" '{print $2}' | awk '{print $1}' | sed -e 's/ .*//' | xargs)\n  if [ -z \"$extracted_date\" ]; then\n    echo \"Warning: Could not parse date from line in $log_file_path: $scan_date_line. Skipping.\"\n    continue\n  fi\n  \n  # Convert extracted_date (e.g., YYYY-MM-DD) to YYYY-MM format\n  file_month_year=$(date -d \"$extracted_date\" +\"%Y-%m\" 2>/dev/null || echo \"\")\n  if [ -z \"$file_month_year\" ]; then\n    echo \"Warning: Invalid date format '$extracted_date' in $log_file_path. Skipping.\"\n    continue\n  fi\n  \n  if [ \"$file_month_year\" = \"2023-05\" ]; then\n    VALID_LOG_FIL"]
[92.698765, "i", "ES+=(\"$log_file_path\")\n    # Get SHA256 checksum\n    checksum=$(sha256sum \"$log_file_path\" | awk '{print $1}')\n    echo \"$log_file_path|$checksum\" >> \"${TMP_WORK_DIR}/checksums.txt\"\n  fi\n\ndone < /tmp/candidate_logs.txt\n\nif [ ${#VALID_LOG_FILES[@]} -eq 0 ]; then\n  echo \"No valid May 2023 log files found.\"\n  rm -f \"${TMP_WORK_DIR}/checksums.txt\"\nelse\n  echo \"Found ${#VALID_LOG_FILES[@]} valid log files from May 2023.\"\nfi\n\n# Clean up candidate list\nrm /tmp/candidate_logs.txt\n"]
[92.698972, "o", "VALID_LOG_FILES=()\r\n\u001b[?2004l\r"]
[92.699088, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.699493, "o", "CHECKSUM_FILE=\"${TMP_WORK_DIR}/checksums.txt\"\r\n\u001b[?2004l\r"]
[92.699584, "o", "\u001b[?2004h"]
[92.699617, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.699746, "o", "touch \"$CHECKSUM_FILE\"\r\n\u001b[?2004l\r"]
[92.701342, "o", "\u001b[?2004h"]
[92.701385, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[92.701425, "o", "\u001b[?2004h"]
[92.701454, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.701683, "o", "while IFS= read -r log_file_path; do\r\n\u001b[?2004l\r"]
[92.701727, "o", "\u001b[?2004h"]
[92.701756, "o", "> "]
[92.702009, "o", "  echo \"Processing $log_file_path...\"\r\n\u001b[?2004l\r"]
[92.702052, "o", "\u001b[?2004h"]
[92.702082, "o", "> "]
[92.702338, "o", "  # Extract scan date from Nmap header\r\n\u001b[?2004l\r"]
[92.702372, "o", "\u001b[?2004h"]
[92.702402, "o", "> "]
[92.70288, "o", "  scan_date_line=$(grep -m 1 \"Starting Nmap.*at\" \"$log_file_path\" || true)\r\n\u001b[?2004l\r"]
[92.702929, "o", "\u001b[?2004h"]
[92.702954, "o", "> "]
[92.703166, "o", "  if [ -z \"$scan_date_line\" ]; then\r\n\u001b[?2004l\r"]
[92.703211, "o", "\u001b[?2004h"]
[92.703241, "o", "> "]
[92.703692, "o", "    echo \"Warning: No Nmap start line in $log_file_path. Skipping.\"\r\n\u001b[?2004l\r"]
[92.703744, "o", "\u001b[?2004h"]
[92.703775, "o", "> "]
[92.703864, "o", "    continue\r\n\u001b[?2004l\r"]
[92.703899, "o", "\u001b[?2004h"]
[92.703936, "o", "> "]
[92.703969, "o", "  fi\r\n\u001b[?2004l\r"]
[92.703999, "o", "\u001b[?2004h"]
[92.704032, "o", ">   \r\n"]
[92.70407, "o", "\u001b[?2004l\r"]
[92.704109, "o", "\u001b[?2004h> "]
[92.704818, "o", "  extracted_date=$(echo \"$scan_date_line\" | awk -F\"at \" '{print $2}' | awk '{print $1}' | sed -e 's/ .*//' | xargs)"]
[92.70483, "o", "\r\n\u001b[?2004l\r"]
[92.704895, "o", "\u001b[?2004h"]
[92.704924, "o", "> "]
[92.705135, "o", "  if [ -z \"$extracted_date\" ]; then\r\n\u001b[?2004l\r"]
[92.705177, "o", "\u001b[?2004h"]
[92.705209, "o", "> "]
[92.705808, "o", "    echo \"Warning: Could not parse date from line in $log_file_path: $scan_date_line. Skipping.\"\r\n"]
[92.705823, "o", "\u001b[?2004l\r"]
[92.705904, "o", "\u001b[?2004h> "]
[92.706068, "o", "    continue\r\n\u001b[?2004l\r\u001b[?2004h> "]
[92.706159, "o", "  fi\r\n\u001b[?2004l\r\u001b[?2004h"]
[92.706197, "o", "> "]
[92.706232, "o", "  \r\n\u001b[?2004l\r"]
[92.706267, "o", "\u001b[?2004h"]
[92.706306, "o", "> "]
[92.706696, "o", "  # Convert extracted_date (e.g., YYYY-MM-DD) to YYYY-MM format\r\n\u001b[?2004l\r"]
[92.706733, "o", "\u001b[?2004h"]
[92.706768, "o", "> "]
[92.70726, "o", "  file_month_year=$(date -d \"$extracted_date\" +\"%Y-%m\" 2>/dev/null || echo \"\")\r\n\u001b[?2004l\r"]
[92.707321, "o", "\u001b[?2004h> "]
[92.707566, "o", "  if [ -z \"$file_month_year\" ]; then\r\n\u001b[?2004l\r"]
[92.707611, "o", "\u001b[?2004h"]
[92.707658, "o", "> "]
[92.708185, "o", "    echo \"Warning: Invalid date format '$extracted_date' in $log_file_path. Skipping.\"\r\n\u001b[?2004l\r"]
[92.708245, "o", "\u001b[?2004h> "]
[92.708338, "o", "    continue\r\n\u001b[?2004l\r"]
[92.70838, "o", "\u001b[?2004h"]
[92.708427, "o", ">   fi\r\n\u001b[?2004l\r"]
[92.708476, "o", "\u001b[?2004h> "]
[92.708525, "o", "  \r\n\u001b[?2004l\r"]
[92.708586, "o", "\u001b[?2004h> "]
[92.70887, "o", "  if [ \"$file_month_year\" = \"2023-05\" ]; then\r\n\u001b[?2004l\r"]
[92.708932, "o", "\u001b[?2004h> "]
[92.709189, "o", "    VALID_LOG_FILES+=(\"$log_file_path\")\r\n\u001b[?2004l\r"]
[92.709239, "o", "\u001b[?2004h> "]
[92.70942, "o", "    # Get SHA256 checksum\r\n\u001b[?2004l\r"]
[92.709462, "o", "\u001b[?2004h> "]
[92.709879, "o", "    checksum=$(sha256sum \"$log_file_path\" | awk '{print $1}')\r\n\u001b[?2004l\r"]
[92.70993, "o", "\u001b[?2004h> "]
[92.710397, "o", "    echo \"$log_file_path|$checksum\" >> \"${TMP_WORK_DIR}/checksums.txt\"\r\n\u001b[?2004l\r"]
[92.710453, "o", "\u001b[?2004h> "]
[92.71051, "o", "  fi\r\n\u001b[?2004l\r"]
[92.71056, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[92.71061, "o", "\u001b[?2004h> "]
[92.710816, "o", "done < /tmp/candidate_logs.txt\r\n\u001b[?2004l\r"]
[92.710954, "o", "Processing /home/user/scan_logs/archive/scan_gw.log...\r\n"]
[92.713034, "o", "Warning: No Nmap start line in /home/user/scan_logs/archive/scan_gw.log. Skipping.\r\n"]
[92.713079, "o", "Processing /home/user/scan_logs/scan_latin.log...\r\n"]
[92.71505, "o", "Warning: No Nmap start line in /home/user/scan_logs/scan_latin.log. Skipping.\r\n"]
[92.715097, "o", "Processing /home/user/scan_logs/scan_old.log...\r\n"]
[92.717923, "o", "Warning: No Nmap start line in /home/user/scan_logs/scan_old.log. Skipping."]
[92.719147, "o", "\r\nProcessing /home/user/scan_logs/scan_std.log...\r\n"]
[92.721209, "o", "Warning: No Nmap start line in /home/user/scan_logs/scan_std.log. Skipping.\r\n"]
[92.721298, "o", "Processing /home/user/scan_logs/archive/scan_gw.log...\r\n"]
[92.723619, "o", "Warning: No Nmap start line in /home/user/scan_logs/archive/scan_gw.log. Skipping.\r\n"]
[92.72374, "o", "\u001b[?2004h"]
[92.723781, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.723794, "o", "\r\n\u001b[?2004l\r"]
[92.723851, "o", "\u001b[?2004h"]
[92.723895, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.724145, "o", "if [ ${#VALID_LOG_FILES[@]} -eq 0 ]; then\r\n\u001b[?2004l\r"]
[92.724256, "o", "\u001b[?2004h> "]
[92.724489, "o", "  echo \"No valid May 2023 log files found.\"\r\n\u001b[?2004l\r"]
[92.72453, "o", "\u001b[?2004h"]
[92.724569, "o", "> "]
[92.724828, "o", "  rm -f \"${TMP_WORK_DIR}/checksums.txt\"\r\n\u001b[?2004l\r"]
[92.724888, "o", "\u001b[?2004h> "]
[92.724936, "o", "else\r\n\u001b[?2004l\r"]
[92.724977, "o", "\u001b[?2004h> "]
[92.725432, "o", "  echo \"Found ${#VALID_LOG_FILES[@]} valid log files from May 2023.\"\r\n\u001b[?2004l\r"]
[92.725474, "o", "\u001b[?2004h"]
[92.725505, "o", "> "]
[92.725536, "o", "fi\r\n\u001b[?2004l\r"]
[92.725562, "o", "No valid May 2023 log files found.\r\n"]
[92.732343, "o", "\u001b[?2004h"]
[92.732362, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.732424, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[92.732465, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.732624, "o", "# Clean up candidate list\r\n\u001b[?2004l\r"]
[92.732684, "o", "\u001b[?2004h"]
[92.732726, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[92.732895, "o", "rm /tmp/candidate_logs.txt\r\n\u001b[?2004l\r"]
[92.734723, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.050477, "i", "echo '{\"scans\": []}' > /home/user/ingest/manifest.json\n"]
[115.051009, "o", "echo '{\"scans\": []}' > /home/user/ingest/manifest.json\r\n\u001b[?2004l\r"]
[115.051351, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.141487, "i", "CSV_CONTENT_ARRAY=()\nCSV_HEADER=\"Hash,Host,Open_Ports,Duration,PPS\"\nCSV_CONTENT_ARRAY+=(\"${CSV_HEADER}\")\n\nSTART_TIME=$(date +%s.%N)\n\n# Create runtime comment\nRUNTIME_COMMENT=\"#parser_runtime=0.00\"\nCSV_CONTENT_ARRAY+=(\"${RUNTIME_COMMENT}\")\n\n# Join CSV lines and convert to UTF-16LE with BOM\nCSV_UTF8=$(printf \"%s\\n\" \"${CSV_CONTENT_ARRAY[@]}\")\nCSV_UTF16LE=$(echo -n \"$CSV_UTF8\" | iconv -f UTF-8 -t UTF-16LE | (printf '\\xEF\\xBB\\xBF'; cat))\n\necho -n \"$CSV_UTF16LE\" > /home/user/ingest/cyber_core_import.csv\n\necho \"Manifest.json created. CSV created with header and runtime comment only.\"\n\n# Display manifest.json content\nif [ -f /home/user/ingest/manifest.json ]; then\n    cat /home/user/ingest/manifest.json\nelse\n    echo \"Error: manifest.json not found.\"\nfi\n\n# Clean up temporary directory\nrm -rf \"$TMP_WORK_DIR\"\n"]
[115.141733, "o", "CSV_CONTENT_ARRAY=()\r\n\u001b[?2004l\r"]
[115.141913, "o", "\u001b[?2004h"]
[115.141941, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.142302, "o", "CSV_HEADER=\"Hash,Host,Open_Ports,Duration,PPS\"\r\n"]
[115.142318, "o", "\u001b[?2004l\r"]
[115.142392, "o", "\u001b[?2004h"]
[115.14244, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.142705, "o", "CSV_CONTENT_ARRAY+=(\"${CSV_HEADER}\")\r\n\u001b[?2004l\r"]
[115.142807, "o", "\u001b[?2004h"]
[115.142854, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.142911, "o", "\u001b[?2004h"]
[115.142954, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.14314, "o", "START_TIME=$(date +%s.%N)\r\n\u001b[?2004l\r"]
[115.145902, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.145928, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.146011, "o", "# Create runtime comment\r\n\u001b[?2004l\r"]
[115.146028, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.146134, "o", "RUNTIME_COMMENT=\"#parser_runtime=0.00\"\r\n\u001b[?2004l\r"]
[115.146178, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.14628, "o", "CSV_CONTENT_ARRAY+=(\"${RUNTIME_COMMENT}\")\r\n\u001b[?2004l\r"]
[115.146316, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.146347, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.146485, "o", "# Join CSV lines and convert to UTF-16LE with BOM\r\n\u001b[?2004l\r"]
[115.146517, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.146644, "o", "CSV_UTF8=$(printf \"%s\\n\" \"${CSV_CONTENT_ARRAY[@]}\")\r\n\u001b[?2004l\r"]
[115.147274, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.147532, "o", "CSV_UTF16LE=$(echo -n \"$CSV_UTF8\" | iconv -f UTF-8 -t UTF-16LE | (printf '\\xEF\\xBB\\xBF'; cat))\r\n\u001b[?2004l\r"]
[115.150776, "o", "bash: warning: command substitution: ignored null byte in input\r\n"]
[115.15148, "o", "\u001b[?2004h"]
[115.151525, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.151577, "o", "\u001b[?2004h"]
[115.15161, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.152059, "o", "echo -n \"$CSV_UTF16LE\" > /home/user/ingest/cyber_core_import.csv\r\n\u001b[?2004l\r"]
[115.152327, "o", "\u001b[?2004h"]
[115.152365, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.15242, "o", "\u001b[?2004h"]
[115.152453, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.152962, "o", "echo \"Manifest.json created. CSV created with header and runtime comment only.\"\r\n\u001b[?2004l\r"]
[115.153016, "o", "Manifest.json created. CSV created with header and runtime comment only.\r\n"]
[115.153056, "o", "\u001b[?2004h"]
[115.153104, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.153157, "o", "\u001b[?2004hroot@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.153366, "o", "# Display manifest.json content\r\n\u001b[?2004l\r"]
[115.153429, "o", "\u001b[?2004h"]
[115.153455, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.153763, "o", "if [ -f /home/user/ingest/manifest.json ]; then\r\n\u001b[?2004l\r"]
[115.15386, "o", "\u001b[?2004h> "]
[115.154123, "o", "    cat /home/user/ingest/manifest.json\r\n\u001b[?2004l\r"]
[115.154163, "o", "\u001b[?2004h"]
[115.154195, "o", "> "]
[115.154237, "o", "else\r\n\u001b[?2004l\r"]
[115.154279, "o", "\u001b[?2004h> "]
[115.154585, "o", "    echo \"Error: manifest.json not found.\"\r\n\u001b[?2004l\r"]
[115.154623, "o", "\u001b[?2004h"]
[115.154654, "o", "> "]
[115.154697, "o", "fi\r\n\u001b[?2004l\r"]
[115.156281, "o", "{\"scans\": []}\r\n"]
[115.156594, "o", "\u001b[?2004h"]
[115.156631, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# \r\n\u001b[?2004l\r"]
[115.156701, "o", "\u001b[?2004h"]
[115.156739, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.15694, "o", "# Clean up temporary directory\r\n\u001b[?2004l\r"]
[115.156993, "o", "\u001b[?2004h"]
[115.157024, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
[115.157163, "o", "rm -rf \"$TMP_WORK_DIR\"\r\n\u001b[?2004l\r"]
[115.15857, "o", "\u001b[?2004h"]
[115.158615, "o", "root@3650ae5b-7ca8-43d0-9c41-36abf9b49945:~# "]
