[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:~# clear
[?2004l[H[J[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:~# cd /var/lib/ci_logs
[?2004l[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# ls -la
[?2004ltotal 4
drwxr-xr-x 1 root root  34 Feb 13 18:49 [0m[01;34m.[0m
drwxr-xr-x 1 root root 154 Feb 13 19:06 [01;34m..[0m
-rw-r--r-- 1 root root  87 Feb 13 18:49 manifest.xml
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# ACTIVE_LOG_FILE=$(xmllint --xpath "//active_log/text()" manifest.xml | tr -d " \t\n\r")
[?2004lbash: xmllint: command not found
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# echo Active log file: ${ACTIVE_LOG_FILE}
[?2004lActive log file:
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# if [ -f "${ACTIVE_LOG_FILE}" ]; then echo "Active log file exists"; else echo "Active log file does not exist!"; exit 1; fi
[?2004lActive log file does not exist!
exit
[0;32masciinema: recording finished[0m
[0;32masciinema: asciicast saved to /logs/agent/recording.cast[0m
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:~# cd /var/lib/ci_logs
[?2004l[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# which xmlstarlet
[?2004l[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# if [ -x "$(which xmlstarlet)" ]; then ACTIVE_LOG_FILE=$(xmlstarlet sel -t -m '//active_log' -v 'text()' -n manifest.xml | tr -d " \t\n\r"); echo "Using xmlstarlet - Active log: ${ACTIVE_LOG_FILE}"; elif command -v python3 &>/dev/null; then echo "Using Python to parse manifest.xml"; python3 -c "
[?2004l[?2004h> import xml.etree.ElementTree as ET
[?2004l[?2004h> import sys
[?2004l[?2004h> 
[?2004l[?2004h> tree = ET.parse('manifest.xml')
[?2004l[?2004h> root = tree.getroot()
[?2004l[?2004h> active_log = root.find('active_log')
[?2004l[?2004h> if active_log is not None and active_log.text:
[?2004l[?2004h>     filename = active_log.text.strip()
[?2004l[?2004h>     if len(filename) > 0:
[?2004l[?2004h>         sys.stdout.write(filename)
[?2004l[?2004h>     else:
[?2004l[?2004h>         sys.stderr.write('Error: active_log tag found but text is empty')
[?2004l[?2004h>         sys.exit(1)
[?2004l[?2004h> else:
[?2004l[?2004h>     sys.stderr.write('Error: active_log tag not found in manifest.xml')
[?2004l[?2004h>     sys.exit(1)
[?2004l[?2004h> " > active_log_filename.txt 2>parse_error.txt
[?2004l[?2004h> ACTIVE_LOG_FILE=$(cat active_log_filename.txt 2>/dev/null)
[?2004l[?2004h> if [ -n "${ACTIVE_LOG_FILE}" ]; then
[?2004l[?2004h>     echo "Active log file (via Python): ${ACTIVE_LOG_FILE}"
[?2004l[?2004h>     rm -f active_log_filename.txt parse_error.txt
[?2004l[?2004h> else
[?2004l[?2004h>     echo "Error parsing manifest.xml with Python. Check parse_error.txt for details."
[?2004l[?2004h>     cat parse_error.txt
[?2004l[?2004h>     exit 1
[?2004l[?2004h> fi
[?2004l[?2004h> else
[?2004l[?2004h>  echo "Error: Neither xmlstarlet nor python3 are available. Cannot parse manifest.xml."
[?2004l[?2004h>  exit 1
[?2004l[?2004h> fi
[?2004lUsing Python to parse manifest.xml
Active log file (via Python): build_dump_v2.json
[?2004hroot@bcbaf73e-615c-42d8-87f9-67f188af4160:/var/lib/ci_logs# if [ -f "${ACTIVE_LOG_FILE}" ]; then echo "Active log file exists: ${ACTIVE_LOG_FILE}"; else echo "Active log file '${ACTIVE_LOG_FILE}' does not exist!"; exit 1; fi
[?2004lActive log file 'build_dump_v2.json' does not exist!
logout
