{"version": 2, "width": 160, "height": 40, "timestamp": 1771008929, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005726, "o", "\u001b[?2004h"]
[0.006284, "o", "root@d656fac5-41d4-4ed3-84b1-a1869c7d423a:~# "]
[0.917976, "i", "clear\r"]
[0.918079, "o", "clear\r\n\u001b[?2004l\r"]
[0.91902, "o", "\u001b[H\u001b[J"]
[0.919118, "o", "\u001b[?2004h"]
[0.919152, "o", "root@d656fac5-41d4-4ed3-84b1-a1869c7d423a:~# "]
[23.903209, "i", "mkdir -p /home/user/diagnostics\n"]
[23.903379, "o", "mkdir -p /home/user/diagnostics\r\n\u001b[?2004l\r"]
[23.904539, "o", "\u001b[?2004hroot@d656fac5-41d4-4ed3-84b1-a1869c7d423a:~# "]
[24.012934, "i", "cat > /home/user/diagnostics/targets.txt << 'EOF'\nexample.com\n# This is a comment\n1.1.1.1\nEOF\n"]
[24.013197, "o", "cat > /home/user/diagnostics/targets.txt << 'EOF'\r\n\u001b[?2004l\r\u001b[?2004h> example.com\r\n\u001b[?2004l\r\u001b[?2004h"]
[24.013246, "o", "> "]
[24.013317, "o", "# This is a comment\r\n\u001b[?2004l\r"]
[24.013348, "o", "\u001b[?2004h> 1.1.1.1\r\n\u001b[?2004l\r\u001b[?2004h> EOF\r\n\u001b[?2004l\r"]
[24.015067, "o", "\u001b[?2004hroot@d656fac5-41d4-4ed3-84b1-a1869c7d423a:~# "]
[24.174332, "i", "cat > /home/user/diagnostics/run_net_checks.sh << 'EOF'\n#!/bin/sh\n\n# Directory containing logs and configuration\ntest -d /home/user/diagnostics || { echo \"Error: diagnostics directory missing\" >&2; exit 1; }\n\n# Configuration file containing target hosts\ntargets_file=\"/home/user/diagnostics/targets.txt\"\ntest -f \"$targets_file\" || { echo \"Error: targets.txt file not found\" >&2; exit 1; }\n\n# Log file\nlog_file=\"/home/user/diagnostics/netcheck.log\"\n\n# Rotate existing log if needed\nif [ -f \"$log_file\" ]; then\n    gzip -c \"$log_file\" > /home/user/diagnostics/netcheck.previous.log.gz\n    rm -f \"$log_file\"\nfi\n\n# Create new log with header\ntimestamp=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\necho \"# Netcheck Report\" > \"$log_file\"\necho \"Timestamp: $timestamp\" >> \"$log_file\"\n\n# Function to run a single network check\nrun_check() {\n    local host=\"$1\"\n    local command=\"$2\"\n    local cmd_to_run=\"$3\"\n    \n    # Execute command, capture stdout and stderr combined\n    output=$(eval \"$cmd_to_run\" 2>&1)\n    \n    # Get exit code\n    exit_"]
[24.174435, "i", "code=$?\n    \n    # Encode output and write to log atomically\n    flock -x 200\n    echo \"===== START host=$host check=$command =====\" >> \"$log_file\"\n    echo \"$output\" | base64 >> \"$log_file\"\n    echo \"===== END host=$host check=$command status=$exit_code =====\" >> \"$log_file\"\n    flock -u 200\n}\n\n# Read target hosts from file, skipping comments and empty lines\nhosts=$(grep -v '^#' \"$targets_file\" | grep -v '^$')\n\n# Execute checks in parallel using background jobs\nfor host in $hosts; do\n    # Ping check\n    run_check \"$host\" \"ping\" \"ping -n -c 1 $host\" &\n    \n    # Traceroute check  \n    run_check \"$host\" \"traceroute\" \"traceroute -n -m 5 $host\" &\n    \n    # DNS check\n    run_check \"$host\" \"dig\" \"dig +short $host A\" &\ndone\n\n# Wait for all background jobs to complete\nwait\n\n# Calculate SHA-256 checksum of the final log\nsha256sum \"$log_file\" | awk '{print $1}' > /home/user/diagnostics/netcheck.sha256\n\necho \"Diagnostics completed successfully.\"\nEOF"]
[24.17454, "o", "cat > /home/user/diagnostics/run_net_checks.sh << 'EOF'\r\n\u001b[?2004l\r"]
[24.174582, "o", "\u001b[?2004h> "]
[24.174616, "o", "#!/bin/sh\r\n\u001b[?2004l\r"]
[24.174635, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.174654, "o", "\u001b[?2004h"]
[24.174672, "o", "> "]
[24.174798, "o", "# Directory containing logs and configuration\r\n\u001b[?2004l\r"]
[24.174832, "o", "\u001b[?2004h"]
[24.174856, "o", "> "]
[24.175074, "o", "test -d /home/user/diagnostics || { echo \"Error: diagnostics directory missing\" >&2; exit 1; }\r\n\u001b[?2004l\r"]
[24.175106, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[24.17513, "o", "> "]
[24.175228, "o", "# Configuration file containing target hosts\r\n\u001b[?2004l\r"]
[24.175254, "o", "\u001b[?2004h> "]
[24.175373, "o", "targets_file=\"/home/user/diagnostics/targets.txt\"\r\n\u001b[?2004l\r"]
[24.175395, "o", "\u001b[?2004h> "]
[24.175601, "o", "test -f \"$targets_file\" || { echo \"Error: targets.txt file not found\" >&2; exit 1; }\r\n\u001b[?2004l\r\u001b[?2004h"]
[24.17563, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[24.175666, "o", "# Log file\r\n\u001b[?2004l\r"]
[24.175686, "o", "\u001b[?2004h> "]
[24.175838, "o", "log_file=\"/home/user/diagnostics/netcheck.log\"\r\n\u001b[?2004l\r"]
[24.175866, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.175885, "o", "\u001b[?2004h> "]
[24.175973, "o", "# Rotate existing log if needed\r\n\u001b[?2004l\r"]
[24.17599, "o", "\u001b[?2004h> "]
[24.176068, "o", "if [ -f \"$log_file\" ]; then\r\n\u001b[?2004l\r"]
[24.176095, "o", "\u001b[?2004h> "]
[24.176262, "o", "    gzip -c \"$log_file\" > /home/user/diagnostics/netcheck.previous.log.gz\r\n\u001b[?2004l\r"]
[24.176285, "o", "\u001b[?2004h> "]
[24.176339, "o", "    rm -f \"$log_file\"\r\n\u001b[?2004l\r"]
[24.176356, "o", "\u001b[?2004h> "]
[24.176372, "o", "fi\r\n\u001b[?2004l\r"]
[24.176389, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.176407, "o", "\u001b[?2004h> "]
[24.176485, "o", "# Create new log with header\r\n\u001b[?2004l\r"]
[24.176507, "o", "\u001b[?2004h> "]
[24.176612, "o", "timestamp=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\")\r\n\u001b[?2004l\r"]
[24.176626, "o", "\u001b[?2004h> "]
[24.176742, "o", "echo \"# Netcheck Report\" > \"$log_file\"\r\n\u001b[?2004l\r"]
[24.176758, "o", "\u001b[?2004h> "]
[24.176895, "o", "echo \"Timestamp: $timestamp\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[24.176913, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.176933, "o", "\u001b[?2004h> "]
[24.177038, "o", "# Function to run a single network check\r\n\u001b[?2004l\r"]
[24.177063, "o", "\u001b[?2004h> "]
[24.177095, "o", "run_check() {\r\n\u001b[?2004l\r"]
[24.177118, "o", "\u001b[?2004h> "]
[24.177167, "o", "    local host=\"$1\"\r\n\u001b[?2004l\r"]
[24.177186, "o", "\u001b[?2004h> "]
[24.177249, "o", "    local command=\"$2\"\r\n\u001b[?2004l\r"]
[24.177269, "o", "\u001b[?2004h> "]
[24.177336, "o", "    local cmd_to_run=\"$3\"\r\n\u001b[?2004l\r"]
[24.177355, "o", "\u001b[?2004h> "]
[24.177373, "o", "    \r\n\u001b[?2004l\r"]
[24.177392, "o", "\u001b[?2004h> "]
[24.177537, "o", "    # Execute command, capture stdout and stderr combined\r\n\u001b[?2004l\r"]
[24.177567, "o", "\u001b[?2004h> "]
[24.177669, "o", "    output=$(eval \"$cmd_to_run\" 2>&1)\r\n\u001b[?2004l\r"]
[24.177688, "o", "\u001b[?2004h"]
[24.177707, "o", "> "]
[24.177726, "o", "    \r\n\u001b[?2004l\r"]
[24.177746, "o", "\u001b[?2004h> "]
[24.177805, "o", "    # Get exit code\r\n\u001b[?2004l\r"]
[24.177822, "o", "\u001b[?2004h> "]
[24.177871, "o", "    exit_code=$?\r\n\u001b[?2004l\r"]
[24.17789, "o", "\u001b[?2004h> "]
[24.17791, "o", "    \r\n\u001b[?2004l\r"]
[24.177928, "o", "\u001b[?2004h> "]
[24.17805, "o", "    # Encode output and write to log atomically\r\n\u001b[?2004l\r"]
[24.178072, "o", "\u001b[?2004h> "]
[24.178114, "o", "    flock -x 200\r\n\u001b[?2004l\r"]
[24.17813, "o", "\u001b[?2004h> "]
[24.178305, "o", "    echo \"===== START host=$host check=$command =====\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[24.178324, "o", "\u001b[?2004h> "]
[24.178432, "o", "    echo \"$output\" | base64 >> \"$log_file\"\r\n\u001b[?2004l\r"]
[24.178452, "o", "\u001b[?2004h> "]
[24.178687, "o", "    echo \"===== END host=$host check=$command status=$exit_code =====\" >> \"$log_file\"\r\n\u001b[?2004l\r"]
[24.178731, "o", "\u001b[?2004h> "]
[24.178767, "o", "    flock -u 200\r\n\u001b[?2004l\r"]
[24.178786, "o", "\u001b[?2004h"]
[24.178801, "o", "> }\r\n\u001b[?2004l\r"]
[24.17882, "o", "\u001b[?2004h"]
[24.178838, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[24.178853, "o", "> "]
[24.17901, "o", "# Read target hosts from file, skipping comments and empty lines\r\n\u001b[?2004l\r"]
[24.17903, "o", "\u001b[?2004h> "]
[24.179159, "o", "hosts=$(grep -v '^#' \"$targets_file\" | grep -v '^$')\r\n\u001b[?2004l\r"]
[24.179171, "o", "\u001b[?2004h"]
[24.179203, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[24.179326, "o", "# Execute checks in parallel using background jobs\r\n\u001b[?2004l\r"]
[24.179343, "o", "\u001b[?2004h> "]
[24.179407, "o", "for host in $hosts; do\r\n\u001b[?2004l\r"]
[24.17943, "o", "\u001b[?2004h> "]
[24.17947, "o", "    # Ping check\r\n\u001b[?2004l\r"]
[24.179486, "o", "\u001b[?2004h> "]
[24.179621, "o", "    run_check \"$host\" \"ping\" \"ping -n -c 1 $host\" &\r\n\u001b[?2004l\r"]
[24.179641, "o", "\u001b[?2004h"]
[24.179657, "o", "> "]
[24.179672, "o", "    \r\n\u001b[?2004l\r"]
[24.179687, "o", "\u001b[?2004h> "]
[24.179775, "o", "    # Traceroute check  \r\n\u001b[?2004l\r"]
[24.179791, "o", "\u001b[?2004h> "]
[24.179955, "o", "    run_check \"$host\" \"traceroute\" \"traceroute -n -m 5 $host\" &\r\n\u001b[?2004l\r"]
[24.179979, "o", "\u001b[?2004h> "]
[24.179998, "o", "    \r\n\u001b[?2004l\r\u001b[?2004h"]
[24.180017, "o", "> "]
[24.180049, "o", "    # DNS check\r\n\u001b[?2004l\r"]
[24.180067, "o", "\u001b[?2004h> "]
[24.180204, "o", "    run_check \"$host\" \"dig\" \"dig +short $host A\" &\r\n\u001b[?2004l\r\u001b[?2004h"]
[24.18023, "o", "> done\r\n\u001b[?2004l\r"]
[24.18025, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.180269, "o", "\u001b[?2004h> "]
[24.180384, "o", "# Wait for all background jobs to complete\r\n\u001b[?2004l\r"]
[24.180404, "o", "\u001b[?2004h> "]
[24.18042, "o", "wait\r\n\u001b[?2004l\r"]
[24.180434, "o", "\u001b[?2004h> "]
[24.180451, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[24.180466, "o", "> "]
[24.180588, "o", "# Calculate SHA-256 checksum of the final log\r\n\u001b[?2004l\r"]
[24.180607, "o", "\u001b[?2004h"]
[24.180622, "o", "> "]
[24.180847, "o", "sha256sum \"$log_file\" | awk '{print $1}' > /home/user/diagnostics/netcheck.sha256\r\n\u001b[?2004l\r"]
[24.180866, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[24.180885, "o", "\u001b[?2004h> "]
[24.181, "o", "echo \"Diagnostics completed successfully.\"\r\n\u001b[?2004l\r"]
[24.181019, "o", "\u001b[?2004h> "]
[24.181037, "o", "EOF"]
[24.30316, "i", "chmod +x /home/user/diagnostics/run_net_checks.sh\n"]
[24.303333, "o", "chmod +x /home/user/diagnostics/run_net_checks.sh\r\n\u001b[?2004l\r"]
[24.303369, "o", "\u001b[?2004h"]
[24.303394, "o", "> "]
