{"version": 2, "width": 160, "height": 40, "timestamp": 1771009002, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.005495, "o", "\u001b[?2004hroot@664f1b5a-0d69-48a7-b370-55d4965f7588:~# "]
[0.866751, "i", "clear\r"]
[0.866851, "o", "clear\r\n\u001b[?2004l\r"]
[0.867821, "o", "\u001b[H\u001b[J"]
[0.867977, "o", "\u001b[?2004hroot@664f1b5a-0d69-48a7-b370-55d4965f7588:~# "]
[87.001588, "i", "mkdir -p /home/user/diagnostics\n"]
[87.001712, "o", "mkdir -p /home/user/diagnostics\r\n\u001b[?2004l\r"]
[87.003008, "o", "\u001b[?2004h"]
[87.003059, "o", "root@664f1b5a-0d69-48a7-b370-55d4965f7588:~# "]
[87.101332, "i", "cat > /home/user/diagnostics/run_net_checks.sh << 'EOF'\n#!/bin/bash\n\n# Netcheck diagnostic script\n# This script performs network diagnostics on specified targets\n\n# Configuration file path\nTARGETS_FILE=\"/home/user/diagnostics/targets.txt\"\nLOG_FILE=\"/home/user/diagnostics/netcheck.log\"\nLOCK_FILE=\"/home/user/diagnostics/netcheck.lock\"\nPREV_LOG_GZ=\"/home/user/diagnostics/netcheck.previous.log.gz\"\n\n# Ensure script is run as root\nif [[ \"$EUID\" -ne 0 ]]; then\n    echo \"This script must be run as root\" >&2\n    exit 1\nfi\n\n# Function to handle log rotation\nrotate_log() {\n    if [[ -f \"$LOG_FILE\" ]]; then\n        gzip -c \"$LOG_FILE\" > \"$PREV_LOG_GZ\"\n        rm -f \"$LOG_FILE\"\n    fi\n    touch \"$LOG_FILE\"\n    chmod 0600 \"$LOG_FILE\"\n}\n\n# Function to run individual checks and log results\nrun_check() {\n    local host=\"$1\"\n    local check_name=\"$2\"\n    local cmd=\"$3\"\n    \n    # Execute command and capture both stdout and stderr\n    local output\n    output=$(eval \"$cmd\" 2>&1)\n    \n    # Get exit code\n    local exit_code=$?\n  "]
[87.101452, "i", "  \n    # Base64 encode the output\n    local encoded_output\n    encoded_output=$(echo \"$output\" | base64)\n    \n    # Write to log atomically using flock\n    (\n        flock -x 200\n\n        echo \"===== START host=$host check=$check_name =====\"\n        echo \"$encoded_output\"\n        echo \"===== END host=$host check=$check_name status=$exit_code =====\"\n\n    ) 200>\"$LOCK_FILE\"\n}\n\n# === Main script execution ===\n\n# Check if targets file exists\nif [[ ! -f \"$TARGETS_FILE\" ]]; then\n    echo \"Error: targets file $TARGETS_FILE not found\" >&2\n    exit 1\nfi\n\n# Rotate logs\nrotate_log\n\n# Write header to log file\n(\n    flock -x 200\n    echo \"# Netcheck Report\"\n    echo \"Timestamp: $(date -u +'%Y-%m-%dT%H:%M:%SZ')\"\n) 200>\"$LOCK_FILE\" > \"$LOG_FILE\"\n\necho \"Starting network diagnostics...\"\n\n# Process targets file\nwhile IFS= read -r line; do\n    # Skip comments and empty lines\n    [[ \"$line\" = \\#* ]] && continue\n    [[ -z \"$line\" ]] && continue\n    \n    host=\"$line\"\n    \n    # Run all checks in parallel for current host\n    (\n   "]
[87.101488, "i", "     run_check \"$host\" \"ping\" \"ping -n -c 1 $host\"\n        run_check \"$host\" \"traceroute\" \"traceroute -n -m 5 $host\"\n        run_check \"$host\" \"dig\" \"dig +short $host A\"\n    ) &\ndone < \"$TARGETS_FILE\"\n\n# Wait for all background jobs to complete\nwait\necho \"Network diagnostics completed.\"\n\n# Generate SHA-256 checksum\nsha256sum \"$LOG_FILE\" > \"/home/user/diagnostics/netcheck.sha256\"\necho \"SHA-256 checksum generated.\"\nEOF"]
[87.101525, "o", "cat > /home/user/diagnostics/run_net_checks.sh << 'EOF'\r\n"]
[87.101548, "o", "\u001b[?2004l\r"]
[87.101572, "o", "\u001b[?2004h> "]
[87.101607, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[87.101627, "o", "\u001b[?2004h> "]
[87.101646, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[87.101669, "o", "> "]
[87.101724, "o", "# Netcheck diagnostic script\r\n\u001b[?2004l\r"]
[87.101741, "o", "\u001b[?2004h> "]
[87.101903, "o", "# This script performs network diagnostics on specified targets\r\n\u001b[?2004l\r"]
[87.101912, "o", "\u001b[?2004h"]
[87.101954, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[87.102011, "o", "# Configuration file path\r\n\u001b[?2004l\r"]
[87.102027, "o", "\u001b[?2004h"]
[87.102043, "o", "> "]
[87.102151, "o", "TARGETS_FILE=\"/home/user/diagnostics/targets.txt\"\r\n\u001b[?2004l\r"]
[87.102172, "o", "\u001b[?2004h"]
[87.102187, "o", "> "]
[87.102295, "o", "LOG_FILE=\"/home/user/diagnostics/netcheck.log\"\r\n\u001b[?2004l\r"]
[87.102314, "o", "\u001b[?2004h> "]
[87.102433, "o", "LOCK_FILE=\"/home/user/diagnostics/netcheck.lock\"\r\n\u001b[?2004l\r"]
[87.102447, "o", "\u001b[?2004h"]
[87.102468, "o", "> "]
[87.102746, "o", "PREV_LOG_GZ=\"/home/user/diagnostics/netcheck.previous.log.gz\"\r\n\u001b[?2004l\r"]
[87.102789, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h"]
[87.102814, "o", "> "]
[87.102885, "o", "# Ensure script is run as root\r\n\u001b[?2004l\r"]
[87.102902, "o", "\u001b[?2004h"]
[87.102918, "o", "> "]
[87.102979, "o", "if [[ \"$EUID\" -ne 0 ]]; then\r\n\u001b[?2004l\r"]
[87.102995, "o", "\u001b[?2004h"]
[87.10301, "o", "> "]
[87.103119, "o", "    echo \"This script must be run as root\" >&2\r\n\u001b[?2004l\r"]
[87.103143, "o", "\u001b[?2004h> "]
[87.103175, "o", "    exit 1\r\n\u001b[?2004l\r"]
[87.10319, "o", "\u001b[?2004h"]
[87.103206, "o", "> fi\r\n\u001b[?2004l\r"]
[87.103227, "o", "\u001b[?2004h"]
[87.103247, "o", "> \r\n\u001b[?2004l\r"]
[87.103268, "o", "\u001b[?2004h> "]
[87.103353, "o", "# Function to handle log rotation\r\n\u001b[?2004l\r"]
[87.103374, "o", "\u001b[?2004h> "]
[87.103412, "o", "rotate_log() {\r\n\u001b[?2004l\r"]
[87.103429, "o", "\u001b[?2004h"]
[87.103444, "o", "> "]
[87.103546, "o", "    if [[ -f \"$LOG_FILE\" ]]; then\r\n\u001b[?2004l\r"]
[87.103564, "o", "\u001b[?2004h"]
[87.103585, "o", "> "]
[87.103686, "o", "        gzip -c \"$LOG_FILE\" > \"$PREV_LOG_GZ\"\r\n\u001b[?2004l\r"]
[87.103702, "o", "\u001b[?2004h"]
[87.103719, "o", "> "]
[87.103775, "o", "        rm -f \"$LOG_FILE\"\r\n\u001b[?2004l\r"]
[87.103794, "o", "\u001b[?2004h"]
[87.103809, "o", "> "]
[87.103825, "o", "    fi\r\n\u001b[?2004l\r"]
[87.10384, "o", "\u001b[?2004h> "]
[87.103904, "o", "    touch \"$LOG_FILE\"\r\n\u001b[?2004l\r"]
[87.103918, "o", "\u001b[?2004h"]
[87.103932, "o", "> "]
[87.103993, "o", "    chmod 0600 \"$LOG_FILE\"\r\n\u001b[?2004l\r"]
[87.104007, "o", "\u001b[?2004h"]
[87.104021, "o", "> }\r\n\u001b[?2004l\r"]
[87.104036, "o", "\u001b[?2004h"]
[87.10405, "o", "> \r\n\u001b[?2004l\r"]
[87.104068, "o", "\u001b[?2004h> "]
[87.104201, "o", "# Function to run individual checks and log results\r\n\u001b[?2004l\r"]
[87.104218, "o", "\u001b[?2004h"]
[87.104234, "o", "> "]
[87.104267, "o", "run_check() {\r\n\u001b[?2004l\r"]
[87.10428, "o", "\u001b[?2004h"]
[87.104294, "o", "> "]
[87.104342, "o", "    local host=\"$1\"\r\n\u001b[?2004l\r"]
[87.104355, "o", "\u001b[?2004h"]
[87.10437, "o", "> "]
[87.104428, "o", "    local check_name=\"$2\"\r\n\u001b[?2004l\r"]
[87.104448, "o", "\u001b[?2004h> "]
[87.104522, "o", "    local cmd=\"$3\"\r\n\u001b[?2004l\r"]
[87.104538, "o", "\u001b[?2004h"]
[87.104553, "o", ">     \r\n"]
[87.104568, "o", "\u001b[?2004l\r\u001b[?2004h"]
[87.104583, "o", "> "]
[87.104714, "o", "    # Execute command and capture both stdout and stderr\r\n\u001b[?2004l\r"]
[87.104728, "o", "\u001b[?2004h"]
[87.104746, "o", "> "]
[87.104782, "o", "    local output\r\n\u001b[?2004l\r"]
[87.104795, "o", "\u001b[?2004h"]
[87.10481, "o", "> "]
[87.104882, "o", "    output=$(eval \"$cmd\" 2>&1)\r\n\u001b[?2004l\r"]
[87.104898, "o", "\u001b[?2004h"]
[87.104912, "o", "> "]
[87.104927, "o", "    \r\n\u001b[?2004l\r"]
[87.104942, "o", "\u001b[?2004h> "]
[87.104993, "o", "    # Get exit code\r\n\u001b[?2004l\r"]
[87.105007, "o", "\u001b[?2004h"]
[87.105022, "o", "> "]
[87.105075, "o", "    local exit_code=$?\r\n\u001b[?2004l\r"]
[87.105088, "o", "\u001b[?2004h"]
[87.105105, "o", "> "]
[87.10512, "o", "    \r\n\u001b[?2004l\r"]
[87.105134, "o", "\u001b[?2004h> "]
[87.105213, "o", "    # Base64 encode the output\r\n\u001b[?2004l\r"]
[87.105226, "o", "\u001b[?2004h"]
[87.105244, "o", "> "]
[87.105297, "o", "    local encoded_output\r\n\u001b[?2004l\r"]
[87.10531, "o", "\u001b[?2004h"]
[87.105325, "o", "> "]
[87.105432, "o", "    encoded_output=$(echo \"$output\" | base64)\r\n\u001b[?2004l\r"]
[87.105447, "o", "\u001b[?2004h"]
[87.10546, "o", "> "]
[87.105478, "o", "    \r\n\u001b[?2004l\r"]
[87.105493, "o", "\u001b[?2004h> "]
[87.105601, "o", "    # Write to log atomically using flock\r\n\u001b[?2004l\r"]
[87.105615, "o", "\u001b[?2004h"]
[87.10563, "o", "> "]
[87.105645, "o", "    (\r\n\u001b[?2004l\r\u001b[?2004h"]
[87.105661, "o", "> "]
[87.105713, "o", "        flock -x 200\r\n\u001b[?2004l\r"]
[87.105729, "o", "\u001b[?2004h> "]
[87.105744, "o", "\r\n\u001b[?2004l\r"]
[87.105758, "o", "\u001b[?2004h> "]
[87.105908, "o", "        echo \"===== START host=$host check=$check_name =====\"\r\n\u001b[?2004l\r"]
[87.105921, "o", "\u001b[?2004h"]
[87.10594, "o", "> "]
[87.106011, "o", "        echo \"$encoded_output\"\r\n\u001b[?2004l\r"]
[87.106025, "o", "\u001b[?2004h"]
[87.10604, "o", "> "]
[87.106217, "o", "        echo \"===== END host=$host check=$check_name status=$exit_code =====\"\r\n\u001b[?2004l\r"]
[87.10624, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[87.106259, "o", "\u001b[?2004h> "]
[87.106319, "o", "    ) 200>\"$LOCK_FILE\"\r\n\u001b[?2004l\r"]
[87.106332, "o", "\u001b[?2004h"]
[87.106352, "o", "> }\r\n\u001b[?2004l\r"]
[87.106368, "o", "\u001b[?2004h> "]
[87.106383, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[87.106397, "o", "> "]
[87.106482, "o", "# === Main script execution ===\r\n\u001b[?2004l\r"]
[87.1065, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[87.106519, "o", "\u001b[?2004h"]
[87.106533, "o", "> "]
[87.106605, "o", "# Check if targets file exists\r\n\u001b[?2004l\r"]
[87.106618, "o", "\u001b[?2004h"]
[87.106638, "o", "> "]
[87.106714, "o", "if [[ ! -f \"$TARGETS_FILE\" ]]; then\r\n\u001b[?2004l\r"]
[87.106727, "o", "\u001b[?2004h"]
[87.106742, "o", "> "]
[87.106876, "o", "    echo \"Error: targets file $TARGETS_FILE not found\" >&2\r\n\u001b[?2004l\r"]
[87.106891, "o", "\u001b[?2004h"]
[87.106905, "o", "> "]
[87.106929, "o", "    exit 1\r\n\u001b[?2004l\r"]
[87.106942, "o", "\u001b[?2004h"]
[87.106957, "o", "> fi\r\n\u001b[?2004l\r"]
[87.106976, "o", "\u001b[?2004h"]
[87.10699, "o", "> \r\n\u001b[?2004l\r"]
[87.107003, "o", "\u001b[?2004h> "]
[87.107043, "o", "# Rotate logs\r\n\u001b[?2004l\r"]
[87.107058, "o", "\u001b[?2004h"]
[87.107073, "o", "> "]
[87.107096, "o", "rotate_log\r\n\u001b[?2004l\r"]
[87.10711, "o", "\u001b[?2004h"]
[87.107124, "o", "> \r\n\u001b[?2004l\r"]
[87.107141, "o", "\u001b[?2004h> "]
[87.10721, "o", "# Write header to log file\r\n\u001b[?2004l\r"]
[87.107228, "o", "\u001b[?2004h"]
[87.107242, "o", "> (\r\n\u001b[?2004l\r"]
[87.107256, "o", "\u001b[?2004h"]
[87.10727, "o", "> "]
[87.107306, "o", "    flock -x 200\r\n\u001b[?2004l\r"]
[87.107319, "o", "\u001b[?2004h"]
[87.107334, "o", "> "]
[87.107399, "o", "    echo \"# Netcheck Report\"\r\n\u001b[?2004l\r"]
[87.107438, "o", "\u001b[?2004h> "]
[87.107561, "o", "    echo \"Timestamp: $(date -u +'%Y-%m-%dT%H:%M:%SZ')\"\r\n\u001b[?2004l\r"]
[87.10758, "o", "\u001b[?2004h"]
[87.107596, "o", "> "]
[87.107661, "o", ") 200>\"$LOCK_FILE\" > \"$LOG_FILE\"\r\n\u001b[?2004l\r"]
[87.107689, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[87.107706, "o", "\u001b[?2004h> "]
[87.1078, "o", "echo \"Starting network diagnostics...\"\r\n\u001b[?2004l\r"]
[87.107813, "o", "\u001b[?2004h"]
[87.107828, "o", "> \r\n\u001b[?2004l\r"]
[87.107846, "o", "\u001b[?2004h> "]
[87.107906, "o", "# Process targets file\r\n\u001b[?2004l\r"]
[87.10792, "o", "\u001b[?2004h"]
[87.107934, "o", "> "]
[87.107996, "o", "while IFS= read -r line; do\r\n\u001b[?2004l\r"]
[87.10801, "o", "\u001b[?2004h"]
[87.108025, "o", "> "]
[87.108112, "o", "    # Skip comments and empty lines\r\n\u001b[?2004l\r"]
[87.108137, "o", "\u001b[?2004h> "]
[87.108215, "o", "    [[ \"$line\" = \\#* ]] && continue\r\n\u001b[?2004l\r"]
[87.108236, "o", "\u001b[?2004h> "]
[87.10832, "o", "    [[ -z \"$line\" ]] && continue\r\n\u001b[?2004l\r"]
[87.108335, "o", "\u001b[?2004h> "]
[87.108355, "o", "    \r\n\u001b[?2004l\r"]
[87.108374, "o", "\u001b[?2004h> "]
[87.108416, "o", "    host=\"$line\"\r\n\u001b[?2004l\r"]
[87.108431, "o", "\u001b[?2004h"]
[87.108451, "o", ">     \r\n\u001b[?2004l\r"]
[87.10847, "o", "\u001b[?2004h> "]
[87.108598, "o", "    # Run all checks in parallel for current host\r\n\u001b[?2004l\r"]
[87.108614, "o", "\u001b[?2004h> "]
[87.108635, "o", "    (\r\n\u001b[?2004l\r"]
[87.108649, "o", "\u001b[?2004h"]
[87.10867, "o", "> "]
[87.108789, "o", "        run_check \"$host\" \"ping\" \"ping -n -c 1 $host\"\r\n\u001b[?2004l\r"]
[87.108823, "o", "\u001b[?2004h> "]
[87.10897, "o", "        run_check \"$host\" \"traceroute\" \"traceroute -n -m 5 $host\"\r\n\u001b[?2004l\r"]
[87.108987, "o", "\u001b[?2004h> "]
[87.109118, "o", "        run_check \"$host\" \"dig\" \"dig +short $host A\"\r\n\u001b[?2004l\r"]
[87.109144, "o", "\u001b[?2004h> "]
[87.10916, "o", "    ) &\r\n\u001b[?2004l\r"]
[87.109174, "o", "\u001b[?2004h"]
[87.10919, "o", "> "]
[87.10924, "o", "done < \"$TARGETS_FILE\"\r\n\u001b[?2004l\r"]
[87.109261, "o", "\u001b[?2004h"]
[87.109282, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[87.1093, "o", "> "]
[87.109395, "o", "# Wait for all background jobs to complete\r\n\u001b[?2004l\r"]
[87.109422, "o", "\u001b[?2004h> "]
[87.109441, "o", "wait\r\n\u001b[?2004l\r\u001b[?2004h"]
[87.109459, "o", "> "]
[87.10955, "o", "echo \"Network diagnostics completed.\"\r\n\u001b[?2004l\r"]
[87.109576, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[87.109597, "o", "\u001b[?2004h> "]
[87.109667, "o", "# Generate SHA-256 checksum\r\n\u001b[?2004l\r"]
[87.109692, "o", "\u001b[?2004h> "]
[87.109853, "o", "sha256sum \"$LOG_FILE\" > \"/home/user/diagnostics/netcheck.sha256\"\r\n\u001b[?2004l\r"]
[87.109932, "o", "\u001b[?2004h> "]
[87.10996, "o", "echo \"SHA-256 checksum generated.\"\r\n\u001b[?2004l\r"]
[87.109979, "o", "\u001b[?2004h> "]
[87.109997, "o", "EOF"]
[87.421752, "i", "chmod +x /home/user/diagnostics/run_net_checks.sh\n"]
[87.421945, "o", "chmod +x /home/user/diagnostics/run_net_checks.sh\r\n\u001b[?2004l\r"]
[87.421995, "o", "\u001b[?2004h> "]
[87.517623, "i", "cat > /home/user/diagnostics/targets.txt << 'EOF'\n# Example target hosts\n# Comment line\nexample.com\n8.8.8.8\ngithub.com\nEOF"]
[87.517798, "o", "cat > /home/user/diagnostics/targets.txt << 'EOF'\r\n\u001b[?2004l\r"]
[87.517836, "o", "\u001b[?2004h> "]
[87.5179, "o", "# Example target hosts\r\n\u001b[?2004l\r"]
[87.517935, "o", "\u001b[?2004h> "]
[87.51797, "o", "# Comment line\r\n\u001b[?2004l\r"]
[87.517998, "o", "\u001b[?2004h> "]
[87.518041, "o", "example.com\r\n\u001b[?2004l\r"]
[87.51807, "o", "\u001b[?2004h> "]
[87.518099, "o", "8.8.8.8\r\n\u001b[?2004l\r\u001b[?2004h> "]
[87.518135, "o", "github.com\r\n\u001b[?2004l\r"]
[87.518162, "o", "\u001b[?2004h> EOF"]
