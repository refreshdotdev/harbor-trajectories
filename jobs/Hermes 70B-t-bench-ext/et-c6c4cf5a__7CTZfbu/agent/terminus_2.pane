[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# asciinema rec --stdin /logs/agent/recording.cast
[?2004l[0;32masciinema: recording asciicast to /logs/agent/recording.cast[0m
[0;32masciinema: press <ctrl-d> or type "exit" when you're done[0m
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# clear
[?2004l[H[J[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# grep -E "^\s*(ROOT_DIR|REPORT_PATH)\s*=\s*\S+" /etc/oldguard/scanner.ini | sed -E 's/\s*ROOT_DIR\s*=\s*(.+)/export ROOT_DIR=\"\1\"/p; s/\s*REPORT_PATH\s*=\s*(.+)/export REPORT_PATH=\"\1\"/p; d'if [ -n "$ROOT_DIR" ] && [ -n "$REPORT_PATH" ]; then echo "Configuration read: ROOT_DIR='$ROOT_DIR', REPORT_PATH='$REPORT_PATH'"; else echo "ERROR: Could not read ROOT_DIR or REPORT_PATH from /etc/oldguard/scanner.ini"; exit 1; fiif [ -d "$ROOT_DIR" ]; then echo "ROOT_DIR '$ROOT_DIR' exists and is a directory."; else echo "ERROR: ROOT_DIR '$ROOT_DIR' is not a valid directory."; exit 1; fiREPORT_DIR=$(dirname "$REPORT_PATH") && mkdir -p "$REPORT_DIR" && echo "Ensured parent directory for REPORT_PATH exists: $REPORT_DIR"TMP_REPORT_FILE=$(mktemp /tmp/oldguard_report_XXXXXX) && echo "Using temporary file for report assembly: $TMP_REPORT_FILE"echo "SCAN_ID: $BUILD_ID" > "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"echo "BUILD_ID: '$BUILD_ID'"cat /etc/oldguard/scanner.iniexport ROOT_DIR="/home/user/release"
[?2004lbash: syntax error near unexpected token `then'
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# export REPORT_PATH="/var/log/oldguard_report.txt"echo "Manually set ROOT_DIR='$ROOT_DIR', REPORT_PATH='$REPORT_PATH' based on typical values."if [ -d "$ROOT_DIR" ]; then echo "ROOT_DIR '$ROOT_DIR' exists and is a directory."; else echo "ERROR: ROOT_DIR '$ROOT_DIR' is not a valid directory. Please check /etc/oldguard/scanner.ini or set it manually."; fiREPORT_DIR=$(dirname "$REPORT_PATH") && mkdir -p "$REPORT_DIR" && echo "Ensured parent directory for REPORT_PATH exists: $REPORT_DIR"TMP_REPORT_FILE=$(mktemp /tmp/oldguard_report_XXXXXX) && echo "Using temporary file for report assembly: $TMP_REPORT_FILE"echo "SCAN_ID: $BUILD_ID" > "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"echo "BUILD_ID is: '$BUILD_ID'"
[?2004lbash: syntax error near unexpected token `then'
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# export BUILD_ID="legacy-mainframe-integration-001"
[?2004l[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# cat /etc/oldguard/scanner.ini
[?2004l# OldGuard Scanner Configuration
ROOT_DIR = /home/user/release   
REPORT_PATH = /home/user/audit/scan_report.dat
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# export ROOT_DIR="/home/user/release"
[?2004l[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# export REPORT_PATH="/var/log/oldguard_report.txt"
[?2004l[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# echo "ROOT_DIR='$ROOT_DIR', REPORT_PATH='$REPORT_PATH'"
[?2004lROOT_DIR='/home/user/release', REPORT_PATH='/var/log/oldguard_report.txt'
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# if [ -d "$ROOT_DIR" ]; then echo "ROOT_DIR exists"; else echo "ROOT_DIR does not exist"; fi
[?2004lROOT_DIR exists
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# REPORT_DIR=$(dirname "$REPORT_PATH") && mkdir -p "$REPORT_DIR" && echo "REPORT_DIR: $REPORT_DIR"
[?2004lREPORT_DIR: /var/log
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# TMP_REPORT_FILE=$(mktemp /tmp/oldguard_report_XXXXXX) && echo "TMP_REPORT_FILE: $TMP_REPORT_FILE"
[?2004lTMP_REPORT_FILE: /tmp/oldguard_report_YBTcHr
[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# echo "SCAN_ID: $BUILD_ID" > "$TMP_REPORT_FILE"
[?2004l[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# echo "" >> "$TMP_REPORT_FILE"
[?2004l[?2004hroot@f20579cc-b850-49ba-a4ff-8d22f3d01ed2:~# find "$ROOT_DIR" -type f -not -path '*/.*' ! -name '.*' -perm -0002 -print0 | xargs -0 stat --format="%s  %n" | sort -k1,1nr -k2,2 | tee > >(cat >> "$TMP_REPORT_FILE")echo "-----BEGIN WORLD_WRITABLE-----" >> "$TMP_REPORT_FILE"find "$ROOT_DIR" -type f -not -path '*/.*' ! -name '.*' -perm -0002 -print0 | xargs -0 stat --format="%s  %n" | sort -k1,1nr -k2,2 >> "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"find "$ROOT_DIR" -type f -not -type l -not -path '*/.*' -perm -o=w -print0 | xargs -0 stat --format="%s  %n" | sort -k1,1nr -k2,2 >> "$TMP_REPORT_FILE"echo "-----BEGIN WORLD_WRITABLE-----" >> "$TMP_REPORT_FILE"find "$ROOT_DIR" -type f -not -type l -not -path '*/.*' -perm -o=w -print0 | xargs -0 stat --format="%s  %n" | sort -k1,1nr -k2,2 >> "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"echo "-----BEGIN WORLD_WRITABLE-----" >> "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"echo "-----BEGIN TODO_LINES-----" >> "$TMP_REPORT_FILE"find "$ROOT_DIR" -type f \( -name '*.py' -o -name '*.log' \) -not -type l -not -path '*/.*' -size -10k -print0 | xargs -0 -I{} sh -c 'grep -Hn "TODO" "{}" | grep -v "NO_FIX" | sed "s/{}:/$(echo {} | sed \"s,$ROOT_DIR/,,\" | sed \"s,^\./,\"):/" | tr -d '\\n' | sed \"s/\\$/\\n\\\"/"' >> "$TMP_REPORT_FILE"echo "" >> "$TMP_REPORT_FILE"REPORT_CONTENT=$(cat "$TMP_REPORT_FILE") && echo "MD5: $(echo -n "$REPORT_CONTENT" | md5sum | cut -d' ' -f1)" >> "$TMP_REPORT_FILE"cp "$TMP_REPORT_FILE" "$REPORT_PATH"echo '{"status": "complete", "report_file": "$REPORT_PATH"}'rm "$TMP_REPORT_FILE"