============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 3 items

../../../tests/test_final_state.py::test_database_content PASSED         [ 33%]
../../../tests/test_final_state.py::test_legacy_sync_file FAILED         [ 66%]
../../../tests/test_final_state.py::test_manifest_file PASSED            [100%]

=================================== FAILURES ===================================
____________________________ test_legacy_sync_file _____________________________

    def test_legacy_sync_file():
        assert LEGACY_LOG.is_file(), "Legacy sync file missing."
        exp_ver, exp_time, exp_sig = _get_expected_data()
    
        # Expected format: VERSION|TIMESTAMP|SIGNATURE
        # Encoding: ISO-8859-1
        # Line Ending: CRLF
    
        expected_str = f"{exp_ver}|{exp_time}|{exp_sig}\r\n"
        expected_bytes = expected_str.encode("iso-8859-1")
    
        with open(LEGACY_LOG, "rb") as f:
            content = f.read()
    
        # Check exact bytes to verify encoding and line endings
>       assert content == expected_bytes, (
            f"Legacy file content mismatch.\n"
            f"Expected bytes (ISO-8859-1 + CRLF): {expected_bytes!r}\n"
            f"Found bytes:                        {content!r}"
        )
E       AssertionError: Legacy file content mismatch.
E         Expected bytes (ISO-8859-1 + CRLF): b'v2.4.1-beta|1698400800|50d318f35909f2d02a7941a4be4a5be8dd266e0b3e62247e520e3b4152078cd7\r\n'
E         Found bytes:                        b'\r\nVERSION|TIMESTAMP|SIGNATURE\r\nv2.4.1-beta|1698400800|50d318f35909f2d02a7941a4be4a5be8dd266e0b3e62247e520e3b4152078cd7\r\n'
E       assert b'\r\nVERSION...152078cd7\r\n' == b'v2.4.1-beta...152078cd7\r\n'
E         
E         At index 0 diff: b'\r' != b'v'
E         
E         Full diff:
E         - (b'v2.4.1-beta|1698400800|50d318f35909f2d02a7941a4be4a5be8dd266e0b3e62247e520e3'
E         -  b'b4152078cd7\r\n')
E         + (b'\r\nVERSION|TIMESTAMP|SIGNATURE\r\nv2.4.1-beta|1698400800|50d318f35909f2d02a'
E         +  b'7941a4be4a5be8dd266e0b3e62247e520e3b4152078cd7\r\n')

/tests/test_final_state.py:105: AssertionError
=========================== short test summary info ============================
FAILED ../../../tests/test_final_state.py::test_legacy_sync_file - AssertionE...
========================= 1 failed, 2 passed in 0.03s ==========================
