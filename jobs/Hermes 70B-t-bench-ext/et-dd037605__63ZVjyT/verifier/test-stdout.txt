============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 5 items

../../tests/test_final_state.py::test_files_exist PASSED                 [ 20%]
../../tests/test_final_state.py::test_json_encoding_and_validity FAILED  [ 40%]
../../tests/test_final_state.py::test_config_usage FAILED                [ 60%]
../../tests/test_final_state.py::test_data_content FAILED                [ 80%]
../../tests/test_final_state.py::test_text_report_consistency FAILED     [100%]

=================================== FAILURES ===================================
_______________________ test_json_encoding_and_validity ________________________

    def test_json_encoding_and_validity():
        """Verifies the JSON file is UTF-16LE with BOM and valid JSON."""
>       _get_json_data()

/tests/test_final_state.py:41: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def _get_json_data():
        """Helper to read and validate JSON data."""
        if not os.path.exists(JSON_PATH):
            pytest.fail(f"Missing {JSON_PATH}")
    
        with open(JSON_PATH, 'rb') as f:
            raw = f.read()
    
        # Check BOM for UTF-16LE (FF FE)
>       assert raw.startswith(b'\xff\xfe'), "JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)"
E       AssertionError: JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)
E       assert False
E        +  where False = <built-in method startswith of bytes object at 0x5ae6e2cedd20>(b'\xff\xfe')
E        +    where <built-in method startswith of bytes object at 0x5ae6e2cedd20> = b'{\x00\n\x00 \x00 \x00"\x00t\x00i\x00m\x00e\x00s\x00t\x00a\x00m\x00p\x00_\x00u\x00t\x00c\x00"\x00:\x00 \x00"\x002\x000\x002\x006\x00-\x000\x002\x00-\x001\x003\x00T\x001\x008\x00:\x005\x007\x00:\x003\x002\x00Z\x00"\x00,\x00\n\x00 \x00 \x00"\x00i\x00n\x00t\x00e\x00r\x00f\x00a\x00c\x00e\x00_\x00c\x00o\x00n\x00f\x00i\x00g\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00n\x00a\x00m\x00e\x00"\x00:\x00 \x00"\x00l\x00o\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00r\x00i\x00m\x00a\x00r\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x00"\x001\x002\x007\x00.\x000\x00.\x000\x00.\x001\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00m\x00t\x00u\x00"\x00:\x00 \x00n\x00u\x00l\x00l\x00\n\x00 \x00 \x00}\x00,\x00\n\x00 \x00 \x00"\x00c\x00o\x00n\x00n\x00e\x00c\x00t\x00i\x00v\x00i\x00t\x00y\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00g\x00a\x00t\x00e\x00w\x00a\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x001\x007\x002\x00.\x002\x000\x00.\x000\x00.\x001\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00a\x00c\x00t\x00i\x00v\x00e\x00_\x00t\x00c\x00p\x00_\x00f\x00l\x00o\x00w\x00s\x00"\x00:\x00 \x006\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00i\x00n\x00g\x00_\x00j\x00i\x00t\x00t\x00e\x00r\x00_\x00m\x00s\x00"\x00:\x00 \x000\x00.\x000\x003\x001\x00\n\x00 \x00 \x00}\x00\n\x00}\x00\n\x00'.startswith

/tests/test_final_state.py:19: AssertionError
______________________________ test_config_usage _______________________________

    def test_config_usage():
        """Ensures the agent read the REAL config, not the decoy."""
>       data = _get_json_data()

/tests/test_final_state.py:45: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def _get_json_data():
        """Helper to read and validate JSON data."""
        if not os.path.exists(JSON_PATH):
            pytest.fail(f"Missing {JSON_PATH}")
    
        with open(JSON_PATH, 'rb') as f:
            raw = f.read()
    
        # Check BOM for UTF-16LE (FF FE)
>       assert raw.startswith(b'\xff\xfe'), "JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)"
E       AssertionError: JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)
E       assert False
E        +  where False = <built-in method startswith of bytes object at 0x5ae6e2d04d10>(b'\xff\xfe')
E        +    where <built-in method startswith of bytes object at 0x5ae6e2d04d10> = b'{\x00\n\x00 \x00 \x00"\x00t\x00i\x00m\x00e\x00s\x00t\x00a\x00m\x00p\x00_\x00u\x00t\x00c\x00"\x00:\x00 \x00"\x002\x000\x002\x006\x00-\x000\x002\x00-\x001\x003\x00T\x001\x008\x00:\x005\x007\x00:\x003\x002\x00Z\x00"\x00,\x00\n\x00 \x00 \x00"\x00i\x00n\x00t\x00e\x00r\x00f\x00a\x00c\x00e\x00_\x00c\x00o\x00n\x00f\x00i\x00g\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00n\x00a\x00m\x00e\x00"\x00:\x00 \x00"\x00l\x00o\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00r\x00i\x00m\x00a\x00r\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x00"\x001\x002\x007\x00.\x000\x00.\x000\x00.\x001\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00m\x00t\x00u\x00"\x00:\x00 \x00n\x00u\x00l\x00l\x00\n\x00 \x00 \x00}\x00,\x00\n\x00 \x00 \x00"\x00c\x00o\x00n\x00n\x00e\x00c\x00t\x00i\x00v\x00i\x00t\x00y\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00g\x00a\x00t\x00e\x00w\x00a\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x001\x007\x002\x00.\x002\x000\x00.\x000\x00.\x001\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00a\x00c\x00t\x00i\x00v\x00e\x00_\x00t\x00c\x00p\x00_\x00f\x00l\x00o\x00w\x00s\x00"\x00:\x00 \x006\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00i\x00n\x00g\x00_\x00j\x00i\x00t\x00t\x00e\x00r\x00_\x00m\x00s\x00"\x00:\x00 \x000\x00.\x000\x003\x001\x00\n\x00 \x00 \x00}\x00\n\x00}\x00\n\x00'.startswith

/tests/test_final_state.py:19: AssertionError
______________________________ test_data_content _______________________________

    def test_data_content():
>       data = _get_json_data()

/tests/test_final_state.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def _get_json_data():
        """Helper to read and validate JSON data."""
        if not os.path.exists(JSON_PATH):
            pytest.fail(f"Missing {JSON_PATH}")
    
        with open(JSON_PATH, 'rb') as f:
            raw = f.read()
    
        # Check BOM for UTF-16LE (FF FE)
>       assert raw.startswith(b'\xff\xfe'), "JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)"
E       AssertionError: JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)
E       assert False
E        +  where False = <built-in method startswith of bytes object at 0x5ae6e2cfb700>(b'\xff\xfe')
E        +    where <built-in method startswith of bytes object at 0x5ae6e2cfb700> = b'{\x00\n\x00 \x00 \x00"\x00t\x00i\x00m\x00e\x00s\x00t\x00a\x00m\x00p\x00_\x00u\x00t\x00c\x00"\x00:\x00 \x00"\x002\x000\x002\x006\x00-\x000\x002\x00-\x001\x003\x00T\x001\x008\x00:\x005\x007\x00:\x003\x002\x00Z\x00"\x00,\x00\n\x00 \x00 \x00"\x00i\x00n\x00t\x00e\x00r\x00f\x00a\x00c\x00e\x00_\x00c\x00o\x00n\x00f\x00i\x00g\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00n\x00a\x00m\x00e\x00"\x00:\x00 \x00"\x00l\x00o\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00r\x00i\x00m\x00a\x00r\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x00"\x001\x002\x007\x00.\x000\x00.\x000\x00.\x001\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00m\x00t\x00u\x00"\x00:\x00 \x00n\x00u\x00l\x00l\x00\n\x00 \x00 \x00}\x00,\x00\n\x00 \x00 \x00"\x00c\x00o\x00n\x00n\x00e\x00c\x00t\x00i\x00v\x00i\x00t\x00y\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00g\x00a\x00t\x00e\x00w\x00a\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x001\x007\x002\x00.\x002\x000\x00.\x000\x00.\x001\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00a\x00c\x00t\x00i\x00v\x00e\x00_\x00t\x00c\x00p\x00_\x00f\x00l\x00o\x00w\x00s\x00"\x00:\x00 \x006\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00i\x00n\x00g\x00_\x00j\x00i\x00t\x00t\x00e\x00r\x00_\x00m\x00s\x00"\x00:\x00 \x000\x00.\x000\x003\x001\x00\n\x00 \x00 \x00}\x00\n\x00}\x00\n\x00'.startswith

/tests/test_final_state.py:19: AssertionError
_________________________ test_text_report_consistency _________________________

    def test_text_report_consistency():
        """Verifies the text report references the JSON file correctly."""
        if not os.path.exists(JSON_PATH) or not os.path.exists(TEXT_PATH):
            pytest.fail("Missing output files")
    
        # Read JSON raw for hash
        with open(JSON_PATH, 'rb') as f:
            json_bytes = f.read()
        expected_hash = hashlib.sha1(json_bytes).hexdigest()
    
        # Read Text Report (UTF-8)
        with open(TEXT_PATH, 'r', encoding='utf-8') as f:
            lines = [l.strip() for l in f.readlines()]
    
        assert len(lines) == 5, f"Expected 5 lines in summary, found {len(lines)}"
        assert lines[0] == "GAMMA NODE DIAGNOSTIC SUMMARY"
    
        # Check Timestamp consistency
>       data = _get_json_data()

/tests/test_final_state.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    def _get_json_data():
        """Helper to read and validate JSON data."""
        if not os.path.exists(JSON_PATH):
            pytest.fail(f"Missing {JSON_PATH}")
    
        with open(JSON_PATH, 'rb') as f:
            raw = f.read()
    
        # Check BOM for UTF-16LE (FF FE)
>       assert raw.startswith(b'\xff\xfe'), "JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)"
E       AssertionError: JSON file missing UTF-16LE BOM (expected first bytes 0xFF, 0xFE)
E       assert False
E        +  where False = <built-in method startswith of bytes object at 0x5ae6e2cedd20>(b'\xff\xfe')
E        +    where <built-in method startswith of bytes object at 0x5ae6e2cedd20> = b'{\x00\n\x00 \x00 \x00"\x00t\x00i\x00m\x00e\x00s\x00t\x00a\x00m\x00p\x00_\x00u\x00t\x00c\x00"\x00:\x00 \x00"\x002\x000\x002\x006\x00-\x000\x002\x00-\x001\x003\x00T\x001\x008\x00:\x005\x007\x00:\x003\x002\x00Z\x00"\x00,\x00\n\x00 \x00 \x00"\x00i\x00n\x00t\x00e\x00r\x00f\x00a\x00c\x00e\x00_\x00c\x00o\x00n\x00f\x00i\x00g\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00n\x00a\x00m\x00e\x00"\x00:\x00 \x00"\x00l\x00o\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00r\x00i\x00m\x00a\x00r\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x00"\x001\x002\x007\x00.\x000\x00.\x000\x00.\x001\x00"\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00m\x00t\x00u\x00"\x00:\x00 \x00n\x00u\x00l\x00l\x00\n\x00 \x00 \x00}\x00,\x00\n\x00 \x00 \x00"\x00c\x00o\x00n\x00n\x00e\x00c\x00t\x00i\x00v\x00i\x00t\x00y\x00"\x00:\x00 \x00{\x00\n\x00 \x00 \x00 \x00 \x00"\x00g\x00a\x00t\x00e\x00w\x00a\x00y\x00_\x00i\x00p\x00"\x00:\x00 \x001\x007\x002\x00.\x002\x000\x00.\x000\x00.\x001\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00a\x00c\x00t\x00i\x00v\x00e\x00_\x00t\x00c\x00p\x00_\x00f\x00l\x00o\x00w\x00s\x00"\x00:\x00 \x006\x00,\x00\n\x00 \x00 \x00 \x00 \x00"\x00p\x00i\x00n\x00g\x00_\x00j\x00i\x00t\x00t\x00e\x00r\x00_\x00m\x00s\x00"\x00:\x00 \x000\x00.\x000\x003\x001\x00\n\x00 \x00 \x00}\x00\n\x00}\x00\n\x00'.startswith

/tests/test_final_state.py:19: AssertionError
=========================== short test summary info ============================
FAILED ../../tests/test_final_state.py::test_json_encoding_and_validity - Ass...
FAILED ../../tests/test_final_state.py::test_config_usage - AssertionError: J...
FAILED ../../tests/test_final_state.py::test_data_content - AssertionError: J...
FAILED ../../tests/test_final_state.py::test_text_report_consistency - Assert...
========================= 4 failed, 1 passed in 0.03s ==========================
