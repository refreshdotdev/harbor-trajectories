============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-9.0.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
rootdir: /tests
collecting ... collected 3 items

../../tests/test_final_state.py::test_required_files_exist PASSED        [ 33%]
../../tests/test_final_state.py::test_optimized_rules_content FAILED     [ 66%]
../../tests/test_final_state.py::test_audit_manifest_encoding_and_structure PASSED [100%]

=================================== FAILURES ===================================
_________________________ test_optimized_rules_content _________________________

    def test_optimized_rules_content():
        # Read binary to check for CRLF contamination
        content_bytes = OPTIMIZED_RULES.read_bytes()
        assert b"\r\n" not in content_bytes, "optimized_rules.v4 must use Unix LF line endings, not Windows CRLF."
    
        content = content_bytes.decode('utf-8')
        lines = [l.strip() for l in content.split('\n') if l.strip()]
    
        # Check Policies
        assert ":INPUT DROP" in content
        assert ":FORWARD DROP" in content
        assert ":OUTPUT ACCEPT" in content
    
        # Check Rule Ordering
        rules = [l for l in lines if l.startswith("-A")]
        assert "RELATED,ESTABLISHED" in rules[0], "The first rule must be the preserved state rule."
    
        # Check for trap IP (Zero width space)
>       assert "\u200b" not in content, "Configuration values were not sanitized; found zero-width space."
E       AssertionError: Configuration values were not sanitized; found zero-width space.
E       assert '\u200b' not in '*filter\n:I...DROP\nCOMMIT'
E         
E         '\u200b' is contained here:
E           *filter
E           :INPUT DROP [0:0]
E           :FORWARD DROP [0:0]
E           :OUTPUT ACCEPT [0:0]
E           # Sample base rules with Windows line endings...
E         
E         ...Full output truncated (24 lines hidden), use '-vv' to show

/tests/test_final_state.py:41: AssertionError
=========================== short test summary info ============================
FAILED ../../tests/test_final_state.py::test_optimized_rules_content - Assert...
========================= 1 failed, 2 passed in 0.02s ==========================
