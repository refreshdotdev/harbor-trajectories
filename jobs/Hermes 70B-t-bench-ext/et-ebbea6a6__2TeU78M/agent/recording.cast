{"version": 2, "width": 160, "height": 40, "timestamp": 1771008652, "env": {"SHELL": "/bin/bash", "TERM": "screen"}}
[0.006179, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[0.962331, "i", "clear\r"]
[0.962474, "o", "clear\r\n\u001b[?2004l\r"]
[0.963457, "o", "\u001b[H\u001b[J"]
[0.963634, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.275472, "i", "export POLICY_TLS=\"true\"\n"]
[52.275577, "o", "export POLICY_TLS=\"true\"\r\n"]
[52.2756, "o", "\u001b[?2004l\r"]
[52.275646, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.38773, "i", "export POLICY_LOG=\"INFO\"\n"]
[52.387946, "o", "export POLICY_LOG=\"INFO\"\r\n\u001b[?2004l\r"]
[52.388059, "o", "\u001b[?2004h"]
[52.388097, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.529756, "i", "mkdir -p /home/user/policy/configs\n"]
[52.529984, "o", "mkdir -p /home/user/policy/configs\r\n\u001b[?2004l\r"]
[52.531931, "o", "\u001b[?2004h"]
[52.531953, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.644208, "i", "mkdir -p /home/user/policy/reports\n"]
[52.644339, "o", "mkdir -p /home/user/policy/reports\r\n\u001b[?2004l\r"]
[52.645344, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.760413, "i", "mkdir -p /tmp/ini_remediation\n"]
[52.760548, "o", "mkdir -p /tmp/ini_remediation\r\n\u001b[?2004l\r"]
[52.761815, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[52.9174, "i", "cat > /tmp/ini_remediation/process_ini_file.sh << 'EOF'\n#!/bin/bash\n\n# Exit on any error\nset -e\n\n# Set environment variables if not already set\n: ${POLICY_TLS:=\"true\"}\n: ${POLICY_LOG:=\"INFO\"}\n\n# Define the absolute path to the current INI file\nfile_abspath=\"$1\"\n\n# Create backup file with correct permissions and ownership\nbackup_file=\"${file_abspath}.bak\"\nif [[ -f \"${file_abspath}\" ]]; then\n    cp -p -- \"${file_abspath}\" \"${backup_file}\"\n    chmod 0400 \"${backup_file}\"\nfi\n\n# Calculate SHA256 hash of the original file content\noriginal_hash=$(sha256sum \"${file_abspath}\" | awk '{print $1}')\n\n# Define the temporary file for processing\ntemp_file=\"${file_abspath}.tmp\"\n\n# Initialize remediation status\nstatus=\"NO_ACTION_REQUIRED\"\n\n# Define the awk script for INI file processing\nawk_script='\\\nBEGIN {\\\n    FS=\"=| \\\\[|\\\\]\"  # Custom field separator for INI format\n    OFS=\"=\"            # Output field separator\n    sec_security=0\n    sec_logging=0\n    sec_network=0\n    key_enforce_tls=0\n    key_level=0\n    key_trusted_hos"]
[52.917437, "i", "ts=0\n    enforce_tls_value=\"MISSING\"\n    level_value=\"MISSING\"\n    trusted_hosts_value=\"MISSING\"\n    original_enforce_tls=\"MISSING\"\n    original_level=\"MISSING\"\n    original_trusted_hosts=\"MISSING\"\n    new_enforce_tls=\"MISSING\"\n    new_level=\"MISSING\"\n    new_trusted_hosts=\"MISSING\"\n    remediated=0\n}\n\n# Process section headers\nsec_security == 1 || $0 ~ /^\\[security\\]/ { sec_security=!sec_security; next }\nsec_logging == 1 || $0 ~ /^\\[logging\\]/ { sec_logging=!sec_logging; next }\nsec_network == 1 || $0 ~ /^\\[network\\]/ { sec_network=!sec_network; next }\n\n# In security section, handle enforce_tls key\nsec_security && $1 ~ /^enforce_tls$/i {\n    key_enforce_tls=1\n    original_enforce_tls=$2\n    # Convert to lowercase for case-insensitive comparison\n    original_enforce_tls_lower=tolower($2)\n    # Use POLICY_TLS environment variable, default to \"true\"\n    new_enforce_tls=(original_enforce_tls_lower != ENVIRON[\"POLICY_TLS\"]) ? ENVIRON[\"POLICY_TLS\"] : original_enforce_tls\n    if (original_enforce_tls != new_enforce_"]
[52.917527, "i", "tls) {\n        remediated=1\n    }\n    $2=new_enforce_tls\n    key_enforce_tls=0\n    next\n}\n\n# In logging section, handle level key\nsec_logging && $1 ~ /^level$/i {\n    key_level=1\n    original_level=$2\n    original_level_lower=tolower($2)\n    new_level_lower=tolower(ENVIRON[\"POLICY_LOG\"])\n    # Define allowed levels (more restrictive levels are acceptable)\n    allowed_levels= \"WARN|ERROR|FATAL|\" new_level_lower\n    if (!match(allowed_levels, new_level_lower)) {\n        new_level=ENVIRON[\"POLICY_LOG\"]\n    } else {\n        new_level=$2\n    }\n    if (original_level != new_level) {\n        remediated=1\n    }\n    $2=new_level\n    key_level=0\n    next\n}\n\n# In network section, handle trusted_hosts key\nsec_network && $1 ~ /^trusted_hosts$/i {\n    key_trusted_hosts=1\n    original_trusted_hosts=$2\n    # Split comma-separated list and filter non-compliant hostnames\n    if (original_trusted_hosts != \"\") {\n        split(original_trusted_hosts, hosts, /, */)\n        new_trusted_hosts=\"\"\n        for (i in hosts) {\n          "]
[52.917554, "i", "  host=hosts[i]\n            gsub(/^\\s+|\\s+$/, \"\", host)  # Trim whitespace\n            if (host ~ /\\.corp\\.local$/ && host != \"\") {\n                if (new_trusted_hosts != \"\") {\n                    new_trusted_hosts = new_trusted_hosts \", \" host\n                } else {\n                    new_trusted_hosts = host\n                }\n            }\n        }\n        if (original_trusted_hosts != new_trusted_hosts) {\n            remediated=1\n        }\n    } else {\n        new_trusted_hosts=\"\"\n    }\n    $2=new_trusted_hosts\n    key_trusted_hosts=0\n    next\n}\n\n# Save original values for logging purposes\n{\\\n    if (sec_security && $1 ~ /^enforce_tls$/i) original_enforce_tls=$2\n    if (sec_logging && $1 ~ /^level$/i) original_level=$2\n    if (sec_network && $1 ~ /^trusted_hosts$/i) original_trusted_hosts=$2\n}\n\n# Save new values (for when keys are missing and need to be added)\nEND {\n    # If enforce_tls is missing in security section, add it\n    if (original_enforce_tls == \"MISSING\" && sec_security) {\n        print \""]
[52.917576, "i", "[security]\"\n        print \"enforce_tls=\" ENVIRON[\"POLICY_TLS\"]\n        remediated=1\n    }\n    if (original_level == \"MISSING\" && sec_logging) {\n        print \"[logging]\"\n        print \"level=\" ENVIRON[\"POLICY_LOG\"]\n        remediated=1\n    }\n    # Do not add network section or trusted_hosts key if missing\n}\n\n# Print the modified line\n{ print }'\n\n# Process the INI file using awk\nawk -v POLICY_TLS=\"$POLICY_TLS\" -v POLICY_LOG=\"$POLICY_LOG\" \\\n    -v ENFORCE_TLS=\"$POLICY_TLS\" -v LOG_LEVEL=\"$POLICY_LOG\" \\\n    \"${awk_script}\" \"${file_abspath}\" > \"${temp_file}\"\n\n# If remediation occurred, replace the original file with the temp file\nif [ $remediated -eq 1 ]; then\n    mv -f \"${temp_file}\" \"${file_abspath}\"\n    status=\"REMEDIATED\"\nelse\n    rm -f \"${temp_file}\"\n    # Remove backup file if no remediation occurred\n    rm -f \"${backup_file}\"\nfi\n\n# Log the remediation result to a temporary log file\nlog_file=\"/tmp/ini_remediation/$(basename \"${file_abspath}\")_log.txt\"\necho \"FILE: ${file_abspath}\" > \"${log_file}\"\necho \"ORIGIN"]
[52.917595, "i", "AL_HASH: ${original_hash}\" >> \"${log_file}\"\necho \"SECURITY_ENFORCED: was=${original_enforce_tls} -> ${new_enforce_tls}\" >> \"${log_file}\"\necho \"LOG_LEVEL:          was=${original_level} -> ${new_level}\" >> \"${log_file}\"\necho \"NETWORK_HOSTS:      was=${original_trusted_hosts} -> ${new_trusted_hosts}\" >> \"${log_file}\"\necho \"STATUS: ${status}\" >> \"${log_file}\"\necho \"----\" >> \"${log_file}\"\nEOF\n"]
[52.91762, "o", "cat > /tmp/ini_remediation/process_ini_file.sh << 'EOF'\r\n\u001b[?2004l\r"]
[52.917667, "o", "\u001b[?2004h"]
[52.917685, "o", "> "]
[52.917723, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[52.917741, "o", "\u001b[?2004h> \r\n"]
[52.917757, "o", "\u001b[?2004l\r\u001b[?2004h"]
[52.917773, "o", "> "]
[52.917844, "o", "# Exit on any error\r\n\u001b[?2004l\r"]
[52.917861, "o", "\u001b[?2004h> "]
[52.91789, "o", "set -e\r\n\u001b[?2004l\r"]
[52.917909, "o", "\u001b[?2004h> "]
[52.917929, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[52.917947, "o", "> "]
[52.918119, "o", "# Set environment variables if not already set\r\n\u001b[?2004l\r"]
[52.918163, "o", "\u001b[?2004h> "]
[52.918224, "o", ": ${POLICY_TLS:=\"true\"}\r\n\u001b[?2004l\r"]
[52.918244, "o", "\u001b[?2004h> "]
[52.918335, "o", ": ${POLICY_LOG:=\"INFO\"}\r\n\u001b[?2004l\r"]
[52.918351, "o", "\u001b[?2004h> "]
[52.918372, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[52.918391, "o", "> "]
[52.918573, "o", "# Define the absolute path to the current INI file\r\n\u001b[?2004l\r"]
[52.918593, "o", "\u001b[?2004h> "]
[52.91865, "o", "file_abspath=\"$1\"\r\n\u001b[?2004l\r"]
[52.91867, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.918692, "o", "\u001b[?2004h> "]
[52.918889, "o", "# Create backup file with correct permissions and ownership\r\n\u001b[?2004l\r"]
[52.918909, "o", "\u001b[?2004h"]
[52.918925, "o", "> "]
[52.919044, "o", "backup_file=\"${file_abspath}.bak\"\r\n\u001b[?2004l\r"]
[52.91906, "o", "\u001b[?2004h> "]
[52.919182, "o", "if [[ -f \"${file_abspath}\" ]]; then\r\n\u001b[?2004l\r"]
[52.919202, "o", "\u001b[?2004h> "]
[52.919384, "o", "    cp -p -- \"${file_abspath}\" \"${backup_file}\"\r\n\u001b[?2004l\r"]
[52.919401, "o", "\u001b[?2004h> "]
[52.919525, "o", "    chmod 0400 \"${backup_file}\"\r\n\u001b[?2004l\r"]
[52.919545, "o", "\u001b[?2004h"]
[52.919562, "o", "> fi\r\n"]
[52.919582, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[52.919599, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[52.919614, "o", "> "]
[52.919772, "o", "# Calculate SHA256 hash of the original file content\r\n\u001b[?2004l\r"]
[52.919794, "o", "\u001b[?2004h> "]
[52.92003, "o", "original_hash=$(sha256sum \"${file_abspath}\" | awk '{print $1}')\r\n\u001b[?2004l\r"]
[52.920047, "o", "\u001b[?2004h> "]
[52.920063, "o", "\r\n\u001b[?2004l\r\u001b[?2004h"]
[52.920078, "o", "> "]
[52.920245, "o", "# Define the temporary file for processing\r\n\u001b[?2004l\r"]
[52.920263, "o", "\u001b[?2004h> "]
[52.920364, "o", "temp_file=\"${file_abspath}.tmp\"\r\n\u001b[?2004l\r"]
[52.92039, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.920407, "o", "\u001b[?2004h> "]
[52.920532, "o", "# Initialize remediation status\r\n\u001b[?2004l\r"]
[52.92055, "o", "\u001b[?2004h"]
[52.920565, "o", "> "]
[52.920666, "o", "status=\"NO_ACTION_REQUIRED\"\r\n\u001b[?2004l\r"]
[52.920681, "o", "\u001b[?2004h> "]
[52.920698, "o", "\r\n\u001b[?2004l\r"]
[52.920715, "o", "\u001b[?2004h> "]
[52.920872, "o", "# Define the awk script for INI file processing\r\n\u001b[?2004l\r"]
[52.92089, "o", "\u001b[?2004h"]
[52.920909, "o", "> "]
[52.920954, "o", "awk_script='\\\r\n\u001b[?2004l\r"]
[52.92097, "o", "\u001b[?2004h> "]
[52.92101, "o", "BEGIN {\\\r\n\u001b[?2004l\r"]
[52.921027, "o", "\u001b[?2004h> "]
[52.921221, "o", "    FS=\"=| \\\\[|\\\\]\"  # Custom field separator for INI format\r\n\u001b[?2004l\r"]
[52.921237, "o", "\u001b[?2004h> "]
[52.921424, "o", "    OFS=\"=\"            # Output field separator\r\n\u001b[?2004l\r"]
[52.921443, "o", "\u001b[?2004h"]
[52.921459, "o", "> "]
[52.921519, "o", "    sec_security=0\r\n\u001b[?2004l\r"]
[52.921537, "o", "\u001b[?2004h> "]
[52.92161, "o", "    sec_logging=0\r\n\u001b[?2004l\r"]
[52.921629, "o", "\u001b[?2004h"]
[52.921649, "o", "> "]
[52.921709, "o", "    sec_network=0\r\n\u001b[?2004l\r"]
[52.921726, "o", "\u001b[?2004h> "]
[52.921815, "o", "    key_enforce_tls=0\r\n\u001b[?2004l\r"]
[52.921833, "o", "\u001b[?2004h> "]
[52.921899, "o", "    key_level=0\r\n\u001b[?2004l\r"]
[52.921917, "o", "\u001b[?2004h> "]
[52.921996, "o", "    key_trusted_hosts=0\r\n\u001b[?2004l\r"]
[52.922021, "o", "\u001b[?2004h> "]
[52.922193, "o", "    enforce_tls_value=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922212, "o", "\u001b[?2004h"]
[52.922228, "o", "> "]
[52.922316, "o", "    level_value=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922333, "o", "\u001b[?2004h> "]
[52.922439, "o", "    trusted_hosts_value=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922455, "o", "\u001b[?2004h> "]
[52.922593, "o", "    original_enforce_tls=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922609, "o", "\u001b[?2004h> "]
[52.922725, "o", "    original_level=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922737, "o", "\u001b[?2004h"]
[52.922751, "o", "> "]
[52.922884, "o", "    original_trusted_hosts=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.922899, "o", "\u001b[?2004h> "]
[52.922997, "o", "    new_enforce_tls=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.923013, "o", "\u001b[?2004h> "]
[52.923117, "o", "    new_level=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.923136, "o", "\u001b[?2004h> "]
[52.923258, "o", "    new_trusted_hosts=\"MISSING\"\r\n\u001b[?2004l\r"]
[52.923275, "o", "\u001b[?2004h> "]
[52.923347, "o", "    remediated=0\r\n\u001b[?2004l\r"]
[52.923364, "o", "\u001b[?2004h> "]
[52.923383, "o", "}\r\n\u001b[?2004l\r"]
[52.923399, "o", "\u001b[?2004h> \r\n"]
[52.923414, "o", "\u001b[?2004l\r\u001b[?2004h"]
[52.923429, "o", "> "]
[52.923528, "o", "# Process section headers\r\n\u001b[?2004l\r"]
[52.923544, "o", "\u001b[?2004h> "]
[52.923823, "o", "sec_security == 1 || $0 ~ /^\\[security\\]/ { sec_security=!sec_security; next }\r\n\u001b[?2004l\r"]
[52.923848, "o", "\u001b[?2004h> "]
[52.92402, "o", "sec_logging == 1 || $0 ~ /^\\[logging\\]/ { sec_logging=!sec_logging; next }\r\n\u001b[?2004l\r"]
[52.924038, "o", "\u001b[?2004h> "]
[52.92423, "o", "sec_network == 1 || $0 ~ /^\\[network\\]/ { sec_network=!sec_network; next }\r\n\u001b[?2004l\r"]
[52.924246, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.924268, "o", "\u001b[?2004h> "]
[52.924381, "o", "# In security section, handle enforce_tls key\r\n\u001b[?2004l\r"]
[52.924396, "o", "\u001b[?2004h"]
[52.924414, "o", "> "]
[52.924504, "o", "sec_security && $1 ~ /^enforce_tls$/i {\r\n\u001b[?2004l\r"]
[52.924519, "o", "\u001b[?2004h> "]
[52.924582, "o", "    key_enforce_tls=1\r\n\u001b[?2004l\r"]
[52.924602, "o", "\u001b[?2004h> "]
[52.92467, "o", "    original_enforce_tls=$2\r\n\u001b[?2004l\r"]
[52.924685, "o", "\u001b[?2004h> "]
[52.92483, "o", "    # Convert to lowercase for case-insensitive comparison\r\n\u001b[?2004l\r"]
[52.924845, "o", "\u001b[?2004h"]
[52.92486, "o", "> "]
[52.924956, "o", "    original_enforce_tls_lower=tolower($2)\r\n\u001b[?2004l\r"]
[52.924968, "o", "\u001b[?2004h"]
[52.924982, "o", "> "]
[52.925132, "o", "    # Use POLICY_TLS environment variable, default to \"true\"\r\n\u001b[?2004l\r"]
[52.925147, "o", "\u001b[?2004h> "]
[52.925437, "o", "    new_enforce_tls=(original_enforce_tls_lower != ENVIRON[\"POLICY_TLS\"]) ? ENVIRON[\"POLICY_TLS\"] : original_enforce_tls\r\n\u001b[?2004l\r"]
[52.925454, "o", "\u001b[?2004h> "]
[52.92558, "o", "    if (original_enforce_tls != new_enforce_tls) {\r\n\u001b[?2004l\r"]
[52.925596, "o", "\u001b[?2004h"]
[52.92561, "o", "> "]
[52.925657, "o", "        remediated=1\r\n\u001b[?2004l\r"]
[52.925672, "o", "\u001b[?2004h> "]
[52.925695, "o", "    }\r\n\u001b[?2004l\r"]
[52.925708, "o", "\u001b[?2004h"]
[52.925724, "o", "> "]
[52.925776, "o", "    $2=new_enforce_tls\r\n\u001b[?2004l\r"]
[52.925794, "o", "\u001b[?2004h> "]
[52.925852, "o", "    key_enforce_tls=0\r\n\u001b[?2004l\r"]
[52.925868, "o", "\u001b[?2004h"]
[52.925884, "o", "> "]
[52.9259, "o", "    next\r\n\u001b[?2004l\r"]
[52.92592, "o", "\u001b[?2004h> "]
[52.925936, "o", "}\r\n\u001b[?2004l\r"]
[52.925951, "o", "\u001b[?2004h> "]
[52.925967, "o", "\r\n\u001b[?2004l\r"]
[52.925982, "o", "\u001b[?2004h> "]
[52.926075, "o", "# In logging section, handle level key\r\n\u001b[?2004l\r"]
[52.926094, "o", "\u001b[?2004h"]
[52.926109, "o", "> "]
[52.926184, "o", "sec_logging && $1 ~ /^level$/i {\r\n\u001b[?2004l\r"]
[52.926201, "o", "\u001b[?2004h> "]
[52.926246, "o", "    key_level=1\r\n\u001b[?2004l\r"]
[52.926262, "o", "\u001b[?2004h"]
[52.926276, "o", "> "]
[52.926325, "o", "    original_level=$2\r\n\u001b[?2004l\r"]
[52.926341, "o", "\u001b[?2004h> "]
[52.926436, "o", "    original_level_lower=tolower($2)\r\n\u001b[?2004l\r"]
[52.92645, "o", "\u001b[?2004h> "]
[52.926577, "o", "    new_level_lower=tolower(ENVIRON[\"POLICY_LOG\"])\r\n\u001b[?2004l\r"]
[52.926592, "o", "\u001b[?2004h> "]
[52.926761, "o", "    # Define allowed levels (more restrictive levels are acceptable)\r\n\u001b[?2004l\r"]
[52.926775, "o", "\u001b[?2004h> "]
[52.926913, "o", "    allowed_levels= \"WARN|ERROR|FATAL|\" new_level_lower\r\n\u001b[?2004l\r"]
[52.926927, "o", "\u001b[?2004h> "]
[52.927054, "o", "    if (!match(allowed_levels, new_level_lower)) {\r\n\u001b[?2004l\r"]
[52.92707, "o", "\u001b[?2004h> "]
[52.927178, "o", "        new_level=ENVIRON[\"POLICY_LOG\"]\r\n\u001b[?2004l\r"]
[52.927192, "o", "\u001b[?2004h> "]
[52.927231, "o", "    } else {\r\n\u001b[?2004l\r"]
[52.927245, "o", "\u001b[?2004h> "]
[52.927302, "o", "        new_level=$2\r\n\u001b[?2004l\r"]
[52.927316, "o", "\u001b[?2004h> "]
[52.927339, "o", "    }\r\n\u001b[?2004l\r"]
[52.927354, "o", "\u001b[?2004h> "]
[52.927453, "o", "    if (original_level != new_level) {\r\n\u001b[?2004l\r"]
[52.927467, "o", "\u001b[?2004h> "]
[52.927524, "o", "        remediated=1\r\n\u001b[?2004l\r"]
[52.92754, "o", "\u001b[?2004h> "]
[52.927564, "o", "    }\r\n\u001b[?2004l\r"]
[52.927578, "o", "\u001b[?2004h> "]
[52.927632, "o", "    $2=new_level\r\n\u001b[?2004l\r"]
[52.927647, "o", "\u001b[?2004h"]
[52.927662, "o", "> "]
[52.927694, "o", "    key_level=0\r\n\u001b[?2004l\r"]
[52.927708, "o", "\u001b[?2004h> "]
[52.927738, "o", "    next\r\n\u001b[?2004l\r"]
[52.927752, "o", "\u001b[?2004h> "]
[52.927768, "o", "}\r\n\u001b[?2004l\r"]
[52.927783, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.927804, "o", "\u001b[?2004h> "]
[52.927922, "o", "# In network section, handle trusted_hosts key\r\n\u001b[?2004l\r"]
[52.927936, "o", "\u001b[?2004h> "]
[52.92804, "o", "sec_network && $1 ~ /^trusted_hosts$/i {\r\n\u001b[?2004l\r"]
[52.928054, "o", "\u001b[?2004h> "]
[52.928127, "o", "    key_trusted_hosts=1\r\n\u001b[?2004l\r"]
[52.928142, "o", "\u001b[?2004h> "]
[52.928219, "o", "    original_trusted_hosts=$2\r\n\u001b[?2004l\r"]
[52.928234, "o", "\u001b[?2004h> "]
[52.928401, "o", "    # Split comma-separated list and filter non-compliant hostnames\r\n\u001b[?2004l\r"]
[52.928416, "o", "\u001b[?2004h> "]
[52.928519, "o", "    if (original_trusted_hosts != \"\") {\r\n\u001b[?2004l\r"]
[52.928533, "o", "\u001b[?2004h> "]
[52.928662, "o", "        split(original_trusted_hosts, hosts, /, */)\r\n\u001b[?2004l\r"]
[52.928677, "o", "\u001b[?2004h> "]
[52.928753, "o", "        new_trusted_hosts=\"\"\r\n\u001b[?2004l\r"]
[52.928769, "o", "\u001b[?2004h> "]
[52.928839, "o", "        for (i in hosts) {\r\n\u001b[?2004l\r"]
[52.928854, "o", "\u001b[?2004h> "]
[52.928924, "o", "            host=hosts[i]\r\n\u001b[?2004l\r"]
[52.928938, "o", "\u001b[?2004h> "]
[52.929089, "o", "            gsub(/^\\s+|\\s+$/, \"\", host)  # Trim whitespace\r\n\u001b[?2004l\r"]
[52.929105, "o", "\u001b[?2004h> "]
[52.929246, "o", "            if (host ~ /\\.corp\\.local$/ && host != \"\") {\r\n\u001b[?2004l\r"]
[52.929263, "o", "\u001b[?2004h> "]
[52.929381, "o", "                if (new_trusted_hosts != \"\") {\r\n\u001b[?2004l\r"]
[52.929395, "o", "\u001b[?2004h> "]
[52.929562, "o", "                    new_trusted_hosts = new_trusted_hosts \", \" host\r\n\u001b[?2004l\r"]
[52.929577, "o", "\u001b[?2004h> "]
[52.929645, "o", "                } else {\r\n\u001b[?2004l\r"]
[52.929659, "o", "\u001b[?2004h> "]
[52.929774, "o", "                    new_trusted_hosts = host\r\n\u001b[?2004l\r"]
[52.92979, "o", "\u001b[?2004h> "]
[52.929845, "o", "                }\r\n\u001b[?2004l\r"]
[52.92986, "o", "\u001b[?2004h> "]
[52.929898, "o", "            }\r\n\u001b[?2004l\r"]
[52.929913, "o", "\u001b[?2004h> "]
[52.929945, "o", "        }\r\n\u001b[?2004l\r"]
[52.929965, "o", "\u001b[?2004h> "]
[52.930117, "o", "        if (original_trusted_hosts != new_trusted_hosts) {\r\n\u001b[?2004l\r"]
[52.930137, "o", "\u001b[?2004h"]
[52.930155, "o", "> "]
[52.930211, "o", "            remediated=1\r\n\u001b[?2004l\r"]
[52.930225, "o", "\u001b[?2004h> "]
[52.930258, "o", "        }\r\n\u001b[?2004l\r"]
[52.930273, "o", "\u001b[?2004h> "]
[52.930312, "o", "    } else {\r\n\u001b[?2004l\r"]
[52.930326, "o", "\u001b[?2004h> "]
[52.930404, "o", "        new_trusted_hosts=\"\"\r\n\u001b[?2004l\r"]
[52.930421, "o", "\u001b[?2004h> "]
[52.930442, "o", "    }\r\n\u001b[?2004l\r"]
[52.930456, "o", "\u001b[?2004h> "]
[52.930524, "o", "    $2=new_trusted_hosts\r\n\u001b[?2004l\r"]
[52.930538, "o", "\u001b[?2004h> "]
[52.930604, "o", "    key_trusted_hosts=0\r\n\u001b[?2004l\r"]
[52.930619, "o", "\u001b[?2004h> "]
[52.93065, "o", "    next\r\n\u001b[?2004l\r"]
[52.930664, "o", "\u001b[?2004h> "]
[52.930679, "o", "}\r\n\u001b[?2004l\r"]
[52.930695, "o", "\u001b[?2004h> \r\n"]
[52.930711, "o", "\u001b[?2004l\r\u001b[?2004h"]
[52.930724, "o", "> "]
[52.930829, "o", "# Save original values for logging purposes\r\n\u001b[?2004l\r"]
[52.930844, "o", "\u001b[?2004h> "]
[52.930863, "o", "{\\\r\n\u001b[?2004l\r"]
[52.930878, "o", "\u001b[?2004h> "]
[52.931049, "o", "    if (sec_security && $1 ~ /^enforce_tls$/i) original_enforce_tls=$2\r\n\u001b[?2004l\r"]
[52.931065, "o", "\u001b[?2004h> "]
[52.931218, "o", "    if (sec_logging && $1 ~ /^level$/i) original_level=$2\r\n\u001b[?2004l\r"]
[52.931234, "o", "\u001b[?2004h> "]
[52.93141, "o", "    if (sec_network && $1 ~ /^trusted_hosts$/i) original_trusted_hosts=$2\r\n\u001b[?2004l\r"]
[52.931424, "o", "\u001b[?2004h> "]
[52.931439, "o", "}\r\n\u001b[?2004l\r"]
[52.931454, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.931476, "o", "\u001b[?2004h> "]
[52.93164, "o", "# Save new values (for when keys are missing and need to be added)\r\n\u001b[?2004l\r"]
[52.931654, "o", "\u001b[?2004h> "]
[52.931678, "o", "END {\r\n\u001b[?2004l\r"]
[52.931697, "o", "\u001b[?2004h> "]
[52.931845, "o", "    # If enforce_tls is missing in security section, add it\r\n\u001b[?2004l\r"]
[52.931861, "o", "\u001b[?2004h> "]
[52.932011, "o", "    if (original_enforce_tls == \"MISSING\" && sec_security) {\r\n\u001b[?2004l\r"]
[52.932025, "o", "\u001b[?2004h> "]
[52.932108, "o", "        print \"[security]\"\r\n\u001b[?2004l\r"]
[52.932125, "o", "\u001b[?2004h> "]
[52.932245, "o", "        print \"enforce_tls=\" ENVIRON[\"POLICY_TLS\"]\r\n\u001b[?2004l\r"]
[52.93226, "o", "\u001b[?2004h> "]
[52.932328, "o", "        remediated=1\r\n\u001b[?2004l\r\u001b[?2004h"]
[52.932343, "o", "> "]
[52.93236, "o", "    }\r\n\u001b[?2004l\r"]
[52.932375, "o", "\u001b[?2004h> "]
[52.932505, "o", "    if (original_level == \"MISSING\" && sec_logging) {\r\n\u001b[?2004l\r"]
[52.932521, "o", "\u001b[?2004h> "]
[52.932589, "o", "        print \"[logging]\"\r\n\u001b[?2004l\r"]
[52.932607, "o", "\u001b[?2004h> "]
[52.932719, "o", "        print \"level=\" ENVIRON[\"POLICY_LOG\"]\r\n\u001b[?2004l\r"]
[52.932733, "o", "\u001b[?2004h> "]
[52.932791, "o", "        remediated=1\r\n\u001b[?2004l\r"]
[52.932805, "o", "\u001b[?2004h> "]
[52.932828, "o", "    }\r\n\u001b[?2004l\r"]
[52.932845, "o", "\u001b[?2004h> "]
[52.933001, "o", "    # Do not add network section or trusted_hosts key if missing\r\n\u001b[?2004l\r"]
[52.933016, "o", "\u001b[?2004h> "]
[52.93303, "o", "}\r\n\u001b[?2004l\r"]
[52.933044, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[52.933067, "o", "\u001b[?2004h"]
[52.93308, "o", "> "]
[52.933146, "o", "# Print the modified line\r\n\u001b[?2004l\r"]
[52.933165, "o", "\u001b[?2004h> "]
[52.933197, "o", "{ print }'\r\n\u001b[?2004l\r"]
[52.933215, "o", "\u001b[?2004h> \r\n"]
[52.93323, "o", "\u001b[?2004l\r"]
[52.933244, "o", "\u001b[?2004h> "]
[52.933325, "o", "# Process the INI file using awk\r\n\u001b[?2004l\r"]
[52.933347, "o", "\u001b[?2004h> "]
[52.933498, "o", "awk -v POLICY_TLS=\"$POLICY_TLS\" -v POLICY_LOG=\"$POLICY_LOG\" \\\r\n\u001b[?2004l\r"]
[52.933519, "o", "\u001b[?2004h> "]
[52.933662, "o", "    -v ENFORCE_TLS=\"$POLICY_TLS\" -v LOG_LEVEL=\"$POLICY_LOG\" \\\r\n\u001b[?2004l\r"]
[52.933679, "o", "\u001b[?2004h> "]
[52.93381, "o", "    \"${awk_script}\" \"${file_abspath}\" > \"${temp_file}\"\r\n\u001b[?2004l\r"]
[52.933826, "o", "\u001b[?2004h> \r\n"]
[52.93384, "o", "\u001b[?2004l\r"]
[52.933854, "o", "\u001b[?2004h> "]
[52.934027, "o", "# If remediation occurred, replace the original file with the temp file\r\n\u001b[?2004l\r"]
[52.934043, "o", "\u001b[?2004h> "]
[52.934129, "o", "if [ $remediated -eq 1 ]; then\r\n\u001b[?2004l\r"]
[52.934144, "o", "\u001b[?2004h> "]
[52.934253, "o", "    mv -f \"${temp_file}\" \"${file_abspath}\"\r\n\u001b[?2004l\r"]
[52.934268, "o", "\u001b[?2004h> "]
[52.934332, "o", "    status=\"REMEDIATED\"\r\n\u001b[?2004l\r"]
[52.934348, "o", "\u001b[?2004h> "]
[52.934369, "o", "else\r\n\u001b[?2004l\r"]
[52.934384, "o", "\u001b[?2004h> "]
[52.93445, "o", "    rm -f \"${temp_file}\"\r\n\u001b[?2004l\r"]
[52.934465, "o", "\u001b[?2004h> "]
[52.934593, "o", "    # Remove backup file if no remediation occurred\r\n\u001b[?2004l\r"]
[52.934608, "o", "\u001b[?2004h> "]
[52.93468, "o", "    rm -f \"${backup_file}\"\r\n\u001b[?2004l\r"]
[52.934695, "o", "\u001b[?2004h> "]
[52.934711, "o", "fi\r\n\u001b[?2004l\r"]
[52.934725, "o", "\u001b[?2004h> \r\n"]
[52.934738, "o", "\u001b[?2004l\r"]
[52.934752, "o", "\u001b[?2004h> "]
[52.934881, "o", "# Log the remediation result to a temporary log file\r\n\u001b[?2004l\r"]
[52.934897, "o", "\u001b[?2004h> "]
[52.935068, "o", "log_file=\"/tmp/ini_remediation/$(basename \"${file_abspath}\")_log.txt\"\r\n\u001b[?2004l\r"]
[52.935095, "o", "\u001b[?2004h> "]
[52.935205, "o", "echo \"FILE: ${file_abspath}\" > \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.935222, "o", "\u001b[?2004h> "]
[52.935361, "o", "echo \"ORIGINAL_HASH: ${original_hash}\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.935375, "o", "\u001b[?2004h> "]
[52.935602, "o", "echo \"SECURITY_ENFORCED: was=${original_enforce_tls} -> ${new_enforce_tls}\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.935617, "o", "\u001b[?2004h> "]
[52.935817, "o", "echo \"LOG_LEVEL:          was=${original_level} -> ${new_level}\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.935833, "o", "\u001b[?2004h> "]
[52.936072, "o", "echo \"NETWORK_HOSTS:      was=${original_trusted_hosts} -> ${new_trusted_hosts}\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.936096, "o", "\u001b[?2004h> "]
[52.936204, "o", "echo \"STATUS: ${status}\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.936221, "o", "\u001b[?2004h"]
[52.936236, "o", "> "]
[52.936303, "o", "echo \"----\" >> \"${log_file}\"\r\n\u001b[?2004l\r"]
[52.936318, "o", "\u001b[?2004h> "]
[52.936337, "o", "EOF\r\n\u001b[?2004l\r"]
[52.938058, "o", "\u001b[?2004h"]
[52.938076, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[53.900473, "i", "chmod +x /tmp/ini_remediation/process_ini_file.sh\n"]
[53.900657, "o", "chmod +x /tmp/ini_remediation/process_ini_file.sh\r\n\u001b[?2004l\r"]
[53.901648, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[54.101598, "i", "cat > /tmp/ini_remediation/run_scan.sh << 'EOF'\n#!/bin/bash\n\n# Set environment variables\nexport POLICY_TLS=\"${POLICY_TLS:-true}\"\nexport POLICY_LOG=\"${POLICY_LOG:-INFO}\"\n\n# Create a temporary directory for parallel processing\nwork_dir=\"/tmp/ini_remediation\"\nmkdir -p \"${work_dir}\"\n\n# Find all INI files under /home/user/policy/configs\nfind /home/user/policy/configs -type f -name '*.ini' > \"${work_dir}/files.txt\"\n\n# Check if any INI files were found\nif [ ! -s \"${work_dir}/files.txt\" ]; then\n    echo \"No INI files found under /home/user/policy/configs.\" >&2\n    exit 1\nfi\n\n# Process files concurrently using GNU Parallel\ncat \"${work_dir}/files.txt\" | parallel -j +0 --no-notice \\\n    \"${work_dir}/process_ini_file.sh {}\"\n\n# Collect all individual log files\nlog_files=($(ls -1 \"${work_dir}\"/*.txt 2>/dev/null))\n\n# Create the final log file path\nfinal_log=\"/home/user/policy/reports/after_remediation.log\"\n\n# Write header to the final log file\necho \"\" > \"${final_log}\"\n\n# Concatenate log files in alphabetical order\ncat \"${wo"]
[54.101696, "i", "rk_dir}\"/*.txt | sort >> \"${final_log}\"\n\n# Calculate summary statistics\nfiles_scanned=$(wc -l < \"${work_dir}/files.txt\")\nremediated=0\ncompliant=0\nfor log in \"${log_files[@]}\"; do\n    if grep -q \"STATUS: REMEDIATED\" \"${log}\"; then\n        ((remediated++))\n    else\n        ((compliant++))\n    fi\ndone\n\n# Append summary to the final log file\necho \"Summary:\" >> \"${final_log}\"\necho \"FILES_SCANNED=${files_scanned}\" >> \"${final_log}\"\necho \"REMEDIATED=${remediated}\" >> \"${final_log}\"\necho \"COMPLIANT=${compliant}\" >> \"${final_log}\"\n\n# Clean up temporary files\nrm -rf \"${work_dir}\"\nEOF\n"]
[54.101786, "o", "cat > /tmp/ini_remediation/run_scan.sh << 'EOF'\r\n\u001b[?2004l\r"]
[54.101829, "o", "\u001b[?2004h> "]
[54.10187, "o", "#!/bin/bash\r\n\u001b[?2004l\r"]
[54.10189, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[54.101914, "o", "\u001b[?2004h> "]
[54.102, "o", "# Set environment variables\r\n\u001b[?2004l\r"]
[54.102015, "o", "\u001b[?2004h> "]
[54.102147, "o", "export POLICY_TLS=\"${POLICY_TLS:-true}\"\r\n\u001b[?2004l\r"]
[54.102163, "o", "\u001b[?2004h> "]
[54.102279, "o", "export POLICY_LOG=\"${POLICY_LOG:-INFO}\"\r\n\u001b[?2004l\r"]
[54.102295, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[54.102319, "o", "\u001b[?2004h> "]
[54.102454, "o", "# Create a temporary directory for parallel processing\r\n\u001b[?2004l\r"]
[54.102476, "o", "\u001b[?2004h> "]
[54.102555, "o", "work_dir=\"/tmp/ini_remediation\"\r\n\u001b[?2004l\r"]
[54.102571, "o", "\u001b[?2004h> "]
[54.102633, "o", "mkdir -p \"${work_dir}\"\r\n\u001b[?2004l\r"]
[54.102647, "o", "\u001b[?2004h"]
[54.102669, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[54.102683, "o", "> "]
[54.102802, "o", "# Find all INI files under /home/user/policy/configs\r\n\u001b[?2004l\r"]
[54.102821, "o", "\u001b[?2004h> "]
[54.103013, "o", "find /home/user/policy/configs -type f -name '*.ini' > \"${work_dir}/files.txt\"\r\n\u001b[?2004l\r"]
[54.10303, "o", "\u001b[?2004h> \r\n"]
[54.103051, "o", "\u001b[?2004l\r\u001b[?2004h> "]
[54.103155, "o", "# Check if any INI files were found\r\n\u001b[?2004l\r"]
[54.103171, "o", "\u001b[?2004h> "]
[54.103274, "o", "if [ ! -s \"${work_dir}/files.txt\" ]; then\r\n\u001b[?2004l\r"]
[54.103288, "o", "\u001b[?2004h> "]
[54.103451, "o", "    echo \"No INI files found under /home/user/policy/configs.\" >&2\r\n\u001b[?2004l\r"]
[54.103471, "o", "\u001b[?2004h> "]
[54.103502, "o", "    exit 1\r\n\u001b[?2004l\r"]
[54.103521, "o", "\u001b[?2004h> "]
[54.103535, "o", "fi\r\n\u001b[?2004l\r"]
[54.103551, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[54.103572, "o", "\u001b[?2004h> "]
[54.103692, "o", "# Process files concurrently using GNU Parallel\r\n\u001b[?2004l\r"]
[54.103706, "o", "\u001b[?2004h> "]
[54.103852, "o", "cat \"${work_dir}/files.txt\" | parallel -j +0 --no-notice \\\r\n\u001b[?2004l\r"]
[54.103868, "o", "\u001b[?2004h"]
[54.103884, "o", "> "]
[54.103972, "o", "    \"${work_dir}/process_ini_file.sh {}\"\r\n\u001b[?2004l\r"]
[54.103988, "o", "\u001b[?2004h> "]
[54.104002, "o", "\r\n\u001b[?2004l\r"]
[54.104018, "o", "\u001b[?2004h> "]
[54.104109, "o", "# Collect all individual log files\r\n\u001b[?2004l\r"]
[54.104124, "o", "\u001b[?2004h> "]
[54.104259, "o", "log_files=($(ls -1 \"${work_dir}\"/*.txt 2>/dev/null))\r\n\u001b[?2004l\r"]
[54.104273, "o", "\u001b[?2004h> \r\n"]
[54.104288, "o", "\u001b[?2004l\r"]
[54.104304, "o", "\u001b[?2004h> "]
[54.104387, "o", "# Create the final log file path\r\n\u001b[?2004l\r"]
[54.104401, "o", "\u001b[?2004h> "]
[54.104546, "o", "final_log=\"/home/user/policy/reports/after_remediation.log\"\r\n\u001b[?2004l\r"]
[54.104563, "o", "\u001b[?2004h> \r\n"]
[54.104577, "o", "\u001b[?2004l\r"]
[54.104594, "o", "\u001b[?2004h> "]
[54.104685, "o", "# Write header to the final log file\r\n\u001b[?2004l\r"]
[54.1047, "o", "\u001b[?2004h> "]
[54.104768, "o", "echo \"\" > \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.104782, "o", "\u001b[?2004h> \r\n"]
[54.104795, "o", "\u001b[?2004l\r"]
[54.104811, "o", "\u001b[?2004h> "]
[54.104923, "o", "# Concatenate log files in alphabetical order\r\n\u001b[?2004l\r"]
[54.104939, "o", "\u001b[?2004h> "]
[54.105061, "o", "cat \"${work_dir}\"/*.txt | sort >> \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.105078, "o", "\u001b[?2004h> "]
[54.1051, "o", "\r\n\u001b[?2004l\r"]
[54.105116, "o", "\u001b[?2004h> "]
[54.105194, "o", "# Calculate summary statistics\r\n\u001b[?2004l\r"]
[54.105208, "o", "\u001b[?2004h> "]
[54.105332, "o", "files_scanned=$(wc -l < \"${work_dir}/files.txt\")\r\n\u001b[?2004l\r"]
[54.105346, "o", "\u001b[?2004h> "]
[54.105385, "o", "remediated=0\r\n\u001b[?2004l\r"]
[54.105399, "o", "\u001b[?2004h> "]
[54.105438, "o", "compliant=0\r\n\u001b[?2004l\r"]
[54.105452, "o", "\u001b[?2004h> "]
[54.105538, "o", "for log in \"${log_files[@]}\"; do\r\n\u001b[?2004l\r"]
[54.105551, "o", "\u001b[?2004h> "]
[54.10568, "o", "    if grep -q \"STATUS: REMEDIATED\" \"${log}\"; then\r\n\u001b[?2004l\r"]
[54.105697, "o", "\u001b[?2004h> "]
[54.105762, "o", "        ((remediated++))\r\n\u001b[?2004l\r"]
[54.105778, "o", "\u001b[?2004h> "]
[54.105811, "o", "    else\r\n\u001b[?2004l\r"]
[54.105829, "o", "\u001b[?2004h> "]
[54.105891, "o", "        ((compliant++))\r\n\u001b[?2004l\r"]
[54.105905, "o", "\u001b[?2004h> "]
[54.105932, "o", "    fi\r\n\u001b[?2004l\r"]
[54.105946, "o", "\u001b[?2004h> "]
[54.105968, "o", "done\r\n\u001b[?2004l\r"]
[54.105986, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r"]
[54.106004, "o", "\u001b[?2004h> "]
[54.106111, "o", "# Append summary to the final log file\r\n\u001b[?2004l\r"]
[54.106128, "o", "\u001b[?2004h> "]
[54.106213, "o", "echo \"Summary:\" >> \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.106227, "o", "\u001b[?2004h> "]
[54.106368, "o", "echo \"FILES_SCANNED=${files_scanned}\" >> \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.106382, "o", "\u001b[?2004h> "]
[54.10651, "o", "echo \"REMEDIATED=${remediated}\" >> \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.106528, "o", "\u001b[?2004h> "]
[54.106653, "o", "echo \"COMPLIANT=${compliant}\" >> \"${final_log}\"\r\n\u001b[?2004l\r"]
[54.106668, "o", "\u001b[?2004h"]
[54.106682, "o", "> \r\n\u001b[?2004l\r\u001b[?2004h"]
[54.106703, "o", "> "]
[54.106764, "o", "# Clean up temporary files\r\n\u001b[?2004l\r"]
[54.106778, "o", "\u001b[?2004h"]
[54.106792, "o", "> "]
[54.10684, "o", "rm -rf \"${work_dir}\"\r\n\u001b[?2004l\r"]
[54.106854, "o", "\u001b[?2004h> "]
[54.106874, "o", "EOF\r\n\u001b[?2004l\r"]
[54.108476, "o", "\u001b[?2004h"]
[54.108492, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[55.035495, "i", "chmod +x /tmp/ini_remediation/run_scan.sh\n"]
[55.035655, "o", "chmod +x /tmp/ini_remediation/run_scan.sh\r\n\u001b[?2004l\r"]
[55.036693, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[55.129841, "i", "/tmp/ini_remediation/run_scan.sh\n"]
[55.129962, "o", "/tmp/ini_remediation/run_scan.sh\r\n"]
[55.129986, "o", "\u001b[?2004l\r"]
[55.134251, "o", "/tmp/ini_remediation/run_scan.sh: line 21: parallel: command not found\r\n"]
[55.134619, "o", "cat: write error: Broken pipe\r\n"]
[55.14319, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[60.223097, "i", "cat /home/user/policy/reports/after_remediation.log\n"]
[60.223518, "o", "cat /home/user/policy/reports/after_remediation.log\r\n\u001b[?2004l\r"]
[60.224555, "o", "\r\n/home/user/policy/configs/app1.ini\r\n/home/user/policy/configs/app2.ini\r\n/home/user/policy/configs/app3.ini\r\nSummary:\r\nFILES_SCANNED=3\r\nREMEDIATED=0\r\nCOMPLIANT=1\r\n"]
[60.224731, "o", "\u001b[?2004hroot@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[109.518326, "i", "apt-get update && apt-get install -y parallel\n"]
[109.518698, "o", "apt-get update && apt-get install -y parallel\r\n\u001b[?2004l\r"]
[109.602146, "o", "\r0% [Working]"]
[109.755162, "o", "\r            \rHit:1 http://security.ubuntu.com/ubuntu jammy-security InRelease\r\n\r0% [Waiting for headers]"]
[109.814735, "o", "\r                        \rHit:2 http://archive.ubuntu.com/ubuntu jammy InRelease\r\n\r                        \r0% [Working]"]
[109.863521, "o", "\r0% [Waiting for headers]"]
[109.920816, "o", "\r                        \rHit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease\r\n\r                        \r0% [Working]"]
[109.977231, "o", "\r0% [Waiting for headers]"]
[110.024823, "o", "\r                        \rHit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease\r\n\r                        \r0% [Working]"]
[110.074672, "o", "\r0% [Working]"]
[110.155907, "o", "\r20% [Working]\r             \r"]
[110.160707, "o", "\rReading package lists... 0%\r"]
[110.227697, "o", "\rReading package lists... 0%\r"]
[110.234013, "o", "\rReading package lists... 0%\r"]
[110.252134, "o", "\rReading package lists... 3%\r\rReading package lists... 3%\r"]
[110.269977, "o", "\rReading package lists... 4%\r"]
[110.269993, "o", "\rReading package lists... 4%\r"]
[110.541408, "o", "\rReading package lists... 38%\r\rReading package lists... 38%\r"]
[110.549897, "o", "\rReading package lists... 39%\r"]
[110.549993, "o", "\rReading package lists... 39%\r"]
[110.624919, "o", "\rReading package lists... 49%\r\rReading package lists... 49%\r"]
[110.744446, "o", "\rReading package lists... 66%\r\rReading package lists... 66%\r"]
[110.774223, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[110.776057, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[110.777985, "o", "\rReading package lists... 70%\r"]
[110.778096, "o", "\rReading package lists... 70%\r"]
[110.782433, "o", "\rReading package lists... 70%\r"]
[110.782488, "o", "\rReading package lists... 70%\r"]
[110.812912, "o", "\rReading package lists... 79%\r\rReading package lists... 79%\r"]
[110.854759, "o", "\rReading package lists... 96%\r\rReading package lists... 96%\r"]
[110.863684, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[110.864186, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[110.869857, "o", "\rReading package lists... Done\r\r\n"]
[110.926064, "o", "\rReading package lists... 0%\r"]
[110.97142, "o", "\rReading package lists... 0%\r"]
[110.977593, "o", "\rReading package lists... 0%\r"]
[110.995761, "o", "\rReading package lists... 3%\r\rReading package lists... 3%\r"]
[111.014016, "o", "\rReading package lists... 4%\r\rReading package lists... 4%\r"]
[111.278798, "o", "\rReading package lists... 38%\r\rReading package lists... 38%\r"]
[111.287283, "o", "\rReading package lists... 39%\r"]
[111.287334, "o", "\rReading package lists... 39%\r"]
[111.367477, "o", "\rReading package lists... 49%\r"]
[111.367576, "o", "\rReading package lists... 49%\r"]
[111.469036, "o", "\rReading package lists... 66%\r\rReading package lists... 66%\r"]
[111.49908, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[111.501411, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[111.503244, "o", "\rReading package lists... 70%\r\rReading package lists... 70%\r"]
[111.507752, "o", "\rReading package lists... 70%\r"]
[111.507802, "o", "\rReading package lists... 70%\r"]
[111.535707, "o", "\rReading package lists... 79%\r"]
[111.535763, "o", "\rReading package lists... 79%\r"]
[111.578278, "o", "\rReading package lists... 96%\r\rReading package lists... 96%\r"]
[111.587536, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[111.58798, "o", "\rReading package lists... 99%\r\rReading package lists... 99%\r"]
[111.593505, "o", "\rReading package lists... Done\r\r\n"]
[111.610591, "o", "\rBuilding dependency tree... 0%\r\rBuilding dependency tree... 0%\r"]
[111.638397, "o", "\rBuilding dependency tree... 50%\r\rBuilding dependency tree... 50%\r"]
[111.701327, "o", "\rBuilding dependency tree... 67%\r"]
[111.771971, "o", "\rBuilding dependency tree... Done\r\r\n\rReading state information... 0% \r\rReading state information... 4%\r"]
[111.772124, "o", "\rReading state information... Done\r\r\n"]
[111.8842, "o", "The following additional packages will be installed:\r\n"]
[111.884382, "o", "  dbus dmsetup gir1.2-glib-2.0 libapparmor1 libargon2-1 libcryptsetup12 libdbus-1-3 libdevmapper1.02.1 libgdbm-compat4 libgdbm6 libgirepository-1.0-1\r\n"]
[111.88492, "o", "  libglib2.0-0 libglib2.0-data libicu70 libip4tc2 libjson-c5 libkmod2 libperl5.34 libsensors-config libsensors5 libxml2 netbase networkd-dispatcher perl\r\n"]
[111.885155, "o", "  perl-modules-5.34 python3-dbus python3-gi shared-mime-info sysstat systemd systemd-timesyncd ucf xdg-user-dirs xz-utils\r\n"]
[111.885771, "o", "Suggested packages:\r\n  default-dbus-session-bus | dbus-session-bus gdbm-l10n lm-sensors iw | wireless-tools ash csh fish ksh tcsh zsh perl-doc libterm-readline-gnu-perl\r\n  | libterm-readline-perl-perl make libtap-harness-archive-perl python-dbus-doc isag systemd-container libfido2-1 libtss2-esys-3.0.2-0 libtss2-mu0 libtss2-rc0\r\n  policykit-1\r\n"]
[111.964778, "o", "The following NEW packages will be installed:\r\n"]
[111.964941, "o", "  dbus dmsetup gir1.2-glib-2.0 libapparmor1 libargon2-1 libcryptsetup12 libdbus-1-3 libdevmapper1.02.1 libgdbm-compat4 libgdbm6 libgirepository-1.0-1\r\n"]
[111.965124, "o", "  libglib2.0-0 libglib2.0-data libicu70 libip4tc2 libjson-c5 libkmod2 libperl5.34 libsensors-config libsensors5 libxml2 netbase networkd-dispatcher parallel\r\n"]
[111.965182, "o", "  perl perl-modules-5.34 python3-dbus python3-gi shared-mime-info sysstat systemd systemd-timesyncd ucf xdg-user-dirs xz-utils\r\n"]
[111.96857, "o", "0 upgraded, 35 newly installed, 0 to remove and 4 not upgraded.\r\nNeed to get 30.1 MB of archives.\r\nAfter this operation, 121 MB of additional disk space will be used.\r\n"]
[111.982332, "o", "\r0% [Working]"]
[112.16987, "o", "\r            \rGet:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libapparmor1 amd64 3.0.4-2ubuntu2.5 [39.6 kB]\r\n\r0% [1 libapparmor1 6950 B/39.6 kB 18%]"]
[112.302027, "o", "\r                                      \r1% [Working]"]
[112.38819, "o", "\r            \rGet:2 http://archive.ubuntu.com/ubuntu jammy/main amd64 libargon2-1 amd64 0~20171227-0.3 [19.5 kB]\r\n\r1% [2 libargon2-1 2606 B/19.5 kB 13%]"]
[112.416498, "i", "cat > /tmp/ini_remediation/process_ini_file.sh << 'EOF'\n#!/bin/bash\n\n# Exit on any error\nset -e\n\n# Set environment variables if not already set\n: ${POLICY_TLS:=\"true\"}\n: ${POLICY_LOG:=\"INFO\"}\n\n# Define the absolute path to the current INI file\nfile_abspath=\"$1\"\n\n# Create backup file with correct permissions and ownership\nbackup_file=\"${file_abspath}.bak\"\nif [[ -f \"${file_abspath}\" ]]; then\n    cp -p -- \"${file_abspath}\" \"${backup_file}\"\n    chmod 0400 \"${backup_file}\"\nfi\n\n# Calculate SHA256 hash of the original file content\noriginal_hash=$(sha256sum \"${file_abspath}\" | awk '{print $1}')\n\n# Define the temporary file for processing\ntemp_file=\"${file_abspath}.tmp\"\n\n# Initialize remediation status\nstatus=\"NO_ACTION_REQUIRED\"\n\n# Define the awk script for INI file processing\nawk_script='\\\nBEGIN {\\\n    FS=\"=| \\[|\\]\"  # Custom field separator for INI format\n    OFS=\"=\"            # Output field separator\n    sec_security=0\n    sec_logging=0\n    sec_network=0\n    key_enforce_tls=0\n    key_level=0\n    key_trusted_hosts"]
[112.416565, "i", "=0\n    enforce_tls_value=\"MISSING\"\n    level_value=\"MISSING\"\n    trusted_hosts_value=\"MISSING\"\n    original_enforce_tls=\"MISSING\"\n    original_level=\"MISSING\"\n    original_trusted_hosts=\"MISSING\"\n    new_enforce_tls=\"MISSING\"\n    new_level=\"MISSING\"\n    new_trusted_hosts=\"MISSING\"\n    remediated=0\n}\n\n# Process section headers\nsec_security == 1 || $0 ~ /^\\[security\\]/ { sec_security=!sec_security; next }\nsec_logging == 1 || $0 ~ /^\\[logging\\]/ { sec_logging=!sec_logging; next }\nsec_network == 1 || $0 ~ /^\\[network\\]/ { sec_network=!sec_network; next }\n\n# In security section, handle enforce_tls key\nsec_security && $1 ~ /^enforce_tls$/i {\n    key_enforce_tls=1\n    original_enforce_tls=$2\n    # Convert to lowercase for case-insensitive comparison\n    original_enforce_tls_lower=tolower($2)\n    # Use POLICY_TLS environment variable, default to \"true\"\n    new_enforce_tls=(original_enforce_tls_lower != ENVIRON[\"POLICY_TLS\"]) ? ENVIRON[\"POLICY_TLS\"] : original_enforce_tls\n    if (original_enforce_tls != new_enforce_tl"]
[112.416587, "o", "cat > /tmp/ini_remediation/process_ini_file.sh << 'E"]
[112.416606, "i", "s) {\n        remediated=1\n    }\n    $2=new_enforce_tls\n    key_enforce_tls=0\n    next\n}\n\n# In logging section, handle level key\nsec_logging && $1 ~ /^level$/i {\n    key_level=1\n    original_level=$2\n    original_level_lower=tolower($2)\n    new_level_lower=tolower(ENVIRON[\"POLICY_LOG\"])\n    # Define allowed levels (more restrictive levels are acceptable)\n    allowed_levels= \"WARN|ERROR|FATAL|\" new_level_lower\n    if (!match(allowed_levels, new_level_lower)) {\n        new_level=ENVIRON[\"POLICY_LOG\"]\n    } else {\n        new_level=$2\n    }\n    if (original_level != new_level) {\n        remediated=1\n    }\n    $2=new_level\n    key_level=0\n    next\n}\n\n# In network section, handle trusted_hosts key\nsec_network && $1 ~ /^trusted_hosts$/i {\n    key_trusted_hosts=1\n    original_trusted_hosts=$2\n    # Split comma-separated list and filter non-compliant hostnames\n    if (original_trusted_hosts != \"\") {\n        split(original_trusted_hosts, hosts, /, */)\n        new_trusted_hosts=\"\"\n        for (i in hosts) {\n            "]
[112.416621, "o", "OF'\r\n#!/bin/bash\r\n\r\n# Exit on any erro"]
[112.416639, "i", "host=hosts[i]\n            gsub(/^\\s+|\\s+$/, \"\", host)  # Trim whitespace\n            if (host ~ /\\.corp\\.local$/ && host != \"\") {\n                if (new_trusted_hosts != \"\") {\n                    new_trusted_hosts = new_trusted_hosts \", \" host\n                } else {\n                    new_trusted_hosts = host\n                }\n            }\n        }\n        if (original_trusted_hosts != new_trusted_hosts) {\n            remediated=1\n        }\n    } else {\n        new_trusted_hosts=\"\"\n    }\n    $2=new_trusted_hosts\n    key_trusted_hosts=0\n    next\n}\n\n# Save original values for logging purposes\n{\\\n    if (sec_security && $1 ~ /^enforce_tls$/i) original_enforce_tls=$2\n    if (sec_logging && $1 ~ /^level$/i) original_level=$2\n    if (sec_network && $1 ~ /^trusted_hosts$/i) original_trusted_hosts=$2\n}\n\n# Save new values (for when keys are missing and need to be added)\nEND {\n    # If enforce_tls is missing in security section, add it\n    if (original_enforce_tls == \"MISSING\" && sec_security) {\n        print \"[s"]
[112.416654, "o", "r\r\nset -e\r\n\r\n# Set environment variables if not already set\r\n: ${POLICY_TLS:=\"true\"}\r\n: ${POLICY_LOG:=\""]
[112.416672, "i", "ecurity]\"\n        print \"enforce_tls=\" ENVIRON[\"POLICY_TLS\"]\n        remediated=1\n    }\n    if (original_level == \"MISSING\" && sec_logging) {\n        print \"[logging]\"\n        print \"level=\" ENVIRON[\"POLICY_LOG\"]\n        remediated=1\n    }\n    # Do not add network section or trusted_hosts key if missing\n}\n\n# Print the modified line\n{ print }'\n\n# Process the INI file using awk\nawk -v POLICY_TLS=\"$POLICY_TLS\" -v POLICY_LOG=\"$POLICY_LOG\" \\\n    -v ENFORCE_TLS=\"$POLICY_TLS\" -v LOG_LEVEL=\"$POLICY_LOG\" \\\n    \"${awk_script}\" \"${file_abspath}\" > \"${temp_file}\"\n\n# If remediation occurred, replace the original file with the temp file\nif [ $remediated -eq 1 ]; then\n    mv -f \"${temp_file}\" \"${file_abspath}\"\n    status=\"REMEDIATED\"\nelse\n    rm -f \"${temp_file}\"\n    # Remove backup file if no remediation occurred\n    rm -f \"${backup_file}\"\nfi\n\n# Log the remediation result to a temporary log file\nlog_file=\"/tmp/ini_remediation/$(basename \"${file_abspath}\")_log.txt\"\necho \"FILE: ${file_abspath}\" > \"${log_file}\"\necho \"ORIGINAL"]
[112.416686, "o", "INFO\"}\r\n\r\n# Define the absolute path to the current INI f"]
[112.4167, "i", "_HASH: ${original_hash}\" >> \"${log_file}\"\necho \"SECURITY_ENFORCED: was=${original_enforce_tls} -> ${new_enforce_tls}\" >> \"${log_file}\"\necho \"LOG_LEVEL:          was=${original_level} -> ${new_level}\" >> \"${log_file}\"\necho \"NETWORK_HOSTS:      was=${original_trusted_hosts} -> ${new_trusted_hosts}\" >> \"${log_file}\"\necho \"STATUS: ${status}\" >> \"${log_file}\"\necho \"----\" >> \"${log_file}\"\nEOF\n"]
[112.416716, "o", "ile\r\nfile_abspath=\"$1\"\r\n\r\n# Creat"]
[112.416733, "o", "e backup file wit"]
[112.416751, "o", "h correct permi"]
[112.416772, "o", "ssions and ownership\r\nbackup_file="]
[112.41679, "o", "\"${file_abspath}.bak\"\r\nif [[ -f \"${file_abspath}\" ]]; then\r\n"]
[112.416804, "o", "    cp -p -- \"${file_abspath}\" \"${backup_file}\"\r\n"]
[112.416819, "o", "    chmod 0400 \"${backup_file}\"\r\nfi\r\n\r\n# C"]
[112.416866, "o", "alculate SHA256 hash of the original file conte"]
[112.416883, "o", "nt\r\noriginal_hash=$(sha256sum \"${file_abspath}\" | awk '"]
[112.416896, "o", "{print $1}')\r\n\r\n# Define the temporary file for"]
[112.416911, "o", " processing\r\ntemp_file=\"${file_abspath}.tmp\"\r\n\r\n# "]
[112.416926, "o", "Initialize remediation status\r\nstatus=\"NO_ACTION_REQU"]
[112.416942, "o", "I"]
[112.416978, "o", "RED\"\r\n\r\n# Define the awk script"]
[112.416991, "o", " for INI file processing\r\nawk_script='\\\r\nBEGI"]
[112.417005, "o", "N {\\\r\n    FS=\"=| \\[|\\]\"  # Custom field separa"]
[112.417025, "o", "tor for INI format\r\n    OFS=\"=\"            # Output field separat"]
[112.417044, "o", "or\r\n    sec_security=0\r\n    sec_logging=0\r\n "]
[112.41706, "o", "   sec_network=0\r\n    key_enforce_tls=0\r\n    key_level=0\r\n    key_trusted_host"]
[112.417073, "o", "s"]
[112.417111, "o", "=0\r\n    enforce_tls_value=\"MIS"]
[112.417129, "o", "SING\"\r\n    level_value=\"MISSING\"\r\n    trusted_hosts_value="]
[112.417145, "o", "\"MISSING\"\r\n    original_enforce_tls=\"MISSING\"\r\n    origina"]
[112.41716, "o", "l_level=\"MISSING\"\r\n    original_trusted_hosts=\""]
[112.417174, "o", "MISSING\"\r\n    new_enforce_tls=\"MISSING\"\r\n    new"]
[112.417191, "o", "_level="]
[112.417251, "o", "\"MISSING\"\r\n    new_trusted_"]
[112.417264, "o", "hosts=\"MISSING\"\r\n    remediated=0\r\n}\r\n\r\n# Pr"]
[112.417278, "o", "ocess section headers\r\nsec_security == 1 || $0"]
[112.417294, "o", " ~ /^\\[security\\]/ { sec_security=!sec_security; next "]
[112.417309, "o", "}\r\nsec_logging == 1 || $0 ~ /^\\[logging\\]/ { se"]
[112.417323, "o", "c_logging=!sec_logging; next }\r\nsec_network == 1 |"]
[112.417339, "o", "| $0 ~ /^\\[network\\]/ { sec_network=!sec_network; n"]
[112.417352, "o", "ext }\r\n\r\n# In security section, handle enforce"]
[112.417367, "o", "_tls key\r\nsec_security && $1 ~ /^enforce_tls$/i {\r\n"]
[112.417382, "o", "    key_enforce_tls=1\r\n    original_enforce_tls="]
[112.417397, "o", "$2\r\n    # Convert to lowercase for cas"]
[112.417437, "o", "e-insensitive comparison\r\n    orig"]
[112.417451, "o", "inal_enforce_tls_lower=tolower($2)\r\n    # Use P"]
[112.417466, "o", "OLICY_TLS environment variable, default to \"tru"]
[112.417485, "o", "e\"\r\n    new_enforce_tls=(original_enforce_"]
[112.417504, "o", "tls_lower != ENVIRON[\"POLICY_TLS\"]) ? ENVIRON[\"POLICY_TLS\"] : ori"]
[112.417521, "o", "ginal_enforce_tls\r\n    if (original_enforce_tls != n"]
[112.417539, "o", "ew_enforce_tl"]
[112.41757, "o", "s) {\r\n        remediated=1\r\n    }"]
[112.417585, "o", "\r\n    $2=new_enforce_tls\r\n    key_enforce_tls=0\r\n    "]
[112.417599, "o", "next\r\n}\r\n\r\n# In logging section, handle level k"]
[112.417612, "o", "ey\r\nsec_logging && $1 ~ /^level$/i {\r\n    key_"]
[112.417631, "o", "level=1\r\n    original_level=$2\r\n    origina"]
[112.417646, "o", "l_level_lower=tolower($2"]
[112.417676, "o", ")\r\n    new_level_lower=tolower(E"]
[112.417693, "o", "NVIRON[\"POLICY_LOG\"])\r\n    # Define allowed levels (more"]
[112.417708, "o", " restrictive levels are acceptable)\r\n    allowed_le"]
[112.417723, "o", "vels= \"WARN|ERROR|FATAL|\" new_level_lower\r\n    if (!"]
[112.417739, "o", "match(allowed_levels, new_level_lower)) {\r\n        "]
[112.417754, "o", "new_level"]
[112.417785, "o", "=ENVIRON[\"POLICY_LOG\"]\r\n    } "]
[112.417805, "o", "else {\r\n        new_level=$2\r\n    }\r\n    if "]
[112.417819, "o", "(original_level != new_level) {\r\n        remediated=1\r\n    }\r\n    $2=new_"]
[112.417833, "o", "level\r\n    key_level=0\r\n    next\r\n}\r\n\r\n# In networ"]
[112.417849, "o", "k section, handle trusted_hosts key\r\nsec_network"]
[112.417954, "o", " && $1 ~ /^trusted_hosts$/i"]
[112.417968, "o", " {\r\n    key_trusted_hosts=1\r\n    original_tru"]
[112.417983, "o", "sted_hosts=$2\r\n    # Split comma-separated list and "]
[112.418002, "o", "filter non-compliant hostnames\r\n    if (o"]
[112.418018, "o", "riginal_trusted_hosts != \"\") {\r\n        split(original_trusted_hosts, hosts, /"]
[112.418033, "o", ", */)\r\n        new_trusted_hosts=\"\"\r\n        for "]
[112.418049, "o", "(i in hosts) {\r\n            host=hosts[i]\r\n         "]
[112.418066, "o", "   gsub(/^\\s+|\\s+$/, \"\", host)  # Trim whitespace\r\n       "]
[112.418092, "o", "     if (host ~ /\\.corp\\.local$/ && host"]
[112.418108, "o", " != \"\") {\r\n                if (new_trusted_hosts != \"\") {\r\n             "]
[112.418124, "o", "       new_trusted_hosts = new_trusted_hosts \", \" h"]
[112.418139, "o", "ost\r\n                } else {\r\n                    n"]
[112.418153, "o", "ew_trusted_hosts = host\r\n                }\r\n   "]
[112.418167, "o", "         }\r\n        }\r\n        if (original_truste"]
[112.418181, "o", "d_hosts != new_trusted_hosts) {\r\n  "]
[112.418221, "o", "          remediated=1\r\n    "]
[112.418234, "o", "    }\r\n    } else {\r\n        new_trusted_host"]
[112.418248, "o", "s=\"\"\r\n    }\r\n    $2=new_trusted_hosts\r\n    key_tr"]
[112.418263, "o", "usted_hosts=0\r\n    next\r\n}\r\n\r\n# Save original values f"]
[112.418284, "o", "or logging purposes\r\n{\\\r\n    if (sec_security && $1 ~ /^enforce_tls$"]
[112.418297, "o", "/i"]
[112.418328, "o", ") original_enforce_tls=$2\r\n  "]
[112.418348, "o", "  if (sec_logging && $1 ~ /^level$/i) original_level=$2\r\n    if (sec"]
[112.418364, "o", "_network && $1 ~ /^trusted_hosts$/i) original_trus"]
[112.418378, "o", "ted_hosts=$2\r\n}\r\n\r\n# Save new values (for when ke"]
[112.418397, "o", "ys are missing and need to be added)\r\nEND {\r\n    # If e"]
[112.418422, "o", "nforce_tls is missing in secur"]
[112.418437, "o", "ity section, add it\r\n    if (original_enforce_tls"]
[112.418451, "o", " == \"MISSING\" && sec_security) {\r\n        prin"]
[112.418465, "o", "t \"["]
[112.419017, "o", "\r                                     \r1% [Working]\r            \r"]
[112.419032, "o", "Get:3 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libdevmapper1.02.1 amd64 2:1.02.175-2.1ubuntu5 [139 kB]\r\n"]
[112.41909, "o", "\r1% [3 libdevmapper1.02.1 212 B/139 kB 0%]"]
[112.604152, "o", "\r                                         \r2% [Waiting for headers]\r                        \rGet:4 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libjson-c5 amd64 0.15-3~ubuntu1.22.04.2 [33.5 kB]\r\n"]
[112.60433, "o", "\r2% [4 libjson-c5 1342 B/33.5 kB 4%]"]
[112.625461, "o", "\r                                   \r3% [Waiting for headers]\r                        \rGet:5 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libcryptsetup12 amd64 2:2.4.3-1ubuntu1.3 [211 kB]\r\n\r3% [5 libcryptsetup12 2348 B/211 kB 1%]"]
[112.718303, "o", "\r                                       \r4% [Waiting for headers]\r                        \rGet:6 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libip4tc2 amd64 1.8.7-1ubuntu5.2 [19.9 kB]\r\n\r4% [6 libip4tc2 2896 B/19.9 kB 15%]"]
[112.723249, "o", "\r                                   \r5% [Waiting for headers]\r                        \rGet:7 http://archive.ubuntu.com/ubuntu jammy/main amd64 libkmod2 amd64 29-1ubuntu1 [48.0 kB]\r\n\r5% [7 libkmod2 110 B/48.0 kB 0%]"]
[112.736277, "o", "\r                                \r5% [Waiting for headers]\r                        \rGet:8 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 systemd amd64 249.11-0ubuntu3.17 [4583 kB]\r\n\r5% [8 systemd 2500 B/4583 kB 0%]"]
[113.02616, "o", "\r                                \r18% [Waiting for headers]\r                         \rGet:9 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 perl-modules-5.34 all 5.34.0-3ubuntu1.5 [2977 kB]\r\n\r18% [9 perl-modules-5.34 26.6 kB/2977 kB 1%]"]
[113.083549, "o", "\r                                            \r27% [Waiting for headers]\r                         \rGet:10 http://archive.ubuntu.com/ubuntu jammy/main amd64 libgdbm6 amd64 1.23-1 [33.9 kB]\r\n\r27% [10 libgdbm6 33.9 kB/33.9 kB 100%]"]
[113.084137, "o", "\r                                      \r27% [Working]\r             \rGet:11 http://archive.ubuntu.com/ubuntu jammy/main amd64 libgdbm-compat4 amd64 1.23-1 [6606 B]\r\n"]
[113.084236, "o", "\r27% [11 libgdbm-compat4 6606 B/6606 B 100%]"]
[113.084597, "o", "\r                                           \r28% [Working]\r             \r"]
[113.084651, "o", "Get:12 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libperl5.34 amd64 5.34.0-3ubuntu1.5 [4797 kB]\r\n\r28% [12 libperl5.34 12.5 kB/4797 kB 0%]"]
[113.185957, "o", "\r                                       \r41% [Waiting for headers]\r                         \rGet:13 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 perl amd64 5.34.0-3ubuntu1.5 [232 kB]\r\n\r41% [13 perl 45.1 kB/232 kB 19%]"]
[113.19023, "o", "\r                                \r42% [Waiting for headers]\r                         \rGet:14 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libdbus-1-3 amd64 1.12.20-2ubuntu4.1 [189 kB]\r\n"]
[113.19039, "o", "\r42% [14 libdbus-1-3 4096 B/189 kB 2%]"]
[113.194503, "o", "\r                                     \r43% [Waiting for headers]\r                         \rGet:15 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 dbus amd64 1.12.20-2ubuntu4.1 [158 kB]\r\n\r43% [15 dbus 4096 B/158 kB 3%]"]
[113.198996, "o", "\r                              \r44% [Working]\r             \rGet:16 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 dmsetup amd64 2:1.02.175-2.1ubuntu5 [81.7 kB]\r\n\r44% [16 dmsetup 16.4 kB/81.7 kB 20%]"]
[113.200689, "o", "\r                                    \r45% [Waiting for headers]\r                         \rGet:17 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libglib2.0-0 amd64 2.72.4-0ubuntu2.9 [1467 kB]\r\n\r45% [17 libglib2.0-0 20.0 kB/1467 kB 1%]"]
[113.23147, "o", "\r                                        \r50% [Waiting for headers]\r                         \rGet:18 http://archive.ubuntu.com/ubuntu jammy/main amd64 libgirepository-1.0-1 amd64 1.72.0-1 [55.6 kB]\r\n"]
[113.231584, "o", "\r50% [18 libgirepository-1.0-1 45.1 kB/55.6 kB 81%]"]
[113.232422, "o", "\r                                                  \r50% [Waiting for headers]\r                         \r"]
[113.232476, "o", "Get:19 http://archive.ubuntu.com/ubuntu jammy/main amd64 gir1.2-glib-2.0 amd64 1.72.0-1 [164 kB]\r\n\r50% [19 gir1.2-glib-2.0 42.8 kB/164 kB 26%]"]
[113.234934, "o", "\r                                           \r51% [Waiting for headers]"]
[113.234979, "o", "\r                         \rGet:20 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libglib2.0-data all 2.72.4-0ubuntu2.9 [5088 B]\r\n"]
[113.23514, "o", "\r                         \rGet:21 http://archive.ubuntu.com/ubuntu jammy/main amd64 libicu70 amd64 70.1-2 [10.6 MB]\r\n"]
[113.235188, "o", "\r52% [21 libicu70 0 B/10.6 MB 0%]"]
[113.393328, "i", "chmod +x /tmp/ini_remediation/process_ini_file.sh\n"]
[113.455187, "o", "\r                                \r81% [Working]\r             \rGet:22 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libxml2 amd64 2.9.13+dfsg-1ubuntu0.11 [765 kB]\r\n\r81% [22 libxml2 0 B/765 kB 0%]"]
[113.474156, "o", "\r                              \r83% [Waiting for headers]\r                         \rGet:23 http://archive.ubuntu.com/ubuntu jammy/main amd64 netbase all 6.3 [12.9 kB]\r\n"]
[113.474375, "o", "\r                         \rGet:24 http://archive.ubuntu.com/ubuntu jammy/main amd64 python3-dbus amd64 1.2.18-3build1 [99.5 kB]\r\n"]
[113.474404, "o", "\r84% [24 python3-dbus 38.7 kB/99.5 kB 39%]"]
[113.476185, "o", "\r                                         \r85% [Waiting for headers]\r                         \rGet:25 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 python3-gi amd64 3.42.1-0ubuntu1 [229 kB]\r\n"]
[113.476233, "o", "\r85% [25 python3-gi 13.0 kB/229 kB 6%]"]
[113.480998, "o", "\r                                     \r86% [Waiting for headers]\r                         \rGet:26 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 networkd-dispatcher all 2.1-2ubuntu0.22.04.2 [15.8 kB]\r\n"]
[113.481019, "o", "\r86% [26 networkd-dispatcher 15.8 kB/15.8 kB 100%]"]
[113.481226, "o", "\r                                                 \r87% [Waiting for headers]\r                         \rGet:27 http://archive.ubuntu.com/ubuntu jammy/main amd64 shared-mime-info amd64 2.1-2 [454 kB]\r\n"]
[113.48127, "o", "\r87% [27 shared-mime-info 24.6 kB/454 kB 5%]"]
[113.488828, "i", "cat > /tmp/ini_remediation/run_scan.sh << 'EOF'\n#!/bin/bash\n\n# Set environment variables\nexport POLICY_TLS=\"${POLICY_TLS:-true}\"\nexport POLICY_LOG=\"${POLICY_LOG:-INFO}\"\n\n# Create a temporary directory for parallel processing\nwork_dir=\"/tmp/ini_remediation\"\nmkdir -p \"${work_dir}\"\n\n# Find all INI files under /home/user/policy/configs\nfind /home/user/policy/configs -type f -name '*.ini' > \"${work_dir}/files.txt\"\n\n# Check if any INI files were found\nif [ ! -s \"${work_dir}/files.txt\" ]; then\n    echo \"No INI files found under /home/user/policy/configs.\" >&2\n    exit 1\nfi\n\n# Process files concurrently using GNU Parallel\nparallel -j +0 --no-notice -a \"${work_dir}/files.txt\" \\\n    \"${work_dir}/process_ini_file.sh {}\"\n\n# Collect all individual log files\nlog_files=($(ls -1 \"${work_dir}\"/*.txt 2>/dev/null))\n\n# Create the final log file path\nfinal_log=\"/home/user/policy/reports/after_remediation.log\"\n\n# Write header to the final log file\necho \"\" > \"${final_log}\"\n\n# Concatenate log files in alphabetical order\nif [ ${#log_"]
[113.488896, "i", "files[@]} -gt 0 ]; then\n    cat \"${log_files[@]}\" | sort >> \"${final_log}\"\nfi\n\n# Calculate summary statistics\nfiles_scanned=$(wc -l < \"${work_dir}/files.txt\")\nremediated=0\ncompliant=0\nfor log in \"${log_files[@]}\"; do\n    if grep -q \"STATUS: REMEDIATED\" \"${log}\"; then\n        ((remediated++))\n    else\n        ((compliant++))\n    fi\ndone\n\n# Append summary to the final log file\necho \"Summary:\" >> \"${final_log}\"\necho \"FILES_SCANNED=${files_scanned}\" >> \"${final_log}\"\necho \"REMEDIATED=${remediated}\" >> \"${final_log}\"\necho \"COMPLIANT=${compliant}\" >> \"${final_log}\"\n\n# Clean up temporary files\nrm -rf \"${work_dir}\"\nEOF\n"]
[113.490664, "o", "\r                                           \r88% [Working]\r             \r"]
[113.490721, "o", "Get:28 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 systemd-timesyncd amd64 249.11-0ubuntu3.17 [31.2 kB]\r\n\r88% [28 systemd-timesyncd 4096 B/31.2 kB 13%]"]
[113.491257, "o", "\r                                             \r89% [Working]\r             \r"]
[113.491304, "o", "Get:29 http://archive.ubuntu.com/ubuntu jammy/main amd64 ucf all 3.0043 [56.1 kB]\r\n\r89% [29 ucf 3553 B/56.1 kB 6%]"]
[113.492323, "o", "\r                              \r90% [Working]"]
[113.492358, "o", "\r             \rGet:30 http://archive.ubuntu.com/ubuntu jammy/main amd64 xdg-user-dirs amd64 0.17-2ubuntu4 [53.9 kB]\r\n\r90% [30 xdg-user-dirs 12.7 kB/53.9 kB 24%]"]
[113.493375, "o", "\r                                          \r90% [Working]"]
[113.542044, "o", "\r             \rGet:31 http://archive.ubuntu.com/ubuntu jammy/main amd64 xz-utils amd64 5.2.5-2ubuntu1 [84.8 kB]\r\n"]
[113.542099, "o", "\r90% [31 xz-utils 6949 B/84.8 kB 8%]"]
[113.543787, "o", "\r                                   \r91% [Waiting for headers]"]
[113.627777, "o", "\r                         \rGet:32 http://archive.ubuntu.com/ubuntu jammy/main amd64 libsensors-config all 1:3.6.0-7ubuntu1 [5274 B]\r\n\r91% [32 libsensors-config 4531 B/5274 B 86%]"]
[113.628216, "o", "\r                                            \r92% [Working]"]
[113.628276, "o", "\r             \rGet:33 http://archive.ubuntu.com/ubuntu jammy/main amd64 libsensors5 amd64 1:3.6.0-7ubuntu1 [26.3 kB]\r\n\r92% [33 libsensors5 26.3 kB/26.3 kB 100%]"]
[113.628679, "o", "\r                                         \r92% [Waiting for headers]"]
[113.628714, "o", "\r                         \rGet:34 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 sysstat amd64 12.5.2-2ubuntu0.2 [487 kB]\r\n"]
[113.628749, "o", "\r92% [34 sysstat 24.3 kB/487 kB 5%]"]
[113.637714, "o", "\r                                  \r94% [Working]\r             \rGet:35 http://archive.ubuntu.com/ubuntu jammy/universe amd64 parallel all 20210822+ds-2 [1947 kB]\r\n"]
[113.637797, "o", "\r94% [35 parallel 3266 B/1947 kB 0%]"]
[113.678107, "o", "\r                                   \r100% [Working]\r              \rFetched 30.1 MB in 2s (17.6 MB/s)\r\n"]
[113.801407, "o", "debconf: delaying package configuration, since apt-utils is not installed\r\n"]
[113.828601, "o", "security]\"\r\n        print \"enforce_tls=\" ENVIRON[\"POLICY_TLS\"]\r\n        remediated=1\r\n    }\r\n    if (original_level == \"MISSING\" && sec_logging) {\r\n        print \"[logging]\"\r\n        print \"level=\" ENVIRON[\"POLICY_LOG\"]\r\n        remedia"]
[113.828652, "o", "ted=1\r\n    }\r\n    # Do not add network section or trusted_hosts key if missi"]
[113.828814, "o", "ng\r\n}\r\n\r\n# Print the modified line\r\n{ print }'\r\n\r\n# Process the INI file using awk\r\nawk -v POLICY_TLS=\"$POLICY_TLS\" -v POLICY_LOG=\"$POLICY_LOG\" \\\r\n    -v ENFORCE_TLS=\"$POLICY_TLS\" -v LO"]
[113.828883, "o", "G_LEVEL=\"$POLICY_LOG\" \\\r\n    \"${awk_script}\" \"${file_abspath}\" > \"${temp_file}\"\r\n\r\n# If remediation occurred, replace the original file with the temp file\r\nif [ $remediated -eq 1 ]; then\r\n    mv -f \"${temp_file}\" \"${file_abspath}\"\r\n    status=\"REMEDIATED\"\r\nelse\r\n    rm -f \"${temp_file}\"\r\n    # Remove backup file if no remediation occurred\r\n    rm -f \"${backup_file}"]
[113.828964, "o", "\"\r\nfi\r\n\r\n# Log the remediation result to a temporary log file\r\nlog_file=\"/tmp/ini_remediation/$(basename \"${file_abspath}\")_log.txt\"\r\necho \"FILE: ${file_abspath}\" > \"${log_file}\"\r\necho \"ORIGINAL_HASH: ${original_hash}\" >> \"${log_f"]
[113.829024, "o", "ile}\"\r\necho \"SECURITY_ENFO"]
[113.829096, "o", "RCED: was=${original_enforce_tls} -> ${new_enforce_tls}\" >> \"${log_file"]
[113.829159, "o", "}\"\r\necho \"LOG_LEVEL:          was=${original_level} -> ${new_level}\" >> \"${log_file}\"\r\necho \"NETWORK_HOSTS:      w"]
[113.829182, "o", "as=${"]
[113.829267, "o", "original_trusted_hosts} -> ${new_trusted_hosts}\" >> \"${log_fil"]
[113.829323, "o", "e}\"\r\necho \"STATUS: ${status}\" "]
[113.829387, "o", ">> \"${log_file}\"\r\necho \"----\" >> \"${log_file}\"\r\nEOF\r\nchmod +x /tmp/"]
[113.829412, "o", "ini_remediation/process_ini_file.sh\r\ncat > /tmp/ini_remediation/run_scan.sh "]
[113.829488, "o", "<< 'EOF'\r\n#!/bi"]
[113.829548, "o", "n/bash\r\n\r\n# Set environment variables\r\nexport POLICY_TLS=\"${POLICY_TLS:-true}"]
[113.829605, "o", "\"\r\nexport POLICY_LOG=\"${POLICY_LOG:-INFO}\"\r\n\r\n# Create a temporary"]
[113.829662, "o", " directory for parallel processing\r\nwork_dir=\"/tmp/i"]
[113.829728, "o", "ni_remediation\"\r\nmkdir -p \"${work_dir}\"\r\n\r\n# Find all INI files under /home/u"]
[113.829784, "o", "ser/policy/configs\r\nfind /"]
[113.82985, "o", "home/user/policy/configs -type f -name '*.ini' > \"${work_dir}/f"]
[113.829906, "o", "iles.txt\"\r\n\r\n# Check if any INI files were fou"]
[113.829958, "o", "nd\r\nif [ ! -s \"${work_dir}/files.txt\" ]; then\r\n    echo "]
[113.830023, "o", "\"No INI files found under /home/user/policy/configs.\" >&2\r\n    exit 1\r\nfi"]
[113.830102, "o", "\r\n\r\n# Process files concurrently using GNU P"]
[113.830159, "o", "arallel\r\nparallel -j +0 --no-notice -a \"${work_di"]
[113.830225, "o", "r}/files.txt\" \\\r\n    \"${work_dir}/process_ini_file.sh {}\"\r\n\r\n# Colle"]
[113.830278, "o", "ct all individual log files\r\nlog_files=($(ls -1 \"${work_"]
[113.830342, "o", "dir}\"/*.txt 2>/dev/null))\r\n\r\n# Create the final l"]
[113.8304, "o", "og file path\r\nfinal_log=\"/home/user"]
[113.830454, "o", "/policy/reports/after_remediation.log\"\r\n\r\n#"]
[113.83052, "o", " Write header to the final log file\r\necho \"\" > \"${fina"]
[113.830583, "o", "l_log}\"\r\n\r\n# Concatenate log files in alphabetical order\r\nif [ ${#log_files[@]} -gt 0 ]; then\r\n    cat "]
[113.830637, "o", "\"${log_files[@]}\" | sort >> \"${final_lo"]
[113.830678, "o", "g}\"\r\nfi\r\n\r\n# Calculate summary statistics\r\nfi"]
[113.83074, "o", "les_scanned=$(wc -l < \"${"]
[113.830803, "o", "work_dir}/files.txt\")\r\nremediated=0\r\ncompliant=0\r\nfor log in \"${log_files[@]}\"; do\r\n    if grep -q \"STATUS:"]
[113.830864, "o", " REMEDIATED\" \"${log}\"; then\r\n        ((remedia"]
[113.830917, "o", "ted++))\r\n    else\r\n        ((comp"]
[113.830981, "o", "liant++))\r\n    fi\r\ndone\r\n\r\n# Append summary to the final"]
[113.831046, "o", " log file\r\necho \"Summary:\" >> \"${final_log}\"\r\necho \"FILES_SCANNED=${files_scanned"]
[113.831121, "o", "}\" >> \"${final_log}\"\r\necho \"REMEDI"]
[113.831186, "o", "ATED=${remediated}\" >> \"${final_log}\"\r\necho \"COMPLIANT=${compliant}\" >> \"${final_"]
[113.831239, "o", "log}\"\r\n\r\n# Clean up temporary files\r\nrm -rf \"${w"]
[113.831295, "o", "ork_dir}\"\r\nEOF\r\n"]
[113.850648, "o", "Selecting previously unselected package libapparmor1:amd64.\r\n(Reading database ... \r"]
[113.8526, "o", "(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r"]
[113.852663, "o", "(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r"]
[113.854434, "o", "(Reading database ... 70%\r"]
[113.855332, "o", "(Reading database ... 75%\r"]
[113.855974, "o", "(Reading database ... 80%\r"]
[113.856864, "o", "(Reading database ... 85%\r"]
[113.857806, "o", "(Reading database ... 90%\r"]
[113.858324, "o", "(Reading database ... 95%\r"]
[113.859178, "o", "(Reading database ... 100%\r(Reading database ... 6856 files and directories currently installed.)\r\n"]
[113.859565, "o", "Preparing to unpack .../00-libapparmor1_3.0.4-2ubuntu2.5_amd64.deb ...\r\n"]
[113.861176, "o", "Unpacking libapparmor1:amd64 (3.0.4-2ubuntu2.5) ...\r\n"]
[113.877109, "o", "Selecting previously unselected package libargon2-1:amd64.\r\n"]
[113.878129, "o", "Preparing to unpack .../01-libargon2-1_0~20171227-0.3_amd64.deb ...\r\n"]
[113.878897, "o", "Unpacking libargon2-1:amd64 (0~20171227-0.3) ...\r\n"]
[113.906772, "o", "Selecting previously unselected package libdevmapper1.02.1:amd64.\r\n"]
[113.907406, "o", "Preparing to unpack .../02-libdevmapper1.02.1_2%3a1.02.175-2.1ubuntu5_amd64.deb ...\r\n"]
[113.907907, "o", "Unpacking libdevmapper1.02.1:amd64 (2:1.02.175-2.1ubuntu5) ...\r\n"]
[113.923108, "o", "Selecting previously unselected package libjson-c5:amd64.\r\n"]
[113.923667, "o", "Preparing to unpack .../03-libjson-c5_0.15-3~ubuntu1.22.04.2_amd64.deb ...\r\n"]
[113.924264, "o", "Unpacking libjson-c5:amd64 (0.15-3~ubuntu1.22.04.2) ...\r\n"]
[113.938253, "o", "Selecting previously unselected package libcryptsetup12:amd64.\r\n"]
[113.939107, "o", "Preparing to unpack .../04-libcryptsetup12_2%3a2.4.3-1ubuntu1.3_amd64.deb ...\r\n"]
[113.939733, "o", "Unpacking libcryptsetup12:amd64 (2:2.4.3-1ubuntu1.3) ...\r\n"]
[113.95394, "o", "Selecting previously unselected package libip4tc2:amd64.\r\n"]
[113.954498, "o", "Preparing to unpack .../05-libip4tc2_1.8.7-1ubuntu5.2_amd64.deb ...\r\n"]
[113.954931, "o", "Unpacking libip4tc2:amd64 (1.8.7-1ubuntu5.2) ...\r\n"]
[113.971394, "o", "Selecting previously unselected package libkmod2:amd64.\r\n"]
[113.973471, "o", "Preparing to unpack .../06-libkmod2_29-1ubuntu1_amd64.deb ...\r\n"]
[113.974463, "o", "Unpacking libkmod2:amd64 (29-1ubuntu1) ...\r\n"]
[113.988823, "o", "Selecting previously unselected package systemd.\r\n"]
[113.989565, "o", "Preparing to unpack .../07-systemd_249.11-0ubuntu3.17_amd64.deb ...\r\n"]
[114.016139, "o", "Unpacking systemd (249.11-0ubuntu3.17) ...\r\n"]
[114.18804, "o", "Selecting previously unselected package perl-modules-5.34.\r\n"]
[114.189055, "o", "Preparing to unpack .../08-perl-modules-5.34_5.34.0-3ubuntu1.5_all.deb ...\r\n"]
[114.189539, "o", "Unpacking perl-modules-5.34 (5.34.0-3ubuntu1.5) ...\r\n"]
[114.443226, "o", "Selecting previously unselected package libgdbm6:amd64.\r\n"]
[114.444415, "o", "Preparing to unpack .../09-libgdbm6_1.23-1_amd64.deb ...\r\n"]
[114.445003, "o", "Unpacking libgdbm6:amd64 (1.23-1) ...\r\n"]
[114.461456, "o", "Selecting previously unselected package libgdbm-compat4:amd64.\r\n"]
[114.462493, "o", "Preparing to unpack .../10-libgdbm-compat4_1.23-1_amd64.deb ...\r\n"]
[114.463038, "o", "Unpacking libgdbm-compat4:amd64 (1.23-1) ...\r\n"]
[114.475343, "o", "Selecting previously unselected package libperl5.34:amd64.\r\n"]
[114.476353, "o", "Preparing to unpack .../11-libperl5.34_5.34.0-3ubuntu1.5_amd64.deb ...\r\n"]
[114.476918, "o", "Unpacking libperl5.34:amd64 (5.34.0-3ubuntu1.5) ...\r\n"]
[114.50482, "i", "chmod +x /tmp/ini_remediation/run_scan.sh\n"]
[114.504948, "o", "chmod +x /tmp/ini_remediation/run_scan.sh\r\n"]
[114.705786, "i", "/tmp/ini_remediation/run_scan.sh\n"]
[114.705915, "o", "/tmp/ini_remediation/run_scan.sh\r\n"]
[114.729429, "o", "Selecting previously unselected package perl.\r\n"]
[114.73058, "o", "Preparing to unpack .../12-perl_5.34.0-3ubuntu1.5_amd64.deb ...\r\n"]
[114.736485, "o", "Unpacking perl (5.34.0-3ubuntu1.5) ...\r\n"]
[114.757013, "o", "Selecting previously unselected package libdbus-1-3:amd64.\r\n"]
[114.75856, "o", "Preparing to unpack .../13-libdbus-1-3_1.12.20-2ubuntu4.1_amd64.deb ...\r\n"]
[114.759394, "o", "Unpacking libdbus-1-3:amd64 (1.12.20-2ubuntu4.1) ...\r\n"]
[114.774905, "o", "Selecting previously unselected package dbus.\r\n"]
[114.800743, "o", "Preparing to unpack .../14-dbus_1.12.20-2ubuntu4.1_amd64.deb ...\r\n"]
[114.81048, "o", "Unpacking dbus (1.12.20-2ubuntu4.1) ...\r\n"]
[114.83982, "o", "Selecting previously unselected package dmsetup.\r\n"]
[114.841404, "o", "Preparing to unpack .../15-dmsetup_2%3a1.02.175-2.1ubuntu5_amd64.deb ...\r\n"]
[114.842238, "o", "Unpacking dmsetup (2:1.02.175-2.1ubuntu5) ...\r\n"]
[114.857699, "o", "Selecting previously unselected package libglib2.0-0:amd64.\r\n"]
[114.858751, "o", "Preparing to unpack .../16-libglib2.0-0_2.72.4-0ubuntu2.9_amd64.deb ...\r\n"]
[114.859257, "o", "Unpacking libglib2.0-0:amd64 (2.72.4-0ubuntu2.9) ...\r\n"]
[114.892383, "o", "Selecting previously unselected package libgirepository-1.0-1:amd64.\r\n"]
[114.900976, "o", "Preparing to unpack .../17-libgirepository-1.0-1_1.72.0-1_amd64.deb ...\r\n"]
[114.901522, "o", "Unpacking libgirepository-1.0-1:amd64 (1.72.0-1) ...\r\n"]
[114.91654, "o", "Selecting previously unselected package gir1.2-glib-2.0:amd64.\r\n"]
[114.917311, "o", "Preparing to unpack .../18-gir1.2-glib-2.0_1.72.0-1_amd64.deb ...\r\n"]
[114.917832, "o", "Unpacking gir1.2-glib-2.0:amd64 (1.72.0-1) ...\r\n"]
[114.930367, "o", "Selecting previously unselected package libglib2.0-data.\r\n"]
[114.931043, "o", "Preparing to unpack .../19-libglib2.0-data_2.72.4-0ubuntu2.9_all.deb ...\r\n"]
[114.931486, "o", "Unpacking libglib2.0-data (2.72.4-0ubuntu2.9) ...\r\n"]
[114.941067, "o", "Selecting previously unselected package libicu70:amd64.\r\n"]
[114.941726, "o", "Preparing to unpack .../20-libicu70_70.1-2_amd64.deb ...\r\n"]
[114.942277, "o", "Unpacking libicu70:amd64 (70.1-2) ...\r\n"]
[115.152025, "o", "Selecting previously unselected package libxml2:amd64.\r\n"]
[115.153519, "o", "Preparing to unpack .../21-libxml2_2.9.13+dfsg-1ubuntu0.11_amd64.deb ...\r\n"]
[115.15435, "o", "Unpacking libxml2:amd64 (2.9.13+dfsg-1ubuntu0.11) ...\r\n"]
[115.20451, "o", "Selecting previously unselected package netbase.\r\n"]
[115.206029, "o", "Preparing to unpack .../22-netbase_6.3_all.deb ...\r\n"]
[115.206753, "o", "Unpacking netbase (6.3) ...\r\n"]
[115.225796, "o", "Selecting previously unselected package python3-dbus.\r\n"]
[115.227836, "o", "Preparing to unpack .../23-python3-dbus_1.2.18-3build1_amd64.deb ...\r\n"]
[115.228905, "o", "Unpacking python3-dbus (1.2.18-3build1) ...\r\n"]
[115.2462, "o", "Selecting previously unselected package python3-gi.\r\n"]
[115.247275, "o", "Preparing to unpack .../24-python3-gi_3.42.1-0ubuntu1_amd64.deb ...\r\n"]
[115.247881, "o", "Unpacking python3-gi (3.42.1-0ubuntu1) ...\r\n"]
[115.268888, "o", "Selecting previously unselected package networkd-dispatcher.\r\n"]
[115.269963, "o", "Preparing to unpack .../25-networkd-dispatcher_2.1-2ubuntu0.22.04.2_all.deb ...\r\n"]
[115.270532, "o", "Unpacking networkd-dispatcher (2.1-2ubuntu0.22.04.2) ...\r\n"]
[115.289291, "o", "Selecting previously unselected package shared-mime-info.\r\n"]
[115.290927, "o", "Preparing to unpack .../26-shared-mime-info_2.1-2_amd64.deb ...\r\n"]
[115.291842, "o", "Unpacking shared-mime-info (2.1-2) ...\r\n"]
[115.323843, "o", "Selecting previously unselected package systemd-timesyncd.\r\n"]
[115.325404, "o", "Preparing to unpack .../27-systemd-timesyncd_249.11-0ubuntu3.17_amd64.deb ...\r\n"]
[115.326274, "o", "Unpacking systemd-timesyncd (249.11-0ubuntu3.17) ...\r\n"]
[115.343554, "o", "Selecting previously unselected package ucf.\r\n"]
[115.344957, "o", "Preparing to unpack .../28-ucf_3.0043_all.deb ...\r\n"]
[115.347245, "o", "Moving old data out of the way\r\n"]
[115.349063, "o", "Unpacking ucf (3.0043) ...\r\n"]
[115.369868, "o", "Selecting previously unselected package xdg-user-dirs.\r\n"]
[115.370942, "o", "Preparing to unpack .../29-xdg-user-dirs_0.17-2ubuntu4_amd64.deb ...\r\n"]
[115.374573, "o", "Unpacking xdg-user-dirs (0.17-2ubuntu4) ...\r\n"]
[115.413623, "o", "Selecting previously unselected package xz-utils.\r\n"]
[115.414618, "o", "Preparing to unpack .../30-xz-utils_5.2.5-2ubuntu1_amd64.deb ...\r\n"]
[115.415092, "o", "Unpacking xz-utils (5.2.5-2ubuntu1) ...\r\n"]
[115.428966, "o", "Selecting previously unselected package libsensors-config.\r\n"]
[115.430074, "o", "Preparing to unpack .../31-libsensors-config_1%3a3.6.0-7ubuntu1_all.deb ...\r\n"]
[115.430667, "o", "Unpacking libsensors-config (1:3.6.0-7ubuntu1) ...\r\n"]
[115.446147, "o", "Selecting previously unselected package libsensors5:amd64.\r\n"]
[115.447242, "o", "Preparing to unpack .../32-libsensors5_1%3a3.6.0-7ubuntu1_amd64.deb ...\r\n"]
[115.466517, "o", "Unpacking libsensors5:amd64 (1:3.6.0-7ubuntu1) ...\r\n"]
[115.481815, "o", "Selecting previously unselected package sysstat.\r\n"]
[115.482739, "o", "Preparing to unpack .../33-sysstat_12.5.2-2ubuntu0.2_amd64.deb ...\r\n"]
[115.487261, "o", "Unpacking sysstat (12.5.2-2ubuntu0.2) ...\r\n"]
[115.514148, "o", "Selecting previously unselected package parallel.\r\n"]
[115.515212, "o", "Preparing to unpack .../34-parallel_20210822+ds-2_all.deb ...\r\n"]
[115.519381, "o", "Adding 'diversion of /usr/bin/parallel to /usr/bin/parallel.moreutils by parallel'\r\n"]
[115.52327, "o", "Adding 'diversion of /usr/share/man/man1/parallel.1.gz to /usr/share/man/man1/parallel.moreutils.1.gz by parallel'\r\n"]
[115.524296, "o", "Unpacking parallel (20210822+ds-2) ...\r\n"]
[115.556005, "o", "Setting up libip4tc2:amd64 (1.8.7-1ubuntu5.2) ...\r\n"]
[115.55852, "o", "Setting up libapparmor1:amd64 (3.0.4-2ubuntu2.5) ...\r\n"]
[115.559977, "o", "Setting up xdg-user-dirs (0.17-2ubuntu4) ...\r\n"]
[115.567253, "o", "Setting up libglib2.0-0:amd64 (2.72.4-0ubuntu2.9) ...\r\n"]
[115.571417, "o", "No schema files found: doing nothing.\r\n"]
[115.57385, "o", "Setting up libargon2-1:amd64 (0~20171227-0.3) ...\r\n"]
[115.575144, "o", "Setting up libsensors-config (1:3.6.0-7ubuntu1) ...\r\n"]
[115.577349, "o", "Setting up perl-modules-5.34 (5.34.0-3ubuntu1.5) ...\r\n"]
[115.57863, "o", "Setting up libglib2.0-data (2.72.4-0ubuntu2.9) ...\r\n"]
[115.579896, "o", "Setting up libdbus-1-3:amd64 (1.12.20-2ubuntu4.1) ...\r\n"]
[115.58119, "o", "Setting up dbus (1.12.20-2ubuntu4.1) ...\r\n"]
[115.66256, "o", "Setting up xz-utils (5.2.5-2ubuntu1) ...\r\n"]
[115.667228, "o", "update-alternatives: using /usr/bin/xz to provide /usr/bin/lzma (lzma) in auto mode\r\n"]
[115.667557, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzma.1.gz because associated file /usr/share/man/man1/xz.1.gz (of link group lzma) doesn't exist\r\n"]
[115.667717, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/unlzma.1.gz because associated file /usr/share/man/man1/unxz.1.gz (of link group lzma) doesn't exist\r\n"]
[115.667866, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzcat.1.gz because associated file /usr/share/man/man1/xzcat.1.gz (of link group lzma) doesn't exist\r\n"]
[115.66801, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzmore.1.gz because associated file /usr/share/man/man1/xzmore.1.gz (of link group lzma) doesn't exist\r\n"]
[115.668158, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzless.1.gz because associated file /usr/share/man/man1/xzless.1.gz (of link group lzma) doesn't exist\r\n"]
[115.668304, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzdiff.1.gz because associated file /usr/share/man/man1/xzdiff.1.gz (of link group lzma) doesn't exist\r\n"]
[115.668528, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzcmp.1.gz because associated file /usr/share/man/man1/xzcmp.1.gz (of link group lzma) doesn't exist\r\n"]
[115.668675, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzgrep.1.gz because associated file /usr/share/man/man1/xzgrep.1.gz (of link group lzma) doesn't exist\r\n"]
[115.668826, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzegrep.1.gz because associated file /usr/share/man/man1/xzegrep.1.gz (of link group lzma) doesn't exist\r\n"]
[115.66898, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/lzfgrep.1.gz because associated file /usr/share/man/man1/xzfgrep.1.gz (of link group lzma) doesn't exist\r\n"]
[115.67154, "o", "Setting up ucf (3.0043) ...\r\n"]
[115.717096, "o", "debconf: unable to initialize frontend: Dialog\r\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)\r\ndebconf: falling back to frontend: Readline\r\n"]
[115.742531, "o", "Setting up libsensors5:amd64 (1:3.6.0-7ubuntu1) ...\r\n"]
[115.743751, "o", "Setting up libdevmapper1.02.1:amd64 (2:1.02.175-2.1ubuntu5) ...\r\n"]
[115.744987, "o", "Setting up dmsetup (2:1.02.175-2.1ubuntu5) ...\r\n"]
[115.747613, "o", "Setting up libgirepository-1.0-1:amd64 (1.72.0-1) ...\r\n"]
[115.748839, "o", "Setting up netbase (6.3) ...\r\n"]
[115.752815, "o", "Setting up libjson-c5:amd64 (0.15-3~ubuntu1.22.04.2) ...\r\n"]
[115.754038, "o", "Setting up sysstat (12.5.2-2ubuntu0.2) ...\r\n"]
[115.827256, "o", "debconf: unable to initialize frontend: Dialog\r\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 78.)\r\ndebconf: falling back to frontend: Readline\r\n"]
[115.88443, "o", "\r\nCreating config file /etc/default/sysstat with new version\r\n"]
[115.923339, "o", "update-alternatives: using /usr/bin/sar.sysstat to provide /usr/bin/sar (sar) in auto mode\r\n"]
[115.923513, "o", "update-alternatives: warning: skip creation of /usr/share/man/man1/sar.1.gz because associated file /usr/share/man/man1/sar.sysstat.1.gz (of link group sar) doesn't exist\r\n"]
[116.012822, "o", "Created symlink /etc/systemd/system/sysstat.service.wants/sysstat-collect.timer  /lib/systemd/system/sysstat-collect.timer.\r\n"]
[116.106853, "o", "Created symlink /etc/systemd/system/sysstat.service.wants/sysstat-summary.timer  /lib/systemd/system/sysstat-summary.timer.\r\n"]
[116.209076, "o", "Created symlink /etc/systemd/system/multi-user.target.wants/sysstat.service  /lib/systemd/system/sysstat.service.\r\n"]
[116.222224, "o", "Setting up libkmod2:amd64 (29-1ubuntu1) ...\r\n"]
[116.223457, "o", "Setting up libgdbm6:amd64 (1.23-1) ...\r\n"]
[116.224614, "o", "Setting up libicu70:amd64 (70.1-2) ...\r\n"]
[116.225777, "o", "Setting up python3-dbus (1.2.18-3build1) ...\r\n"]
[116.34758, "o", "Setting up libgdbm-compat4:amd64 (1.23-1) ...\r\n"]
[116.349756, "o", "Setting up gir1.2-glib-2.0:amd64 (1.72.0-1) ...\r\n"]
[116.351802, "o", "Setting up libcryptsetup12:amd64 (2:2.4.3-1ubuntu1.3) ...\r\n"]
[116.352982, "o", "Setting up libxml2:amd64 (2.9.13+dfsg-1ubuntu0.11) ...\r\n"]
[116.354138, "o", "Setting up libperl5.34:amd64 (5.34.0-3ubuntu1.5) ...\r\n"]
[116.355317, "o", "Setting up systemd (249.11-0ubuntu3.17) ...\r\n"]
[116.365797, "o", "Created symlink /etc/systemd/system/getty.target.wants/getty@tty1.service  /lib/systemd/system/getty@.service.\r\n"]
[116.368957, "o", "Created symlink /etc/systemd/system/multi-user.target.wants/remote-fs.target  /lib/systemd/system/remote-fs.target.\r\n"]
[116.374554, "o", "Created symlink /etc/systemd/system/dbus-org.freedesktop.resolve1.service  /lib/systemd/system/systemd-resolved.service.\r\nCreated symlink /etc/systemd/system/multi-user.target.wants/systemd-resolved.service  /lib/systemd/system/systemd-resolved.service.\r\n"]
[116.379672, "o", "ln: failed to create symbolic link '/etc/resolv.conf': Device or resource busy\r\n"]
[116.385209, "o", "Created symlink /etc/systemd/system/sysinit.target.wants/systemd-pstore.service  /lib/systemd/system/systemd-pstore.service.\r\n"]
[116.402403, "o", "Initializing machine ID from D-Bus machine ID.\r\n"]
[116.606857, "o", "Setting up perl (5.34.0-3ubuntu1.5) ...\r\n"]
[116.61521, "o", "Setting up python3-gi (3.42.1-0ubuntu1) ...\r\n"]
[116.763906, "o", "Setting up shared-mime-info (2.1-2) ...\r\n"]
[117.176664, "o", "Setting up systemd-timesyncd (249.11-0ubuntu3.17) ...\r\n"]
[117.326872, "o", "Created symlink /etc/systemd/system/dbus-org.freedesktop.timesync1.service  /lib/systemd/system/systemd-timesyncd.service.\r\nCreated symlink /etc/systemd/system/sysinit.target.wants/systemd-timesyncd.service  /lib/systemd/system/systemd-timesyncd.service.\r\n"]
[117.330856, "o", "Setting up parallel (20210822+ds-2) ...\r\n"]
[117.333184, "o", "Setting up networkd-dispatcher (2.1-2ubuntu0.22.04.2) ...\r\n"]
[117.431401, "o", "Created symlink /etc/systemd/system/multi-user.target.wants/networkd-dispatcher.service  /lib/systemd/system/networkd-dispatcher.service.\r\n"]
[117.435575, "o", "Processing triggers for libc-bin (2.35-0ubuntu3.11) ...\r\n"]
[117.483602, "o", "\u001b[?2004h"]
[117.483714, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
[119.591845, "i", "cat /home/user/policy/reports/after_remediation.log\n"]
[119.592305, "o", "cat /home/user/policy/reports/after_remediation.log\r\n\u001b[?2004l\r"]
[119.593349, "o", "\r\n/home/user/policy/configs/app1.ini\r\n/home/user/policy/configs/app2.ini\r\n/home/user/policy/configs/app3.ini\r\nSummary:\r\nFILES_SCANNED=3\r\nREMEDIATED=0\r\nCOMPLIANT=1\r\n"]
[119.593596, "o", "\u001b[?2004h"]
[119.593635, "o", "root@e57fa77a-c8b3-43bf-9486-659f3eb3ba8b:~# "]
