Previous response had warnings:
WARNINGS: - Extra text detected before JSON object
- Extra text detected after JSON object

New Terminal Output:

root@e75d6e9d-7dbc-477b-974d-7a2fec15c896:/home/user/source_files# cat > /tmp/create_summary_fixed.sh << 'EOF'
> #!/bin/bash
>
> AUDIT_DIR="/home/user/audit_2023Q4"
> LOG_FILE="${AUDIT_DIR}/checksum_audit.log"
> SUMMARY_FILE="${AUDIT_DIR}/summary.json"
>
> # Read start time from log file
> START_TIME_FROM_LOG=$(grep "^START_TIME  :" "${LOG_FILE}" | awk -F': ' '{print $2}')
> END_TIME="$(date -u +'%Y-%m-%dT%H:%M:%SZ')"
>
> # Count file records
> FILE_COUNT=$(grep -c "^[^ ]* SHA256=[a-f0-9]*  MD5=[a-f0-9]*" "${LOG_FILE}")
> TOTAL_BYTES=0
>
> # Compute SHA256 hash of the current log content
> LOG_CONTENT_SHA256=$(sha256sum "${LOG_FILE}" | awk '{print $1}')
>
> # Derive HMAC-SHA256 key
> SECRET_KEY_CONTENT=$(cat /home/user/source_files/.secret 2>/dev/null | tr -d ' \n\r\t')
> if [[ -z "${SECRET_KEY_CONTENT}" ]]; then
>     SECRET_KEY_CONTENT=""
> fi
> CURRENT_UTC_DATE=$(date -u +'%Y%m%d')
> HMAC_KEY="${SECRET_KEY_CONTENT}${CURRENT_UTC_DATE}"
>
> # Compute HMAC-SHA256 signature
> LOG_CONTENT_FOR_HMAC=$(cat "${LOG_FILE}")
> echo -n "${LOG_CONTENT_FOR_HMAC}" | openssl dgst -sha256 -hmac "${HMAC_KEY}" | awk '{print $2}' > /tmp/hmac_result.txt 2>/dev/null
> HMAC_SIGNATURE=$(cat /tmp/hmac_result.txt 2>/dev/null)
> rm -f /tmp/hmac_result.txt
>
> # Create JSON summary using jq if available, otherwise use printf
> if command -v jq &> /dev/null; then
>     jq -n \
>         --arg period "2023-Q4" \
>         --argjson file_count "${FILE_COUNT}" \
>         --argjson total_bytes "${TOTAL_BYTES}" \
>         --arg start_time "${START_TIME_FROM_LOG}" \
>         --arg end_time "${END_TIME}" \
>         --arg status "COMPLETED" \
>         --arg log_checksum "${LOG_CONTENT_SHA256}" \
>         --arg signature "${HMAC_SIGNATURE}" \
>         '{
>             period: $period,
>             file_count: $file_count,
>             total_bytes: $total_bytes,
>             start_time: $start_time,
>             end_time: $end_time,
>             status: $status,
>             log_checksum: $log_checksum,
>             signature: $signature
>         }' > "${SUMMARY_FILE}"
> else
>     # Fallback to printf (ensure variables are properly escaped for JSON)
>     # Basic escaping (may fail if variables contain special JSON chars like quotes)
>     # For this task, assume variables are simple hex strings or numbers
>     START_TIME_ESC=${START_TIME_FROM_LOG//"/\\\"}
>     END_TIME_ESC=${END_TIME//"/\\\"}
>     LOG_CHECKSUM_ESC=${LOG_CONTENT_SHA256//"/\\\"}
>     HMAC_SIG_ESC=${HMAC_SIGNATURE//"/\\\"}
>
>     printf '{\n  "period": "2023-Q4",\n  "file_count": %d,\n  "total_bytes": %d,\n  "start_time": "%s",\n  "end_time": "%s",\n  "status": "COMPLETED",\n  "log
_checksum": "%s",\n  "signature": "%s"\n}\n' \
>           "${FILE_COUNT}" "${TOTAL_BYTES}" "${START_TIME_ESC}" "${END_TIME_ESC}" "${LOG_CHECKSUM_ESC}" "${HMAC_SIG_ESC}" > "${SUMMARY_FILE}"
> fi
>
> # Verify JSON formatting
> if [[ -s "${SUMMARY_FILE}" ]]; then
>     echo "JSON summary created at ${SUMMARY_FILE}"
>     if command -v jq &> /dev/null; then
>         jq . "${SUMMARY_FILE}"
>     else
>         cat "${SUMMARY_FILE}"
>     fi
> else
>     echo "Failed to create JSON summary"
> fi
> EOF
root@e75d6e9d-7dbc-477b-974d-7a2fec15c896:/home/user/source_files# chmod +x /tmp/create_summary_fixed.sh
root@e75d6e9d-7dbc-477b-974d-7a2fec15c896:/home/user/source_files# /tmp/create_summary_fixed.sh
/tmp/create_summary_fixed.sh: line 75: unexpected EOF while looking for matching `"'
/tmp/create_summary_fixed.sh: line 77: syntax error: unexpected end of file
root@e75d6e9d-7dbc-477b-974d-7a2fec15c896:/home/user/source_files#
