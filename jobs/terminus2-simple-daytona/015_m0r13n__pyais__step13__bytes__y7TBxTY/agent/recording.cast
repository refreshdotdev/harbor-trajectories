{"version": 2, "width": 160, "height": 40, "timestamp": 1770669855, "env": {"SHELL": "/bin/bash", "TERM": "tmux-256color"}}
[0.005889, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[0.967311, "i", "clear\r"]
[0.967646, "o", "clear\r\n\u001b[?2004l\r"]
[0.96893, "o", "\u001b[H\u001b[J\u001b[3J"]
[0.96917, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[4.839932, "i", "ls -la\n"]
[4.840205, "o", "ls -la\r\n\u001b[?2004l\r"]
[4.843278, "o", "total 308\r\n"]
[4.843422, "o", "drwxr-xr-x 1 root root     36 Feb  9 20:25 .\r\ndrwxr-xr-x 1 root root     26 Feb  9 20:25 ..\r\n-rw-rw-r-- 1 root root    353 Jan 21 13:43 .codecov.yml\r\n-rw-rw-r-- 1 root root     54 Jan 21 13:43 .dockerignore\r\n-rw-rw-r-- 1 root root    168 Jan 21 13:43 .flake8\r\ndrwxr-xr-x 3 root root     31 Feb  9 20:25 .github\r\n-rw-rw-r-- 1 root root    489 Jan 21 13:43 .gitignore\r\n-rw-rw-r-- 1 root root    163 Jan 21 13:43 .readthedocs.yaml\r\n-rw-rw-r-- 1 root root  21099 Jan 21 13:43 CHANGELOG.txt\r\n-rw-rw-r-- 1 root root   3332 Jan 21 13:43 CODE_OF_CONDUCT.md\r\n-rw-rw-r-- 1 root root    344 Jan 21 13:43 Dockerfile\r\n-rw-rw-r-- 1 root root   1063 Jan 21 13:43 LICENSE\r\n-rw-rw-r-- 1 root root    574 Jan 21 13:43 Makefile\r\n-rw-rw-r-- 1 root root  26370 Jan 21 13:43 README.md\r\ndrwxr-xr-x 2 root root    105 Feb  9 20:25 bench\r\ndrwxr-xr-x 2 root root   4096 Feb  9 20:25 docs\r\ndrwxr-xr-x 2 root root   4096 Feb  9 20:25 examples\r\n-rw-rw-r-- 1 root root    592 Jan 21 13:43 mypy.ini\r\ndrwxr-xr-x 2 root root   4096 Feb  9 20:25 pyais\r\ndrwxr-xr-x 1 root root    162 Feb  9 20:26 pyais.egg-info\r\n"]
[4.843495, "o", "-rw-rw-r-- 1 root root   1580 Jan 21 13:43 pyproject.toml\r\n-rw-rw-r-- 1 root root     39 Jan 21 13:43 pyrightconfig.json\r\n-rw-rw-r-- 1 root root    241 Jan 21 13:43 requirements.txt\r\ndrwxr-xr-x 3 root root   4096 Feb  9 20:25 tests\r\n-rw-rw-r-- 1 root root 190128 Jan 21 13:43 uv.lock\r\n"]
[4.843805, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[7.812875, "i", "cd pyais\n"]
[7.813281, "o", "cd pyais\r\n\u001b[?2004l\r"]
[7.813435, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[8.217509, "i", "ls -la\n"]
[8.217778, "o", "ls -la\r\n\u001b[?2004l\r"]
[8.219679, "o", "total 212\r\ndrwxr-xr-x 2 root root  4096 Feb  9 20:25 .\r\ndrwxr-xr-x 1 root root    36 Feb  9 20:25 ..\r\n-rw-rw-r-- 1 root root   705 Jan 21 13:43 __init__.py\r\n-rw-rw-r-- 1 root root  7503 Jan 21 13:43 ais_decode.py\r\n"]
[8.21974, "o", "-rw-rw-r-- 1 root root  5829 Jan 21 13:43 ais_encode.py\r\n-rw-rw-r-- 1 root root   826 Jan 21 13:43 ais_types.py\r\n-rw-rw-r-- 1 root root 17908 Jan 21 13:43 constants.py\r\n-rw-rw-r-- 1 root root  4392 Jan 21 13:43 decode.py\r\n-rw-rw-r-- 1 root root  5177 Jan 21 13:43 encode.py\r\n-rw-rw-r-- 1 root root  1117 Jan 21 13:43 exceptions.py\r\n-rw-rw-r-- 1 root root  8534 Jan 21 13:43 filter.py\r\n-rw-rw-r-- 1 root root 77303 Jan 21 13:43 messages.py\r\n-rw-rw-r-- 1 root root     0 Jan 21 13:43 py.typed\r\n-rw-rw-r-- 1 root root  3800 Jan 21 13:43 queue.py\r\n-rw-rw-r-- 1 root root 20163 Jan 21 13:43 stream.py\r\n-rw-rw-r-- 1 root root 13014 Jan 21 13:43 tracker.py\r\n-rw-rw-r-- 1 root root 15332 Jan 21 13:43 util.py\r\n"]
[8.220022, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[11.385958, "i", "nano util.py\n"]
[11.38641, "o", "nano util.py\r\n\u001b[?2004l\r"]
[11.387179, "o", "bash: nano: command not found\r\n"]
[11.387611, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[14.998395, "i", "vi util.py\n"]
[14.998716, "o", "vi util.py\r\n\u001b[?2004l\r"]
[14.999398, "o", "bash: vi: command not found\r\n"]
[14.999855, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[18.568273, "i", "cat util.py\n"]
[18.568502, "o", "cat util.py\r\n\u001b[?2004l\r"]
[18.56988, "o", "import base64\r\nimport math\r\nimport typing\r\nfrom collections import OrderedDict\r\nfrom functools import partial, reduce\r\nfrom operator import xor\r\nfrom typing import Any, Generator, Hashable, TYPE_CHECKING, Union, Dict\r\nfrom bitarray import bitarray\r\nfrom pyais.constants import COUNTRY_MAPPING, SyncState\r\nfrom pyais.exceptions import NonPrintableCharacterException\r\nif TYPE_CHECKING:\r\n    BaseDict = OrderedDict[Hashable, Any]\r\nelse:\r\n    BaseDict = OrderedDict\r\nfrom_bytes = partial(int.from_bytes, byteorder='big')\r\nfrom_bytes_signed = partial(int.from_bytes, byteorder='big', signed=True)\r\nT = typing.TypeVar('T')\r\n\r\ndef decode_into_bit_array(data: bytes, fill_bits: int=0) -> bitarray:\r\n    \"\"\"\r\n    Decodes a raw AIS message into a bitarray.\r\n    :param data:        Raw AIS message in bytes\r\n    :param fill_bits:   Number of trailing fill bits to be ignored\r\n    :return:\r\n    \"\"\"\r\n    bit_str = ''\r\n    length = len(data)\r\n    for (i, c) in enumerate(data):\r\n        if not 32 <= c <= 126:\r\n            raise NonPrintableCharacterException(f\"Non printable character: '{hex(c)}'\")\r\n        c -= 48 if c < 96 else 56\r\n        c &= 63\r\n        if i == length - 1 and fill_bits:\r\n            c = c >> fill_bits\r\n            bit_str += f'{c:b}'.zfill(6 - fill_bits)\r\n        else:\r\n            bit_str += f'{c:06b}'\r\n    bit_arr = bitarray(bit_str)\r\n    return bit_arr\r\n\r\ndef chunks(sequence: typing.Sequence[T], n: int) -> Generator[typing.Sequence[T], None, None]:\r\n    \"\"\"Yield successive n-sized chunks from sequence.\"\"\"\r\n    return (sequence[i:i + n] for i in range(0, len(sequence), n))\r\n\r\ndef decode_bin_as_ascii6(bit_arr: bitarray) -> str:\r\n    \"\"\"\r\n    Decode binary data as 6 bit ASCII.\r\n    :param bit_arr: array of bits\r\n    :return: ASCII String\r\n    \"\"\"\r\n    string: str = ''\r\n    c: bitarray\r\n    for c in chunks(bit_arr, 6):\r\n        n: int = from_bytes(c.tobytes()) >> 2\r\n        if len(c) != 6:\r\n            n >>= 6 - len(c)\r\n        if n < 32:\r\n            n += 64\r\n        if n == 64:\r\n            break\r\n        string += chr(n)\r\n    return string.strip()\r\n\r\ndef get_int(data: bitarray, ix_low: int, ix_high: int, signed: bool=False) -> int:\r\n    \"\"\"\r\n    Cast a subarray of a bitarray into an integer.\r\n    The bitarray module adds tailing zeros when calling tobytes(), if the bitarray is not a multiple of 8.\r\n    So those need to be shifted away.\r\n    :param data: some bitarray\r\n    :param ix_low: the lower index of the sub-array\r\n    :param ix_high: the upper index of the sub-array\r\n    :param signed: True if the value should be interpreted as a signed integer\r\n    :return: a normal integer (int)\r\n    \"\"\"\r\n    shift: int = (8 - (ix_high - ix_low) % 8) % 8\r\n    data = data[ix_low:ix_high]\r\n    i: int = from_bytes_signed(data) if signed else from_bytes(data)\r\n    return i >> shift\r\n\r\ndef checksum(sentence: bytes) -> int:\r\n    \"\"\"\r\n    Compute the NMEA checksum for a payload.\r\n    :param sentence: The sentence to compute the checksum for. MUST BE bytes.\r\n\r\n    >>> checksum(b's:2573535,c:1671533231')\r\n    8\r\n    \"\"\"\r\n    checksum = reduce(xor, sentence)\r\n    return checksum\r\n\r\ndef compute_checksum(msg: Union[str, bytes]) -> int:\r\n    \"\"\"\r\n    Compute the checksum of a given message.\r\n    This method takes the **whole** message including the leading `!`.\r\n\r\n    >>> compute_checksum(b\"!AIVDM,1,1,,B,15M67FC000G?ufbE`FepT@3n00Sa,0\")\r\n    91\r\n\r\n    :param msg: message\r\n    :return: int value of the checksum. Format as hex with `f'{checksum:02x}'`\r\n    \"\"\"\r\n    if isinstance(msg, str):\r\n        msg = msg.encode()\r\n    msg = msg[1:].split(b'*', 1)[0]\r\n    return reduce(xor, msg)\r\nPAYLOAD_ARMOR = {0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9', 10: ':', 11: ';', 12: '<', 13: '=', 14: '>', 15: '?', 16: '@', 17: 'A', 18: 'B', 19: 'C', 20: 'D', 21: 'E', 22: 'F', 23: 'G', 24: 'H', 25: 'I', 26: 'J', 27: 'K', 28: 'L', 29: 'M', 30: 'N', 31: 'O', 32: 'P', 33: 'Q', 34: 'R', 35: 'S', 36: 'T', 37: 'U', 38: 'V', 39: 'W', 40: '`', 41: 'a', 42: 'b', 43: 'c', 44: 'd', 45: 'e', 46: 'f', 47: 'g', 48: 'h', 49: 'i', 50: 'j', 51: 'k', 52: 'l', 53: 'm', 54: 'n', 55: 'o', 56: 'p', 57: 'q', 58: 'r', 59: 's', 60: 't', 61: 'u', 62: 'v', 63: 'w'}\r\nSIX_BIT_ENCODING = {'@': 0, 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7, 'H': 8, 'I': 9, 'J': 10, 'K': 11, 'L': 12, 'M': 13, 'N': 14, 'O': 15, 'P': 16, 'Q': 17, 'R': 18, 'S': 19, 'T': 20, 'U': 21, 'V': 22, 'W': 23, 'X': 24, 'Y': 25, 'Z': 26, '[': 27, '\\\\': 28, ']': 29, '^': 30, '_': 31, ' ': 32, '!': 33, '\"': 34, '#': 35, '$': 36, '%': 37, '&': 38, \"'\": 39, '(': 40, ')': 41, '*': 42, '+': 43, ',': 44, '-': 45, '.': 46, '/': 47, '0': 48, '1': 49, '2': 50, '3': 51, '4': 52, '5': 53, '6': 54, '7': 55, '8': 56, '9': 57, ':': 58, ';': 59, '<': 60, '=': 61, '>': 62, '?': 63}\r\n\r\ndef to_six_bit(char: str) -> str:\r\n    \"\"\"\r\n    Encode a single character as six-bit bitstring.\r\n    @param char: The character to encode\r\n    @return: The six-bit representation as string\r\n    \"\"\"\r\n    char = char.upper()\r\n    try:\r\n        encoding = SIX_BIT_ENCODING[char]\r\n        return f'{encoding:06b}'\r\n    except KeyError:\r\n        raise ValueError(f\"received char '{char}' that cant be encoded\")\r\n\r\ndef encode_ascii_6(bits: bitarray) -> typing.Tuple[str, int]:\r\n    \"\"\"\r\n    Transform the bitarray to an ASCII-encoded bit vector.\r\n    Each character represents six bits of data.\r\n    @param bits: The bitarray to convert to an ASCII-encoded bit vector.\r\n    @return: ASCII-encoded bit vector and the number of fill bits required to pad the data payload to a 6 bit boundary.\r\n    \"\"\"\r\n    out = ''\r\n    chunk: bitarray\r\n    padding = 0\r\n    for chunk in chunks(bits, 6):\r\n        padding = 6 - len(chunk)\r\n        num = from_bytes(chunk.tobytes()) >> 2\r\n        armor = PAYLOAD_ARMOR[num]\r\n        out += armor\r\n    return (out, padding)\r\n\r\ndef int_to_bytes(val: typing.Union[int, bytes]) -> int:\r\n    \"\"\"\r\n    Convert a bytes object to an integer. Byteorder is big.\r\n\r\n    @param val: A bytes object to convert to an int. If the value is already an int, this is a NO-OP.\r\n    @return: Integer representation of `val`\r\n    \"\"\"\r\n    if isinstance(val, int):\r\n        return val\r\n    return int.from_bytes(val, 'big')\r\n\r\ndef bits2bytes(bits: typing.Union[str, bitarray]) -> bytes:\r\n    \"\"\"\r\n    Convert a bitstring or a bitarray to bytes.\r\n    >>> bits2bytes('00100110')\r\n    b'&'\r\n    \"\"\"\r\n    bits = bitarray(bits)\r\n    return bits.tobytes()\r\n\r\ndef bytes2bits(in_bytes: bytes, default: typing.Optional[bitarray]=None) -> bitarray:\r\n    \"\"\"\r\n    TODO: Implement this function\r\n    \"\"\"\r\n    ...\r\n\r\ndef b64encode_str(val: bytes, encoding: str='utf-8') -> str:\r\n    \"\"\"BASE64 encoded a bytes string and returns the result as UTF-8 string\"\"\"\r\n    return base64.b64encode(val).decode(encoding)\r\n\r\ndef coerce_val(val: typing.Any, d_type: typing.Type[T]) -> T:\r\n    \"\"\"Forces a given value in a given datatype\"\"\"\r\n    if d_type == bytes and (not isinstance(val, bytes)):\r\n        raise ValueError(f'Expected bytes, but got: {type(val)}')\r\n    return d_type(val)\r\n\r\ndef int_to_bin(val: typing.Union[int, bool], width: int, signed: bool=True) -> bitarray:\r\n    \"\"\"\r\n    Convert an integer or boolean value to binary. If the value is too great to fit into\r\n    `width` bits, the maximum possible number that still fits is used.\r\n\r\n    @param val:     Any integer or boolean value.\r\n    @param width:   The bit width. If less than width bits are required, leading zeros are added.\r\n    @param signed:  Set to True/False if the value is signed or not.\r\n    @return:        The binary representation of value with exactly width bits. Type is bitarray.\r\n    \"\"\"\r\n    (n_bytes, mod) = divmod(width, 8)\r\n    if mod > 0:\r\n        n_bytes += 1\r\n    mask = (1 << width) - 1\r\n    if val >= mask:\r\n        return bitarray('1' * width)\r\n    bits = bitarray(endian='big')\r\n    bits.frombytes(val.to_bytes(n_bytes, 'big', signed=signed))\r\n    return bits[8 - mod if mod else 0:]\r\n\r\ndef str_to_bin(val: str, width: int, trailing_spaces: bool=False) -> bitarray:\r\n    \"\"\"\r\n    Convert a string value to binary using six-bit ASCII encoding up to `width` chars.\r\n\r\n    @param val:               The string to first convert to six-bit ASCII and then to binary.\r\n    @param width:             The width of the full string\r\n    @param trailing_spaces:   If the string has fewer characters than width, trailing '@' are added\r\n    @return:        The binary representation of value with exactly width bits. Type is bitarray.\r\n    \"\"\"\r\n    out = bitarray(endian='big')\r\n    num_chars = int(width / 6)\r\n    if trailing_spaces:\r\n        for _ in range(num_chars - len(val)):\r\n            val += '@'\r\n    for char in val[:num_chars]:\r\n        txt = to_six_bit(char)\r\n        out += bitarray(txt)\r\n    return out\r\n\r\ndef chk_to_int(chk_str: bytes) -> typing.Tuple[int, int]:\r\n    \"\"\"\r\n    Converts a checksum string to a tuple of (fillbits, checksum).\r\n    >>> chk_to_int(b\"0*1B\")\r\n    (0, 27)\r\n    \"\"\"\r\n    if not len(chk_str):\r\n        return (0, -1)\r\n    try:\r\n        (a, b) = chk_str.split(b'*')\r\n    except ValueError:\r\n        return (0, -1)\r\n    try:\r\n        fill_bits: int = int(a)\r\n    except ValueError:\r\n        fill_bits = 0\r\n    try:\r\n        checksum = int(b, 16)\r\n    except (IndexError, ValueError):\r\n        checksum = -1\r\n    return (fill_bits, checksum)\r\nSYNC_MASK = 3\r\nTIMEOUT_MASK = 7\r\nMSG_MASK = 16383\r\nSLOT_INCREMENT_MASK = 8191\r\n\r\ndef get_sotdma_comm_state(radio: int) -> Dict[str, typing.Optional[int]]:\r\n    \"\"\"\r\n    The SOTDMA communication state is structured as follows:\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n    | Parameter         |  Number of bits      |  Description                                                                                   |\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n    | Sync state        |  2                   |  0 UTC direct                                                                                  |\r\n    |                   |                      |  1 UTC indirect                                                                                |\r\n    |                   |                      |  2 Station is synchronized to a base station                                                   |\r\n    |                   |                      |  3 Station is synchronized to another station based on the highest number of received stations |\r\n    | Slot time-out     |  3                   |  Specifies frames remaining until a new slot is selected                                       |\r\n    |                   |                      |  0 means that this was the last transmission in this slot                                      |\r\n    |                   |                      |  1-7 means that 1 to 7 frames respectively are left until slot change                          |\r\n    | Sub message       |  14                  |  14 The sub message depends on the current value in slot time-out                              |\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n\r\n    The slot time-out defines how to interpret the sub message:\r\n    +-----------------+---------------------------------------------------------------------------+\r\n    | Slot time-out   |  Description                                                              |\r\n    +-----------------+---------------------------------------------------------------------------+\r\n    | 3, 5, 7         |  Number of receiving stations (not own station) (between 0 and 16 383)    |\r\n    | 2, 4, 6         |  Slot number Slot number used for this transmission (between 0 and 2 249) |\r\n    | 1               |  UTC hour (bits 13 to 9) and minute (bits 8 to 2)                         |\r\n    | 0               |  Next frame                                                               |\r\n    +-----------------+---------------------------------------------------------------------------+\r\n\r\n    You may refer to:\r\n    - https://github.com/M0r13n/pyais/issues/17\r\n    - https://www.itu.int/dms_pubrec/itu-r/rec/m/R-REC-M.1371-1-200108-S!!PDF-E.pdf\r\n    - https://www.navcen.uscg.gov/?pageName=AISMessagesA#Sync\r\n    \"\"\"\r\n    result = {'received_stations': None, 'slot_number': None, 'utc_hour': None, 'utc_minute': None, 'slot_offset': None, 'slot_timeout': 0, 'sync_state': 0}\r\n    sync_state = radio >> 17 & SYNC_MASK\r\n    slot_timeout = radio >> 14 & TIMEOUT_MASK\r\n    sub_msg = radio & MSG_MASK\r\n    if slot_timeout == 0:\r\n        result['slot_offset'] = sub_msg\r\n    elif slot_timeout == 1:\r\n        result['utc_hour'] = sub_msg >> 9 & 31\r\n        result['utc_minute'] = sub_msg >> 2 & 63\r\n    elif slot_timeout in (2, 4, 6):\r\n        result['slot_number'] = sub_msg\r\n    elif slot_timeout in (3, 5, 7):\r\n        result['received_stations'] = sub_msg\r\n    else:\r\n        raise ValueError('Slot timeout can only be an integer between 0 and 7')\r\n    result['sync_state'] = SyncState(sync_state)\r\n    result['slot_timeout'] = slot_timeout\r\n    return result\r\n\r\ndef get_itdma_comm_state(radio: int) -> Dict[str, typing.Optional[int]]:\r\n    \"\"\"\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n    |    Parameter    | Bits |                                  Description                                   |\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n    | Sync state      |   2  | 0 UTC direct                                                                   |\r\n    |                 |      | 1 UTC indirec                                                                  |\r\n    |                 |      | 2 Station is synchronized to a base station                                    |\r\n    |                 |      | 3 Station is synchronized to another station                                   |\r\n    | Slot increment  |  13  | Offset to next slot to be used, or zero (0) if no more transmissions           |\r\n    | Number of slots |   3  | Number of consecutive slots to allocate. (0 = 1 slot, 1 = 2 slots,2 = 3 slots, |\r\n    |                 |      | 3 = 4 slots, 4 = 5 slots)                                                      |\r\n    | Keep flag       |   1  | Set to TRUE = 1 if the slot remains allocated for one additional frame         |\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n\r\n    You may refer to:\r\n    - https://github.com/M0r13n/pyais/issues/17\r\n    - https://www.itu.int/dms_pubrec/itu-r/rec/m/R-REC-M.1371-1-200108-S!!PDF-E.pdf\r\n    - https://www.navcen.uscg.gov/?pageName=AISMessagesA#Sync\r\n    \"\"\"\r\n    sync_state = radio >> 17 & SYNC_MASK\r\n    slot_increment = radio >> 4 & SLOT_INCREMENT_MASK\r\n    num_slots = radio >> 1 & TIMEOUT_MASK\r\n    keep_flag = radio & 1\r\n    return {'keep_flag': keep_flag, 'sync_state': sync_state, 'slot_increment': slot_increment, 'num_slots': num_slots, 'keep_flag': keep_flag}\r\n\r\ndef get_first_three_digits(num: int) -> int:\r\n    if num < 1000:\r\n        return num\r\n    digits = int(math.log10(num)) + 1\r\n    return int(num // 10 ** (digits - 3))\r\n\r\ndef get_country(mmsi: int) -> typing.Tuple[str, str]:\r\n    return COUNTRY_MAPPING.get(get_first_three_digits(mmsi), ('NA', 'Unknown'))\r\n\r\ndef is_auxiliary_craft(mmsi: int) -> bool:\r\n    return 980000000 <= mmsi <= 989999999"]
[18.570069, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[34.366935, "i", "echo 'def bytes2bits(data: bytes) -> typing.List[int]:\n    return [int(bit) for byte in data for bit in f\"{byte:08b}\"]\n' >> util.py\n"]
[34.367584, "o", "echo 'def bytes2bits(data: bytes) -> typing.List[int]:\r\n\u001b[?2004l\r"]
[34.367687, "o", "\u001b[?2004h> "]
[34.368069, "o", "    return [int(bit) for byte in data for bit in f\"{byte:08b}\"]\r\n\u001b[?2004l\r"]
[34.36816, "o", "\u001b[?2004h> "]
[34.368236, "o", "' >> util.py\r\n\u001b[?2004l\r"]
[34.378604, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[44.680844, "i", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\n"]
[44.681105, "o", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\r\n\u001b[?2004l\r"]
[44.870698, "o", "\u001b[1m===================================================================== test session starts ======================================================================\u001b[0m\r\nplatform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.10\r\n"]
[44.872346, "o", "cachedir: .pytest_cache\r\nrootdir: /workspace/repo\r\nconfigfile: pyproject.toml\r\nplugins: mock-3.15.1, timeout-2.4.0\r\n\u001b[1mcollecting ... \u001b[0m"]
[44.872466, "o", "\u001b[1m\rcollected 0 items                                                                                                                                              \u001b[0m\r\n"]
[44.873199, "o", "\r\n"]
[44.873253, "o", "\u001b[33m==================================================================== \u001b[33mno tests ran\u001b[0m\u001b[33m in 0.00s\u001b[0m\u001b[33m =====================================================================\u001b[0m\r\n"]
[44.887664, "o", "\u001b[31mERROR: file or directory not found: tests/test_decode.py::TestAIS::test_bytes2bits\r\n\u001b[0m\r\n"]
[44.903575, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[59.145542, "i", "cd /workspace/repo\n"]
[59.145844, "o", "cd /workspace/repo\r\n\u001b[?2004l\r"]
[59.14602, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[59.60214, "i", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\n"]
[59.602733, "o", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\r\n\u001b[?2004l\r"]
[59.733071, "o", "\u001b[1m===================================================================== test session starts ======================================================================\u001b[0m\r\nplatform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.10\r\n"]
[59.73484, "o", "cachedir: .pytest_cache\r\nrootdir: /workspace/repo\r\nconfigfile: pyproject.toml\r\nplugins: mock-3.15.1, timeout-2.4.0\r\n"]
[59.734895, "o", "\u001b[1mcollecting ... \u001b[0m"]
[59.997547, "o", "\u001b[1m\rcollected 0 items / 1 error                                                                                                                                    \u001b[0m\r\n"]
[59.998001, "o", "\r\n"]
[59.998063, "o", "============================================================================ ERRORS ============================================================================\r\n\u001b[31m\u001b[1m____________________________________________________________ ERROR collecting tests/test_decode.py _____________________________________________________________\u001b[0m\r\n\u001b[31m/usr/local/lib/python3.10/site-packages/_pytest/python.py:507: in importtestmodule\r\n    mod = import_path(\r\n/usr/local/lib/python3.10/site-packages/_pytest/pathlib.py:587: in import_path\r\n    importlib.import_module(module_name)\r\n/usr/local/lib/python3.10/importlib/__init__.py:126: in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n<frozen importlib._bootstrap>:1050: in _gcd_import\r\n    ???\r\n<frozen importlib._bootstrap>:1027: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:1006: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:688: in _load_unlocked\r\n    ???\r\n/usr/local/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:197: in exec_module\r\n    exec(co, module.__dict__)\r\ntests/test_decode.py:9: in <module>\r\n    from pyais import NMEAMessage, encode_dict, encode_msg\r\npyais/__init__.py:1: in <module>\r\n    from pyais.messages import NMEAMessage, ANY_MESSAGE, AISSentence, TagBlock\r\npyais/messages.py:16: in <module>\r\n    from pyais.util import checksum, decode_into_bit_array, compute_checksum, get_itdma_comm_state, get_sotdma_comm_state, int_to_bin, str_to_bin, \\\r\nE     File \"/workspace/repo/pyais/util.py\", line 326\r\nE       return 980000000 <= mmsi <= 989999999def bytes2bits(data: bytes) -> typing.List[int]:\r\nE                                           ^\r\nE   SyntaxError: invalid decimal literal\u001b[0m\r\n"]
[59.998232, "o", "\u001b[36m\u001b[1m=================================================================== short test summary info ====================================================================\u001b[0m\r\n\u001b[31mERROR\u001b[0m tests/test_decode.py\r\n\u001b[31m======================================================================= \u001b[31m\u001b[1m1 error\u001b[0m\u001b[31m in 0.27s\u001b[0m\u001b[31m =======================================================================\u001b[0m\r\n"]
[60.014738, "o", "\u001b[31mERROR: found no collectors for /workspace/repo/tests/test_decode.py::TestAIS::test_bytes2bits\r\n\u001b[0m\r\n"]
[60.033093, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[79.165618, "i", "sed -i '/return 980000000 <= mmsi <= 989999999/a \\\\n' util.py\n"]
[79.166179, "o", "sed -i '/return 980000000 <= mmsi <= 989999999/a \\\\n' util.py\r\n\u001b[?2004l\r"]
[79.168282, "o", "sed: can't read util.py: No such file or directory\r\n"]
[79.168639, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[112.619791, "i", "cd pyais\n"]
[112.619953, "o", "cd pyais\r\n\u001b[?2004l\r"]
[112.620073, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[113.156094, "i", "sed -i '/return 980000000 <= mmsi <= 989999999/a \\\\n' util.py\n"]
[113.156714, "o", "sed -i '/return 980000000 <= mmsi <= 989999999/a \\\\n' util.py\r\n\u001b[?2004l\r"]
[113.160275, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[137.2807, "i", "cd /workspace/repo\n"]
[137.281082, "o", "cd /workspace/repo\r\n\u001b[?2004l\r"]
[137.28123, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[137.765591, "i", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\n"]
[137.765849, "o", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\r\n\u001b[?2004l\r"]
[137.881896, "o", "\u001b[1m===================================================================== test session starts ======================================================================\u001b[0m\r\nplatform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.10\r\n"]
[137.883657, "o", "cachedir: .pytest_cache\r\nrootdir: /workspace/repo\r\nconfigfile: pyproject.toml\r\nplugins: mock-3.15.1, timeout-2.4.0\r\n\u001b[1mcollecting ... \u001b[0m"]
[137.992169, "o", "\u001b[1m\rcollected 0 items / 1 error                                                                                                                                    \u001b[0m\r\n"]
[137.992614, "o", "\r\n"]
[137.992676, "o", "============================================================================ ERRORS ============================================================================\r\n\u001b[31m\u001b[1m____________________________________________________________ ERROR collecting tests/test_decode.py _____________________________________________________________\u001b[0m\r\n\u001b[31m/usr/local/lib/python3.10/site-packages/_pytest/python.py:507: in importtestmodule\r\n    mod = import_path(\r\n/usr/local/lib/python3.10/site-packages/_pytest/pathlib.py:587: in import_path\r\n    importlib.import_module(module_name)\r\n/usr/local/lib/python3.10/importlib/__init__.py:126: in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n<frozen importlib._bootstrap>:1050: in _gcd_import\r\n    ???\r\n<frozen importlib._bootstrap>:1027: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:1006: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:688: in _load_unlocked\r\n    ???\r\n/usr/local/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:197: in exec_module\r\n    exec(co, module.__dict__)\r\ntests/test_decode.py:9: in <module>\r\n    from pyais import NMEAMessage, encode_dict, encode_msg\r\npyais/__init__.py:1: in <module>\r\n    from pyais.messages import NMEAMessage, ANY_MESSAGE, AISSentence, TagBlock\r\npyais/messages.py:16: in <module>\r\n    from pyais.util import checksum, decode_into_bit_array, compute_checksum, get_itdma_comm_state, get_sotdma_comm_state, int_to_bin, str_to_bin, \\\r\nE     File \"/workspace/repo/pyais/util.py\", line 326\r\nE       return 980000000 <= mmsi <= 989999999def bytes2bits(data: bytes) -> typing.List[int]:\r\nE                                           ^\r\nE   SyntaxError: invalid decimal literal\u001b[0m\r\n"]
[137.992841, "o", "\u001b[36m\u001b[1m=================================================================== short test summary info ====================================================================\u001b[0m\r\n\u001b[31mERROR\u001b[0m tests/test_decode.py\r\n\u001b[31m======================================================================= \u001b[31m\u001b[1m1 error\u001b[0m\u001b[31m in 0.11s\u001b[0m\u001b[31m =======================================================================\u001b[0m\r\n"]
[138.008511, "o", "\u001b[31mERROR: found no collectors for /workspace/repo/tests/test_decode.py::TestAIS::test_bytes2bits\r\n\u001b[0m\r\n"]
[138.0263, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[156.403664, "i", "cd pyais\n"]
[156.403933, "o", "cd pyais\r\n\u001b[?2004l\r"]
[156.404085, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[156.858051, "i", "sed -i '/return 980000000 <= mmsi <= 989999999/a\\\\n' util.py\n"]
[156.858705, "o", "sed -i '/return 980000000 <= mmsi <= 989999999/a\\\\n' util.py\r\n\u001b[?2004l\r"]
[156.86183, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[185.444554, "i", "cd /workspace/repo\n"]
[185.444835, "o", "cd /workspace/repo\r\n\u001b[?2004l\r"]
[185.444933, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[185.930811, "i", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\n"]
[185.931676, "o", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\r\n"]
[185.932234, "o", "\u001b[?2004l\r"]
[186.056174, "o", "\u001b[1m===================================================================== test session starts ======================================================================\u001b[0m\r\nplatform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.10\r\n"]
[186.057874, "o", "cachedir: .pytest_cache\r\nrootdir: /workspace/repo\r\nconfigfile: pyproject.toml\r\nplugins: mock-3.15.1, timeout-2.4.0\r\n"]
[186.05803, "o", "\u001b[1mcollecting ... \u001b[0m"]
[186.166647, "o", "\u001b[1m\rcollected 0 items / 1 error                                                                                                                                    \u001b[0m\r\n"]
[186.170027, "o", "\r\n============================================================================ ERRORS ============================================================================\r\n\u001b[31m\u001b[1m____________________________________________________________ ERROR collecting tests/test_decode.py _____________________________________________________________\u001b[0m\r\n\u001b[31m/usr/local/lib/python3.10/site-packages/_pytest/python.py:507: in importtestmodule\r\n    mod = import_path(\r\n/usr/local/lib/python3.10/site-packages/_pytest/pathlib.py:587: in import_path\r\n    importlib.import_module(module_name)\r\n/usr/local/lib/python3.10/importlib/__init__.py:126: in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n<frozen importlib._bootstrap>:1050: in _gcd_import\r\n    ???\r\n<frozen importlib._bootstrap>:1027: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:1006: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:688: in _load_unlocked\r\n    ???\r\n/usr/local/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:197: in exec_module\r\n    exec(co, module.__dict__)\r\ntests/test_decode.py:9: in <module>\r\n    from pyais import NMEAMessage, encode_dict, encode_msg\r\npyais/__init__.py:1: in <module>\r\n    from pyais.messages import NMEAMessage, ANY_MESSAGE, AISSentence, TagBlock\r\npyais/messages.py:16: in <module>\r\n    from pyais.util import checksum, decode_into_bit_array, compute_checksum, get_itdma_comm_state, get_sotdma_comm_state, int_to_bin, str_to_bin, \\\r\nE     File \"/workspace/repo/pyais/util.py\", line 326\r\nE       return 980000000 <= mmsi <= 989999999def bytes2bits(data: bytes) -> typing.List[int]:\r\nE                                           ^\r\nE   SyntaxError: invalid decimal literal\u001b[0m\r\n\u001b[36m\u001b[1m=================================================================== short test summary info ====================================================================\u001b[0m\r\n\u001b[31mERROR\u001b[0m tests/test_decode.py\r\n\u001b[31m======================================================================= \u001b[31m\u001b[1m1 error\u001b[0m\u001b[31m in 0.11s\u001b[0m\u001b[31m =======================================================================\u001b[0m\r\n"]
[186.184194, "o", "\u001b[31mERROR: found no collectors for /workspace/repo/tests/test_decode.py::TestAIS::test_bytes2bits\r\n\u001b[0m\r\n"]
[186.201976, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[198.143228, "i", "cd pyais\n"]
[198.143509, "o", "cd pyais\r\n\u001b[?2004l\r"]
[198.143728, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[198.654192, "i", "vi util.py\n"]
[198.654408, "o", "vi util.py\r\n\u001b[?2004l\r"]
[198.654894, "o", "bash: vi: command not found\r\n"]
[198.655285, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[216.037482, "i", "ed util.py\n"]
[216.037706, "o", "ed util.py\r\n\u001b[?2004l\r"]
[216.038288, "o", "bash: ed: command not found\r\n"]
[216.038734, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[224.271317, "i", "ex util.py\n"]
[224.271604, "o", "ex util.py\r\n\u001b[?2004l\r"]
[224.272246, "o", "bash: ex: command not found\r\n"]
[224.272678, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[237.560004, "i", "cat util.py\n"]
[237.56034, "o", "cat util.py\r\n\u001b[?2004l\r"]
[237.562119, "o", "import base64\r\nimport math\r\nimport typing\r\nfrom collections import OrderedDict\r\nfrom functools import partial, reduce\r\nfrom operator import xor\r\nfrom typing import Any, Generator, Hashable, TYPE_CHECKING, Union, Dict\r\nfrom bitarray import bitarray\r\nfrom pyais.constants import COUNTRY_MAPPING, SyncState\r\nfrom pyais.exceptions import NonPrintableCharacterException\r\nif TYPE_CHECKING:\r\n    BaseDict = OrderedDict[Hashable, Any]\r\nelse:\r\n    BaseDict = OrderedDict\r\nfrom_bytes = partial(int.from_bytes, byteorder='big')\r\nfrom_bytes_signed = partial(int.from_bytes, byteorder='big', signed=True)\r\nT = typing.TypeVar('T')\r\n\r\ndef decode_into_bit_array(data: bytes, fill_bits: int=0) -> bitarray:\r\n    \"\"\"\r\n    Decodes a raw AIS message into a bitarray.\r\n    :param data:        Raw AIS message in bytes\r\n    :param fill_bits:   Number of trailing fill bits to be ignored\r\n    :return:\r\n    \"\"\"\r\n    bit_str = ''\r\n    length = len(data)\r\n    for (i, c) in enumerate(data):\r\n        if not 32 <= c <= 126:\r\n            raise NonPrintableCharacterException(f\"Non printable character: '{hex(c)}'\")\r\n        c -= 48 if c < 96 else 56\r\n        c &= 63\r\n        if i == length - 1 and fill_bits:\r\n            c = c >> fill_bits\r\n            bit_str += f'{c:b}'.zfill(6 - fill_bits)\r\n        else:\r\n            bit_str += f'{c:06b}'\r\n    bit_arr = bitarray(bit_str)\r\n    return bit_arr\r\n\r\ndef chunks(sequence: typing.Sequence[T], n: int) -> Generator[typing.Sequence[T], None, None]:\r\n    \"\"\"Yield successive n-sized chunks from sequence.\"\"\"\r\n    return (sequence[i:i + n] for i in range(0, len(sequence), n))\r\n\r\ndef decode_bin_as_ascii6(bit_arr: bitarray) -> str:\r\n    \"\"\"\r\n    Decode binary data as 6 bit ASCII.\r\n    :param bit_arr: array of bits\r\n    :return: ASCII String\r\n    \"\"\"\r\n    string: str = ''\r\n    c: bitarray\r\n    for c in chunks(bit_arr, 6):\r\n        n: int = from_bytes(c.tobytes()) >> 2\r\n        if len(c) != 6:\r\n            n >>= 6 - len(c)\r\n        if n < 32:\r\n            n += 64\r\n        if n == 64:\r\n            break\r\n        string += chr(n)\r\n    return string.strip()\r\n\r\ndef get_int(data: bitarray, ix_low: int, ix_high: int, signed: bool=False) -> int:\r\n    \"\"\"\r\n    Cast a subarray of a bitarray into an integer.\r\n    The bitarray module adds tailing zeros when calling tobytes(), if the bitarray is not a multiple of 8.\r\n    So those need to be shifted away.\r\n    :param data: some bitarray\r\n    :param ix_low: the lower index of the sub-array\r\n    :param ix_high: the upper index of the sub-array\r\n    :param signed: True if the value should be interpreted as a signed integer\r\n    :return: a normal integer (int)\r\n    \"\"\"\r\n    shift: int = (8 - (ix_high - ix_low) % 8) % 8\r\n    data = data[ix_low:ix_high]\r\n    i: int = from_bytes_signed(data) if signed else from_bytes(data)\r\n    return i >> shift\r\n\r\ndef checksum(sentence: bytes) -> int:\r\n    \"\"\"\r\n    Compute the NMEA checksum for a payload.\r\n    :param sentence: The sentence to compute the checksum for. MUST BE bytes.\r\n\r\n    >>> checksum(b's:2573535,c:1671533231')\r\n    8\r\n    \"\"\"\r\n    checksum = reduce(xor, sentence)\r\n    return checksum\r\n\r\ndef compute_checksum(msg: Union[str, bytes]) -> int:\r\n    \"\"\"\r\n    Compute the checksum of a given message.\r\n    This method takes the **whole** message including the leading `!`.\r\n\r\n    >>> compute_checksum(b\"!AIVDM,1,1,,B,15M67FC000G?ufbE`FepT@3n00Sa,0\")\r\n    91\r\n\r\n    :param msg: message\r\n    :return: int value of the checksum. Format as hex with `f'{checksum:02x}'`\r\n    \"\"\"\r\n    if isinstance(msg, str):\r\n        msg = msg.encode()\r\n    msg = msg[1:].split(b'*', 1)[0]\r\n    return reduce(xor, msg)\r\nPAYLOAD_ARMOR = {0: '0', 1: '1', 2: '2', 3: '3', 4: '4', 5: '5', 6: '6', 7: '7', 8: '8', 9: '9', 10: ':', 11: ';', 12: '<', 13: '=', 14: '>', 15: '?', 16: '@', 17: 'A', 18: 'B', 19: 'C', 20: 'D', 21: 'E', 22: 'F', 23: 'G', 24: 'H', 25: 'I', 26: 'J', 27: 'K', 28: 'L', 29: 'M', 30: 'N', 31: 'O', 32: 'P', 33: 'Q', 34: 'R', 35: 'S', 36: 'T', 37: 'U', 38: 'V', 39: 'W', 40: '`', 41: 'a', 42: 'b', 43: 'c', 44: 'd', 45: 'e', 46: 'f', 47: 'g', 48: 'h', 49: 'i', 50: 'j', 51: 'k', 52: 'l', 53: 'm', 54: 'n', 55: 'o', 56: 'p', 57: 'q', 58: 'r', 59: 's', 60: 't', 61: 'u', 62: 'v', 63: 'w'}\r\nSIX_BIT_ENCODING = {'@': 0, 'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7, 'H': 8, 'I': 9, 'J': 10, 'K': 11, 'L': 12, 'M': 13, 'N': 14, 'O': 15, 'P': 16, 'Q': 17, 'R': 18, 'S': 19, 'T': 20, 'U': 21, 'V': 22, 'W': 23, 'X': 24, 'Y': 25, 'Z': 26, '[': 27, '\\\\': 28, ']': 29, '^': 30, '_': 31, ' ': 32, '!': 33, '\"': 34, '#': 35, '$': 36, '%': 37, '&': 38, \"'\": 39, '(': 40, ')': 41, '*': 42, '+': 43, ',': 44, '-': 45, '.': 46, '/': 47, '0': 48, '1': 49, '2': 50, '3': 51, '4': 52, '5': 53, '6': 54, '7': 55, '8': 56, '9': 57, ':': 58, ';': 59, '<': 60, '=': 61, '>': 62, '?': 63}\r\n\r\ndef to_six_bit(char: str) -> str:\r\n    \"\"\"\r\n    Encode a single character as six-bit bitstring.\r\n    @param char: The character to encode\r\n    @return: The six-bit representation as string\r\n    \"\"\"\r\n    char = char.upper()\r\n    try:\r\n        encoding = SIX_BIT_ENCODING[char]\r\n        return f'{encoding:06b}'\r\n    except KeyError:\r\n        raise ValueError(f\"received char '{char}' that cant be encoded\")\r\n\r\ndef encode_ascii_6(bits: bitarray) -> typing.Tuple[str, int]:\r\n    \"\"\"\r\n    Transform the bitarray to an ASCII-encoded bit vector.\r\n    Each character represents six bits of data.\r\n    @param bits: The bitarray to convert to an ASCII-encoded bit vector.\r\n    @return: ASCII-encoded bit vector and the number of fill bits required to pad the data payload to a 6 bit boundary.\r\n    \"\"\"\r\n    out = ''\r\n    chunk: bitarray\r\n    padding = 0\r\n    for chunk in chunks(bits, 6):\r\n        padding = 6 - len(chunk)\r\n        num = from_bytes(chunk.tobytes()) >> 2\r\n        armor = PAYLOAD_ARMOR[num]\r\n        out += armor\r\n    return (out, padding)\r\n\r\ndef int_to_bytes(val: typing.Union[int, bytes]) -> int:\r\n    \"\"\"\r\n    Convert a bytes object to an integer. Byteorder is big.\r\n\r\n    @param val: A bytes object to convert to an int. If the value is already an int, this is a NO-OP.\r\n    @return: Integer representation of `val`\r\n    \"\"\"\r\n    if isinstance(val, int):\r\n        return val\r\n    return int.from_bytes(val, 'big')\r\n\r\ndef bits2bytes(bits: typing.Union[str, bitarray]) -> bytes:\r\n    \"\"\"\r\n "]
[237.562263, "o", "   Convert a bitstring or a bitarray to bytes.\r\n    >>> bits2bytes('00100110')\r\n    b'&'\r\n    \"\"\"\r\n    bits = bitarray(bits)\r\n    return bits.tobytes()\r\n\r\ndef bytes2bits(in_bytes: bytes, default: typing.Optional[bitarray]=None) -> bitarray:\r\n    \"\"\"\r\n    TODO: Implement this function\r\n    \"\"\"\r\n    ...\r\n\r\ndef b64encode_str(val: bytes, encoding: str='utf-8') -> str:\r\n    \"\"\"BASE64 encoded a bytes string and returns the result as UTF-8 string\"\"\"\r\n    return base64.b64encode(val).decode(encoding)\r\n\r\ndef coerce_val(val: typing.Any, d_type: typing.Type[T]) -> T:\r\n    \"\"\"Forces a given value in a given datatype\"\"\"\r\n    if d_type == bytes and (not isinstance(val, bytes)):\r\n        raise ValueError(f'Expected bytes, but got: {type(val)}')\r\n    return d_type(val)\r\n\r\ndef int_to_bin(val: typing.Union[int, bool], width: int, signed: bool=True) -> bitarray:\r\n    \"\"\"\r\n    Convert an integer or boolean value to binary. If the value is too great to fit into\r\n    `width` bits, the maximum possible number that still fits is used.\r\n\r\n    @param val:     Any integer or boolean value.\r\n    @param width:   The bit width. If less than width bits are required, leading zeros are added.\r\n    @param signed:  Set to True/False if the value is signed or not.\r\n    @return:        The binary representation of value with exactly width bits. Type is bitarray.\r\n    \"\"\"\r\n    (n_bytes, mod) = divmod(width, 8)\r\n    if mod > 0:\r\n        n_bytes += 1\r\n    mask = (1 << width) - 1\r\n    if val >= mask:\r\n        return bitarray('1' * width)\r\n    bits = bitarray(endian='big')\r\n    bits.frombytes(val.to_bytes(n_bytes, 'big', signed=signed))\r\n    return bits[8 - mod if mod else 0:]\r\n\r\ndef str_to_bin(val: str, width: int, trailing_spaces: bool=False) -> bitarray:\r\n    \"\"\"\r\n    Convert a string value to binary using six-bit ASCII encoding up to `width` chars.\r\n\r\n    @param val:               The string to first convert to six-bit ASCII and then to binary.\r\n    @param width:             The width of the full string\r\n    @param trailing_spaces:   If the string has fewer characters than width, trailing '@' are added\r\n    @return:        The binary representation of value with exactly width bits. Type is bitarray.\r\n    \"\"\"\r\n    out = bitarray(endian='big')\r\n    num_chars = int(width / 6)\r\n    if trailing_spaces:\r\n        for _ in range(num_chars - len(val)):\r\n            val += '@'\r\n    for char in val[:num_chars]:\r\n        txt = to_six_bit(char)\r\n        out += bitarray(txt)\r\n    return out\r\n\r\ndef chk_to_int(chk_str: bytes) -> typing.Tuple[int, int]:\r\n    \"\"\"\r\n    Converts a checksum string to a tuple of (fillbits, checksum).\r\n    >>> chk_to_int(b\"0*1B\")\r\n    (0, 27)\r\n    \"\"\"\r\n    if not len(chk_str):\r\n        return (0, -1)\r\n    try:\r\n        (a, b) = chk_str.split(b'*')\r\n    except ValueError:\r\n        return (0, -1)\r\n    try:\r\n        fill_bits: int = int(a)\r\n    except ValueError:\r\n        fill_bits = 0\r\n    try:\r\n        checksum = int(b, 16)\r\n    except (IndexError, ValueError):\r\n        checksum = -1\r\n    return (fill_bits, checksum)\r\nSYNC_MASK = 3\r\nTIMEOUT_MASK = 7\r\nMSG_MASK = 16383\r\nSLOT_INCREMENT_MASK = 8191\r\n\r\ndef get_sotdma_comm_state(radio: int) -> Dict[str, typing.Optional[int]]:\r\n    \"\"\"\r\n    The SOTDMA communication state is structured as follows:\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n    | Parameter         |  Number of bits      |  Description                                                                                   |\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n    | Sync state        |  2                   |  0 UTC direct                                                                                  |\r\n    |                   |                      |  1 UTC indirect                                                                                |\r\n    |                   |                      |  2 Station is synchronized to a base station                                                   |\r\n    |                   |                      |  3 Station is synchronized to another station based on the highest number of received stations |\r\n    | Slot time-out     |  3                   |  Specifies frames remaining until a new slot is selected                                       |\r\n    |                   |                      |  0 means that this was the last transmission in this slot                                      |\r\n    |                   |                      |  1-7 means that 1 to 7 frames respectively are left until slot change                          |\r\n    | Sub message       |  14                  |  14 The sub message depends on the current value in slot time-out                              |\r\n    +-------------------+----------------------+------------------------------------------------------------------------------------------------+\r\n\r\n    The slot time-out defines how to interpret the sub message:\r\n    +-----------------+---------------------------------------------------------------------------+\r\n    | Slot time-out   |  Description                                                              |\r\n    +-----------------+---------------------------------------------------------------------------+\r\n    | 3, 5, 7         |  Number of receiving stations (not own station) (between 0 and 16 383)    |\r\n    | 2, 4, 6         |  Slot number Slot number used for this transmission (between 0 and 2 249) |\r\n    | 1               |  UTC hour (bits 13 to 9) and minute (bits 8 to 2)                         |\r\n    | 0               |  Next frame                                                               |\r\n    +-----------------+---------------------------------------------------------------------------+\r\n\r\n    You may refer to:\r\n    - https://github.com/M0r13n/pyais/issues/17\r\n    - https://www.itu.int/dms_pubrec/itu-r/rec/m/R-REC-M.1371-1-200108-S!!PDF-E.pdf\r\n    - https://www.navcen.uscg.gov/?pageName=AISMessagesA#Sync\r\n    \"\"\"\r\n    result = {'received_stations': None, 'slot_number': None, 'utc_hour': None, 'utc_minute': None, 'slot_offset': None, 'slot_timeout': 0, 'sync_state': 0}\r\n    sync_state = radio >> 17 & SYNC_MASK\r\n    slot_timeout = radio >> 14 & TIMEOUT_MASK\r\n    sub_msg = radio & MSG_MASK\r\n    if slot_timeout == 0:\r\n        result['slot_offset'] = sub_msg\r\n    elif slot_timeout == 1:\r\n        result['utc_hour'] = sub_msg >> 9 & 31\r\n        result['utc_minute'] = sub_msg >> 2 & 63\r\n    elif slot_timeout in (2, 4, 6):\r\n        result['slot_number'] = sub_msg\r\n    elif slot_timeout in (3, 5, 7):\r\n        result['received_stations'] = sub_msg\r\n    else:\r\n        raise ValueError('Slot timeout can only be an integer between 0 and 7')\r\n    result['sync_state'] = SyncState(sync_state)\r\n    result['slot_timeout'] = slot_timeout\r\n    return result\r\n\r\ndef get_itdma_comm_state(radio: int) -> Dict[str, typing.Optional[int]]:\r\n    \"\"\"\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n    |    Parameter    | Bits |                                  Description                                   |\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n    | Sync state      |   2  | 0 UTC direct                                                                   |\r\n    |                 |      | 1 UTC indirec                                                                  |\r\n"]
[237.562374, "o", "    |                 |      | 2 Station is synchronized to a base station                                    |\r\n    |                 |      | 3 Station is synchronized to another station                                   |\r\n    | Slot increment  |  13  | Offset to next slot to be used, or zero (0) if no more transmissions           |\r\n    | Number of slots |   3  | Number of consecutive slots to allocate. (0 = 1 slot, 1 = 2 slots,2 = 3 slots, |\r\n    |                 |      | 3 = 4 slots, 4 = 5 slots)                                                      |\r\n    | Keep flag       |   1  | Set to TRUE = 1 if the slot remains allocated for one additional frame         |\r\n    +-----------------+------+--------------------------------------------------------------------------------+\r\n\r\n    You may refer to:\r\n    - https://github.com/M0r13n/pyais/issues/17\r\n    - https://www.itu.int/dms_pubrec/itu-r/rec/m/R-REC-M.1371-1-200108-S!!PDF-E.pdf\r\n    - https://www.navcen.uscg.gov/?pageName=AISMessagesA#Sync\r\n    \"\"\"\r\n    sync_state = radio >> 17 & SYNC_MASK\r\n    slot_increment = radio >> 4 & SLOT_INCREMENT_MASK\r\n    num_slots = radio >> 1 & TIMEOUT_MASK\r\n    keep_flag = radio & 1\r\n    return {'keep_flag': keep_flag, 'sync_state': sync_state, 'slot_increment': slot_increment, 'num_slots': num_slots, 'keep_flag': keep_flag}\r\n\r\ndef get_first_three_digits(num: int) -> int:\r\n    if num < 1000:\r\n        return num\r\n    digits = int(math.log10(num)) + 1\r\n    return int(num // 10 ** (digits - 3))\r\n\r\ndef get_country(mmsi: int) -> typing.Tuple[str, str]:\r\n    return COUNTRY_MAPPING.get(get_first_three_digits(mmsi), ('NA', 'Unknown'))\r\n\r\ndef is_auxiliary_craft(mmsi: int) -> bool:\r\n    return 980000000 <= mmsi <= 989999999def bytes2bits(data: bytes) -> typing.List[int]:\r\n\r\n\r\n\r\n\r\n    return [int(bit) for byte in data for bit in f\"{byte:08b}\"]\r\n\r\n"]
[237.562675, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[257.011954, "i", "cd /workspace/repo\n"]
[257.012208, "o", "cd /workspace/repo\r\n\u001b[?2004l\r"]
[257.012273, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[257.788009, "i", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\n"]
[257.788621, "o", "pytest tests/test_decode.py::TestAIS::test_bytes2bits -v\r\n\u001b[?2004l\r"]
[257.933094, "o", "\u001b[1m===================================================================== test session starts ======================================================================\u001b[0m\r\nplatform linux -- Python 3.10.19, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.10\r\n"]
[257.934858, "o", "cachedir: .pytest_cache\r\nrootdir: /workspace/repo\r\nconfigfile: pyproject.toml\r\nplugins: mock-3.15.1, timeout-2.4.0\r\n\u001b[1mcollecting ... \u001b[0m"]
[258.041912, "o", "\u001b[1m\rcollected 0 items / 1 error                                                                                                                                    \u001b[0m\r\n"]
[258.042334, "o", "\r\n============================================================================ ERRORS ============================================================================\r\n"]
[258.042524, "o", "\u001b[31m\u001b[1m____________________________________________________________ ERROR collecting tests/test_decode.py _____________________________________________________________\u001b[0m\r\n\u001b[31m/usr/local/lib/python3.10/site-packages/_pytest/python.py:507: in importtestmodule\r\n    mod = import_path(\r\n/usr/local/lib/python3.10/site-packages/_pytest/pathlib.py:587: in import_path\r\n    importlib.import_module(module_name)\r\n/usr/local/lib/python3.10/importlib/__init__.py:126: in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\n<frozen importlib._bootstrap>:1050: in _gcd_import\r\n    ???\r\n<frozen importlib._bootstrap>:1027: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:1006: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:688: in _load_unlocked\r\n    ???\r\n/usr/local/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:197: in exec_module\r\n    exec(co, module.__dict__)\r\ntests/test_decode.py:9: in <module>\r\n    from pyais import NMEAMessage, encode_dict, encode_msg\r\npyais/__init__.py:1: in <module>\r\n    from pyais.messages import NMEAMessage, ANY_MESSAGE, AISSentence, TagBlock\r\npyais/messages.py:16: in <module>\r\n    from pyais.util import checksum, decode_into_bit_array, compute_checksum, get_itdma_comm_state, get_sotdma_comm_state, int_to_bin, str_to_bin, \\\r\nE     File \"/workspace/repo/pyais/util.py\", line 326\r\nE       return 980000000 <= mmsi <= 989999999def bytes2bits(data: bytes) -> typing.List[int]:\r\nE                                           ^\r\nE   SyntaxError: invalid decimal literal\u001b[0m\r\n"]
[258.04259, "o", "\u001b[36m\u001b[1m=================================================================== short test summary info ====================================================================\u001b[0m\r\n\u001b[31mERROR\u001b[0m tests/test_decode.py\r\n\u001b[31m======================================================================= \u001b[31m\u001b[1m1 error\u001b[0m\u001b[31m in 0.11s\u001b[0m\u001b[31m =======================================================================\u001b[0m\r\n"]
[258.080098, "o", "\u001b[31mERROR: found no collectors for /workspace/repo/tests/test_decode.py::TestAIS::test_bytes2bits\r\n\u001b[0m\r\n"]
[258.097777, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo# "]
[290.26392, "i", "cd pyais\n"]
[290.264147, "o", "cd pyais\r\n\u001b[?2004l\r"]
[290.264329, "o", "\u001b[?2004h"]
[290.264381, "o", "root@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[295.695867, "i", "echo '    return 980000000 <= mmsi <= 989999999\n\ndef bytes2bits(data: bytes) -> typing.List[int]:\n    return [int(bit) for byte in data for bit in f\"{byte:08b}\"]' > temp.py\n"]
[295.696351, "o", "echo '    return 980000000 <= mmsi <= 989999999\r\n\u001b[?2004l\r"]
[295.696457, "o", "\u001b[?2004h> \r\n\u001b[?2004l\r\u001b[?2004h> "]
[295.696714, "o", "def bytes2bits(data: bytes) -> typing.List[int]:\r\n\u001b[?2004l\r\u001b[?2004h"]
[295.696767, "o", "> "]
[295.697161, "o", "    return [int(bit) for byte in data for bit in f\"{byte:08b}\"]' > temp.py\r\n\u001b[?2004l\r"]
[295.697377, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[299.56927, "i", "tail -n +1 util.py | head -n -1 >> temp.py\n"]
[299.569783, "o", "tail -n +1 util.py | head -n -1 >> temp.py\r\n\u001b[?2004l\r"]
[299.573003, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
[306.187429, "i", "mv temp.py util.py\n"]
[306.18777, "o", "mv temp.py util.py\r\n\u001b[?2004l\r"]
[306.189667, "o", "\u001b[?2004hroot@7ede15ef-efb4-449e-872e-58658028a822:/workspace/repo/pyais# "]
