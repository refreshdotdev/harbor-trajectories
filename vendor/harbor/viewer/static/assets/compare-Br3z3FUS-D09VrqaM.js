import{b as c}from"./index-CYR-HZan.js";const v=w();function l(e,...t){if(!v)return;const r=b(e,...t);performance.mark(r);try{console.log(e,...t)}catch{console.log(r)}}function F(e,...t){v&&console.warn(e,...t)}function b(e,...t){return e.replace(/%[sfdO]/g,r=>{const s=t.shift();return r==="%O"&&s?JSON.stringify(s).replace(/"([^"]+)":/g,"$1:"):String(s)})}function w(){try{const e="nuqs-localStorage-test";if(typeof localStorage>"u")return!1;localStorage.setItem(e,e);const t=localStorage.getItem(e)===e;return localStorage.removeItem(e),t&&(localStorage.getItem("debug")||"").includes("nuqs")}catch{return!1}}const S={303:"Multiple adapter contexts detected. This might happen in monorepos.",404:"nuqs requires an adapter to work with your framework.",409:"Multiple versions of the library are loaded. This may lead to unexpected behavior. Currently using `%s`, but `%s` (via the %s adapter) was about to load on top.",414:"Max safe URL length exceeded. Some browsers may not be able to accept this URL. Consider limiting the amount of state stored in the URL.",422:"Invalid options combination: `limitUrlUpdates: debounce` should be used in SSR scenarios, with `shallow: false`",429:"URL update rate-limited by the browser. Consider increasing `throttleMs` for key(s) `%s`. %O",500:"Empty search params cache. Search params can't be accessed in Layouts.",501:"Search params cache already populated. Have you called `parse` twice?"};function f(e){return`[nuqs] ${S[e]}
  See https://nuqs.dev/NUQS-${e}`}function L(e){if(e.size===0)return"";const t=[];for(const[s,n]of e.entries()){const o=s.replace(/#/g,"%23").replace(/&/g,"%26").replace(/\+/g,"%2B").replace(/=/g,"%3D").replace(/\?/g,"%3F");t.push(`${o}=${Q(n)}`)}return"?"+t.join("&")}function Q(e){return e.replace(/%/g,"%25").replace(/\+/g,"%2B").replace(/ /g,"+").replace(/#/g,"%23").replace(/&/g,"%26").replace(/"/g,"%22").replace(/'/g,"%27").replace(/`/g,"%60").replace(/</g,"%3C").replace(/>/g,"%3E").replace(/[\x00-\x1F]/g,t=>encodeURIComponent(t))}const h=c.createContext({useAdapter(){throw new Error(f(404))}});h.displayName="NuqsAdapterContext";v&&typeof window<"u"&&(window.__NuqsAdapterContext&&window.__NuqsAdapterContext!==h&&console.error(f(303)),window.__NuqsAdapterContext=h);function T(e){return({children:t,defaultOptions:r,processUrlSearchParams:s,...n})=>c.createElement(h.Provider,{...n,value:{useAdapter:e,defaultOptions:r,processUrlSearchParams:s}},t)}function j(e){const t=c.useContext(h);if(!("useAdapter"in t))throw new Error(f(404));return t.useAdapter(e)}const k=()=>c.useContext(h).defaultOptions,V=()=>c.useContext(h).processUrlSearchParams;function A(){if(typeof window>"u"||!window.GestureEvent)return 50;try{const e=navigator.userAgent?.match(/version\/([\d\.]+) safari/i);return parseFloat(e[1])>=17?120:320}catch{return 320}}function x(e){return{method:"throttle",timeMs:e}}const p=x(A());function I(e){return e===null||Array.isArray(e)&&e.length===0}function M(e,t,r){if(typeof e=="string")r.set(t,e);else{r.delete(t);for(const s of e)r.append(t,s);r.has(t)||r.set(t,"")}return r}function O(){const e=new Map;return{on(t,r){const s=e.get(t)||[];return s.push(r),e.set(t,s),()=>this.off(t,r)},off(t,r){const s=e.get(t);s&&e.set(t,s.filter(n=>n!==r))},emit(t,r){e.get(t)?.forEach(s=>s(r))}}}function g(e,t,r){function s(){e(),r.removeEventListener("abort",o)}const n=setTimeout(s,t);function o(){clearTimeout(n),r.removeEventListener("abort",o)}r.addEventListener("abort",o)}function m(){const e=Promise;if(Promise.hasOwnProperty("withResolvers"))return Promise.withResolvers();let t=()=>{},r=()=>{};return{promise:new e((s,n)=>{t=s,r=n}),resolve:t,reject:r}}function C(e,t){let r=t;for(let s=e.length-1;s>=0;s--){const n=e[s];if(!n)continue;const o=r;r=()=>n(o)}r()}function q(){return new URLSearchParams(location.search)}var y=class{updateMap=new Map;options={history:"replace",scroll:!1,shallow:!0};timeMs=p.timeMs;transitions=new Set;resolvers=null;controller=null;lastFlushedAt=0;resetQueueOnNextPush=!1;push({key:e,query:t,options:r},s=p.timeMs){this.resetQueueOnNextPush&&(this.reset(),this.resetQueueOnNextPush=!1),l("[nuqs gtq] Enqueueing %s=%s %O",e,t,r),this.updateMap.set(e,t),r.history==="push"&&(this.options.history="push"),r.scroll&&(this.options.scroll=!0),r.shallow===!1&&(this.options.shallow=!1),r.startTransition&&this.transitions.add(r.startTransition),(!Number.isFinite(this.timeMs)||s>this.timeMs)&&(this.timeMs=s)}getQueuedQuery(e){return this.updateMap.get(e)}getPendingPromise({getSearchParamsSnapshot:e=q}){return this.resolvers?.promise??Promise.resolve(e())}flush({getSearchParamsSnapshot:e=q,rateLimitFactor:t=1,...r},s){if(this.controller??=new AbortController,!Number.isFinite(this.timeMs))return l("[nuqs gtq] Skipping flush due to throttleMs=Infinity"),Promise.resolve(e());if(this.resolvers)return this.resolvers.promise;this.resolvers=m();const n=()=>{this.lastFlushedAt=performance.now();const[u,i]=this.applyPendingUpdates({...r,autoResetQueueOnUpdate:r.autoResetQueueOnUpdate??!0,getSearchParamsSnapshot:e},s);i===null?(this.resolvers.resolve(u),this.resetQueueOnNextPush=!0):this.resolvers.reject(u),this.resolvers=null};return g(()=>{const u=performance.now()-this.lastFlushedAt,i=this.timeMs,a=t*Math.max(0,i-u);l("[nuqs gtq] Scheduling flush in %f ms. Throttled at %f ms (x%f)",a,i,t),a===0?n():g(n,a,this.controller.signal)},0,this.controller.signal),this.resolvers.promise}abort(){return this.controller?.abort(),this.controller=new AbortController,this.resolvers?.resolve(new URLSearchParams),this.resolvers=null,this.reset()}reset(){const e=Array.from(this.updateMap.keys());return l("[nuqs gtq] Resetting queue %s",JSON.stringify(Object.fromEntries(this.updateMap))),this.updateMap.clear(),this.transitions.clear(),this.options={history:"replace",scroll:!1,shallow:!0},this.timeMs=p.timeMs,e}applyPendingUpdates(e,t){const{updateUrl:r,getSearchParamsSnapshot:s}=e;let n=s();if(l("[nuqs gtq] Applying %d pending update(s) on top of %s",this.updateMap.size,n.toString()),this.updateMap.size===0)return[n,null];const o=Array.from(this.updateMap.entries()),u={...this.options},i=Array.from(this.transitions);e.autoResetQueueOnUpdate&&this.reset(),l("[nuqs gtq] Flushing queue %O with options %O",o,u);for(const[a,d]of o)d===null?n.delete(a):n=M(d,a,n);t&&(n=t(n));try{return C(i,()=>{r(n,u)}),[n,null]}catch(a){return console.error(f(429),o.map(([d])=>d).join(),a),[n,a]}}};const P=new y;function E(e,t,r){const s=c.useCallback(()=>{const o=Object.fromEntries(e.map(u=>[u,r(u)]));return[JSON.stringify(o),o]},[e.join(","),r]),n=c.useRef(null);return n.current===null&&(n.current=s()),c.useSyncExternalStore(c.useCallback(o=>{const u=e.map(i=>t(i,o));return()=>u.forEach(i=>i())},[e.join(","),t]),()=>{const[o,u]=s();return n.current[0]===o?n.current[1]:(n.current=[o,u],u)},()=>n.current[1])}var R=class{callback;resolvers=m();controller=new AbortController;queuedValue=void 0;constructor(e){this.callback=e}abort(){this.controller.abort(),this.queuedValue=void 0}push(e,t){return this.queuedValue=e,this.controller.abort(),this.controller=new AbortController,g(()=>{const r=this.resolvers;try{l("[nuqs dq] Flushing debounce queue",e);const s=this.callback(e);l("[nuqs dq] Reset debounce queue %O",this.queuedValue),this.queuedValue=void 0,this.resolvers=m(),s.then(n=>r.resolve(n)).catch(n=>r.reject(n))}catch(s){this.queuedValue=void 0,r.reject(s)}},t,this.controller.signal),this.resolvers.promise}},N=class{throttleQueue;queues=new Map;queuedQuerySync=O();constructor(e=new y){this.throttleQueue=e}useQueuedQueries(e){return E(e,(t,r)=>this.queuedQuerySync.on(t,r),t=>this.getQueuedQuery(t))}push(e,t,r,s){if(!Number.isFinite(t)){const u=r.getSearchParamsSnapshot??q;return Promise.resolve(u())}const n=e.key;if(!this.queues.has(n)){l("[nuqs dqc] Creating debounce queue for `%s`",n);const u=new R(i=>(this.throttleQueue.push(i),this.throttleQueue.flush(r,s).finally(()=>{this.queues.get(i.key)?.queuedValue===void 0&&(l("[nuqs dqc] Cleaning up empty queue for `%s`",i.key),this.queues.delete(i.key)),this.queuedQuerySync.emit(i.key)})));this.queues.set(n,u)}l("[nuqs dqc] Enqueueing debounce update %O",e);const o=this.queues.get(n).push(e,t);return this.queuedQuerySync.emit(n),o}abort(e){const t=this.queues.get(e);return t?(l("[nuqs dqc] Aborting debounce queue %s=%s",e,t.queuedValue?.query),this.queues.delete(e),t.abort(),this.queuedQuerySync.emit(e),r=>(r.then(t.resolvers.resolve,t.resolvers.reject),r)):r=>r}abortAll(){for(const[e,t]of this.queues.entries())l("[nuqs dqc] Aborting debounce queue %s=%s",e,t.queuedValue?.query),t.abort(),t.resolvers.resolve(new URLSearchParams),this.queuedQuerySync.emit(e);this.queues.clear()}getQueuedQuery(e){const t=this.queues.get(e)?.queuedValue?.query;return t!==void 0?t:this.throttleQueue.getQueuedQuery(e)}};const D=new N(P);function _(e,t){return e===t?!0:e===null||t===null||typeof e=="string"||typeof t=="string"||e.length!==t.length?!1:e.every((r,s)=>r===t[s])}export{D as a,T as b,_ as c,l as d,f as e,O as f,P as g,V as h,p as i,j,I as k,L as r,k as u,F as w};
