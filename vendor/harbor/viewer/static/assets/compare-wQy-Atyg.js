import{b as l,t as e,x as q,v as W,w as G,A as T}from"./index-CYR-HZan.js";import{c as M,k as Q,l as V,P as X,m as j,n as D,o as Y,p as _,d as Z,u as ee,f as O,B as te,a as re,b as H,q as oe,r as se,e as ne,L as ae,s as ce}from"./api-BgrBwReI.js";import{t as ie}from"./index-JVv6katd.js";import{c as L,R as le,A as de,P as ue,D as me,C as xe,a as pe}from"./index-DvJT0nJi.js";import{K as he}from"./kbd-CNHFVw7L.js";import{T as fe,a as ve,b as je}from"./tooltip-CILBUYcN.js";const be=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],$=M("arrow-left",be);var S,R="HoverCard",[F]=V(R,[L]),k=L(),[ge,P]=F(R),I=r=>{const{__scopeHoverCard:s,children:a,open:c,defaultOpen:n,onOpenChange:d,openDelay:f=700,closeDelay:v=300}=r,u=k(s),b=l.useRef(0),h=l.useRef(0),C=l.useRef(!1),t=l.useRef(!1),[i,o]=Q({prop:c,defaultProp:n??!1,onChange:d,caller:R}),p=l.useCallback(()=>{clearTimeout(h.current),b.current=window.setTimeout(()=>o(!0),f)},[f,o]),x=l.useCallback(()=>{clearTimeout(b.current),!C.current&&!t.current&&(h.current=window.setTimeout(()=>o(!1),v))},[v,o]),m=l.useCallback(()=>o(!1),[o]);return l.useEffect(()=>()=>{clearTimeout(b.current),clearTimeout(h.current)},[]),e.jsx(ge,{scope:s,open:i,onOpenChange:o,onOpen:p,onClose:x,onDismiss:m,hasSelectionRef:C,isPointerDownOnContentRef:t,children:e.jsx(le,{...u,children:a})})};I.displayName=R;var U="HoverCardTrigger",B=l.forwardRef((r,s)=>{const{__scopeHoverCard:a,...c}=r,n=P(U,a),d=k(a);return e.jsx(de,{asChild:!0,...d,children:e.jsx(X.a,{"data-state":n.open?"open":"closed",...c,ref:s,onPointerEnter:j(r.onPointerEnter,y(n.onOpen)),onPointerLeave:j(r.onPointerLeave,y(n.onClose)),onFocus:j(r.onFocus,n.onOpen),onBlur:j(r.onBlur,n.onClose),onTouchStart:j(r.onTouchStart,f=>f.preventDefault())})})});B.displayName=U;var E="HoverCardPortal",[Ce,Ne]=F(E,{forceMount:void 0}),z=r=>{const{__scopeHoverCard:s,forceMount:a,children:c,container:n}=r,d=P(E,s);return e.jsx(Ce,{scope:s,forceMount:a,children:e.jsx(D,{present:a||d.open,children:e.jsx(ue,{asChild:!0,container:n,children:c})})})};z.displayName=E;var w="HoverCardContent",J=l.forwardRef((r,s)=>{const a=Ne(w,r.__scopeHoverCard),{forceMount:c=a.forceMount,...n}=r,d=P(w,r.__scopeHoverCard);return e.jsx(D,{present:c||d.open,children:e.jsx(_e,{"data-state":d.open?"open":"closed",...n,onPointerEnter:j(r.onPointerEnter,y(d.onOpen)),onPointerLeave:j(r.onPointerLeave,y(d.onClose)),ref:s})})});J.displayName=w;var _e=l.forwardRef((r,s)=>{const{__scopeHoverCard:a,onEscapeKeyDown:c,onPointerDownOutside:n,onFocusOutside:d,onInteractOutside:f,...v}=r,u=P(w,a),b=k(a),h=l.useRef(null),C=Y(s,h),[t,i]=l.useState(!1);return l.useEffect(()=>{if(t){const o=document.body;return S=o.style.userSelect||o.style.webkitUserSelect,o.style.userSelect="none",o.style.webkitUserSelect="none",()=>{o.style.userSelect=S,o.style.webkitUserSelect=S}}},[t]),l.useEffect(()=>{if(h.current){const o=()=>{i(!1),u.isPointerDownOnContentRef.current=!1,setTimeout(()=>{document.getSelection()?.toString()!==""&&(u.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",o),()=>{document.removeEventListener("pointerup",o),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!1}}},[u.isPointerDownOnContentRef,u.hasSelectionRef]),l.useEffect(()=>{h.current&&Re(h.current).forEach(p=>p.setAttribute("tabindex","-1"))}),e.jsx(me,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:f,onEscapeKeyDown:c,onPointerDownOutside:n,onFocusOutside:j(d,o=>{o.preventDefault()}),onDismiss:u.onDismiss,children:e.jsx(xe,{...b,...v,onPointerDown:j(v.onPointerDown,o=>{o.currentTarget.contains(o.target)&&i(!0),u.hasSelectionRef.current=!1,u.isPointerDownOnContentRef.current=!0}),ref:C,style:{...v.style,userSelect:t?"text":void 0,WebkitUserSelect:t?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})})}),we="HoverCardArrow",ye=l.forwardRef((r,s)=>{const{__scopeHoverCard:a,...c}=r,n=k(a);return e.jsx(pe,{...n,...c,ref:s})});ye.displayName=we;function y(r){return s=>s.pointerType==="touch"?void 0:r()}function Re(r){const s=[],a=document.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;a.nextNode();)s.push(a.currentNode);return s}var ke=I,Pe=B,Te=z,Se=J;function Ee({...r}){return e.jsx(ke,{"data-slot":"hover-card",...r})}function Oe({...r}){return e.jsx(Pe,{"data-slot":"hover-card-trigger",...r})}function He({className:r,align:s="center",sideOffset:a=4,...c}){return e.jsx(Te,{"data-slot":"hover-card-portal",children:e.jsx(Se,{"data-slot":"hover-card-content",align:s,sideOffset:a,className:_("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",r),...c})})}function $e(r){if(r===null)return"N/A";const s=Math.floor(r/1e3),a=Math.floor(s/60),c=Math.floor(a/60);return c>0?`${c}h ${a%60}m`:a>0?`${a}m ${s%60}s`:`${s}s`}function A(r){const s=[];return r.job_name&&s.push(r.job_name),r.agent_name&&s.push(r.agent_name),r.model_provider&&r.model_name?s.push(`${r.model_provider}/${r.model_name}`):r.model_name&&s.push(r.model_name),s.join(" / ")||"Unknown"}const Be=q(function(){const s=W(),[a]=G(),c=a.getAll("job");Z("escape",()=>s("/"));const{data:n,isLoading:d,error:f}=ee({queryKey:["comparison",c],queryFn:()=>ce(c),enabled:c.length>=1}),{minReward:v,maxReward:u}=l.useMemo(()=>{if(!n)return{minReward:0,maxReward:1};const t=[];for(const i of Object.values(n.cells))for(const o of Object.values(i))o.avg_reward!==null&&o.avg_reward!==void 0&&t.push(o.avg_reward);return t.length===0?{minReward:0,maxReward:1}:{minReward:Math.min(...t),maxReward:Math.max(...t)}},[n]),b=(t,i,o)=>{const p=i.source||"_",x=o.agent_name||"_",m=o.model_provider||"_",N=o.model_name||"_",g=i.task_name;s(`/jobs/${encodeURIComponent(t.job_name)}/tasks/${encodeURIComponent(p)}/${encodeURIComponent(x)}/${encodeURIComponent(m)}/${encodeURIComponent(N)}/${encodeURIComponent(g)}`)},h=async t=>{await navigator.clipboard.writeText(t.task_name),ie("Copied to clipboard",{description:t.task_name})},C=t=>{const i=new URLSearchParams;t.agent_name&&i.set("agent",t.agent_name),t.model_provider&&i.set("provider",t.model_provider),t.model_name&&i.set("model",t.model_name);const o=i.toString();s(`/jobs/${encodeURIComponent(t.job_name)}${o?`?${o}`:""}`)};return c.length<1?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[e.jsx("p",{className:"text-muted-foreground",children:"Select at least 1 job to compare."}),e.jsx(O,{asChild:!0,children:e.jsxs(T,{to:"/",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Back to Jobs"]})})]}):e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4",children:[e.jsx(te,{children:e.jsxs(re,{children:[e.jsx(H,{children:e.jsx(oe,{asChild:!0,children:e.jsx(T,{to:"/",children:"Jobs"})})}),e.jsx(se,{}),e.jsx(H,{children:e.jsxs(ne,{children:["Compare (",c.length," jobs)"]})})]})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(he,{children:"Esc"}),e.jsx("span",{children:"to go back"})]})]}),e.jsx("div",{className:"flex-1 border-t",children:d?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(ae,{text:"Loading comparison data"})}):f?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4",children:[e.jsxs("p",{className:"text-destructive",children:["Error loading comparison data: ",f.message]}),e.jsx(O,{asChild:!0,children:e.jsxs(T,{to:"/",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Back to Jobs"]})})]}):n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto h-full border-b",children:e.jsxs("div",{className:"grid w-fit border-r",style:{gridTemplateColumns:`min-content repeat(${n.tasks.length}, min-content)`},children:[e.jsx("div",{className:"bg-background sticky top-0 left-0 z-20 border-r border-b"}),n.tasks.map((t,i)=>e.jsxs(fe,{children:[e.jsx(ve,{asChild:!0,children:e.jsx("button",{type:"button",onClick:()=>h(t),className:_("bg-background sticky top-0 z-10 flex items-end justify-center border-b hover:bg-muted/50 transition-colors",i<n.tasks.length-1&&"border-r"),children:e.jsx("span",{className:"p-3 text-xs whitespace-nowrap",style:{writingMode:"sideways-lr",textOrientation:"mixed"},children:t.task_name})})}),e.jsx(je,{children:e.jsxs("p",{className:"text-xs",children:[t.source&&e.jsxs("span",{children:[t.source," / "]}),t.task_name]})})]},t.key)),n.agent_models.map((t,i)=>{const o=i===n.agent_models.length-1;return e.jsxs("div",{className:"contents",children:[e.jsx("div",{className:_("bg-background sticky left-0 z-10 border-r",!o&&"border-b"),children:e.jsx("button",{type:"button",onClick:()=>C(t),className:"flex items-center justify-end w-full h-full hover:bg-muted/50 transition-colors",title:A(t),children:e.jsx("span",{className:"text-right text-xs whitespace-nowrap p-3 pl-4",children:A(t)})})}),n.tasks.map(p=>{const x=n.cells[p.key]?.[t.key],m=x?.avg_reward??null,N=u-v,g=m!==null&&N>0?(m-v)/N:m??0,K=m!==null?g<.5?Math.min(g+.1,1):Math.max(g-.1,0):0;return e.jsxs(Ee,{openDelay:200,children:[e.jsx(Oe,{asChild:!0,children:e.jsxs("button",{type:"button",onClick:()=>x&&b(x,p,t),className:"group relative isolate flex items-center justify-center",disabled:!x,children:[e.jsx("div",{className:"absolute inset-0 transition-colors group-hover:opacity-0",style:{backgroundColor:`color-mix(in oklch, var(--foreground) ${(g*100).toFixed(1)}%, transparent)`}}),e.jsx("div",{className:"absolute inset-0 opacity-0 transition-colors group-hover:opacity-100",style:{backgroundColor:`color-mix(in oklch, var(--foreground) ${(K*100).toFixed(1)}%, transparent)`}}),e.jsx("p",{className:_("relative z-10 flex size-14 items-center justify-center text-xs tabular-nums",m!==null&&g>.5?"text-background":"text-foreground"),children:m!==null?m.toFixed(2):"N/A"})]})}),e.jsx(He,{className:"w-64 text-sm",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Task"}),e.jsx("p",{className:"text-xs",children:p.task_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Job"}),e.jsx("p",{className:"text-xs",children:t.job_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Agent"}),e.jsx("p",{className:"text-xs",children:t.agent_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Model"}),e.jsx("p",{className:"text-xs",children:t.model_provider&&t.model_name?`${t.model_provider}/${t.model_name}`:t.model_name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Avg Reward"}),e.jsx("p",{className:"text-xs tabular-nums",children:m!==null?m.toFixed(4):"N/A"})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Avg Duration"}),e.jsx("p",{className:"text-xs tabular-nums",children:$e(x.avg_duration_ms)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Trials"}),e.jsxs("p",{className:"text-xs tabular-nums",children:[x.n_completed,"/",x.n_trials]})]})]})]})})]},`${t.key}-${p.key}`)})]},t.key)})]})}),e.jsx("p",{className:"text-xs text-muted-foreground p-4 text-center",children:"Tasks are sorted by average resolution rate across agents. Jobs and agents are sorted by average resolution rate across tasks."})]}):null})]})});export{Be as default};
