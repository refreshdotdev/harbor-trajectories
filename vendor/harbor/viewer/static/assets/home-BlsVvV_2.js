import{x as ye,v as Ce,b as c,t as e}from"./index-CYR-HZan.js";import{u as Se,t as B,l as we}from"./index-JVv6katd.js";import{c as re,u as L,d as De,B as _e,a as Me,b as Te,e as Pe,f as Z,g as ke,h as Fe,i as Ee,j as Ve}from"./api-BgrBwReI.js";import{u as Ke,X as Oe,E as W,a as Y,b as ee,c as se,d as Re}from"./empty-TlmgxYvO.js";import{u as N,p as D,a as y,T as Ae,I as Ie,S as te,C as V}from"./input-BPzPo60M.js";import{u as $e,a as Je,D as qe,c as Be,P as Le,b as He,d as p,e as Qe,f as K,g as ae,h as Ge,S as m}from"./hooks-CJW8H_7B.js";import{T as _,a as M,b as T}from"./tooltip-CILBUYcN.js";import{K as P}from"./kbd-CNHFVw7L.js";import"./mutation--h5hHClj.js";import"./index-DvJT0nJi.js";import"./compare-Br3z3FUS-D09VrqaM.js";import"./scroll-area-Bnf4hdko.js";const ze=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]],Ue=re("folder-open",ze);const Xe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],Ze=re("grid-3x3",Xe),H=100,We=[{value:"today",label:"Last 24 hours"},{value:"week",label:"Last 7 days"},{value:"month",label:"Last 30 days"}];function Ye(s,t){if(!s)return"-";const n=new Date(s).getTime(),d=(t?new Date(t).getTime():Date.now())-n,u=Math.floor(d/1e3),o=Math.floor(u/60),r=Math.floor(o/60);return r>0?`${r}h ${o%60}m`:o>0?`${o}m ${u%60}s`:`${u}s`}const es=[Be(),{accessorKey:"name",header:({column:s})=>e.jsx(m,{column:s,children:"Job Name"})},{accessorKey:"datasets",header:({column:s})=>e.jsx(m,{column:s,children:"Datasets"}),sortingFn:(s,t)=>{const n=s.original.datasets[0]??"",l=t.original.datasets[0]??"";return n.localeCompare(l)},cell:({row:s})=>{const t=s.original.datasets;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(T,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"agents",header:({column:s})=>e.jsx(m,{column:s,children:"Agents"}),sortingFn:(s,t)=>{const n=s.original.agents[0]??"",l=t.original.agents[0]??"";return n.localeCompare(l)},cell:({row:s})=>{const t=s.original.agents;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(T,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"providers",header:({column:s})=>e.jsx(m,{column:s,children:"Providers"}),sortingFn:(s,t)=>{const n=s.original.providers[0]??"",l=t.original.providers[0]??"";return n.localeCompare(l)},cell:({row:s})=>{const t=s.original.providers;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(T,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"models",header:({column:s})=>e.jsx(m,{column:s,children:"Models"}),sortingFn:(s,t)=>{const n=s.original.models[0]??"",l=t.original.models[0]??"";return n.localeCompare(l)},cell:({row:s})=>{const t=s.original.models;return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):t.length===1?e.jsx("span",{className:"text-sm",children:t[0]}):e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("span",{className:"text-sm cursor-default",children:[t[0]," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",t.length-1," more"]})]})}),e.jsx(T,{children:e.jsx("p",{children:t.join(", ")})})]})}},{accessorKey:"environment_type",header:({column:s})=>e.jsx(m,{column:s,children:"Environment"}),cell:({row:s})=>{const t=s.original.environment_type;return t?e.jsx("span",{className:"text-sm",children:t}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"started_at",header:({column:s})=>e.jsx(m,{column:s,children:"Started"}),cell:({row:s})=>{const t=s.original.started_at;return t?new Date(t).toLocaleString(void 0,{dateStyle:"short",timeStyle:"short"}):"-"}},{id:"duration",header:({column:s})=>e.jsx(m,{column:s,children:"Duration"}),accessorFn:s=>!s.started_at||!s.finished_at?0:new Date(s.finished_at).getTime()-new Date(s.started_at).getTime(),cell:({row:s})=>{const{started_at:t,finished_at:n}=s.original;return!t||!n?"-":Ye(t,n)}},{accessorKey:"n_total_trials",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(m,{column:s,children:"Trials"})}),cell:({row:s})=>{const t=s.original.n_total_trials,n=s.original.n_completed_trials;return e.jsxs("div",{className:"text-right",children:[n,"/",t]})}},{accessorKey:"n_errors",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(m,{column:s,children:"Errors"})}),cell:({row:s})=>{const t=s.original.n_errors;return e.jsx("div",{className:"text-right",children:t})}},{accessorKey:"evals",header:({column:s})=>e.jsx("div",{className:"text-right",children:e.jsx(m,{column:s,children:"Result"})}),sortingFn:(s,t)=>{const n=Object.entries(s.original.evals),l=Object.entries(t.original.evals),d=n[0]?.[1]?.metrics[0],u=l[0]?.[1]?.metrics[0],o=d?Object.values(d)[0]:null,r=u?Object.values(u)[0]:null;return o===null&&r===null?0:o===null?1:r===null?-1:typeof o=="number"&&typeof r=="number"?o-r:String(o).localeCompare(String(r))},cell:({row:s})=>{const t=s.original.evals,n=Object.entries(t);if(n.length===0)return e.jsx("div",{className:"text-right text-muted-foreground",children:"-"});const[,l]=n[0],d=l.metrics[0];if(!d)return e.jsx("div",{className:"text-right text-muted-foreground",children:"-"});const[u,o]=Object.entries(d)[0],r=typeof o=="number"?o.toFixed(2):String(o);return n.length===1?e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsx("div",{className:"text-right cursor-default",children:r})}),e.jsx(T,{children:e.jsxs("p",{children:[u,"=",r]})})]}):e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs("div",{className:"text-right cursor-default",children:[r," ",e.jsxs("span",{className:"text-muted-foreground",children:["+",n.length-1," more"]})]})}),e.jsx(T,{align:"end",children:e.jsx("ul",{className:"space-y-0.5",children:n.map(([h,k])=>{const F=k.metrics[0],g=`(${h.split("__").join(", ")})`;if(!F)return e.jsx("li",{children:g},h);const[$,x]=Object.entries(F)[0],J=typeof x=="number"?x.toFixed(2):x;return e.jsxs("li",{children:[g,": ",$,"=",J]},h)})})})]})}}],ms=ye(function(){const t=Ce(),n=Se(),[l,d]=N("selected",D(y).withDefault([])),[u,o]=c.useState(!1),[r,h]=c.useState(1),[k,F]=N("q",y.withDefault("")),[g,$]=N("agent",D(y).withDefault([])),[x,J]=N("provider",D(y).withDefault([])),[C,ne]=N("model",D(y).withDefault([])),[S,le]=N("date",D(y).withDefault([])),[O,oe]=N("hide",D(y).withDefault([])),R=c.useMemo(()=>[{value:"name",label:"Job Name"},{value:"datasets",label:"Datasets"},{value:"agents",label:"Agents"},{value:"providers",label:"Providers"},{value:"models",label:"Models"},{value:"environment_type",label:"Environment"},{value:"started_at",label:"Started"},{value:"duration",label:"Duration"},{value:"n_total_trials",label:"Trials"},{value:"n_errors",label:"Errors"},{value:"evals",label:"Result"}],[]),ie=c.useMemo(()=>{const a={};for(const i of O)a[i]=!1;return a},[O]),ce=c.useMemo(()=>R.filter(a=>!O.includes(a.value)).map(a=>a.value),[R,O]),de=a=>{const i=R.filter(b=>!a.includes(b.value)).map(b=>b.value);oe(i.length>0?i:null)},A=$e(k,300);c.useEffect(()=>{h(1)},[A,g,x,C,S]);const{data:w}=L({queryKey:["jobFilters"],queryFn:Fe,staleTime:6e4}),{data:ue}=L({queryKey:["config"],queryFn:Ee,staleTime:1/0}),he=c.useMemo(()=>(w?.agents??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[w?.agents]),me=c.useMemo(()=>(w?.providers??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[w?.providers]),xe=c.useMemo(()=>(w?.models??[]).map(a=>({value:a.value,label:a.value,count:a.count})),[w?.models]),{data:q,isLoading:ge}=L({queryKey:["jobs",r,A,g,x,C,S],queryFn:()=>Ve(r,H,{search:A||void 0,agents:g.length>0?g:void 0,providers:x.length>0?x:void 0,models:C.length>0?C:void 0,dates:S.length>0?S:void 0}),placeholderData:we}),j=q?.items??[],f=q?.total_pages??0,Q=q?.total??0,G=c.useRef(null);De("mod+k",a=>{a.preventDefault(),G.current?.focus()},{enableOnFormTags:!0});const{highlightedIndex:pe}=Je({rows:j,onNavigate:a=>t(`/jobs/${a.name}`)}),je=c.useMemo(()=>{const a={};for(const i of l)a[i]=!0;return a},[l]),v=c.useMemo(()=>j.filter(a=>l.includes(a.name)),[j,l]),fe=a=>{const i=Object.keys(a).filter(b=>a[b]);d(i.length>0?i:null)},z=c.useRef(!1),U=c.useRef([]),ve=c.useCallback(a=>{const i=j[a]?.name;z.current=!!i&&l.includes(i),U.current=l},[j,l]),be=c.useCallback(a=>{const i=new Set(Array.from(a).map(E=>j[E]?.name).filter(Boolean)),b=U.current;let I;if(z.current)I=b.filter(E=>!i.has(E));else{const E=new Set([...b,...i]);I=Array.from(E)}d(I.length>0?I:null)},[j,d]),X=Ke({mutationFn:async a=>{await Promise.all(a.map(i=>ke(i)))},onSuccess:()=>{n.invalidateQueries({queryKey:["jobs"]}),B("Jobs deleted",{description:`${v.length} job(s) deleted`}),d(null),o(!1)},onError:a=>{B.error("Failed to delete jobs",{description:a.message}),o(!1)}}),Ne=()=>{u?X.mutate(v.map(a=>a.name)):o(!0)};return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(_e,{className:"mb-4",children:e.jsx(Me,{children:e.jsx(Te,{children:e.jsx(Pe,{children:"Jobs"})})})}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:"Jobs"}),e.jsx("p",{className:"text-muted-foreground",children:"Browse and inspect Harbor jobs"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{children:"j"}),e.jsx(P,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx("span",{children:"drag to select multiple"})]}),v.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[v.length>=1&&e.jsxs(Z,{variant:"secondary",onClick:()=>{const a=new URLSearchParams;for(const i of v)a.append("job",i.name);t(`/compare?${a}`)},children:[e.jsx(Ze,{className:"h-4 w-4"}),"Compare (",v.length,")"]}),e.jsxs(Z,{variant:u?"destructive":"secondary",onClick:Ne,onBlur:()=>o(!1),disabled:X.isPending,children:[e.jsx(Ae,{className:"h-4 w-4"}),u?`Confirm delete (${v.length})`:`Delete (${v.length})`]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-7 -mb-px",children:[e.jsxs("div",{className:"col-span-2 relative",children:[e.jsx(Ie,{ref:G,placeholder:"Search for jobs...",value:k,onChange:a=>F(a.target.value||null),size:"lg",variant:"card",className:"peer pl-9 pr-16 shadow-none"}),e.jsx(te,{className:"pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-border transition-colors peer-focus-visible:text-ring"}),k?e.jsx("button",{type:"button",onClick:()=>F(null),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",children:e.jsx(Oe,{className:"h-4 w-4"})}):e.jsxs("div",{className:"pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-0.5",children:[e.jsx(P,{children:"âŒ˜"}),e.jsx(P,{children:"K"})]})]}),e.jsx(V,{options:he,value:g,onValueChange:$,placeholder:"All agents",searchPlaceholder:"Search agents...",emptyText:"No agents found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(V,{options:me,value:x,onValueChange:J,placeholder:"All providers",searchPlaceholder:"Search providers...",emptyText:"No providers found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(V,{options:xe,value:C,onValueChange:ne,placeholder:"All models",searchPlaceholder:"Search models...",emptyText:"No models found.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(V,{options:We,value:S,onValueChange:le,placeholder:"All time",searchPlaceholder:"Search...",emptyText:"No options.",variant:"card",className:"w-full border-l-0 shadow-none"}),e.jsx(V,{options:R,value:ce,onValueChange:de,placeholder:"Columns",searchPlaceholder:"Search columns...",emptyText:"No columns.",variant:"card",className:"w-full border-l-0 shadow-none",multiSelectLabel:"columns"})]}),e.jsx(qe,{columns:es,data:j,onRowClick:a=>t(`/jobs/${a.name}`),enableRowSelection:!0,rowSelection:je,onRowSelectionChange:fe,columnVisibility:ie,getRowId:a=>a.name,isLoading:ge,className:"border-t-0",highlightedIndex:pe,enableDragSelect:!0,onDragStart:ve,onSelectedIndicesChange:be,emptyState:A||g.length>0||x.length>0||C.length>0||S.length>0?e.jsx(W,{className:"border-0",children:e.jsxs(Y,{children:[e.jsx(ee,{variant:"icon",children:e.jsx(te,{})}),e.jsx(se,{children:"No jobs match those filters"})]})}):e.jsx(W,{className:"border-0",children:e.jsxs(Y,{children:[e.jsx(ee,{variant:"icon",children:e.jsx(Ue,{})}),e.jsxs(se,{children:["No jobs in ",ue?.jobs_dir??"jobs directory"]}),e.jsxs(Re,{children:["Start a job using"," ",e.jsx("code",{className:"bg-muted px-1 py-0.5 cursor-default hover:bg-ring/20 hover:text-foreground transition-colors",onClick:()=>{navigator.clipboard.writeText("harbor run -d <dataset>"),B("Copied to clipboard")},children:"harbor run -d <dataset>"})]})]})})}),f>1&&e.jsxs("div",{className:"grid grid-cols-3 items-center mt-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",(r-1)*H+1,"-",Math.min(r*H,Q)," of ",Q," jobs"]}),e.jsx(Le,{children:e.jsxs(He,{children:[e.jsx(p,{children:e.jsx(Qe,{onClick:()=>h(a=>Math.max(1,a-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),r>2&&e.jsx(p,{children:e.jsx(K,{onClick:()=>h(1),className:"cursor-pointer",children:"1"})}),r>3&&e.jsx(p,{children:e.jsx(ae,{})}),r>1&&e.jsx(p,{children:e.jsx(K,{onClick:()=>h(r-1),className:"cursor-pointer",children:r-1})}),e.jsx(p,{children:e.jsx(K,{isActive:!0,children:r})}),r<f&&e.jsx(p,{children:e.jsx(K,{onClick:()=>h(r+1),className:"cursor-pointer",children:r+1})}),r<f-2&&e.jsx(p,{children:e.jsx(ae,{})}),r<f-1&&e.jsx(p,{children:e.jsx(K,{onClick:()=>h(f),className:"cursor-pointer",children:f})}),e.jsx(p,{children:e.jsx(Ge,{onClick:()=>h(a=>Math.min(f,a+1)),className:r===f?"pointer-events-none opacity-50":"cursor-pointer"})})]})}),e.jsx("div",{})]})]})});export{ms as default};
