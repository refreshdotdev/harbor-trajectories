import{x as E,B as q,w as F,v as H,t as e,A as w}from"./index-CYR-HZan.js";import{u as J,B as Q,a as A,b as U,q as P,r as B,e as G,D as O}from"./api-BgrBwReI.js";import{C as V,B as D}from"./code-block-CUSGUC3x.js";import{a as W,D as X,P as Y,b as Z,d as g,e as ee,g as se,f as ne,h as te,S as f}from"./hooks-CJW8H_7B.js";import{K as b}from"./kbd-CNHFVw7L.js";import"./index-JVv6katd.js";import"./scroll-area-Bnf4hdko.js";function ae({reward:n}){const s=Math.max(0,Math.min(1,n)),t=Math.round(s*100);return e.jsx(D,{variant:"outline",className:"tabular-nums border-transparent rounded-none",style:{backgroundColor:`color-mix(in oklab, var(--foreground) ${t}%, transparent)`,color:s>.5?"var(--background)":void 0},children:n.toFixed(2)})}function re(n,s){if(!n)return"-";const t=new Date(n).getTime(),r=(s?new Date(s).getTime():Date.now())-t,o=Math.floor(r/1e3),c=Math.floor(o/60),l=Math.floor(c/60);return l>0?`${l}h ${c%60}m`:c>0?`${c}m ${o%60}s`:`${o}s`}const oe=[{accessorKey:"name",header:({column:n})=>e.jsx(f,{column:n,children:"Trial"})},{id:"duration",accessorFn:n=>{if(!n.started_at)return null;const s=new Date(n.started_at).getTime();return(n.finished_at?new Date(n.finished_at).getTime():Date.now())-s},header:({column:n})=>e.jsx(f,{column:n,children:"Duration"}),cell:({row:n})=>{const{started_at:s,finished_at:t}=n.original,a=re(s,t);return!t&&s?e.jsxs("span",{className:"text-muted-foreground",children:[a,"..."]}):a}},{accessorKey:"started_at",header:({column:n})=>e.jsx(f,{column:n,children:"Started"}),cell:({row:n})=>{const s=n.original.started_at;return s?new Date(s).toLocaleString():"-"}},{accessorKey:"reward",header:({column:n})=>e.jsx("div",{className:"text-right",children:e.jsx(f,{column:n,children:"Reward"})}),cell:({row:n})=>{const s=n.original.reward,t=n.original.error_type;return t?e.jsx("div",{className:"text-right",children:e.jsx(D,{variant:"destructive",children:t})}):s===null?e.jsx("div",{className:"text-right text-muted-foreground",children:"-"}):e.jsx("div",{className:"text-right",children:e.jsx(ae,{reward:s})})}}];function _(n,s){const t=new URLSearchParams(n);return t.set("page",s.toString()),`?${t.toString()}`}function ie(n,s,t,a){const r=["harbor run"];return s&&r.push(`-d ${s}`),r.push(`-t ${n}`),t&&r.push(`-a ${t}`),a&&r.push(`-m ${a}`),r.join(" ")}function ce(n,s){const t=[];if(s<=7)for(let a=1;a<=s;a++)t.push(a);else{t.push(1),n>3&&t.push("ellipsis");const a=Math.max(2,n-1),r=Math.min(s-1,n+1);for(let o=a;o<=r;o++)t.push(o);n<s-2&&t.push("ellipsis"),t.push(s)}return t}const je=E(function(){const{jobName:s,taskName:t,source:a,agent:r,modelProvider:o,modelName:c}=q(),[l]=F(),v=H(),$=parseInt(l.get("page")||"1",10),N=parseInt(l.get("pageSize")||"100",10),h=a==="_"?void 0:a,m=r==="_"?void 0:r,C=o==="_"?void 0:o,I=c==="_"?void 0:c,x=C?I?`${C}/${I}`:C:I,{data:u,isLoading:S}=J({queryKey:["trials",s,t,$,N,h,m,x],queryFn:()=>O(s,$,N,{taskName:t,source:h,agentName:m,modelName:x}),enabled:!!s&&!!t}),y=u?.items??[],R=u?.total??0,i=u?.page??$,k=u?.page_size??N,p=u?.total_pages??0,M=R>0?(i-1)*k+1:0,T=Math.min(i*k,R),K=ce(i,p),{highlightedIndex:L}=W({rows:y,onNavigate:d=>v(`/jobs/${encodeURIComponent(s)}/tasks/${encodeURIComponent(a)}/${encodeURIComponent(r)}/${encodeURIComponent(o)}/${encodeURIComponent(c)}/${encodeURIComponent(t)}/trials/${encodeURIComponent(d.name)}`),onEscapeUnhighlighted:()=>v(`/jobs/${encodeURIComponent(s)}`)}),j=[];return m&&j.push(x?`${m} (${x})`:m),h&&j.push(h),e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Q,{className:"mb-4",children:e.jsxs(A,{children:[e.jsx(U,{children:e.jsx(P,{asChild:!0,children:e.jsx(w,{to:"/",children:"Jobs"})})}),e.jsx(B,{}),e.jsx(U,{children:e.jsx(P,{asChild:!0,children:e.jsx(w,{to:`/jobs/${encodeURIComponent(s)}`,children:s})})}),e.jsx(B,{}),e.jsx(U,{children:e.jsx(G,{children:t})})]})}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-medium mb-2",children:t}),j.length>0&&e.jsx("div",{className:"text-sm text-muted-foreground",children:j.join(" / ")})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"j"}),e.jsx(b,{children:"k"}),e.jsx("span",{children:"to navigate"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"Enter"}),e.jsx("span",{children:"to open"})]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{children:"Esc"}),e.jsx("span",{children:"to deselect"})]})]})]})]}),e.jsx(V,{code:ie(t,h,m,x),lang:"bash",className:"-mb-px"}),e.jsx(X,{columns:oe,data:y,onRowClick:d=>v(`/jobs/${encodeURIComponent(s)}/tasks/${encodeURIComponent(a)}/${encodeURIComponent(r)}/${encodeURIComponent(o)}/${encodeURIComponent(c)}/${encodeURIComponent(t)}/trials/${encodeURIComponent(d.name)}`),isLoading:S,highlightedIndex:L}),p>1&&e.jsxs("div",{className:"flex items-center mt-4",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:["Showing ",M,"-",T," of ",R," trials"]}),e.jsx(Y,{className:"flex-1 justify-center",children:e.jsxs(Z,{children:[e.jsx(g,{children:e.jsx(ee,{href:i>1?_(l,i-1):"#","aria-disabled":i<=1,className:i<=1?"pointer-events-none opacity-50":""})}),K.map((d,z)=>d==="ellipsis"?e.jsx(g,{children:e.jsx(se,{})},`ellipsis-${z}`):e.jsx(g,{children:e.jsx(ne,{href:_(l,d),isActive:d===i,children:d})},d)),e.jsx(g,{children:e.jsx(te,{href:i<p?_(l,i+1):"#","aria-disabled":i>=p,className:i>=p?"pointer-events-none opacity-50":""})})]})}),e.jsx("div",{className:"flex-1"})]})]})});export{je as default};
