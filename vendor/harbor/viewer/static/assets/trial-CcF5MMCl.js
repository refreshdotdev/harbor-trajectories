import{b as g,t as e,R as _,x as ze,B as Ke,v as Ue,A as X}from"./index-CYR-HZan.js";import{c as B,l as ge,k as oe,P as z,m as ve,n as We,o as be,H as Ge,p as P,d as Qe,u as R,B as Je,a as Ye,b as K,q as Z,r as ee,e as Xe,L as T,I as Ze,f as he,J as ye,K as et,M as Ne,N as tt,O as st,Q as nt}from"./api-BgrBwReI.js";import{t as U,u as rt}from"./index-JVv6katd.js";import{g as ot,E as L,a as E,b as O,c as F,d as V,u as at}from"./empty-TlmgxYvO.js";import{m as it,T as ae,a as ie,b as M,c as $,F as lt,D as ct,d as dt,e as ut,f as xt,g as mt,h as ht,L as pt,S as ft,i as jt,j as gt,k as vt,l as te}from"./tabs-DnzvJY73.js";import{u as Ce}from"./index-DvJT0nJi.js";import{b as bt}from"./scroll-area-Bnf4hdko.js";import{C as A,B as pe}from"./code-block-CUSGUC3x.js";import"./mutation--h5hHClj.js";const yt=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]],Nt=B("image-off",yt);const Ct=[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]],_t=B("route",Ct);const wt=[["path",{d:"M15 12h-5",key:"r7krc0"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],_e=B("scroll-text",wt);const kt=[["path",{d:"M12 19h8",key:"baeox8"}],["path",{d:"m4 17 6-6-6-6",key:"1yngyt"}]],Tt=B("terminal",kt);const It=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],St=B("triangle-alert",It);var G="Collapsible",[At,we]=ge(G),[Mt,le]=At(G),ke=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,open:o,defaultOpen:a,disabled:r,onOpenChange:i,...u}=t,[m,h]=oe({prop:o,defaultProp:a??!1,onChange:i,caller:G});return e.jsx(Mt,{scope:s,disabled:r,contentId:Ce(),open:m,onOpenToggle:g.useCallback(()=>h(d=>!d),[h]),children:e.jsx(z.div,{"data-state":de(m),"data-disabled":r?"":void 0,...u,ref:n})})});ke.displayName=G;var Te="CollapsibleTrigger",Ie=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,...o}=t,a=le(Te,s);return e.jsx(z.button,{type:"button","aria-controls":a.contentId,"aria-expanded":a.open||!1,"data-state":de(a.open),"data-disabled":a.disabled?"":void 0,disabled:a.disabled,...o,ref:n,onClick:ve(t.onClick,a.onOpenToggle)})});Ie.displayName=Te;var ce="CollapsibleContent",Se=g.forwardRef((t,n)=>{const{forceMount:s,...o}=t,a=le(ce,t.__scopeCollapsible);return e.jsx(We,{present:s||a.open,children:({present:r})=>e.jsx($t,{...o,ref:n,present:r})})});Se.displayName=ce;var $t=g.forwardRef((t,n)=>{const{__scopeCollapsible:s,present:o,children:a,...r}=t,i=le(ce,s),[u,m]=g.useState(o),h=g.useRef(null),d=be(n,h),j=g.useRef(0),p=j.current,f=g.useRef(0),v=f.current,b=i.open||u,x=g.useRef(b),l=g.useRef(void 0);return g.useEffect(()=>{const c=requestAnimationFrame(()=>x.current=!1);return()=>cancelAnimationFrame(c)},[]),Ge(()=>{const c=h.current;if(c){l.current=l.current||{transitionDuration:c.style.transitionDuration,animationName:c.style.animationName},c.style.transitionDuration="0s",c.style.animationName="none";const C=c.getBoundingClientRect();j.current=C.height,f.current=C.width,x.current||(c.style.transitionDuration=l.current.transitionDuration,c.style.animationName=l.current.animationName),m(o)}},[i.open,o]),e.jsx(z.div,{"data-state":de(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!b,...r,ref:d,style:{"--radix-collapsible-content-height":p?`${p}px`:void 0,"--radix-collapsible-content-width":v?`${v}px`:void 0,...t.style},children:b&&a})});function de(t){return t?"open":"closed"}var Rt=ke,Pt=Ie,Dt=Se,I="Accordion",Lt=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[ue,Et,Ot]=it(I),[Q]=ge(I,[Ot,we]),xe=we(),Ae=_.forwardRef((t,n)=>{const{type:s,...o}=t,a=o,r=o;return e.jsx(ue.Provider,{scope:t.__scopeAccordion,children:s==="multiple"?e.jsx(qt,{...r,ref:n}):e.jsx(Ht,{...a,ref:n})})});Ae.displayName=I;var[Me,Ft]=Q(I),[$e,Vt]=Q(I,{collapsible:!1}),Ht=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},collapsible:r=!1,...i}=t,[u,m]=oe({prop:s,defaultProp:o??"",onChange:a,caller:I});return e.jsx(Me,{scope:t.__scopeAccordion,value:_.useMemo(()=>u?[u]:[],[u]),onItemOpen:m,onItemClose:_.useCallback(()=>r&&m(""),[r,m]),children:e.jsx($e,{scope:t.__scopeAccordion,collapsible:r,children:e.jsx(Re,{...i,ref:n})})})}),qt=_.forwardRef((t,n)=>{const{value:s,defaultValue:o,onValueChange:a=()=>{},...r}=t,[i,u]=oe({prop:s,defaultProp:o??[],onChange:a,caller:I}),m=_.useCallback(d=>u((j=[])=>[...j,d]),[u]),h=_.useCallback(d=>u((j=[])=>j.filter(p=>p!==d)),[u]);return e.jsx(Me,{scope:t.__scopeAccordion,value:i,onItemOpen:m,onItemClose:h,children:e.jsx($e,{scope:t.__scopeAccordion,collapsible:!0,children:e.jsx(Re,{...r,ref:n})})})}),[Bt,J]=Q(I),Re=_.forwardRef((t,n)=>{const{__scopeAccordion:s,disabled:o,dir:a,orientation:r="vertical",...i}=t,u=_.useRef(null),m=be(u,n),h=Et(s),j=bt(a)==="ltr",p=ve(t.onKeyDown,f=>{if(!Lt.includes(f.key))return;const v=f.target,b=h().filter(Y=>!Y.ref.current?.disabled),x=b.findIndex(Y=>Y.ref.current===v),l=b.length;if(x===-1)return;f.preventDefault();let c=x;const C=0,S=l-1,H=()=>{c=x+1,c>S&&(c=C)},q=()=>{c=x-1,c<C&&(c=S)};switch(f.key){case"Home":c=C;break;case"End":c=S;break;case"ArrowRight":r==="horizontal"&&(j?H():q());break;case"ArrowDown":r==="vertical"&&H();break;case"ArrowLeft":r==="horizontal"&&(j?q():H());break;case"ArrowUp":r==="vertical"&&q();break}const Be=c%l;b[Be].ref.current?.focus()});return e.jsx(Bt,{scope:s,disabled:o,direction:a,orientation:r,children:e.jsx(ue.Slot,{scope:s,children:e.jsx(z.div,{...i,"data-orientation":r,ref:m,onKeyDown:o?void 0:p})})})}),W="AccordionItem",[zt,me]=Q(W),Pe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,value:o,...a}=t,r=J(W,s),i=Ft(W,s),u=xe(s),m=Ce(),h=o&&i.value.includes(o)||!1,d=r.disabled||t.disabled;return e.jsx(zt,{scope:s,open:h,disabled:d,triggerId:m,children:e.jsx(Rt,{"data-orientation":r.orientation,"data-state":Ve(h),...u,...a,ref:n,disabled:d,open:h,onOpenChange:j=>{j?i.onItemOpen(o):i.onItemClose(o)}})})});Pe.displayName=W;var De="AccordionHeader",Le=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(I,s),r=me(De,s);return e.jsx(z.h3,{"data-orientation":a.orientation,"data-state":Ve(r.open),"data-disabled":r.disabled?"":void 0,...o,ref:n})});Le.displayName=De;var ne="AccordionTrigger",Ee=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(I,s),r=me(ne,s),i=Vt(ne,s),u=xe(s);return e.jsx(ue.ItemSlot,{scope:s,children:e.jsx(Pt,{"aria-disabled":r.open&&!i.collapsible||void 0,"data-orientation":a.orientation,id:r.triggerId,...u,...o,ref:n})})});Ee.displayName=ne;var Oe="AccordionContent",Fe=_.forwardRef((t,n)=>{const{__scopeAccordion:s,...o}=t,a=J(I,s),r=me(Oe,s),i=xe(s);return e.jsx(Dt,{role:"region","aria-labelledby":r.triggerId,"data-orientation":a.orientation,...i,...o,ref:n,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...t.style}})});Fe.displayName=Oe;function Ve(t){return t?"open":"closed"}var Kt=Ae,Ut=Pe,Wt=Le,Gt=Ee,Qt=Fe;function Jt({...t}){return e.jsx(Kt,{"data-slot":"accordion",...t})}function Yt({className:t,...n}){return e.jsx(Ut,{"data-slot":"accordion-item",className:P("border-b last:border-b-0",t),...n})}function Xt({className:t,children:n,...s}){return e.jsx(Wt,{className:"flex min-w-0",children:e.jsxs(Gt,{"data-slot":"accordion-trigger",className:P("group focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 min-w-0 items-start justify-between gap-4 rounded-md py-4 text-left text-sm transition-all outline-none focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...s,children:[n,e.jsx(ot,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function Zt({className:t,children:n,...s}){return e.jsx(Qt,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...s,children:e.jsx("div",{className:P("pt-0 pb-4",t),children:n})})}function y({className:t,...n}){return e.jsx("div",{"data-slot":"card",className:P("bg-card text-card-foreground flex flex-col gap-6 border py-6",t),...n})}function w({className:t,...n}){return e.jsx("div",{"data-slot":"card-header",className:P("flex flex-col gap-1.5 px-6",t),...n})}function k({className:t,...n}){return e.jsx("div",{"data-slot":"card-title",className:P("leading-none font-semibold",t),...n})}function N({className:t,...n}){return e.jsx("div",{"data-slot":"card-content",className:P("px-6",t),...n})}function es({src:t,path:n}){const[s,o]=g.useState(null),a=async()=>{try{const r=await fetch(t);let i=r.statusText||"Failed to load image";if(!r.ok)try{i=(await r.json()).detail||i}catch{}o({status:r.status,message:i})}catch{o({status:0,message:"Network error"})}};return s?e.jsx("div",{className:"my-2",children:e.jsxs("div",{className:"text-sm bg-muted/50 rounded border border-dashed border-muted-foreground/50 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-2",children:[e.jsx(Nt,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Image unavailable"}),s.status>0&&e.jsx("span",{className:"text-xs bg-muted px-1.5 py-0.5 rounded",children:s.status})]}),e.jsx("div",{className:"text-xs font-mono text-muted-foreground/80 break-all",children:n}),e.jsx("div",{className:"text-xs text-muted-foreground/60 mt-2",children:s.message})]})}):e.jsxs("div",{className:"my-2",children:[e.jsx("img",{src:t,alt:`Image: ${n}`,className:"max-w-full h-auto rounded border border-border",style:{maxHeight:"400px"},loading:"lazy",onError:a}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:n})]})}function ts(t){return t==null?"":typeof t=="string"?t:t.filter(n=>n.type==="text").map(n=>n.text||"").join(`
`)}function ss(t){return ts(t)?.split(`
`)[0]||null}function He({content:t,jobName:n,trialName:s,className:o=""}){return t==null?e.jsx("span",{className:"text-muted-foreground italic",children:"(empty)"}):typeof t=="string"?e.jsx("div",{className:`text-sm whitespace-pre-wrap break-words ${o}`,children:t||e.jsx("span",{className:"text-muted-foreground italic",children:"(empty)"})}):e.jsx("div",{className:`space-y-3 ${o}`,children:t.map((a,r)=>{if(a.type==="text")return e.jsx("div",{className:"text-sm whitespace-pre-wrap break-words",children:a.text},r);if(a.type==="image"&&a.source){const i=`/api/jobs/${encodeURIComponent(n)}/trials/${encodeURIComponent(s)}/files/agent/${a.source.path}`;return e.jsx(es,{src:i,path:a.source.path},r)}return null})})}function ns({content:t,jobName:n,trialName:s}){return t==null?e.jsx("span",{className:"text-muted-foreground italic",children:"(empty)"}):e.jsx(He,{content:t,jobName:n,trialName:s})}function rs(t){return t?new Date(t).toLocaleString():"-"}function qe(t,n){if(!t)return"-";const s=new Date(t).getTime(),a=(n?new Date(n).getTime():Date.now())-s,r=Math.floor(a/1e3),i=Math.floor(r/60),u=Math.floor(i/60);return u>0?`${u}h ${i%60}m ${r%60}s`:i>0?`${i}m ${r%60}s`:`${r}s`}function os(t){if(!t?.started_at)return 0;const n=new Date(t.started_at).getTime();return(t.finished_at?new Date(t.finished_at).getTime():Date.now())-n}function as({segments:t,totalLabel:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.reduce((x,l)=>x+l.value,0);if(i===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No token data"})]});const u=1,m=t.map(x=>x.value>0?x.value/i*100:0),h=m.map(x=>x>0&&x<u),d=h.reduce((x,l,c)=>l?x+(u-m[c]):x,0),j=m.reduce((x,l,c)=>!h[c]&&l>0?x+l:x,0),p=j>0?(j-d)/j:1,f=m.map((x,l)=>x===0?0:h[l]?u:x*p),v=[];let b=0;for(let x=0;x<f.length;x++)v.push(b),b+=f[x];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t[s].value.toLocaleString()," tokens"]})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((x,l)=>{if(x.value===0)return null;const c=f[l],C=s!==null&&s!==l,S=v[l]+c/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${c}%`,backgroundColor:x.color,opacity:C?.3:1},onMouseEnter:()=>{o(l),r(S)},onMouseLeave:()=>o(null)},x.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((x,l)=>{if(x.value===0)return null;const c=h[l];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:x.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[x.label,c&&" (scaled)"]})]},x.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function is({phases:t,totalDuration:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0),i=t.map(l=>os(l.timing)),u=i.reduce((l,c)=>l+c,0);if(u===0)return e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 bg-muted rounded"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"No timing data"})]});const m=1,h=i.map(l=>l>0?l/u*100:0),d=h.map(l=>l>0&&l<m),j=d.reduce((l,c,C)=>c?l+(m-h[C]):l,0),p=h.reduce((l,c,C)=>!d[C]&&c>0?l+c:l,0),f=p>0?(p-j)/p:1,v=h.map((l,c)=>l===0?0:d[c]?m:l*f),b=[];let x=0;for(let l=0;l<v.length;l++)b.push(x),x+=v[l];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium",children:t[s].label}),e.jsx("div",{className:"text-sm text-muted-foreground",children:qe(t[s].timing?.started_at??null,t[s].timing?.finished_at??null)})]})}),e.jsx("div",{className:"flex h-8 overflow-hidden",children:t.map((l,c)=>{if(i[c]===0)return null;const S=v[c],H=s!==null&&s!==c,q=b[c]+S/2;return e.jsx("div",{className:"transition-opacity duration-150",style:{width:`${S}%`,backgroundColor:l.color,opacity:H?.3:1},onMouseEnter:()=>{o(c),r(q)},onMouseLeave:()=>o(null)},l.label)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex gap-4",children:t.map((l,c)=>{if(i[c]===0)return null;const S=d[c];return e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{backgroundColor:l.color}}),e.jsxs("span",{className:"text-muted-foreground",children:[l.label,S&&" (scaled)"]})]},l.label)})}),e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function se({label:t,value:n,className:s,showBorder:o=!0}){return e.jsxs("div",{className:`flex justify-between py-1 text-sm ${o?"border-b border-border last:border-0":""}`,children:[e.jsx("span",{className:"text-muted-foreground",children:t}),e.jsx("span",{className:s,children:n})]})}function fe(t,n){if(!t||!n)return null;const s=new Date(t).getTime(),a=new Date(n).getTime()-s;return a<0?null:re(a)}function re(t){const n=t/1e3;if(n<60)return`${n.toFixed(1)}s`;const s=Math.floor(n/60),o=n%60;return`${s}m ${o.toFixed(0)}s`}function ls({step:t,jobName:n,trialName:s}){const a={agent:"text-purple-600 dark:text-purple-300"}.agent;return e.jsxs("div",{className:"space-y-3",children:[t.message&&e.jsx(He,{content:t.message,jobName:n,trialName:s}),t.reasoning_content&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Reasoning"}),e.jsx("pre",{className:"text-xs bg-muted p-2 overflow-x-auto whitespace-pre-wrap",children:t.reasoning_content})]}),t.tool_calls&&t.tool_calls.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Tool Calls"}),t.tool_calls.map(r=>e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:`text-xs font-mono mb-1 ${a}`,children:r.function_name}),e.jsx(A,{code:JSON.stringify(r.arguments,null,2),lang:"json"})]},r.tool_call_id))]}),t.observation&&t.observation.results.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Observations"}),t.observation.results.map((r,i)=>e.jsx("div",{className:"mb-2",children:e.jsx(ns,{content:r.content,jobName:n,trialName:s})},i))]}),t.metrics&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Tokens: ",(t.metrics.prompt_tokens??0).toLocaleString()," prompt /"," ",(t.metrics.completion_tokens??0).toLocaleString()," completion",t.metrics.cost_usd&&` / $${t.metrics.cost_usd.toFixed(4)}`]})]})}function cs({step:t,prevTimestamp:n,startTimestamp:s}){const o={system:"text-gray-600 dark:text-gray-300",user:"text-blue-600 dark:text-blue-300",agent:"text-purple-600 dark:text-purple-300"},a=fe(n,t.timestamp),r=fe(s,t.timestamp),i=ss(t.message);return e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 min-w-0 flex items-center gap-2 overflow-hidden",children:[e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:["#",t.step_id]}),e.jsx("span",{className:`text-xs font-medium shrink-0 ${o[t.source]}`,children:t.source}),t.model_name&&e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model_name}),e.jsx("span",{className:"text-xs truncate min-w-0 transition-colors group-data-[state=open]:text-border",children:i||e.jsx("span",{className:"text-muted-foreground italic",children:"No message"})})]}),(r||a)&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground shrink-0",children:[a&&e.jsxs(pe,{variant:"secondary",className:"text-xs font-normal",children:["+",a]}),r&&e.jsx(pe,{variant:"outline",className:"text-xs font-normal",children:r})]})]})}function ds(t){const n=["var(--color-neutral-400)","var(--color-neutral-500)","var(--color-neutral-600)","var(--color-neutral-700)"],s=t%6,o=s<=3?s:6-s;return n[o]}function us({steps:t,onStepClick:n}){const[s,o]=g.useState(null),[a,r]=g.useState(0);if(t.length===0)return null;const i=t[0].timestamp?new Date(t[0].timestamp).getTime():0,u=t.map((p,f)=>{const v=p.timestamp?new Date(p.timestamp).getTime():0,b=f>0?t[f-1]:null,x=b?.timestamp?new Date(b.timestamp).getTime():v;return{stepId:p.step_id,durationMs:Math.max(0,v-x),elapsedMs:v-i}}),m=u.reduce((p,f)=>p+f.durationMs,0);if(m===0)return e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"h-6 bg-muted"})});const h=u.map(p=>p.durationMs/m*100),d=[];let j=0;for(const p of h)d.push(j),j+=p;return e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[s!==null&&e.jsx("div",{className:"absolute bottom-full mb-2 z-10 -translate-x-1/2 pointer-events-none",style:{left:`${a}%`},children:e.jsxs("div",{className:"bg-popover border border-border rounded-md shadow-md px-3 py-2 whitespace-nowrap",children:[e.jsxs("div",{className:"text-sm font-medium",children:["Step #",u[s].stepId]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Duration: ",re(u[s].durationMs)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Started at: ",re(u[s].elapsedMs)]})]})}),e.jsx("div",{className:"flex h-6 overflow-hidden",children:u.map((p,f)=>{if(p.durationMs===0)return null;const v=h[f],b=s!==null&&s!==f,x=d[f]+v/2;return e.jsx("div",{className:"transition-opacity duration-150 cursor-pointer",style:{width:`${v}%`,backgroundColor:ds(f),opacity:b?.3:1},onMouseEnter:()=>{o(f),r(x)},onMouseLeave:()=>o(null),onClick:()=>n(f)},p.stepId)})})]})})}function xs({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["trajectory",t,n],queryFn:()=>ye(t,n)}),[a,r]=g.useState([]),i=g.useRef([]);if(o)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trajectory"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]});if(!s)return e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_t,{})}),e.jsx(F,{children:"No trajectory"}),e.jsxs(V,{children:["No ATIF trajectory found at ",n,"/agent/trajectory.json"]})]})});const u=m=>{const h=`step-${m}`;r(d=>d.includes(h)?d:[...d,h]),i.current[m]?.scrollIntoView({behavior:"smooth",block:"start"})};return e.jsxs(y,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Trajectory"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.steps.length," steps",s.final_metrics?.total_cost_usd&&e.jsxs(e.Fragment,{children:[" / $",s.final_metrics.total_cost_usd.toFixed(4)," total"]})]})]}),e.jsxs(N,{children:[e.jsx(us,{steps:s.steps,onStepClick:u}),e.jsx(Jt,{type:"multiple",value:a,onValueChange:r,children:s.steps.map((m,h)=>e.jsxs(Yt,{value:`step-${h}`,ref:d=>{i.current[h]=d},children:[e.jsx(Xt,{children:e.jsx(cs,{step:m,prevTimestamp:h>0?s.steps[h-1]?.timestamp??null:null,startTimestamp:s.steps[0]?.timestamp??null})}),e.jsx(Zt,{children:e.jsx(ls,{step:m,jobName:t,trialName:n})})]},m.step_id))})]})]})}function ms({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["verifier-output",t,n],queryFn:()=>et(t,n)});if(o)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Verifier Output"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]});const a=!!s?.stdout,r=!!s?.ctrf;return!a&&!r?e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_e,{})}),e.jsx(F,{children:"No verifier logs"}),e.jsx(V,{children:"No test output or CTRF results found"})]})}):a&&r?e.jsx(y,{className:"py-0 gap-0",children:e.jsx(N,{className:"p-0",children:e.jsxs(ae,{defaultValue:"stdout",children:[e.jsxs(ie,{children:[e.jsx(M,{value:"stdout",children:"Output"}),e.jsx(M,{value:"ctrf",children:"CTRF"})]}),e.jsx($,{value:"stdout",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.stdout,lang:"text"})}),e.jsx($,{value:"ctrf",className:"mt-0 -mx-px",children:e.jsx(A,{code:s.ctrf,lang:"json"})})]})})}):a?e.jsx(A,{code:s.stdout,lang:"text"}):e.jsx(A,{code:s.ctrf,lang:"json"})}function hs({jobName:t,trialName:n}){const s=rt(),[o,a]=g.useState(!1),[r,i]=g.useState("haiku"),u=at({mutationFn:()=>Ze(t,n,r),onSuccess:()=>{s.invalidateQueries({queryKey:["agent-logs",t,n]}),a(!1),U.success("Summary generated")},onError:m=>{U.error("Failed to generate summary",{description:m.message})}});return e.jsxs(ct,{open:o,onOpenChange:a,children:[e.jsx(dt,{asChild:!0,children:e.jsx(he,{children:"Generate Summary"})}),e.jsxs(ut,{children:[e.jsxs(xt,{children:[e.jsx(mt,{children:"Generate Summary"}),e.jsx(ht,{children:"Use Claude to analyze this trial and generate a summary."})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(pt,{htmlFor:"model",children:"Model"}),e.jsxs(ft,{value:r,onValueChange:i,children:[e.jsx(jt,{id:"model",children:e.jsx(gt,{})}),e.jsxs(vt,{children:[e.jsx(te,{value:"haiku",children:"Haiku (Recommended)"}),e.jsx(te,{value:"sonnet",children:"Sonnet"}),e.jsx(te,{value:"opus",children:"Opus"})]})]})]}),e.jsx(he,{className:"w-full",onClick:()=>u.mutate(),disabled:u.isPending,children:u.isPending?e.jsx(T,{text:"Generating"}):"Generate"})]})]})]})}function ps({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});return o?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Summary"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]}):s?.summary?e.jsx(A,{code:s.summary,lang:"markdown",wrap:!0}):e.jsxs(L,{className:"bg-card border",children:[e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(lt,{})}),e.jsx(F,{children:"No summary"}),e.jsx(V,{children:"Generate a summary of this trial using Claude."})]}),e.jsx(hs,{jobName:t,trialName:n})]})}function fs({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["exception",t,n],queryFn:()=>tt(t,n)});return o?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Exception"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]}):s?e.jsx(A,{code:s,lang:"text"}):e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(St,{})}),e.jsx(F,{children:"No exception"}),e.jsx(V,{children:"No exception.txt file found in this trial."})]})})}function js({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["trial-log",t,n],queryFn:()=>st(t,n)});return o?e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Trial Log"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]}):s?e.jsx(A,{code:s,lang:"text"}):e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(_e,{})}),e.jsx(F,{children:"No trial log"}),e.jsx(V,{children:"No trial.log file found in this trial."})]})})}function gs({jobName:t,trialName:n}){const{data:s,isLoading:o}=R({queryKey:["agent-logs",t,n],queryFn:()=>Ne(t,n)});if(o)return e.jsxs(y,{children:[e.jsx(w,{children:e.jsx(k,{children:"Agent Logs"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]});if(!(s&&(s.oracle||s.setup||s.commands.length>0)))return e.jsx(L,{className:"bg-card border",children:e.jsxs(E,{children:[e.jsx(O,{variant:"icon",children:e.jsx(Tt,{})}),e.jsx(F,{children:"No agent logs"}),e.jsx(V,{children:"No oracle, setup, or command logs found"})]})});const r=[];s.oracle&&r.push({id:"oracle",label:"Oracle",content:s.oracle,lang:"text"}),s.setup&&r.push({id:"setup",label:"Setup",content:s.setup,lang:"text"});for(const i of s.commands)r.push({id:`command-${i.index}`,label:`Command ${i.index}`,content:i.content,lang:"text"});return r.length===0?null:e.jsx(y,{className:"py-0 gap-0",children:e.jsx(N,{className:"p-0",children:e.jsxs(ae,{defaultValue:r[0].id,children:[e.jsx(ie,{children:r.map(i=>e.jsx(M,{value:i.id,children:i.label},i.id))}),r.map(i=>e.jsx($,{value:i.id,className:"mt-0 -mx-px",children:e.jsx(A,{code:i.content,lang:i.lang})},i.id))]})})})}function vs(t){const n=["harbor run"];t.source&&n.push(`-d ${t.source}`),n.push(`-t ${t.task_name}`),n.push(`-a ${t.agent_info.name}`);const s=t.agent_info.model_info;if(s){const o=s.provider?`${s.provider}/${s.name}`:s.name;n.push(`-m ${o}`)}return n.join(" ")}function D({value:t}){const n=async()=>{await navigator.clipboard.writeText(t),U("Copied to clipboard",{description:t})};return e.jsx("span",{onClick:n,className:"cursor-default hover:opacity-70 transition-opacity",children:t})}function je(t,n){return`/jobs/${encodeURIComponent(t)}/tasks/${encodeURIComponent(n.source)}/${encodeURIComponent(n.agent)}/${encodeURIComponent(n.modelProvider)}/${encodeURIComponent(n.modelName)}/${encodeURIComponent(n.taskName)}`}function bs({trial:t,jobName:n,trialName:s}){const{data:o}=R({queryKey:["trajectory",n,s],queryFn:()=>ye(n,s)}),a=t.verifier_result?.rewards?.reward??null,r=o?.final_metrics;return e.jsxs(e.Fragment,{children:[e.jsx(A,{code:vs(t),lang:"bash",className:"-mb-px -mx-px"}),e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(y,{className:"-mb-px gap-3 py-4",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between",children:[e.jsx(k,{children:"Outcome"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:rs(t.started_at)})]}),e.jsxs(N,{children:[e.jsx(se,{label:"Reward",value:a!==null?a.toFixed(2):"-",showBorder:!1}),r?.total_cost_usd&&e.jsx(se,{label:"Cost",value:`$${r.total_cost_usd.toFixed(4)}`,showBorder:!1}),t.exception_info&&e.jsx(se,{label:"Error",value:e.jsx(D,{value:t.exception_info.exception_type}),className:"text-destructive",showBorder:!1})]})]}),e.jsxs(y,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(N,{children:e.jsx(as,{segments:[{label:"Cached",value:r?.total_cached_tokens??0,color:"var(--color-neutral-400)"},{label:"Prompt",value:Math.max(0,(r?.total_prompt_tokens??0)-(r?.total_cached_tokens??0)),color:"var(--color-neutral-500)"},{label:"Output",value:r?.total_completion_tokens??0,color:"var(--color-neutral-600)"}],totalLabel:`${((r?.total_prompt_tokens??0)+(r?.total_completion_tokens??0)).toLocaleString()} tokens`})})]}),e.jsxs(y,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(N,{children:e.jsx(is,{phases:[{label:"Env Setup",timing:t.environment_setup,color:"var(--color-neutral-400)"},{label:"Agent Setup",timing:t.agent_setup,color:"var(--color-neutral-500)"},{label:"Agent Execution",timing:t.agent_execution,color:"var(--color-neutral-600)"},{label:"Verifier",timing:t.verifier,color:"var(--color-neutral-700)"}],totalDuration:qe(t.started_at,t.finished_at)})})]})]}),e.jsxs(ae,{defaultValue:"trajectory",className:"mt-6",children:[e.jsxs(ie,{className:"bg-card border border-b-0 w-full",children:[e.jsx(M,{value:"trajectory",children:"Trajectory"}),e.jsx(M,{value:"agent-logs",children:"Agent Logs"}),e.jsx(M,{value:"test-output",children:"Verifier Logs"}),e.jsx(M,{value:"trial-log",children:"Trial Log"}),e.jsx(M,{value:"summary",children:"Summary"}),e.jsx(M,{value:"exception",children:"Exception"})]}),e.jsx($,{value:"trajectory",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(xs,{jobName:n,trialName:s})}),e.jsx($,{value:"agent-logs",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(gs,{jobName:n,trialName:s})}),e.jsx($,{value:"test-output",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ms,{jobName:n,trialName:s})}),e.jsx($,{value:"trial-log",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(js,{jobName:n,trialName:s})}),e.jsx($,{value:"summary",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(ps,{jobName:n,trialName:s})}),e.jsx($,{value:"exception",forceMount:!0,className:"data-[state=inactive]:hidden",children:e.jsx(fs,{jobName:n,trialName:s})})]})]})}function ys(){return e.jsxs("div",{className:"grid grid-cols-1 -mx-px",children:[e.jsxs(y,{className:"-mb-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Outcome"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]}),e.jsxs(y,{className:"-mb-px -mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Tokens"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]}),e.jsxs(y,{className:"-mt-px gap-3 py-4",children:[e.jsx(w,{children:e.jsx(k,{children:"Timing"})}),e.jsx(N,{children:e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})})})]})]})}const Ms=ze(function(){const{jobName:n,trialName:s,source:o,agent:a,modelProvider:r,modelName:i,taskName:u}=Ke(),m=Ue(),h={source:o,agent:a,modelProvider:r,modelName:i,taskName:u};Qe("escape",()=>m(je(n,h)),{enableOnFormTags:!1});const{data:d,isLoading:j,error:p}=R({queryKey:["trial",n,s],queryFn:()=>nt(n,s),enabled:!!n&&!!s});return e.jsxs("div",{className:"container mx-auto py-10",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(Je,{className:"mb-4",children:e.jsxs(Ye,{children:[e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:"/",children:"Jobs"})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:`/jobs/${encodeURIComponent(n)}`,children:n})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Z,{asChild:!0,children:e.jsx(X,{to:je(n,h),children:u})})}),e.jsx(ee,{}),e.jsx(K,{children:e.jsx(Xe,{children:s})})]})}),e.jsx("h1",{className:"text-4xl font-medium mb-4 w-fit cursor-default hover:text-foreground/80 transition-colors",onClick:async()=>{await navigator.clipboard.writeText(s),U("Copied to clipboard",{description:s})},children:s}),j?e.jsx("div",{className:"text-sm text-muted-foreground",children:e.jsx(T,{})}):d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 text-sm text-muted-foreground",children:[d.source&&e.jsxs(e.Fragment,{children:[e.jsx(D,{value:d.source}),e.jsx("span",{className:"text-border",children:"|"})]}),e.jsx(D,{value:d.task_name}),e.jsx("span",{className:"text-border",children:"|"}),e.jsx(D,{value:d.agent_info.version&&d.agent_info.version!=="unknown"?`${d.agent_info.name}@${d.agent_info.version}`:d.agent_info.name}),d.agent_info.model_info&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsx(D,{value:`${d.agent_info.model_info.provider}/${d.agent_info.model_info.name}`})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-3",children:e.jsx(D,{value:d.trial_uri.startsWith("file://")?d.trial_uri.slice(7):d.trial_uri})})]}):null]}),!j&&(p||!d)?e.jsx("div",{className:"text-destructive",children:p instanceof Error?p.message:"Failed to load trial"}):j?e.jsx(ys,{}):d?e.jsx(bs,{trial:d,jobName:n,trialName:s}):null]})});export{Ms as default};
